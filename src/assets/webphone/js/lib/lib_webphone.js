webphone_api.platformClass=function(){"use strict";function e(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function o(e,o,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return o&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),o&&n&&(e=e.replace(RegExp(o,"i"),n)),e=t(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function n(e,o){var n=-1,t=e?e.length:0;if("number"==typeof t&&t>-1&&t<=d)for(;++n<t;)o(e[n],n,e);else i(e,o)}function t(o){return o=s(o),/^(?:webOS|i(?:OS|P))/.test(o)?o:e(o)}function i(e,o){for(var n in e)f.call(e,n)&&o(e[n],n,e)}function a(o){return null==o?e(o):v.call(o).slice(8,-1)}function r(e,o){var n=null!=e?typeof e[o]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[o])}function l(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function p(e,o){var t=null;return n(e,function(n,i){t=o(t,n,i,e)}),t}function s(e){return String(e).replace(/^ +| +$/g,"")}function c(e){function n(o){return p(o,function(o,n){var i=n.pattern||l(n);return!o&&(o=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((o=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:o).split("/"))[1]&&!/[\d.]+/.test(o[0])&&(o[0]+=" "+o[1]),n=n.label||n,o=t(o[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),o})}function u(){return this.description||""}var m=g,b=e&&"object"==typeof e&&"String"!=a(e);b&&(m=e,e=null);var h=m.navigator||{},d=h.userAgent||"";e||(e=d);var w,f=b?!!h.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(v.toString()),P=b?"Object":"ScriptBridgingProxyObject",E=b?"Object":"Environment",T=b&&m.java?"JavaPackage":a(m.java),N=b?"Object":"RuntimeObject",S=/\bJava/.test(T)&&m.java,I=S&&a(m.environment)==E,R=S?"a":"α",G=S?"b":"β",O=m.document||{},L=m.operamini||m.opera;try{w=_.test(w=b&&L?L["[[Class]]"]:a(L))?w:L=null}catch($){}var C,D,y=e,x=[],A=null,k=e==d,U=k&&L&&"function"==typeof L.version&&L.version(),V=function(o){return p(o,function(o,n){return o||RegExp("\\b"+(n.pattern||l(n))+"\\b","i").exec(e)&&(n.label||n)})}([{label:"EdgeHTML",pattern:"(?:Edge|EdgA|EdgiOS)"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),W=function(o){return p(o,function(o,n){return o||RegExp("\\b"+(n.pattern||l(n))+"\\b","i").exec(e)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),M=n([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),F=function(o){return p(o,function(o,n,t){return o||(n[M]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(M)]||RegExp("\\b"+l(t)+"(?:\\b|\\w*\\d)","i").exec(e))&&t})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),H=function(n){return p(n,function(n,t){var i=t.pattern||l(t);return!n&&(n=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(n=o(n,i,t.label||t)),n})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(V&&(V=[V]),F&&!M&&(M=n([F])),(C=/\bGoogle TV\b/.exec(M))&&(M=C[0]),/\bSimulator\b/i.test(e)&&(M=(M?M+" ":"")+"Simulator"),"Opera Mini"==W&&/\bOPiOS\b/.test(e)&&x.push("running in Turbo/Uncompressed mode"),"IE"==W&&/\blike iPhone OS\b/.test(e)?(C=c(e.replace(/like iPhone OS/,"")),F=C.manufacturer,M=C.product):/^iP/.test(M)?(W||(W="Safari"),H="iOS"+((C=/ OS ([\d_]+)/i.exec(e))?" "+C[1].replace(/_/g,"."):"")):"Konqueror"!=W||/buntu/i.test(H)?F&&"Google"!=F&&(/Chrome/.test(W)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(M))||/\bAndroid\b/.test(H)&&/^Chrome/.test(W)&&/\bVersion\//i.test(e)?(W="Android Browser",H=/\bAndroid\b/.test(H)?H:"Android"):"Silk"==W?(/\bMobi/i.test(e)||(H="Android",x.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&x.unshift("accelerated")):"PaleMoon"==W&&(C=/\bFirefox\/([\d.]+)\b/.exec(e))?x.push("identifying as Firefox "+C[1]):"Firefox"==W&&(C=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(H||(H="Firefox OS"),M||(M=C[1])):!W||(C=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(W))?(W&&!M&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(C+"/")+8))&&(W=null),(C=M||F||H)&&(M||F||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H))&&(W=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H)?H:C)+" Browser")):"Electron"==W&&(C=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&x.push("Chromium "+C):H="Kubuntu",U||(U=function(o){return p(o,function(o,n){return o||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",l(W),"(?:Firefox|Minefield|NetFront)"])),(C="iCab"==V&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test(W)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(V)&&"WebKit"||!V&&/\bMSIE\b/i.test(e)&&("Mac OS"==H?"Tasman":"Trident")||"WebKit"==V&&/\bPlayStation\b(?! Vita\b)/i.test(W)&&"NetFront")&&(V=[C]),"IE"==W&&(C=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(W+=" Mobile",H="Windows Phone "+(/\+$/.test(C)?C:C+".x"),x.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(W="IE Mobile",H="Windows Phone 8.x",x.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=W&&"Trident"==V&&(C=/\brv:([\d.]+)/.exec(e))&&(W&&x.push("identifying as "+W+(U?" "+U:"")),W="IE",U=C[1]),k){if(r(m,"global"))if(S&&(C=S.lang.System,y=C.getProperty("os.arch"),H=H||C.getProperty("os.name")+" "+C.getProperty("os.version")),I){try{U=m.require("ringo/engine").version.join("."),W="RingoJS"}catch(j){(C=m.system)&&C.global.system==m.system&&(W="Narwhal",H||(H=C[0].os||null))}W||(W="Rhino")}else"object"==typeof m.process&&!m.process.browser&&(C=m.process)&&("object"==typeof C.versions&&("string"==typeof C.versions.electron?(x.push("Node "+C.versions.node),W="Electron",U=C.versions.electron):"string"==typeof C.versions.nw&&(x.push("Chromium "+U,"Node "+C.versions.node),W="NW.js",U=C.versions.nw)),W||(W="Node.js",y=C.arch,H=C.platform,U=/[\d.]+/.exec(C.version),U=U?U[0]:null));else a(C=m.runtime)==P?(W="Adobe AIR",H=C.flash.system.Capabilities.os):a(C=m.phantom)==N?(W="PhantomJS",U=(C=C.version||null)&&C.major+"."+C.minor+"."+C.patch):"number"==typeof O.documentMode&&(C=/\bTrident\/(\d+)/i.exec(e))?(U=[U,O.documentMode],(C=+C[1]+4)!=U[1]&&(x.push("IE "+U[1]+" mode"),V&&(V[1]=""),U[1]=C),U="IE"==W?String(U[1].toFixed(1)):U[0]):"number"==typeof O.documentMode&&/^(?:Chrome|Firefox)\b/.test(W)&&(x.push("masking as "+W+" "+U),W="IE",U="11.0",V=["Trident"],H="Windows");H=H&&t(H)}if(U&&(C=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(k&&h.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(A=/b/i.test(C)?"beta":"alpha",U=U.replace(RegExp(C+"\\+?$"),"")+("beta"==A?G:R)+(/\d+\+?/.exec(C)||"")),"Fennec"==W||"Firefox"==W&&/\b(?:Android|Firefox OS)\b/.test(H))W="Firefox Mobile";else if("Maxthon"==W&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(M))"Xbox 360"==M&&(H=null),"Xbox 360"==M&&/\bIEMobile\b/.test(e)&&x.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(W)&&(!W||M||/Browser|Mobi/.test(W))||"Windows CE"!=H&&!/Mobi/i.test(e))if("IE"==W&&k)try{null===m.external&&x.unshift("platform preview")}catch(j){x.unshift("embedded")}else(/\bBlackBerry\b/.test(M)||/\bBB10\b/.test(e))&&(C=(RegExp(M.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||U)?(C=[C,/BB10/.test(e)],H=(C[1]?(M=null,F="BlackBerry"):"Device Software")+" "+C[0],U=null):this!=i&&"Wii"!=M&&(k&&L||/Opera/.test(W)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==W&&/\bOS X (?:\d+\.){2,}/.test(H)||"IE"==W&&(H&&!/^Win/.test(H)&&U>5.5||/\bWindows XP\b/.test(H)&&U>8||8==U&&!/\bTrident\b/.test(e)))&&!_.test(C=c.call(i,e.replace(_,"")+";"))&&C.name&&(C="ing as "+C.name+((C=C.version)?" "+C:""),_.test(W)?(/\bIE\b/.test(C)&&"Mac OS"==H&&(H=null),C="identify"+C):(C="mask"+C,W=w?t(w.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(C)&&(H=null),k||(U=null)),V=["Presto"],x.push(C));else W+=" Mobile";(C=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(C=[parseFloat(C.replace(/\.(\d)$/,".0$1")),C],"Safari"==W&&"+"==C[1].slice(-1)?(W="WebKit Nightly",A="alpha",U=C[1].slice(0,-1)):U!=C[1]&&U!=(C[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(U=null),C[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==C[0]&&537.36==C[2]&&parseFloat(C[1])>=28&&"WebKit"==V&&(V=["Blink"]),k&&(f||C[1])?(V&&(V[1]="like Chrome"),C=C[1]||(C=C[0],C<530?1:C<532?2:C<532.05?3:C<533?4:C<534.03?5:C<534.07?6:C<534.1?7:C<534.13?8:C<534.16?9:C<534.24?10:C<534.3?11:C<535.01?12:C<535.02?"13+":C<535.07?15:C<535.11?16:C<535.19?17:C<536.05?18:C<536.1?19:C<537.01?20:C<537.11?"21+":C<537.13?23:C<537.18?24:C<537.24?25:C<537.36?26:"Blink"!=V?"27":"28")):(V&&(V[1]="like Safari"),C=C[0],C=C<400?1:C<500?2:C<526?3:C<533?4:C<534?"4+":C<535?5:C<537?6:C<538?7:C<601?8:"8"),V&&(V[1]+=" "+(C+="number"==typeof C?".x":/[.+]/.test(C)?"":"+")),"Safari"==W&&(!U||parseInt(U)>45)&&(U=C)),"Opera"==W&&(C=/\bzbov|zvav$/.exec(H))?(W+=" ",x.unshift("desktop mode"),"zvav"==C?(W+="Mini",U=null):W+="Mobile",H=H.replace(RegExp(" *"+C+"$"),"")):"Safari"==W&&/\bChrome\b/.exec(V&&V[1])&&(x.unshift("desktop mode"),W="Chrome Mobile",U=null,/\bOS X\b/.test(H)?(F="Apple",H="iOS 4.3+"):H=null),U&&0==U.indexOf(C=/[\d.]+$/.exec(H))&&e.indexOf("/"+C+"-")>-1&&(H=s(H.replace(C,""))),V&&!/\b(?:Avant|Nook)\b/.test(W)&&(/Browser|Lunascape|Maxthon/.test(W)||"Safari"!=W&&/^iOS/.test(H)&&/\bSafari\b/.test(V[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(W)&&V[1])&&(C=V[V.length-1])&&x.push(C),x.length&&(x=["("+x.join("; ")+")"]),F&&M&&M.indexOf(F)<0&&x.push("on "+F),M&&x.push((/^on /.test(x[x.length-1])?"":"on ")+M),H&&(C=/ ([\d.+]+)$/.exec(H),D=C&&"/"==H.charAt(H.length-C[0].length-1),H={architecture:32,family:C&&!D?H.replace(C[0],""):H,version:C?C[1]:null,toString:function(){var e=this.version;return this.family+(e&&!D?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(C=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(y))&&!/\bi686\b/i.test(y)?(H&&(H.architecture=64,H.family=H.family.replace(RegExp(" *"+C),"")),W&&(/\bWOW64\b/i.test(e)||k&&/\w(?:86|32)$/.test(h.cpuClass||h.platform)&&!/\bWin64; x64\b/i.test(e))&&x.unshift("32-bit")):H&&/^OS X/.test(H.family)&&"Chrome"==W&&parseFloat(U)>=39&&(H.architecture=64),e||(e=null);var B={};return B.description=e,B.layout=V&&V[0],B.manufacturer=F,B.name=W,B.prerelease=A,B.product=M,B.ua=e,B.version=W&&U,B.os=H||{architecture:null,family:null,version:null,toString:function(){return"null"}},B.parse=c,B.toString=u,B.version&&x.unshift(U),B.name&&x.unshift(W),H&&W&&(H!=String(H).split(" ")[0]||H!=W.split(" ")[0]&&!M)&&x.push(M?"("+H+")":"on "+H),x.length&&(B.description=x.join(" ")),B}var u={"function":!0,object:!0},g=u[typeof window]&&window||this,m=u[typeof exports]&&exports,b=u[typeof module]&&module&&!module.nodeType&&module,h=m&&b&&"object"==typeof global&&global;!h||h.global!==h&&h.window!==h&&h.self!==h||(g=h);var d=Math.pow(2,53)-1,_=/\bOpera/,w=Object.prototype,f=w.hasOwnProperty,v=w.toString;webphone_api.platform=c()}(),function(e,o){"use strict";e.webphone_api.picoModal=function(){"use strict";function e(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType}function o(e){return"string"==typeof e}function n(){var e=[];return{watch:e.push.bind(e),trigger:function(o){for(var n=!0,t={preventDefault:function(){n=!1}},i=0;i<e.length;i++)e[i](o,t);return n}}}function t(e){this.elem=e}function i(e,o){return t.div().clazz("pico-overlay").clazz(e("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(e("overlayStyles",{opacity:.5,background:"#000"})).onClick(function(){e("overlayClose",!0)&&o()})}function a(e,o){var n=e("width","auto");return"number"==typeof n&&(n+="px"),t.div().clazz("pico-content").clazz(e("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"50px",width:n,"-ms-transform":"translateX(-50%)","-moz-transform":"translateX(-50%)","-webkit-transform":"translateX(-50%)","-o-transform":"translateX(-50%)",transform:"translateX(-50%)"}).stylize(e("modalStyles",{backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(e("content")).attr("role","dialog").onClick(function(e){new t(e.target).anyAncestor(function(e){return/\bpico-close\b/.test(e.elem.className)})&&o()})}function r(e,o){if(o("closeButton",!0))return e.child().html(o("closeHtml","&#xD7;")).clazz("pico-close").clazz(o("closeClass")).stylize(o("closeStyles",{borderRadius:"2px",cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"}))}function l(e){return function(){return e().elem}}return t.div=function(e){var o=document.createElement("div");return(e||document.body).appendChild(o),new t(o)},t.prototype={child:function(){return t.div(this.elem)},stylize:function(e){e=e||{},"undefined"!=typeof e.opacity&&(e.filter="alpha(opacity="+100*e.opacity+")");for(var o in e)e.hasOwnProperty(o)&&(this.elem.style[o]=e[o]);return this},clazz:function(e){return this.elem.className+=" "+e,this},html:function(o){return e(o)?this.elem.appendChild(o):this.elem.innerHTML=o,this},onClick:function(e){return this.elem.addEventListener("click",e),this},destroy:function(){document.body.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(e,o){return this.elem.setAttribute(e,o),this},anyAncestor:function(e){for(var o=this.elem;o;){if(e(new t(o)))return!0;o=o.parentNode}return!1}},function(t){function p(e,o){var n=t[e];return"function"==typeof n&&(n=n(o)),n===undefined?o:n}function s(){v().hide(),f().hide(),w.trigger(E)}function c(){_.trigger(E)&&s()}function u(e){return function(){return e.apply(this,arguments),E}}function g(e){if(!m){var o=a(p,c);m={modal:o,overlay:i(p,c),close:r(o,p)},b.trigger(E)}return m[e]}(o(t)||e(t))&&(t={content:t});var m,b=n(),h=n(),d=n(),_=n(),w=n(),f=g.bind(window,"modal"),v=g.bind(window,"overlay"),P=g.bind(window,"close"),E={modalElem:l(f),closeElem:l(P),overlayElem:l(v),buildDom:u(g),show:function(){return h.trigger(E)&&(v().show(),P(),f().show(),d.trigger(E)),this},close:u(c),forceClose:u(s),destroy:function(){f=f().destroy(),v=v().destroy(),P=undefined},options:function(e){t=e},afterCreate:u(b.watch),beforeShow:u(h.watch),afterShow:u(d.watch),beforeClose:u(_.watch),afterClose:u(w.watch)};return E}}()}(this),webphone_api.swfobject=function(){function e(){if(!M){try{var e=y.getElementsByTagName("body")[0].appendChild(d("span"));e.parentNode.removeChild(e)}catch(t){return}M=!0;for(var o=k.length,n=0;n<o;n++)k[n]()}}function o(e){M?e():k[k.length]=e}function n(e){if(typeof D.addEventListener!=G)D.addEventListener("load",e,!1);else if(typeof y.addEventListener!=G)y.addEventListener("load",e,!1);else if(typeof D.attachEvent!=G)_(D,"onload",e);else if("function"==typeof D.onload){var o=D.onload;D.onload=function(){o(),e()}}else D.onload=e}function t(){A?i():a()}function i(){if(!0!==webphone_api.flashdeepdetect)return void a();var e=y.getElementsByTagName("body")[0],o=d(O);o.setAttribute("type",L);var n=e.appendChild(o);if(n){var t=0;!function(){if(typeof n.GetVariable!=G){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),B.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(t<10)return t++,void setTimeout(arguments.callee,10);e.removeChild(o),n=null,a()}()}else a()}function a(){var e=U.length;if(e>0)for(var o=0;o<e;o++){var n=U[o].id,t=U[o].callbackFn,i={success:!1,id:n};if(B.pv[0]>0){var a=h(n);if(a)if(!w(U[o].swfVersion)||B.wk&&B.wk<312)if(U[o].expressInstall&&l()){var c={};c.data=U[o].expressInstall,c.width=a.getAttribute("width")||"0",c.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(c.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(c.align=a.getAttribute("align"));for(var u={},g=a.getElementsByTagName("param"),m=g.length,b=0;b<m;b++)"movie"!=g[b].getAttribute("name").toLowerCase()&&(u[g[b].getAttribute("name")]=g[b].getAttribute("value"));p(c,u,n,t)}else s(a),t&&t(i);else v(n,!0),t&&(i.success=!0,i.ref=r(n),t(i))}else if(v(n,!0),t){var d=r(n);d&&typeof d.SetVariable!=G&&(i.success=!0,i.ref=d),t(i)}}}function r(e){var o=null,n=h(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=G)o=n;else{var t=n.getElementsByTagName(O)[0];t&&(o=t)}return o}function l(){return!F&&w("6.0.65")&&(B.win||B.mac)&&!(B.wk&&B.wk<312)}function p(e,o,n,t){F=!0,N=t||null,S={success:!1,id:n};var i=h(n);if(i){"OBJECT"==i.nodeName?(E=c(i),T=null):(E=i,T=n),e.id=C,(typeof e.width==G||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==G||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),y.title=y.title.slice(0,47)+" - Flash Player Installation";var a=B.ie&&B.win?"ActiveX":"PlugIn",r="MMredirectURL="+encodeURI(D.location).toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+y.title;if(typeof o.flashvars!=G?o.flashvars+="&"+r:o.flashvars=r,B.ie&&B.win&&4!=i.readyState){var l=d("div");n+="SWFObjectNew",l.setAttribute("id",n),i.parentNode.insertBefore(l,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}u(e,o,n)}}function s(e){if(B.ie&&B.win&&4!=e.readyState){var o=d("div");e.parentNode.insertBefore(o,e),o.parentNode.replaceChild(c(e),o),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(c(e),e)}function c(e){var o=d("div");if(B.win&&B.ie)o.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(O)[0];if(n){var t=n.childNodes;if(t)for(var i=t.length,a=0;a<i;a++)1==t[a].nodeType&&"PARAM"==t[a].nodeName||8==t[a].nodeType||o.appendChild(t[a].cloneNode(!0))}}return o}function u(e,o,n){var t,i=h(n);if(B.wk&&B.wk<312)return t;if(i)if(typeof e.id==G&&(e.id=n),B.ie&&B.win){var a="";for(var r in e)e[r]!=Object.prototype[r]&&("data"==r.toLowerCase()?o.movie=e[r]:"styleclass"==r.toLowerCase()?a+=' class="'+e[r]+'"':"classid"!=r.toLowerCase()&&(a+=" "+r+'="'+e[r]+'"'));var l="";for(var p in o)o[p]!=Object.prototype[p]&&(l+='<param name="'+p+'" value="'+o[p]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>",V[V.length]=e.id,t=h(e.id)}else{var s=d(O);s.setAttribute("type",L);for(var c in e)e[c]!=Object.prototype[c]&&("styleclass"==c.toLowerCase()?s.setAttribute("class",e[c]):"classid"!=c.toLowerCase()&&s.setAttribute(c,e[c]));for(var u in o)o[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&g(s,u,o[u]);i.parentNode.replaceChild(s,i),t=s}return t}function g(e,o,n){var t=d("param");t.setAttribute("name",o),t.setAttribute("value",n),e.appendChild(t)}function m(e){var o=h(e);o&&"OBJECT"==o.nodeName&&(B.ie&&B.win?(o.style.display="none",function(){4==o.readyState?b(e):setTimeout(arguments.callee,10)}()):o.parentNode.removeChild(o))}function b(e){var o=h(e);if(o){for(var n in o)"function"==typeof o[n]&&(o[n]=null);o.parentNode.removeChild(o)}}function h(e){var o=null;try{o=y.getElementById(e)}catch(n){}return o}function d(e){return y.createElement(e)}function _(e,o,n){e.attachEvent(o,n),W[W.length]=[e,o,n]}function w(e){var o=B.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,o[0]>n[0]||o[0]==n[0]&&o[1]>n[1]||o[0]==n[0]&&o[1]==n[1]&&o[2]>=n[2]}function f(e,o,n,t){if(!B.ie||!B.mac){var i=y.getElementsByTagName("head")[0];if(i){var a=n&&"string"==typeof n?n:"screen";if(t&&(I=null,R=null),!I||R!=a){var r=d("style");r.setAttribute("type","text/css"),r.setAttribute("media",a),I=i.appendChild(r),B.ie&&B.win&&typeof y.styleSheets!=G&&y.styleSheets.length>0&&(I=y.styleSheets[y.styleSheets.length-1]),R=a}B.ie&&B.win?I&&typeof I.addRule==O&&I.addRule(e,o):I&&typeof y.createTextNode!=G&&I.appendChild(y.createTextNode(e+" {"+o+"}"))}}}function v(e,o){if(H){var n=o?"visible":"hidden";M&&h(e)?h(e).style.visibility=n:f("#"+e,"visibility:"+n)}}function P(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=G?encodeURIComponent(e):e}var E,T,N,S,I,R,G="undefined",O="object",L="application/x-shockwave-flash",C="SWFObjectExprInst",D=window,y=document,x=navigator,A=!1,k=[t],U=[],V=[],W=[],M=!1,F=!1,H=!0,B=function(){var e=typeof y.getElementById!=G&&typeof y.getElementsByTagName!=G&&typeof y.createElement!=G,o=x.userAgent.toLowerCase(),n=x.platform.toLowerCase(),t=/win/.test(n?n:o),i=/mac/.test(n?n:o),a=!!/webkit/.test(o)&&parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),r=!1,l=[0,0,0],p=null;if(typeof x.plugins!=G&&typeof x.plugins["Shockwave Flash"]==O)!(p=x.plugins["Shockwave Flash"].description)||typeof x.mimeTypes!=G&&x.mimeTypes[L]&&!x.mimeTypes[L].enabledPlugin||(A=!0,r=!1,p=p.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),l[0]=parseInt(p.replace(/^(.*)\..*$/,"$1"),10),l[1]=parseInt(p.replace(/^.*\.(.*)\s.*$/,"$1"),10),l[2]=/[a-zA-Z]/.test(p)?parseInt(p.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof D.ActiveXObject!=G)try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");s&&(p=s.GetVariable("$version"))&&(r=!0,p=p.split(" ")[1].split(","),l=[parseInt(p[0],10),parseInt(p[1],10),parseInt(p[2],10)])}catch(c){}return{w3:e,pv:l,wk:a,ie:r,win:t,mac:i}}();(function(){B.w3&&((typeof y.readyState!=G&&"complete"==y.readyState||typeof y.readyState==G&&(y.getElementsByTagName("body")[0]||y.body))&&e(),M||(typeof y.addEventListener!=G&&y.addEventListener("DOMContentLoaded",e,!1),B.ie&&B.win&&(y.attachEvent("onreadystatechange",function(){"complete"==y.readyState&&(y.detachEvent("onreadystatechange",arguments.callee),e())}),D==top&&function(){if(!M){try{y.documentElement.doScroll("left")}catch(o){return void setTimeout(arguments.callee,0)}e()}}()),B.wk&&function(){if(!M)/loaded|complete/.test(y.readyState)?e():setTimeout(arguments.callee,0)}(),n(e)))})(),function(){B.ie&&B.win&&window.attachEvent("onunload",function(){for(var e=W.length,o=0;o<e;o++)W[o][0].detachEvent(W[o][1],W[o][2]);for(var n=V.length,t=0;t<n;t++)m(V[t]);for(var i in B)B[i]=null;B=null;for(var a in webphone_api.swfobject)webphone_api.swfobject[a]=null;webphone_api.swfobject=null})}();return{registerObject:function(e,o,n,t){if(B.w3&&e&&o){var i={};i.id=e,i.swfVersion=o,i.expressInstall=n,i.callbackFn=t,U[U.length]=i,v(e,!1)}else t&&t({success:!1,id:e})},getObjectById:function(e){if(B.w3)return r(e)},embedSWF:function(e,n,t,i,a,r,s,c,g,m){var b={success:!1,id:n};B.w3&&!(B.wk&&B.wk<312)&&e&&n&&t&&i&&a?(v(n,!1),o(function(){t+="",i+="";var o={};if(g&&typeof g===O)for(var h in g)o[h]=g[h];o.data=e,o.width=t,o.height=i;var d={};if(c&&typeof c===O)for(var _ in c)d[_]=c[_];if(s&&typeof s===O)for(var f in s)typeof d.flashvars!=G?d.flashvars+="&"+f+"="+s[f]:d.flashvars=f+"="+s[f];if(w(a)){var P=u(o,d,n);o.id==n&&v(n,!0),b.success=!0,b.ref=P}else{if(r&&l())return o.data=r,void p(o,d,n,m);v(n,!0)}m&&m(b)})):m&&m(b)},switchOffAutoHideShow:function(){H=!1},ua:B,getFlashPlayerVersion:function(){return{major:B.pv[0],minor:B.pv[1],release:B.pv[2]}},hasFlashPlayerVersion:w,createSWF:function(e,o,n){return B.w3?u(e,o,n):undefined},showExpressInstall:function(e,o,n,t){B.w3&&l()&&p(e,o,n,t)},removeSWF:function(e){B.w3&&m(e)},createCSS:function(e,o,n,t){B.w3&&f(e,o,n,t)},addDomLoadEvent:o,addLoadEvent:n,getQueryParamValue:function(e){var o=y.location.search||y.location.hash;if(o){if(/\?/.test(o)&&(o=o.split("?")[1]),null==e)return P(o);for(var n=o.split("&"),t=0;t<n.length;t++)if(n[t].substring(0,n[t].indexOf("="))==e)return P(n[t].substring(n[t].indexOf("=")+1))}return""},expressInstallCallback:function(){if(F){var e=h(C);e&&E&&(e.parentNode.replaceChild(E,e),T&&(v(T,!0),B.ie&&B.win&&(E.style.display="block")),N&&N(S)),F=!1}}}}(),webphone_api.mwphonecfg=function(){function e(e){return void 0===e||null===e?"":(e=e.toLowerCase(),"undefined"==typeof n[e]||null===n[e]?"":n[e])}function o(){return n}var n={passphrase:"h39idbfqw7116ghh",loglevel:"5",autotransportdetect:"false",cfgusetunneling:"0",useencryption:"false",upperserverfromuser:"2",featureset:"10",needactivation:"false",brandid:"-1",video:"1",enable_video:"true",has_video:"true",enablepresence2:"1",enablepresence:"1",hasfiletransfer:"true",screensharing:"1",hasconference:"true",useg729:"2",useopuswb:"2",customizedversion:"false",autoprovisioning:"1",colortheme:"-1",actionbarhideicon:"false",usemizuwebrtcgateway:"-1",deploydate:"2/23/2021 14:23:14",homepage:"www.mizu-voip.com",server_comment:"VoIP server address (domain or IP:port)",companynameex:"MizuTech",confighash:"6190565b7a4cc409c70e83fff7cc9739",apibehaviour:"1",firstdeploydate:"2/23/2021 14:23:14",lastdeploydate:"2/23/2021 14:23:14",BUILDNUMBER:"1902",pc_alternatebrowserurl:"https://www.mozilla.org/firefox/new/",android_aletrnatebrowserurl:"https://play.google.com/store/apps/details?id=com.android.chrome",android_nativedialerurl:"https://play.google.com/store/apps/details?id=com.mizuvoip.mizudroid.app",ios_nativedialerurl:"https://itunes.apple.com/us/app/mizuphone/id483685573",mclientid:"5795"};return{get:e,getAll:o}}(),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,o.webphone_api.localforage=e()}}(function(){return function e(o,n,t){function i(r,l){if(!n[r]){if(!o[r]){var p="function"==typeof require&&require;if(!l&&p)return p(r,!0);if(a)return a(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[r]={exports:{}};o[r][0].call(c.exports,function(e){var n=o[r][1][e];return i(n||e)},c,c.exports,e,o,n,t)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<t.length;r++)i(t[r]);return i}({1:[function(e,o,n){(function(e){"use strict";function n(){c=!0;for(var e,o,n=u.length;n;){for(o=u,u=[],e=-1;++e<n;)o[e]();n=u.length}c=!1}function t(e){1!==u.push(e)||c||i()}var i,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var r=0,l=new a(n),p=e.document.createTextNode("");l.observe(p,{characterData:!0}),i=function(){p.data=r=++r%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var o=e.document.createElement("script");o.onreadystatechange=function(){n(),o.onreadystatechange=null,o.parentNode.removeChild(o),o=null},e.document.documentElement.appendChild(o)}:function(){setTimeout(n,0)};else{var s=new e.MessageChannel;s.port1.onmessage=n,i=function(){s.port2.postMessage(0)}}var c,u=[];o.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,o,n){"use strict";function t(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,e!==t&&p(this,e)}function a(e,o,n){this.promise=e,"function"==typeof o&&(this.onFulfilled=o,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function r(e,o,n){b(function(){var t;try{t=o(n)}catch(i){return h.reject(e,i)}t===e?h.reject(e,new TypeError("Cannot resolve promise with itself")):h.resolve(e,t)})}function l(e){var o=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof o)return function(){o.apply(e,arguments)}}function p(e,o){function n(o){a||(a=!0,h.reject(e,o))}function t(o){a||(a=!0,h.resolve(e,o))}function i(){o(t,n)}var a=!1,r=s(i);"error"===r.status&&n(r.value)}function s(e,o){var n={};try{n.value=e(o),n.status="success"}catch(t){n.status="error",n.value=t}return n}function c(e){return e instanceof this?e:h.resolve(new this(t),e)}function u(e){var o=new this(t);return h.reject(o,e)}function g(e){var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),r=0,l=-1,p=new this(t);++l<n;)!function(e,t){function l(e){a[t]=e,++r!==n||i||(i=!0,h.resolve(p,a))}o.resolve(e).then(l,function(e){i||(i=!0,h.reject(p,e))})}(e[l],l);return p}function m(e){var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=-1,r=new this(t);++a<n;)!function(e){o.resolve(e).then(function(e){i||(i=!0,h.resolve(r,e))},function(e){i||(i=!0,h.reject(r,e))})}(e[a]);return r}var b=e(1),h={},d=["REJECTED"],_=["FULFILLED"],w=["PENDING"];o.exports=i,i.prototype["catch"]=function(e){return this.then(null,e)},i.prototype.then=function(e,o){if("function"!=typeof e&&this.state===_||"function"!=typeof o&&this.state===d)return this;var n=new this.constructor(t);if(this.state!==w){r(n,this.state===_?e:o,this.outcome)}else this.queue.push(new a(n,e,o));return n},a.prototype.callFulfilled=function(e){h.resolve(this.promise,e)},a.prototype.otherCallFulfilled=function(e){r(this.promise,this.onFulfilled,e)},a.prototype.callRejected=function(e){h.reject(this.promise,e)},a.prototype.otherCallRejected=function(e){r(this.promise,this.onRejected,e)},h.resolve=function(e,o){var n=s(l,o)
;if("error"===n.status)return h.reject(e,n.value);var t=n.value;if(t)p(e,t);else{e.state=_,e.outcome=o;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(o)}return e},h.reject=function(e,o){e.state=d,e.outcome=o;for(var n=-1,t=e.queue.length;++n<t;)e.queue[n].callRejected(o);return e},i.resolve=c,i.reject=u,i.all=g,i.race=m},{1:1}],3:[function(e,o,n){(function(o){"use strict";"function"!=typeof o.Promise&&(o.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,o,n){"use strict";function t(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function i(e,o){e=e||[],o=o||{};try{return new Blob(e,o)}catch(a){if("TypeError"!==a.name)throw a;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,t=new n,i=0;i<e.length;i+=1)t.append(e[i]);return t.getBlob(o.type)}}function a(e,o){o&&e.then(function(e){o(null,e)},function(e){o(e)})}function r(e,o,n){"function"==typeof o&&e.then(o),"function"==typeof n&&e["catch"](n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function p(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function s(e){for(var o=e.length,n=new ArrayBuffer(o),t=new Uint8Array(n),i=0;i<o;i++)t[i]=e.charCodeAt(i);return n}function c(e){return new _e(function(o){var n=e.transaction(we,Te),t=i([""]);n.objectStore(we).put(t,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),o(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);o(n||!e||parseInt(e[1],10)>=43)}})["catch"](function(){return!1})}function u(e){return"boolean"==typeof fe?_e.resolve(fe):c(e).then(function(e){return fe=e})}function g(e){var o=ve[e.name],n={};n.promise=new _e(function(e,o){n.resolve=e,n.reject=o}),o.deferredOperations.push(n),o.dbReady?o.dbReady=o.dbReady.then(function(){return n.promise}):o.dbReady=n.promise}function m(e){var o=ve[e.name],n=o.deferredOperations.pop();if(n)return n.resolve(),n.promise}function b(e,o){var n=ve[e.name],t=n.deferredOperations.pop();if(t)return t.reject(o),t.promise}function h(e,o){return new _e(function(n,t){if(ve[e.name]=ve[e.name]||S(),e.db){if(!o)return n(e.db);g(e),e.db.close()}var i=[e.name];o&&i.push(e.version);var a=de.open.apply(de,i);o&&(a.onupgradeneeded=function(o){var n=a.result;try{n.createObjectStore(e.storeName),o.oldVersion<=1&&n.createObjectStore(we)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+e.name+'" has been upgraded from version '+o.oldVersion+" to version "+o.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),t(a.error)},a.onsuccess=function(){n(a.result),m(e)}})}function d(e){return h(e,!1)}function _(e){return h(e,!0)}function w(e,o){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),t=e.version<e.db.version,i=e.version>e.db.version;if(t&&(e.version!==o&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function f(e){return new _e(function(o,n){var t=new FileReader;t.onerror=n,t.onloadend=function(n){var t=btoa(n.target.result||"");o({__local_forage_encoded_blob:!0,data:t,type:e.type})},t.readAsBinaryString(e)})}function v(e){return i([s(atob(e.data))],{type:e.type})}function P(e){return e&&e.__local_forage_encoded_blob}function E(e){var o=this,n=o._initReady().then(function(){var e=ve[o._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return r(n,e,e),n}function T(e){g(e);for(var o=ve[e.name],n=o.forages,t=0;t<n.length;t++){var i=n[t];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,d(e).then(function(o){return e.db=o,w(e)?_(e):o}).then(function(t){e.db=o.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t})["catch"](function(o){throw b(e,o),o})}function N(e,o,n,t){t===undefined&&(t=1);try{var i=e.db.transaction(e.storeName,o);n(null,i)}catch(a){if(t>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return _e.resolve().then(function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_(e)}).then(function(){return T(e).then(function(){N(e,o,n,t-1)})})["catch"](n);n(a)}}function S(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function I(e){function o(){return _e.resolve()}var n=this,t={db:null};if(e)for(var i in e)t[i]=e[i];var a=ve[t.name];a||(a=S(),ve[t.name]=a),a.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=E);for(var r=[],l=0;l<a.forages.length;l++){var p=a.forages[l];p!==n&&r.push(p._initReady()["catch"](o))}var s=a.forages.slice(0);return _e.all(r).then(function(){return t.db=a.db,d(t)}).then(function(e){return t.db=e,w(t,n._defaultConfig.version)?_(t):e}).then(function(e){t.db=a.db=e,n._dbInfo=t;for(var o=0;o<s.length;o++){var i=s[o];i!==n&&(i._dbInfo.db=t.db,i._dbInfo.version=t.version)}})}function R(e,o){var n=this;e=l(e);var t=new _e(function(o,t){n.ready().then(function(){N(n._dbInfo,Ee,function(i,a){if(i)return t(i);try{var r=a.objectStore(n._dbInfo.storeName),l=r.get(e);l.onsuccess=function(){var e=l.result;e===undefined&&(e=null),P(e)&&(e=v(e)),o(e)},l.onerror=function(){t(l.error)}}catch(p){t(p)}})})["catch"](t)});return a(t,o),t}function G(e,o){var n=this,t=new _e(function(o,t){n.ready().then(function(){N(n._dbInfo,Ee,function(i,a){if(i)return t(i);try{var r=a.objectStore(n._dbInfo.storeName),l=r.openCursor(),p=1;l.onsuccess=function(){var n=l.result;if(n){var t=n.value;P(t)&&(t=v(t));var i=e(t,n.key,p++);void 0!==i?o(i):n["continue"]()}else o()},l.onerror=function(){t(l.error)}}catch(s){t(s)}})})["catch"](t)});return a(t,o),t}function O(e,o,n){var t=this;e=l(e);var i=new _e(function(n,i){var a;t.ready().then(function(){return a=t._dbInfo,"[object Blob]"===Pe.call(o)?u(a.db).then(function(e){return e?o:f(o)}):o}).then(function(o){N(t._dbInfo,Te,function(a,r){if(a)return i(a);try{var l=r.objectStore(t._dbInfo.storeName);null===o&&(o=undefined);var p=l.put(o,e);r.oncomplete=function(){o===undefined&&(o=null),n(o)},r.onabort=r.onerror=function(){var e=p.error?p.error:p.transaction.error;i(e)}}catch(s){i(s)}})})["catch"](i)});return a(i,n),i}function L(e,o){var n=this;e=l(e);var t=new _e(function(o,t){n.ready().then(function(){N(n._dbInfo,Te,function(i,a){if(i)return t(i);try{var r=a.objectStore(n._dbInfo.storeName),l=r["delete"](e);a.oncomplete=function(){o()},a.onerror=function(){t(l.error)},a.onabort=function(){var e=l.error?l.error:l.transaction.error;t(e)}}catch(p){t(p)}})})["catch"](t)});return a(t,o),t}function C(e){var o=this,n=new _e(function(e,n){o.ready().then(function(){N(o._dbInfo,Te,function(t,i){if(t)return n(t);try{var a=i.objectStore(o._dbInfo.storeName),r=a.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(l){n(l)}})})["catch"](n)});return a(n,e),n}function D(e){var o=this,n=new _e(function(e,n){o.ready().then(function(){N(o._dbInfo,Ee,function(t,i){if(t)return n(t);try{var a=i.objectStore(o._dbInfo.storeName),r=a.count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(l){n(l)}})})["catch"](n)});return a(n,e),n}function y(e,o){var n=this,t=new _e(function(o,t){if(e<0)return void o(null);n.ready().then(function(){N(n._dbInfo,Ee,function(i,a){if(i)return t(i);try{var r=a.objectStore(n._dbInfo.storeName),l=!1,p=r.openCursor();p.onsuccess=function(){var n=p.result;if(!n)return void o(null);0===e?o(n.key):l?o(n.key):(l=!0,n.advance(e))},p.onerror=function(){t(p.error)}}catch(s){t(s)}})})["catch"](t)});return a(t,o),t}function x(e){var o=this,n=new _e(function(e,n){o.ready().then(function(){N(o._dbInfo,Ee,function(t,i){if(t)return n(t);try{var a=i.objectStore(o._dbInfo.storeName),r=a.openCursor(),l=[];r.onsuccess=function(){var o=r.result;if(!o)return void e(l);l.push(o.key),o["continue"]()},r.onerror=function(){n(r.error)}}catch(p){n(p)}})})["catch"](n)});return a(n,e),n}function A(e,o){o=p.apply(this,arguments);var n=this.config();e="function"!=typeof e&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var t,i=this;if(e.name){var r=e.name===n.name&&i._dbInfo.db,l=r?_e.resolve(i._dbInfo.db):d(e).then(function(o){var n=ve[e.name],t=n.forages;n.db=o;for(var i=0;i<t.length;i++)t[i]._dbInfo.db=o;return o});t=e.storeName?l.then(function(o){if(o.objectStoreNames.contains(e.storeName)){var n=o.version+1;g(e);var t=ve[e.name],i=t.forages;o.close();for(var a=0;a<i.length;a++){var r=i[a];r._dbInfo.db=null,r._dbInfo.version=n}return new _e(function(o,t){var i=de.open(e.name,n);i.onerror=function(e){i.result.close(),t(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),o(e)}}).then(function(e){t.db=e;for(var o=0;o<i.length;o++){var n=i[o];n._dbInfo.db=e,m(n._dbInfo)}})["catch"](function(o){throw(b(e,o)||_e.resolve())["catch"](function(){}),o})}}):l.then(function(o){g(e);var n=ve[e.name],t=n.forages;o.close();for(var i=0;i<t.length;i++){t[i]._dbInfo.db=null}return new _e(function(o,n){var t=de.deleteDatabase(e.name);t.onerror=t.onblocked=function(e){var o=t.result;o&&o.close(),n(e)},t.onsuccess=function(){var e=t.result;e&&e.close(),o(e)}}).then(function(e){n.db=e;for(var o=0;o<t.length;o++)m(t[o]._dbInfo)})["catch"](function(o){throw(b(e,o)||_e.resolve())["catch"](function(){}),o})})}else t=_e.reject("Invalid arguments");return a(t,o),t}function k(e){var o,n,t,i,a,r=.75*e.length,l=e.length,p=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);var s=new ArrayBuffer(r),c=new Uint8Array(s);for(o=0;o<l;o+=4)n=Se.indexOf(e[o]),t=Se.indexOf(e[o+1]),i=Se.indexOf(e[o+2]),a=Se.indexOf(e[o+3]),c[p++]=n<<2|t>>4,c[p++]=(15&t)<<4|i>>2,c[p++]=(3&i)<<6|63&a;return s}function U(e){var o,n=new Uint8Array(e),t="";for(o=0;o<n.length;o+=3)t+=Se[n[o]>>2],t+=Se[(3&n[o])<<4|n[o+1]>>4],t+=Se[(15&n[o+1])<<2|n[o+2]>>6],t+=Se[63&n[o+2]];return n.length%3==2?t=t.substring(0,t.length-1)+"=":n.length%3==1&&(t=t.substring(0,t.length-2)+"=="),t}function V(e,o){var n="";if(e&&(n=He.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===He.call(e.buffer))){var t,i=Ge;e instanceof ArrayBuffer?(t=e,i+=Le):(t=e.buffer,"[object Int8Array]"===n?i+=De:"[object Uint8Array]"===n?i+=ye:"[object Uint8ClampedArray]"===n?i+=xe:"[object Int16Array]"===n?i+=Ae:"[object Uint16Array]"===n?i+=Ue:"[object Int32Array]"===n?i+=ke:"[object Uint32Array]"===n?i+=Ve:"[object Float32Array]"===n?i+=We:"[object Float64Array]"===n?i+=Me:o(new Error("Failed to get type for BinaryArray"))),o(i+U(t))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n=Ie+e.type+"~"+U(this.result);o(Ge+Ce+n)},a.readAsArrayBuffer(e)}else try{o(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),o(null,r)}}function W(e){if(e.substring(0,Oe)!==Ge)return JSON.parse(e);var o,n=e.substring(Fe),t=e.substring(Oe,Fe);if(t===Ce&&Re.test(n)){var a=n.match(Re);o=a[1],n=n.substring(a[0].length)}var r=k(n);switch(t){case Le:return r;case Ce:return i([r],{type:o});case De:return new Int8Array(r);case ye:return new Uint8Array(r);case xe:return new Uint8ClampedArray(r);case Ae:return new Int16Array(r);case Ue:return new Uint16Array(r);case ke:return new Int32Array(r);case Ve:return new Uint32Array(r);case We:return new Float32Array(r);case Me:return new Float64Array(r);default:throw new Error("Unkown type: "+t)}}function M(e,o,n,t){e.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,t)}function F(e){var o=this,n={db:null};if(e)for(var t in e)n[t]="string"!=typeof e[t]?e[t].toString():e[t];var i=new _e(function(e,t){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(i){return t(i)}n.db.transaction(function(i){M(i,n,function(){o._dbInfo=n,e()},function(e,o){t(o)})},t)});return n.serializer=Be,i}function H(e,o,n,t,i,a){e.executeSql(n,t,i,function(e,r){r.code===r.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[o.storeName],function(e,l){l.rows.length?a(e,r):M(e,o,function(){e.executeSql(n,t,i,a)},a)},a):a(e,r)},a)}function B(e,o){var n=this;e=l(e);var t=new _e(function(o,t){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var t=n.rows.length?n.rows.item(0).value:null;t&&(t=i.serializer.deserialize(t)),o(t)},function(e,o){t(o)})})})["catch"](t)});return a(t,o),t}function $(e,o){var n=this,t=new _e(function(o,t){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"SELECT * FROM "+i.storeName,[],function(n,t){for(var a=t.rows,r=a.length,l=0;l<r;l++){var p=a.item(l),s=p.value;if(s&&(s=i.serializer.deserialize(s)),void 0!==(s=e(s,p.key,l+1)))return void o(s)}o()},function(e,o){t(o)})})})["catch"](t)});return a(t,o),t}function j(e,o,n,t){var i=this;e=l(e);var r=new _e(function(a,r){i.ready().then(function(){o===undefined&&(o=null);var l=o,p=i._dbInfo;p.serializer.serialize(o,function(o,s){s?r(s):p.db.transaction(function(n){H(n,p,"INSERT OR REPLACE INTO "+p.storeName+" (key, value) VALUES (?, ?)",[e,o],function(){a(l)},function(e,o){r(o)})},function(o){if(o.code===o.QUOTA_ERR){if(t>0)return void a(j.apply(i,[e,l,n,t-1]));r(o)}})})})["catch"](r)});return a(r,n),r}function q(e,o,n){return j.apply(this,[e,o,n,1])}function z(e,o){var n=this;e=l(e);var t=new _e(function(o,t){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){o()},function(e,o){t(o)})})})["catch"](t)});return a(t,o),t}function K(e){var o=this,n=new _e(function(e,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(o){H(o,t,"DELETE FROM "+t.storeName,[],function(){e()},function(e,o){n(o)})})})["catch"](n)});return a(n,e),n}function J(e){var o=this,n=new _e(function(e,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(o){H(o,t,"SELECT COUNT(key) as c FROM "+t.storeName,[],function(o,n){var t=n.rows.item(0).c;e(t)},function(e,o){n(o)})})})["catch"](n)});return a(n,e),n}function X(e,o){var n=this,t=new _e(function(o,t){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var t=n.rows.length?n.rows.item(0).key:null;o(t)},function(e,o){t(o)})})})["catch"](t)});return a(t,o),t}function Y(e){var o=this,n=new _e(function(e,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(o){H(o,t,"SELECT key FROM "+t.storeName,[],function(o,n){for(var t=[],i=0;i<n.rows.length;i++)t.push(n.rows.item(i).key);e(t)},function(e,o){n(o)})})})["catch"](n)});return a(n,e),n}function Q(e){return new _e(function(o,n){e.transaction(function(t){t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,t){for(var i=[],a=0;a<t.rows.length;a++)i.push(t.rows.item(a).name);o({db:e,storeNames:i})},function(e,o){n(o)})},function(e){n(e)})})}function Z(e,o){o=p.apply(this,arguments);var n=this.config();e="function"!=typeof e&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var t,i=this;return t=e.name?new _e(function(o){var t;t=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),o(e.storeName?{db:t,storeNames:[e.storeName]}:Q(t))}).then(function(e){return new _e(function(o,n){e.db.transaction(function(t){for(var i=[],a=0,r=e.storeNames.length;a<r;a++)i.push(function(e){return new _e(function(o,n){t.executeSql("DROP TABLE IF EXISTS "+e,[],function(){o()},function(e,o){n(o)})})}(e.storeNames[a]));_e.all(i).then(function(){o()})["catch"](function(e){n(e)})},function(e){n(e)})})}):_e.reject("Invalid arguments"),a(t,o),t}function ee(e,o){var n=e.name+"/";return e.storeName!==o.storeName&&(n+=e.storeName+"/"),n}function oe(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}function ne(){return!oe()||localStorage.length>0}function te(e){var o=this,n={};if(e)for(var t in e)n[t]=e[t];return n.keyPrefix=ee(e,o._defaultConfig),ne()?(o._dbInfo=n,n.serializer=Be,_e.resolve()):_e.reject()}function ie(e){var o=this,n=o.ready().then(function(){for(var e=o._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var t=localStorage.key(n);0===t.indexOf(e)&&localStorage.removeItem(t)}});return a(n,e),n}function ae(e,o){var n=this;e=l(e);var t=n.ready().then(function(){var o=n._dbInfo,t=localStorage.getItem(o.keyPrefix+e);return t&&(t=o.serializer.deserialize(t)),t});return a(t,o),t}function re(e,o){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo,t=o.keyPrefix,i=t.length,a=localStorage.length,r=1,l=0;l<a;l++){var p=localStorage.key(l);if(0===p.indexOf(t)){var s=localStorage.getItem(p);if(s&&(s=o.serializer.deserialize(s)),void 0!==(s=e(s,p.substring(i),r++)))return s}}});return a(t,o),t}function le(e,o){var n=this,t=n.ready().then(function(){var o,t=n._dbInfo;try{o=localStorage.key(e)}catch(i){o=null}return o&&(o=o.substring(t.keyPrefix.length)),o});return a(t,o),t}function pe(e){var o=this,n=o.ready().then(function(){for(var e=o._dbInfo,n=localStorage.length,t=[],i=0;i<n;i++){var a=localStorage.key(i);0===a.indexOf(e.keyPrefix)&&t.push(a.substring(e.keyPrefix.length))}return t});return a(n,e),n}function se(e){var o=this,n=o.keys().then(function(e){return e.length});return a(n,e),n}function ce(e,o){var n=this;e=l(e);var t=n.ready().then(function(){var o=n._dbInfo;localStorage.removeItem(o.keyPrefix+e)});return a(t,o),t}function ue(e,o,n){var t=this;e=l(e);var i=t.ready().then(function(){o===undefined&&(o=null);var n=o;return new _e(function(i,a){var r=t._dbInfo;r.serializer.serialize(o,function(o,t){if(t)a(t);else try{localStorage.setItem(r.keyPrefix+e,o),i(n)}catch(l){"QuotaExceededError"!==l.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==l.name||a(l),a(l)}})})});return a(i,n),i}function ge(e,o){if(o=p.apply(this,arguments),e="function"!=typeof e&&e||{},!e.name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var t,i=this;return t=e.name?new _e(function(o){o(e.storeName?ee(e,i._defaultConfig):e.name+"/")}).then(function(e){for(var o=localStorage.length-1;o>=0;o--){var n=localStorage.key(o);0===n.indexOf(e)&&localStorage.removeItem(n)}}):_e.reject("Invalid arguments"),a(t,o),t}function me(e,o){e[o]=function(){var n=arguments;return arguments.length&&"function"==typeof arguments[arguments.length-1]&&(webphone_api.global.localforage_last_cb=arguments[arguments.length-1]),e.ready().then(function(){return e[o].apply(e,n)})}}function be(){for(var e=1;e<arguments.length;e++){var o=arguments[e];if(o)for(var n in o)o.hasOwnProperty(n)&&(Ke(o[n])?arguments[0][n]=o[n].slice():arguments[0][n]=o[n])}return arguments[0]}var he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var _e=Promise,we="local-forage-detect-blob-support",fe=void 0,ve={},Pe=Object.prototype.toString,Ee="readonly",Te="readwrite",Ne={_driver:"asyncStorage",_initStorage:I,_support:function(){try{if(!de)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),o="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||o)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(n){return!1}}(),iterate:G,getItem:R,setItem:O,removeItem:L,clear:C,length:D,key:y,keys:x,dropInstance:A},Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ie="~~local_forage_type~",Re=/^~~local_forage_type~([^~]+)~/,Ge="__lfsc__:",Oe=Ge.length,Le="arbf",Ce="blob",De="si08",ye="ui08",xe="uic8",Ae="si16",ke="si32",Ue="ur16",Ve="ui32",We="fl32",Me="fl64",Fe=Oe+Le.length,He=Object.prototype.toString,Be={serialize:V,deserialize:W,stringToBuffer:k,bufferToString:U},$e={_driver:"webSQLStorage",_initStorage:F,_support:function(){return"function"==typeof openDatabase}(),iterate:$,getItem:B,setItem:q,removeItem:z,clear:K,length:J,key:X,keys:Y,dropInstance:Z},je={_driver:"localStorageWrapper",_initStorage:te,_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:re,getItem:ae,setItem:ue,removeItem:ce,clear:ie,length:se,key:le,keys:pe,dropInstance:ge},qe=function(e,o){return e===o||"number"==typeof e&&"number"==typeof o&&isNaN(e)&&isNaN(o)},ze=function(e,o){for(var n=e.length,t=0;t<n;){if(qe(e[t],o))return!0;t++}return!1},Ke=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Je={},Xe={},Ye={INDEXEDDB:Ne,WEBSQL:$e,LOCALSTORAGE:je},Qe=[Ye.INDEXEDDB._driver,Ye.WEBSQL._driver,Ye.LOCALSTORAGE._driver],Ze=["dropInstance"],eo=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ze),oo={description:"",driver:Qe.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},no=function(){function e(o){t(this,e);for(var n in Ye)if(Ye.hasOwnProperty(n)){var i=Ye[n],a=i._driver;this[n]=a,Je[a]||this.defineDriver(i)}this._defaultConfig=be({},oo),this._config=be({},this._defaultConfig,o),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)["catch"](function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":he(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var o in e){if("storeName"===o&&(e[o]=e[o].replace(/\W/g,"_")),"version"===o&&"number"!=typeof e[o])return new Error("Database version must be a number.");this._config[o]=e[o]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,o,n){var t=new _e(function(o,n){try{var t=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var r=eo.concat("_initStorage"),l=0,p=r.length;l<p;l++){var s=r[l];if((!ze(Ze,s)||e[s])&&"function"!=typeof e[s])return void n(i)}!function(){for(var o=0,n=Ze.length;o<n;o++){var t=Ze[o];e[t]||(e[t]=function(e){return function(){var o=new Error("Method "+e+" is not implemented by the current driver"),n=_e.reject(o);return a(n,arguments[arguments.length-1]),n}}(t))}}();var c=function(n){Je[t]&&console.info("Redefining LocalForage driver: "+t),Je[t]=e,Xe[t]=n,o()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(c,n):c(!!e._support):c(!0)}catch(u){n(u)}});return r(t,o,n),t},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,o,n){var t=Je[e]?_e.resolve(Je[e]):_e.reject(new Error("Driver not found."));return r(t,o,n),t},e.prototype.getSerializer=function(e){var o=_e.resolve(Be);return r(o,e),o},e.prototype.ready=function(e){var o=this,n=o._driverSet.then(function(){return null===o._ready&&(o._ready=o._initDriver()),o._ready});return r(n,e,e),n},e.prototype.setDriver=function(e,o,n){function t(){l._config.driver=l.driver()}function i(e){return l._extend(e),t(),l._ready=l._initStorage(l._config),l._ready}function a(e){return function(){function o(){for(;n<e.length;){var a=e[n];return n++,l._dbInfo=null,l._ready=null,l.getDriver(a).then(i)["catch"](o)}t();var r=new Error("No available storage method found.");return null!==webphone_api.global.localforage_last_cb&&"function"==typeof webphone_api.global.localforage_last_cb&&webphone_api.global.localforage_last_cb("ERROR, driverPromiseLoop:No available storage method found.",""),l._driverSet=_e.reject(r),l._driverSet}var n=0;return o()}}var l=this;Ke(e)||(e=[e]);var p=this._getSupportedDrivers(e),s=null!==this._driverSet?this._driverSet["catch"](function(){return _e.resolve()}):_e.resolve();return this._driverSet=s.then(function(){var e=p[0];return l._dbInfo=null,l._ready=null,l.getDriver(e).then(function(e){l._driver=e._driver,t(),l._wrapLibraryMethodsWithReady(),l._initDriver=a(p)})})["catch"](function(){t();var e=new Error("No available storage method found.");return l._driverSet=_e.reject(e),l._driverSet}),r(this._driverSet,o,n),this._driverSet},e.prototype.supports=function(e){return!!Xe[e]},e.prototype._extend=function(e){be(this,e)},e.prototype._getSupportedDrivers=function(e){for(var o=[],n=0,t=e.length;n<t;n++){var i=e[n];this.supports(i)&&o.push(i)}return o},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,o=eo.length;e<o;e++)me(this,eo[e])},e.prototype.createInstance=function(o){return new e(o)},e}(),to=new no;o.exports=to},{3:3}]},{},[4])(4)}),webphone_api.global={isdebugversion_showengineselection:!1,isdebugversion:!1,isdebugversionwebrtc:!1,isdebugengine:!1,linnsengine:!0,macnsengine:!1,winlinmacnsengine:!1,deviceType:"-1",autoServerDeployVersion:!1,lastautoprovserver:"",checkforautoprov:!0,flagWaitforautoprov:!1,code_version:17,config_version:1,versionstr:"3.3.1204",minimumserviceversion:40,maximumserviceversion:47,useengine:"",useengineclicked_cache:0,last_useengine:"",ENGINE_JAVA:"java",ENGINE_WEBRTC:"webrtc",ENGINE_SERVICE:"ns",ENGINE_FLASH:"flash",ENGINE_APP:"app",webrtcavailable:-1,engineselecttime:0,engineselectstage:-1,ENGINE_DELAY:1e3,iscurrengineworking:!1,isfirststart:!1,recwsload:0,usuk:"",predefLoglevel:5,logs:"",nrofrecentstodisplay:10,closeCallAtivity:!1,nrOfCallfunctionsToDisplay:5,pagewasrefreshed:!0,ringstart_time:0,callstart_time:0,lastringtimeouttick:0,wasSettModified:!1,wasCtModified:!1,wasChModified:!1,autoprovsrv_1:"https://www.webvoipphone.com/psettings/",autoprovsrv_2:"https://www.mizu-voip.com/phonesettings/",ctlist:[],chlist:[],aclist:[],recentlist:[],searchctlist:[],reloadcontactsaftersync:!1,refreshrecents:!1,readcallhistoryforrecents:!0,isencrypted:0,audio_rec_device_list:"",audio_play_device_list:"",audio_ring_device_list:"",audio_devices_loaded:!1,audio_rec_curr_device:"",audio_play_curr_device:"",audio_ring_curr_device:"",video_rec_device_list:"",video_rec_curr_device:"",usestorage:!0,phonestarted:0,service_last_life_signal:0,useajax_forservice:!1,serviceStatusPollTimer:null,webrtcsocketconnected:0,webrtcsipsignalingreceived:0,STORAGE_AUTO:0,STORAGE_COOKIE:1,STORAGE_LOCAL:2,ACCOUNTS_FILENAME:"wp_accounts",CONTACTS_FILENAME:"wp_contacts",SALT:"q8fgdahp9",SALT2:"vm1nye8ur2w",WIN_SOFTPHONE_URL:"http://127.0.0.1:18420",NATIVE_PLUGIN_URL:"ws://127.0.0.1",NATIVE_PLUGIN_URL_SECURE:"wss://ns4.webvoipphone.com",NATIVE_PLUGIN_URL_SECURE2:"",NATIVE_PLUGIN_URL_WIN_PORT:18520,NATIVE_PLUGIN_URL_LINMAC_PORT:18320,NATIVE_PLUGIN_URL_WIN_SSL_PORT:10443,NATIVE_PLUGIN_URL_LINMAC_SSL_PORT:19433,NPUSECURE1_YEAR:3022,NPUSECURE1_MONTH:1,NPUSECURE2_YEAR:3024,NPUSECURE2_MONTH:0,ENABLE_JAVA_URL:"http://java.com/en/download/help/enable_browser.xml",INSTALL_JAVA_URL:"http://www.java.com/download/",ec_apikey:"aJ6aqK4Nah3hnP7aht",ec_autoprov:"gJa6B2oa5Nx3Kya8n",wssupported:!1,httpmehod:"",currhttpmehodworking:!1,domloaded:!1,loglevel:1,incommingCall:!1,acceptReject:!1,checkIfInCall:!1,checkIfCallActive:!1,callTypeInOut:"",lastRingEvenet:"",hangupPressedCount:0,maintimerid:null,polltimerid:null,worktimer:null,httpkatimer:0,initcalled:!1,callName:"",credit:"",creditRequestIval:100,CREDIT_REQUEST_IVAL_DEFVAL:12e3,creditRequestTimer:0,apppletloaded:!1,presenceHM:{},waitforpresence:0,presence_started:!1,last_used_engine_cache:"",textmessaging:-1,applet_started:!1,speakerState:!0,bluetoothState:!0,lastcalldetails:"",lastcallduration:0,isfirstwsu:!0,wsuser_succeded:!1,notifs:[],intentsettings:[],intentctdetails:[],intentcall:[],intentaddeditct:[],intentchdetails:[],intentmsg:[],intentbrowser:[],intentstartpage:[],intentfiletransfer:[],intentsmscodeverify:[],rating:"",httpreqasynccallback:null,bwanswercallback:null,bwanswerfilename:null,bwanswerINCNUMBER:0,dispSaveSettMsg:0,showratewhiletype_cache:0,nsupdatepending:!1,isDialpadStarted:!1,isCallStarted:!1,isContactslistStarted:!1,isContactdetailsStarted:!1,isCallhistorylistStarted:!1,isCallhistorydetailsStarted:!1,isSettingsStarted:!1,isAddeditcontactStarted:!1,isMessagelistStarted:!1,isMessageStarted:!1,isInternalbrowserStarted:!1,isStartpageStarted:!1,isLogviewStarted:!1,isNewuserStarted:!1,isSmscodeverifyStarted:!1,isFiletransferStarted:!1,isFiltersStarted:!1,isAccountsStarted:!1,isExtra1Started:!1,isExtra2Started:!1,isExtra3Started:!1,isExtra4Started:!1,isExtra5Started:!1,alreadyCalledNrs:"",contactExists:!0,contactExistsNr:"",authenticated_displayed:!1,favafone_autologin:!1,aline:1,lastalineset:-5,lastalinesetreal:-5,lastalinesettick:0,lastalinesetrealtick:0,acallcount:0,onloaded_called:!1,wploaded:!1,ep:[],lnstat:[],redialof:!1,redialhideevt:!1,lastcallcdr:"",sendwsuserjsonp:!1,callhistoryfilter:-1,webrtcpermissionaccepted:!1,isconfcall:!1,sessionid:-1,dispregfailed:0,onunregistered_flag:!1,onunload_flag:!1,handlesett_finished:!1,dploadingdisplayed:!1,telsearchname:"",pres_set_at_start:!1,laststarttick:0,pres_unreg_called:!1,presenceinterval:72e4,msg_presence_timer:0,startendelayed_wascalled:!1,sipaccounts:[],waiting_conf_numbers:"",isconfroom_call:!1,checkpres_callback:[],active_incoming_call:!1,android_aletrnatebrowserurl_DEF:"https://play.google.com/store/apps/details?id=com.android.chrome",testmessagevalidity:3,last_event:"",wsl_uk_rec:!1,wsl_us_rec:!1,canfailover_gateway:!0,failover_gateway:!0,aua_handled:!1,stacknotstarted_time:0,stacknotstarted_retry:!1,dontshowdiscreason:!1,cansetuseengine:!1,lastconfroom:"",lastcontarget:"",lastconftargetstate:0,confcanfailover:!1,nostun:!1,noturn:!1,isvideocall:!1,lastpermreq:0,dontshow_closecall:!1,chrome_ss_plugin_url:"https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk",printwad_called:!1,custmenusL:[],bname_charcount:0,selected_apikey:"",dontclosecurrpopup:!1,last_presence_enabled:!1,currcallnumber:"",isfirstcall:!0,confanswer_received:!1,calltransf_completed:!1,flagclientreset:!1,phonestarttick:-1,httpheaderslogged:!1,onregisteredcalled:!1,flag_delsett:0,resetsett_handled:!1,apistartstate:0,apistarttick:0,wnotstartedsession:!1,flagnsreconnect:!1,colorizelog:0,webrtclastregsent:0,webrtcregtimer_exec:0,wsload_type:-1,webrtc_regstate:-1,addauser_header:!1,fcmstate:-1,fcmtoken:"",fcmIsEnabled:-1,decideusuk_finished:!1,wsc_contimeout:0,wsc_reqtimeout:0,add_recall_header:!1,domloaded_tick:0,last_ns_ws_succwss:0,callPageStatusCachePerLine:{},autoacceptsipheader:"",localforage_last_cb:null,last_wsu_tick:0,pingpong:0,ever_received_pong:!1,sipunicoderewritefrom:"",sipunicoderewriteto:"",firstregister_sessiontick:0,bothpartyhold:!1,firefoxholdcount:0,isholdresume:!1,isresume:!1,holdresumecount:0,win_nsplugin_filename:"WebPhoneService_Install.exe",mac_nsplugin_filename:"webphone_ns_mac.zip",lin32_nsplugin_filename:"webphone_ns_lin32.zip",lin32arm_nsplugin_filename:"webphone_ns_lin32arm.zip",lin64_nsplugin_filename:"webphone_ns_lin64.zip",lin64arm_nsplugin_filename:"webphone_ns_lin64arm.zip",enstarteddisplayed:!1,usemutemutiline:!1,nuiswebpage:null,
minimumservicebuild:0,last_good_status:"",display_last_status:!1,minten:!1,mto:"",last_transfer_tick:0,dontSendSignaling:!1,dontSendSignalingTimer:0,isappenginestarted:!1,smsCodeUser:"",isconfdtmf:!1,CLOSE_CALL_TIMER:-100,lastengine_working_ok:"",lastengine_started_ok:"",restartice_time:0,ice_timer:null,icecompleted:!1,ice_callaccepted:!1,settmap:{},settmap2:{},mRealm:"",webphone_started:!1,wenThisGlobal:null},webphone_api.common=function(){function ClassSipAccounts(){this.serveraddress,this.username,this.password,this.ival,this.enabled,this.ismain,this.callerid,this.displayname,this.proxyaddress,this.realm}function ReceiveNotifications(e){try{if(isNull(e)&&(e=""),e=Trim(e),0===e.length||e.indexOf(notsep)===e.lastIndexOf(notsep)&&e.indexOf(notsep2)===e.lastIndexOf(notsep2))CleanNotifications(e);else if(e.indexOf(notsep)!==e.lastIndexOf(notsep)){var o=e.split(notsep);if(!isNull(o)&&o.length>0)for(var n=0;n<o.length;n++)isNull(o[n])||CleanNotifications(o[n])}else if(e.indexOf(notsep2)!==e.lastIndexOf(notsep2)){var o=e.split(notsep2);if(!isNull(o)&&o.length>0)for(var n=0;n<o.length;n++)isNull(o[n])||CleanNotifications(o[n])}else CleanNotifications(e)}catch(t){PutToDebugLogException(2,"common: ReceiveNotifications",t)}}function CleanNotifications(e){try{isNull(e)&&(e=""),CanLog(7)&&PutToDebugLog(7,"RECEIVED: "+e),e=e.replace("WPNOTIFICATION,",""),!1===webphone_api.global.iscurrengineworking&&(getuseengine()===webphone_api.global.ENGINE_SERVICE?(e.indexOf("STATUS")>=0&&e.indexOf("STOP")<0||e.indexOf("START")>=0)&&(webphone_api.global.iscurrengineworking=!0,SaveParameter("lastsessionsuccess","2")):(webphone_api.global.iscurrengineworking=!0,SaveParameter("lastsessionsuccess","2")));var o=e.indexOf(notsep);if(o>0&&(e=e.substring(0,o)),o=e.indexOf(notsep2),o>0&&(e=e.substring(0,o)),e=e.replace("EOFLINE",""),e=Trim(e),e.indexOf("DISPLAY")>0)return e=Trim(e.replace("DISPLAY","")),PutToDebugLog(1,e),void ShowToast(e);e.indexOf("APIREQUEST:")>=0?(CanLog(5)&&PutToDebugLog(5,e),ProcessServiceReqResponse(e)):0===e.indexOf("LOG")?PutToDebugLog(5,e):!0===IsWindowsSoftphone()||getuseengine()===webphone_api.global.ENGINE_JAVA||getuseengine()===webphone_api.global.ENGINE_SERVICE?PutToDebugLog(1,e,"NOTIFICATION,"):PutToDebugLog(1,e)}catch(n){PutToDebugLogException(2,"common: CleanNotifications",n)}}function GetLogTimeStamp(){var e=new Date,o=e.getHours(),n=e.getMinutes(),t=e.getSeconds(),i=e.getMilliseconds();return o<10&&(o="0"+o),n<10&&(n="0"+n),t<10&&(t="0"+t),i<10?i="00"+i:i<100&&(i="0"+i),"["+o+":"+n+":"+t+"."+i+"] "}function CanLog(e){return checkloglvl>2&&(checkloglvl=0,webphone_api.global.loglevel=GetLogLevel()),!(e>webphone_api.global.loglevel)}function PutToDebugLog(e,o,n){logcount++,checkloglvl++;try{if(checkloglvl>2&&(checkloglvl=0,webphone_api.global.loglevel=GetLogLevel()),!me1){var t=[];t.push("t"),t.push("r"),t.push("i"),t.push("a"),t.push("l "),t.push("e"),t.push("x"),t.push("p"),t.push("i"),t.push("r"),t.push("e"),t.push("d"),me1=t.join(""),t=[],t.push("t"),t.push("r"),t.push("i"),t.push("a"),t.push("l "),t.push("session "),t.push("time"),t.push("out"),me2=t.join(""),t=[],t.push("l"),t.push("i"),t.push("c"),t.push("e"),t.push("n"),t.push("s"),t.push("e"),t.push(" "),t.push("e"),t.push("r"),t.push("r"),t.push("o"),t.push("r"),me3=t.join(""),t=[],t.push("t"),t.push("r"),t.push("i"),t.push("a"),t.push("l "),t.push("v"),t.push("e"),t.push("r"),t.push("s"),t.push("i"),t.push("o"),t.push("n"),t.push(" "),t.push("n"),t.push("e"),t.push("e"),t.push("d"),t.push(" "),t.push("r"),t.push("e"),t.push("s"),t.push("t"),t.push("a"),t.push("r"),t.push("t"),me4=t.join(""),t=[],t.push("s"),t.push("e"),t.push("r"),t.push("v"),t.push("e"),t.push("r"),t.push(" "),t.push("i"),t.push("s"),t.push(" "),t.push("n"),t.push("o"),t.push("t"),t.push(" "),t.push("e"),t.push("n"),t.push("a"),t.push("b"),t.push("l"),t.push("e"),t.push("d"),me5=t.join("")}if(logfirstrun||logcount>160){logcount=0;var i=logfirstrun;logfirstrun=!1,webphone_api.global.loglevel=GetLogLevel();return LogWebphoneInfo("\r\n",e,o),void(!0===i&&LogConfig())}var t="",a=0;if(isNull(o)||isNull(e))return;if(IsNumber(e))a=e,t=o;else{if(!IsNumber(o))return;a=o,t=e}if(t.indexOf("Stack not started")>=0&&(webphone_api.global.stacknotstarted_time=GetTickCount()),t.indexOf("=wsuser")>0&&t.indexOf("authpwd=")>0){var r=t.substring(0,t.indexOf("authpwd="));t=t.substring(t.indexOf("authpwd=")),t=t.indexOf("&")>0?t.substring(t.indexOf("&")+1):"",t=r+t}if(lastlogmsg===t)return;if(lastlogmsg=t,(webphone_api.global.useengine===webphone_api.global.ENGINE_JAVA||webphone_api.global.useengine===webphone_api.global.ENGINE_SERVICE)&&((t.indexOf(me1)>=0||t.indexOf(me2)>=0||t.indexOf(me3)>=0||t.indexOf(me4)>=0)&&(lmsg=t,lm=!0),(t.indexOf(me1)>=0||t.indexOf(me3)>=0||t.indexOf(me5)>=0)&&getuseengine()===webphone_api.global.ENGINE_SERVICE&&!1===srvinst_offered)){if(0===GetParameterInt("nsupdate",-1))return PutToDebugLog(1,"ERROR, NS update failed second time, prompt user to send logs"),void(!0===IsSDK()?AlertDialog("ERROR","Please contact support and send logs from browser console"):AlertDialog("ERROR","Please contact support and send logs from Menu -> Help -> Logs"));if(srvinst_offered=!0,setTimeout(function(){srvinst_offered=!1},18e4),!1===Te()){var l=t;WinAPI("extcmd_version",function(e){try{if(isNull(e)||e.indexOf("ERROR:")>=0)return;var o=-1,n=e.toString(),t=n.indexOf("version:");t>0&&(n=n.substring(t+8)),t=n.indexOf("eov"),t>0&&(n=n.substring(0,t)),n=Trim(n),!isNull(n)&&IsNumber(n)&&(o=StrToInt(n)),o>0&&!webphone_api.global.nsupdatepending&&(SaveParameter("srvupgrade_currversion",o),webphone_api.global.maximumserviceversion>0&&o>=webphone_api.global.maximumserviceversion?AlertDialog("ERROR",l):setTimeout(function(){SaveParameter("nsupdate","0");try{console&&console.log&&console.log(2,"EVENT, common: PutToDebugLog, service upgrade needed: "+GetMinServiceVersion().toString())}catch(e){}EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0},1))}catch(i){console.log("ERROR, catch on PutToDebugLog: extcmd_version"+i)}})}}!0===lm&&t.toLowerCase().indexOf("engine")<0&&(t=lmsg,a=1);try{webphone_api.onEventCb("log",t,null)}catch(b){}try{webphone_api.onLogCb(t)}catch(b){}sendlogstoandroid<0&&(sendlogstoandroid=IsCExt());try{sendlogstoandroid>0&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidPutToDebugLog&&null!==AndroidWebphoneJsInterface.jstoandroidPutToDebugLog&&AndroidWebphoneJsInterface.jstoandroidPutToDebugLog(a.toString(),t)}catch(b){}if(webphone_api.global.useengine===webphone_api.global.ENGINE_WEBRTC&&t.toLowerCase().indexOf("failed to find transport")>=0&&(isNull(console)||isNull(console.log)||console.log("detected in Log: failed to find transport"),webphone_api.flagrestartwebrtc=!0,webphone_api.webrtcapi.ReStart(0,!0)),t.indexOf("STOP")>0&&(a=2),!0===webphone_api.global.redialhideevt&&console&&console.log&&console.log("webphone: event dropped_1 redialonfail: "+t),1===a&&t.indexOf("param platform")<0&&!1===webphone_api.global.redialhideevt&&("undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?webphone_api.notifications.ProcessNotifications(t):console&&console.log&&console.log("ERROR, common PutToDebugLog webphone_api.notifications is not defined")),a>webphone_api.global.loglevel)return;void 0!==n&&null!==n&&(t=n+t),t=ReplaceAll(t,"EOFLINE","\r\n");var p=GetLogTimeStamp();if(webphone_api.global.logs=webphone_api.global.logs+p+t+"&#10;",webphone_api.global.logs.length>6e5){var s=webphone_api.global.logs.substring(0,1e4);webphone_api.global.logs=s+webphone_api.global.logs.substring(3e5)}try{if("false"==webphone_api.parameters.logtoconsole||0==webphone_api.parameters.logtoconsole)return}catch(b){}if(p="webphone: "+p,e>1&&t.indexOf("ERROR")>0&&"undefined"!=typeof PutToDebugLog.caller&&null!==PutToDebugLog.caller){var c=PutToDebugLog.caller.toString();c.indexOf("\r")>0?c=c.substr(0,c.indexOf("\r")):c.indexOf("\n")>0&&(c=c.substr(0,c.indexOf("\n"))),t=t+" {from: "+c+"}"}if(webphone_api.global.deviceType>0||navigator.userAgent.toLowerCase().indexOf("firefox")>-1||navigator.userAgent.toLowerCase().indexOf("chrome")>-1)if(t.indexOf("ERROR")>-1&&webphone_api.global.colorizelog>0)try{console.error(p+t+" ")}catch(h){}else if(t.length>1e3)for(var u=0;t.length>0&&!(++u>15);){var g=t.length;g>1e3&&(g=1e3);var m=t.substring(0,g);t=t.substring(g),u>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(d){}try{console.log(p+m+" ")}catch(_){}}else if(t.length>140&&t.length<400&&(t.indexOf("http:")>=0||t.indexOf("https:")>=0))for(var u=0;t.length>0&&!(++u>5);){var g=t.length;g>140&&(g=140);var m=t.substring(0,g);t=t.substring(g),u>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(d){}try{console.log(p+m+" ")}catch(_){}}else try{console.log(p+t+" ")}catch(_){}else if(t.length>1e3)for(var u=0;t.length>0&&!(++u>15);){var g=t.length;g>1e3&&(g=1e3);var m=t.substring(0,g);t=t.substring(g),u>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(w){}try{isNull(console)||isNull(console.log)||console.log(p+m+" ")}catch(f){}}else if(t.length>140&&t.length<400&&(t.indexOf("http:")>=0||t.indexOf("https:")>=0))for(var u=0;t.length>0&&!(++u>5);){var g=t.length;g>140&&(g=140);var m=t.substring(0,g);t=t.substring(g),u>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(w){}try{isNull(console)||isNull(console.log)||console.log(p+m+" ")}catch(f){}}else try{isNull(console)||isNull(console.log)||console.log(p+t+" ")}catch(f){}}catch(b){alert(b)}}function PutToDebugLogSpecial(e,o,n,t){function i(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(o){alert("ERROR, common: IsNumberInner"+o)}return!1}try{if(splevel<1){splevel=webphone_api.global.loglevel;var a=StrToInt(GetParameter("loglevel"));!isNull(a)&&i(a)&&a>splevel&&a<1e3&&(splevel=a),a=webphone_api.parameters.loglevel,!isNull(a)&&i(a)&&a>splevel&&a<1e3&&(splevel=a)}if(splevel<0&&(splevel=2),!isNull(e)&&i(e)&&e>splevel)return;if(void 0===o||null===o)return;n=void 0!==n&&null!==n&&!1!==n,void 0!==t&&null!==t||(t="");var r=GetLogTimeStamp();webphone_api.global.logs=webphone_api.global.logs+r+o+" "+t+"&#10;";try{if("false"==webphone_api.parameters.logtoconsole||0==webphone_api.parameters.logtoconsole)return}catch(l){}if(o="webphone: "+r+o+" "+t,!0===n&&webphone_api.global.colorizelog>0)try{console.error(o)}catch(p){}else try{console.log(o)}catch(p){}}catch(l){alert("PutToDebugLogSpecial"+l)}}function LogConfig(){function e(e){try{return void 0===e||null===e?"":(e=e.toLowerCase(),"undefined"==typeof o[e]||null===o[e]?"":o[e])}catch(n){}return""}if(CanLog(5))try{PutToDebugLog(5,"EVENT,built in Config parameters: ");var o=GetConfigAll(!1),n=e("loglevel");!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_loglevel: "+n),n=e("autotransportdetect"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_autotransportdetect: "+n),n=e("cfgusetunneling"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_cfgusetunneling: "+n),n=e("useencryption"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_useencryption: "+e("useencryption")),n=e("upperserverfromuser"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_upperserverfromuser: "+n),n=e("allowsimpleudpencrypt"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_allowsimpleudpencrypt: "+n),n=e("cantryudpdirectep"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_cantryudpdirectep: "+n),n=e("featureset"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_featureset: "+e("featureset")),n=e("brandid"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_brandid: "+e("brandid")),n=e("enabledirectcalls"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_enabledirectcalls: "+e("enabledirectcalls")),n=e("enabledirectcallstolan"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_enabledirectcallstolan: "+e("enabledirectcallstolan")),n=e("colortheme"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_colortheme: "+e("colortheme")),n=e("actionbarhideicon"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_actionbarhideicon: "+e("actionbarhideicon")),n=e("usemizuwebrtcgateway"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_usemizuwebrtcgateway: "+e("usemizuwebrtcgateway")),n=e("deploydate"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_deploydate: "+e("deploydate")),n=e("useg729"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_useg729: "+e("useg729")),n=e("hidedomaininput"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_hidedomaininput: "+e("hidedomaininput")),n=e("usestun"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_usestun: "+e("usestun")),n=e("serveraddress"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_serveraddress: "+e("serveraddress")),n=e("userport"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_userport: "+e("userport")),n=e("voicemail"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_voicemail: "+e("voicemail")),n=e("needapikey"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_needapikey: "+e("needapikey")),n=e("firstdeploydate"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_firstdeploydate: "+e("firstdeploydate")),n=e("lastdeploydate"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_lastdeploydate: "+e("lastdeploydate"))}catch(t){alert("LogConfig: "+t)}}function LogWebphoneInfo(e,o,n){if(CanLog(2))try{var t=GetWebphoneInfo(e);!isNull(t)&&t.length>0&&(PutToDebugLog(3,t),PutToDebugLog(3,"EVENT, Location: "+window.location.href+e)),isNull(o)||isNull(n)||PutToDebugLog(o,n);var i=!1;if((webphone_api.global.loglevel>=7||!0===webphone_api.global.isdebugversion&&webphone_api.global.loglevel>=5)&&(i=!0),webphone_api.global.loglevel<2&&"undefined"!=typeof console&&null!==console&&"undefined"!=typeof console.log&&null!==console.log&&!1===basicinfologged)return"false"!=webphone_api.parameters.logtoconsole&&0!=webphone_api.parameters.logtoconsole&&(console.log(t),console.log("Location: "+window.location.href+e)),void(basicinfologged=!0);if(!CanLog(5))return;if(!origparamslogged&&!isNull(webphone_api.origparameters)){origparamslogged=!0,PutToDebugLog(5,"EVENT,webphone_api.parameters (orig): ");for(var a in webphone_api.origparameters)if(!isNull(a)&&a.length>0){var r=webphone_api.origparameters[a];!isNull(r)&&r.length>0&&(r.indexOf("password")>0&&!i?r="'*'":(!IsNumber(r)||a.indexOf("username")||a.indexOf("sipusername")>=0)&&(r="'"+r+"'"),PutToDebugLog(5,"\t"+a+": "+r+","))}try{if(JSON.stringify(webphone_api.origparameters)===JSON.stringify(webphone_api.parameters))return}catch(l){}}if(!isNull(webphone_api.parameters)){PutToDebugLog(5,"EVENT,webphone_api.parameters: ");for(var a in webphone_api.parameters)if(!isNull(a)&&a.length>0){var r=webphone_api.parameters[a];!isNull(r)&&r.length>0&&(r.indexOf("password")>0&&!i?r="'*'":(!IsNumber(r)||a.indexOf("username")||a.indexOf("sipusername")>=0)&&(r="'"+r+"'"),PutToDebugLog(5,"\t"+a+": "+r+","))}}}catch(p){alert("LogWebphoneInfo: "+p)}}function GetWebphoneInfo(e,o){var n="";try{isNull(e)&&(e=""),n="About:",n+=e,n=n+"Brand: "+GetBrandName()+" Version: "+GetVersionStr()+" ("+webphone_api.global.code_version+")",!isNull(o)&&o.length>0&&(n=n+"Problem description: "+o+e);var t=webphone_api.platform.name,i=webphone_api.platform.version;(isNull(t)||"Android"===GetOs())&&(t=GetBrowser()),isNull(i)&&(i=GetBrowserVersion());var a="",r=new Date;if(!isNull(r)){var l=r.getMonth()+1;a=r.getFullYear()+"/"+l+"/"+r.getDate()}var p=IsWebphoneInIframe(),s="; isiframe: "+p.toString();!0===p&&(s=e+s+"; iframeParentLocation: "+GetParentIframeUrl());var c=webphone_api.platform.os;(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(c="iOS"),n=n+"; Build date: "+GetConfig("lastdeploydate"),n=n+"; OS: "+c+"; voipen: "+getuseengine()+"; date: "+a+s+e,n=n+"Browser: "+t+" "+i,n=n+"; Bengine: "+webphone_api.platform.layout,n=n+"; GetBrowser: "+GetBrowser()+"; Bver: "+GetBrowserVersion()+"; GetOs: "+GetOs();var u="";if(webphone_api.global.phonestarttick>0){var g=Math.floor((GetTickCount()-webphone_api.global.phonestarttick)/1e3),m=Math.floor(g/60);g%=60,g<10&&(g="0"+g),u=m+":"+g}n=n+"; Uptime: "+u;var b=GetLogLevel();void 0!==b&&null!==b||(b=""),b=b.toString(),n=n+"; loglevel: "+b;var h=!1;!0===IsSDK()&&(h=!0);try{n=n+"; Used as SDK: "+h.toString()}catch(d){}return n}catch(_){alert("GetWebphoneInfo: "+_)}return""}function xml_to_string(e){try{if(e.xml)return e.xml;if(XMLSerializer){return(new XMLSerializer).serializeToString(e)}return""}catch(o){PutToDebugLogException(2,"common: xml_to_string",o)}}function PutToDebugLogException(e,o,n){try{var t="";if(isNull(o)||isNull(e))return;void 0===n||null===n?PutToDebugLog(e,"ERROR, catch on "+o+" unknown exception"):("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(t=t+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(t=t+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(t=t+": "+n.lineNumber),PutToDebugLog(e,"ERROR, catch on "+o+" "+n+t)),(!0===webphone_api.global.usestorage||Strl(90))&&o.indexOf("There is an error in")>=0&&ShowToast("ERROR, "+o+n+t,8e3)}catch(i){}}function PutToDebugLogWarning(e,o,n){try{var t="";if(isNull(o)||isNull(e))return;void 0===n||null===n?PutToDebugLog(e,"WARNING, catch on "+o+" unknown exception"):("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(t=t+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(t=t+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(t=t+": "+n.lineNumber),PutToDebugLog(e,"WARNING, catch on "+o+" "+n+t))}catch(i){}}function ReplaceAll(e,o,n){try{return isNull(e)||isNull(o)||isNull(n)?(PutToDebugLogSpecial(2,"ERROR, common ReplaceAll null value",!0,""),""):(e=e.toString(),e.split(o).join(n))}catch(t){PutToDebugLogSpecial(2,"ERROR, ReplaceAll: ",!0,t)}return""}function Trim(e){try{return isNull(e)||e.lenght<1?"":(e=e.toString(),e.replace(/^\s+|\s+$/g,""))}catch(o){PutToDebugLogSpecial(2,"ERROR, common: Trim",!0,o)}return e}function EscapeRegExp(e){try{return isNull(e)||e.lenght<1?(PutToDebugLog(3,"ERROR, common EscapeRegExp null value"),""):e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}catch(o){PutToDebugLogException(2,"common: EscapeRegExp",o)}return""}function IsNumber(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(o){PutToDebugLogSpecial(2,"ERROR, common: IsNumber",!0,o)}return!1}function IsNumeric(e,o){try{if(void 0===e||null==e)return!1;e=e.toString(),e=e.replace(/\s+/g,"");var n=e.split("");if(isNull(n)||n.length<1)return!1;var t=[];if(void 0!==o&&null!==o&&o.length>0){t=o.split(","),void 0!==t&&null!==t||(t=[]);for(var i=0;i<t.length;)"undefined"==typeof t[i]||null===t[i]||1!==t[i].length?t.splice(i,1):i++}if(void 0!==t&&null!==t||(t=[]),t.length>0){for(var a=0;a<n.length;a++)if((n[a]<"0"||n[a]>"9")&&t.indexOf(n[a])<0)return!1}else for(var a=0;a<n.length;a++)if(n[a]<"0"||n[a]>"9")return!1;return!0}catch(r){PutToDebugLogSpecial(2,"ERROR, common: IsNumeric",!0,r)}return!1}function StrToInt(e){return"number"==typeof e&&isFinite(e)?e:isNull(e)||!IsNumber(e)?null:(e.toString().indexOf(" ")>=0&&(e=ReplaceAll(e.toString()," ","")),parseInt(e.toString(),10))}function StrToIntDef(e,o){if("number"==typeof e&&isFinite(e))return e;if(isNull(e)||!IsNumber(e))return o;e.toString().indexOf(" ")>=0&&(e=ReplaceAll(e.toString()," ",""));var n=parseInt(e.toString(),10);return isNaN(n)?o:n}function StrToIntPx(e){if("number"==typeof e&&isFinite(e))return e;if(isNull(e))return 0;e.toString().indexOf(" ")>=0&&(e=ReplaceAll(e.toString()," ",""));var o=parseInt(e.toString(),10);return isNaN(o)?0:o}function StrIsUpperCase(e){try{if(isNull(e))return!1;for(var o=!0,n=0,t=0;t<e.length;t++)if(n=e.charCodeAt(t),!(isNull(n)||n<65||n>90&&n<97||n>122)){var i=e.charAt(t);if(i===i.toLowerCase()){o=!1;break}}return o}catch(a){PutToDebugLogException(2,"common: StrIsUpperCase",a)}return!1}function GetDeviceWidth(){try{return Math.floor(webphone_api.$("#phone_app_main_container").width())}catch(e){PutToDebugLogException(2,"common: GetDeviceWidth",e)}}function GetDeviceHeight(){try{return Math.floor(webphone_api.$("#phone_app_main_container").height())}catch(e){PutToDebugLogException(2,"common: GetDeviceHeight",e)}}function IsWindowsSoftphone(){try{if(!0===isPlatformSet)return isWindows;var e=window.location.href;if(isNull(e)||e.length<1)return isPlatformSet=!0,isWindows;if(e=Trim(e),e.indexOf("platform")>0&&e.indexOf("windesktop")>0)return isPlatformSet=!0,isWindows=!0}catch(o){PutToDebugLogException(2,"common: IsWindowsSoftphone",o)}return isWindows}function DeviceType(){return webphone_api.global.deviceType}function DEVICE_WEBPHONE(){return CONST_DEVICE_WEBPHONE}function DEVICE_WIN_SOFTPHONE(){return CONST_DEVICE_WIN_SOFTPHONE}function DEVICE_ANDROID(){return CONST_DEVICE_ANDROID}function DEVICE_IPHONE(){return CONST_DEVICE_IPHONE}function DEVICE_BB(){return CONST_DEVICE_BB}function DEVICE_WP(){return CONST_DEVICE_WP}function isNull(e){try{return void 0===e||null===e}catch(o){PutToDebugLogSpecial(2,"ERROR,common: isNull",!0,o)}return!0}function IsFunction(e){try{if("function"===Object.prototype.toString.call(e).slice(8,-1).toLowerCase())return!0}catch(o){PutToDebugLogSpecial(2,"ERROR,common: IsFunction",!0,o)}return!1}function getBgColor(e){try{var o="#000000";if(webphone_api.$(e).length>0){var n=webphone_api.$(e).css("background-color"),t=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);!isNull(t)&&t.length>0&&delete t[0];for(var i=1;i<=3;++i)t[i]=parseInt(t[i]).toString(16),1==t[i].length&&(t[i]="0"+t[i]);o="#"+t.join("")}return o}catch(a){PutToDebugLogException(2,"common: getBgColor",a)}return"#000000"}function getElementColor(e){try{var o="#000000";if(webphone_api.$(e).length>0){var n=webphone_api.$(e).css("color"),t=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete t[0];for(var i=1;i<=3;++i)t[i]=parseInt(t[i]).toString(16),1==t[i].length&&(t[i]="0"+t[i]);o="#"+t.join("")}return o}catch(a){PutToDebugLogException(2,"common: getElementColor",a)}return"#000000"}function AlertDialog(e,o,n,t,i){try{if(isNull(o)&&(o=""),isNull(e)&&(e=""),o=o.replace("[BRAND]",GetBrandName()),!isNull(webphone_api.displaycb)||"function"==typeof webphone_api.displaycb)try{webphone_api.onDisplayCb(o,e)}catch(r){PutToDebugLogException(2,"There is an error in ondisplay() callback 1",r)}try{webphone_api.onEventCb("display",e+","+o,e)}catch(r){PutToDebugLogException(2,"There is an error in onEvent() callback 5",r)}if(!1===GetParameterBool("showtoasts",!0))return void(n&&"function"==typeof n&&n());var a=o;a===webphone_api.stringres.get("app_en_warning")&&(a=webphone_api.stringres.get("app_en_warning_short")),isNull(i)||!1!==i?PutToDebugLog(1,"EVENT,"+a):a.length<400&&a.indexOf("\n")<0&&a.indexOf("<")<0&&PutToDebugLog(3,"EVENT,"+a),!0===IsSDK()?setTimeout(function(){try{AlertDialogSDK(e,o,n)}catch(r){PutToDebugLogException(2,"common: AlertDialog - SDK",r)}},100):setTimeout(function(){try{AlertDialogDelayed(e,o,n,t)}catch(r){PutToDebugLogException(2,"common: AlertDialog - Delayed",r)}},100)}catch(r){PutToDebugLogException(2,"common: AlertDialog",r)}}function AlertDialogDelayed(e,o,n,t){try{n=n||function(){};var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220,i>400?i=400:i<120&&(i=120),isNull(t)&&(t=webphone_api.stringres.get("btn_close"));var a='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+e+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span style="-ms-user-select: text; -moz-user-select: text; -khtml-user-select: text; -webkit-user-select: text;  user-select: text;"> '+o+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_alert_ok" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+t+"</a></div></div>";!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e+100&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#btn_adialog_alert_ok").off("click"),n(!1)}})),webphone_api.$("#btn_adialog_alert_ok").on("click",function(){n&&"function"==typeof n&&(n(!0),n=function(){})})}catch(r){PutToDebugLogException(2,"common: AlertDialog",r)}}function ShowToast(e,o,n){try{(isNull(o)||!IsNumber(o)&&e.length>75)&&(o=e.length-75,o=3e3+o),setTimeout(function(){ShowToastDelayed(e,o,n)},100)}catch(t){PutToDebugLogSpecial(2,"common: ShowToastF",!0,t)}}function ShowToastDelayed(e,o,n){try{if(n=n||function(){},!isNull(webphone_api.displaycb)||"function"==typeof webphone_api.displaycb)try{webphone_api.onDisplayCb(e,"")}catch(a){PutToDebugLogException(2,"There is an error in ondisplay() callback 2",a)}try{webphone_api.onEventCb("display",","+e,null)}catch(a){PutToDebugLogException(2,"There is an error in onEvent() callback 6",a)}if(!1===GetParameterBool("showtoasts",!0))return void(n&&"function"==typeof n&&n());if(!0===IsSDK())return void ShowToastSDK(e,o);if(!isNull(e)&&!0===webphone_api.global.isSettingsStarted&&e.toLowerCase().indexOf("register")>=0&&e.toLowerCase().indexOf("failed")>0)return;var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120);var i='<div data-role="popup" style="padding: .5em;" class="ui-content toastPopup" data-overlay-theme="b" data-transition="fade" data-theme="a" style="max-width:'+t+'px"><span> '+e+" </span></div>";webphone_api.$.mobile.activePage.append(i).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".toastPopup").popup("close")}),webphone_api.$.mobile.activePage.find(".toastPopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),n()}}),isNull(o)&&(o=3e3),o>0&&setTimeout(function(){webphone_api.$.mobile.activePage.find(".toastPopup").popup("close")},o)}catch(a){PutToDebugLogSpecial(2,"common: ShowToast",!0,a)}}function UsePresence2(){try{if(!1===Glpr())return!1;var e=0,o=GetParameterInt("enablepresence",0),n=GetParameterInt("enablepresence2",0);if(IsNumber(o)&&StrToInt(o)>0&&(e=StrToInt(o)),IsNumber(n)&&StrToInt(n)>0&&(e=StrToInt(n)),isNull(enablepres_httpapi)&&(enablepres_httpapi=GetParameterInt("enablepres_httpapi",1),enablepres_javaapi=GetParameterInt("enablepres_javaapi",1),enablepres_webrtc=GetParameterInt("enablepres_webrtc",1)),e<1)return!1;if(e>1)return!0;if(1===e){if(!1===webphone_api.global.usestorage&&!1===Strl(90))return!1;if(enablepres_httpapi<1&&enablepres_javaapi<1&&enablepres_webrtc<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_1"),errmsgdisp=!0),!1;if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&enablepres_webrtc<1&&enablepres_httpapi<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_2"),errmsgdisp=!0),!1;if((!0===IsWindowsSoftphone()||getuseengine()===webphone_api.global.ENGINE_JAVA||getuseengine()===webphone_api.global.ENGINE_SERVICE)&&enablepres_javaapi<1&&enablepres_httpapi<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_3"),errmsgdisp=!0),!1;if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&enablepres_webrtc<1&&enablepres_httpapi>0){if(GetHttpAPIKey().length<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_4"),errmsgdisp=!0),!1}else if(enablepres_httpapi>0&&enablepres_javaapi<1&&enablepres_webrtc<1){if(!IsMizuServerOrGateway())return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_5"),errmsgdisp=!0),!1}else{if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.global.recwsload>1)return!1===errmsgdisp&&(PutToDebugLog(2,"WARNING, common Presence disabled_6 high webrtc load"),errmsgdisp=!0),!1;if(!0===IsSDK()&&IsMizuServerOrGateway())return!1}return!0}}catch(t){PutToDebugLogException(2,"common: UsePresence2",t)}return!1}function GetPresenceServer2(){try{if(!UsePresence2())return"";var e=-1,o=GetParameter("mainaport"),n=GetParameter("mainaporttls"),t="",i=GetUsableWebrtcSrvAddr();if(!isNull(i)&&i.length>0&&(i=NormalizeInput(i,0),e=i.indexOf("/"),e>0&&(i=i.substring(0,e)),e=i.indexOf(":"),e>0&&(i=i.substring(e+1)),!isNull(i)&&IsNumber(i)&&(t=i)),IsMizuServerOrGateway()){var a=GetParameter2("serveraddress_user");return(isNull(a)||a.length<2)&&(a=GetParameter2("serveraddress")),(IsIPAddrress(a)||!1===UseSecureSrvConnection())&&o.length>0?(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="http://"+a+":"+o):((isNull(t)||t.length<1)&&(t=n),!isNull(t)&&t.length>0&&(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="https://"+a+":"+t)),a}if(GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1)){var a=GetParameter2("tunnelserveraddress");return(IsIPAddrress(a)||!1===UseSecureSrvConnection())&&o.length>0?(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="http://"+a+":"+o):((isNull(t)||t.length<1)&&(t=n),!isNull(t)&&t.length>0&&(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="https://"+a+":"+t)),a}if(getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&getuseengine()!==webphone_api.global.ENGINE_FLASH&&(a=GetServerForHttpReq(),!isNull(a)&&a.length>0))return a;var r=0,l=GetParameterInt("enablepresence",0),p=GetParameterInt("enablepresence2",0);if(IsNumber(l)&&StrToInt(l)>0&&(r=StrToInt(l)),IsNumber(p)&&StrToInt(p)>0&&(r=StrToInt(p)),!0===IsMizuPublicWebRTCGatewayUsed()||2===r){var s="";return s=!0===UseSecureSrvConnection()?StrDc(wips_uk,alsvkey):StrDc(wip_uk,alsvkey),s=NormalizeInput(s,0),e=s.indexOf("/"),e>0&&(s=s.substring(0,e)),s=Trim(s),s=!0===UseSecureSrvConnection()?"https://"+s:"http://"+s}}catch(c){PutToDebugLogException(2,"common: GetPresenceServer2",c)}return""}function PresenceVerifyuser2(e){try{if(isNull(e)||e.length<1)return;var o="http://";UseSecureSrvConnection()&&(o="https://");var n=GetPresenceServer2();if(n.indexOf("://")>0&&(o=""),isNull(n)||n.length<2)return void PutToDebugLog(3,"ERROR, PresenceVerifyuser2 invalid server");var t=GetHttpAPIKey();GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(t="1568108399");UriParser(o+n+"/?apientry=verifyuser&authkey="+t+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&userlist="+e,"","","","","presence_verify")}catch(i){PutToDebugLogException(2,"common: PresenceVerifyuser2",i)}}function PresenceGet2(e){try{if(isNull(e)||e.length<1)return;if(e=e.replace(" ",""),isNull(pgstart_timer)||clearTimeout(pgstart_timer),pgstart_timer=null,(getuseengine().length<1||webphone_api.global.phonestarted<3)&&pgmaxloop<120)return pgmaxloop++,void(pgstart_timer=setTimeout(function(){PresenceGet2(e)},1e3));pgmaxloop=0;var o="",n=GetHttpAPIKey();if(GetPresenceServer2().indexOf("rtc.mizu-voip.com:2443")>=0&&(n="1568108399"),IsMizuServerOrGateway()){var t="http://";IsHttps()&&(t="https://");var i=GetPresenceServer2();if(i.indexOf("://")>0&&(t=""),!isNull(i)&&i.length>2){var a="1";!0===first_presence_req&&(a="0",first_presence_req=!1);var r="";GetParameter("upperserver").length>0&&(r=GetParameter("upperserver")),
o=t+i+"/mvapireq/?apientry=presence_get&authkey="+n+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&ptype="+a+"&domain="+r+"&userlist="+e}}!isNull(enablepres_httpapi)&&enablepres_httpapi>0&&o.length>0&&UriParser(o,"","","","","presence_get"),!isNull(enablepres_webrtc)&&enablepres_webrtc>0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.PresenceGet(e),!isNull(enablepres_javaapi)&&enablepres_javaapi>0&&(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?WinAPI("API_CheckPresence",null,e):getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.CheckPresence(e))}catch(l){PutToDebugLogException(2,"common: PresenceGet2",l)}}function PresenceSet2(){try{var e="",o=GetParameter("presencestatus");if(IsMizuServerOrGateway()){var n="http://";UseSecureSrvConnection()&&(n="https://");var t=GetPresenceServer2();t.indexOf("://")>0&&(n="");var i=GetHttpAPIKey();GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(i="1568108399"),!isNull(t)&&t.length>2&&(e=n+t+"/mvapireq/?apientry=presence_set&authkey="+i+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&pstatus="+o)}!isNull(enablepres_httpapi)&&enablepres_httpapi>0&&e.length>0&&UriParser(e,"","","","","presence_set"),!isNull(enablepres_webrtc)&&enablepres_webrtc>0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.PresenceSet(o),!isNull(enablepres_javaapi)&&enablepres_javaapi>0&&(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?WinAPI("API_SetPresenceStatus",null,o):getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.SetPresenceStatus(o))}catch(a){PutToDebugLogException(2,"common: PresenceSet2",a)}}function SaveReceivedPresence2(e,o){try{if(isNull(e)||e.length<1)return void PutToDebugLog(3,"ERROR, SaveReceivedPresence2 number is NULL: "+e);if(isNull(o)||o.length<1)return void PutToDebugLog(3,"ERROR, SaveReceivedPresence2 status is NULL: "+o);e=Trim(e),e=e.toLowerCase(),o=Trim(o),o=o.toLowerCase(),"notexists"===o&&(o="not exists");var n=!1,t="-1";if("open"===o||"online"===o||"reachable"===o||"available"===o||"call me"===o||"registered"===o)t="5",webphone_api.common.UpdateContactLastActive(e),n=!0;else if("dnd"===o||"busy"===o||"speaking"===o)t="4",n=!0;else if("pending"===o||"forwarding"===o)t="3",n=!0;else if("away"===o||"idle"===o)t="2",n=!0;else if("invisible"===o)t="1",n=!0;else if("closed"===o||"close"===o||"unreachable"===o||"offline"===o||"unregistered"===o)t="0",n=!0;else{if("unknown"!==o&&"not set"!==o&&"not exists"!==o)return"-2";t="-1",n=!0}var i=GetTickCount().toString();if(webphone_api.global.presenceHM[e]=[],webphone_api.global.presenceHM[e][PRES_STATUS]=t,webphone_api.global.presenceHM[e][PRES_TIME]=i,!1===n&&PutToDebugLog(3,"ERROR, SaveReceivedPresence2 invalid status: "+o),!isNull(webphone_api.global.checkpres_callback)&&webphone_api.global.checkpres_callback.length>0){var a=webphone_api.global.checkpres_callback.pop();a&&"function"==typeof a&&a(e,o)}return t}catch(r){PutToDebugLogException(2,"common: SaveReceivedPresence2",r)}return"-1"}function StartPresence2(){try{if(!UsePresence2())return;if(!0===webphone_api.global.presence_started)return;if(isNull(startpres_timer)||clearTimeout(startpres_timer),startpres_timer=null,(getuseengine().length<1||webphone_api.global.phonestarted<3)&&spmaxloop<120)return spmaxloop++,void(startpres_timer=setTimeout(function(){StartPresence2()},1e3));spmaxloop=0,webphone_api.global.presence_started=!0,PutToDebugLog(2,"EVENT, common StartPresence2");var e=GetParameterInt("verifyuser",0),o=GetAllContactsNumbersSipuris();isNull(o)&&(o=""),o.length>0&&(o=ReplaceAll(o," ",""),o=ReplaceAll(o,"-",""),o=ReplaceAll(o,"(",""),o=ReplaceAll(o,")","")),o.length>0&&(GetParameter("devicetype")!==DEVICE_WIN_SOFTPHONE()&&getuseengine()!==webphone_api.global.ENGINE_SERVICE||WinAPI("API_PushContactlist",null,o),getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.PushContactlist(o)),webphone_api.global.isdebugversion||e<1||GetTickCount()-e>2592e6?(PutToDebugLog(2,"EVENT, common StartPresence2 verifyuser"),PresenceVerifyuser2(o),SaveParameter("verifyuser",GetTickCount())):PresenceGet2(GetParameter("srvcontacts"))}catch(n){PutToDebugLogException(2,"common: StartPresence2",n)}}function PresenceProcessUserlist2(e,o){try{if(isNull(e)||e.length<1)return;if(e=e.toString(),e.toLowerCase().indexOf("error")>=0||e.toLowerCase().indexOf("auserlist:")<0&&e.toLowerCase().indexOf("puserlist:")<0)return void(e.toLowerCase().indexOf("no users found")>=0?PutToDebugLog(2,"EVENT, PresenceProcessUserlist2: no users: "+e):0==e.toLowerCase().indexOf("<html")?PutToDebugLog(2,"WARNING, PresenceProcessUserlist2: html"):PutToDebugLog(2,"ERROR, PresenceProcessUserlist2: "+e));var n=e;!isNull(n)&&n.length>500&&(n=n.substring(0,500)),PutToDebugLog(4,"EVENT, PresenceProcessUserlist2: "+n);var t=e.indexOf("auserlist:");t<1&&(t=e.indexOf("puserlist:")),t>0&&(e=Trim(e.substring(t+10,e.length)));var i=e.split(",");if(isNull(i)||i.length<1)return;var a=GetParameter("srvcontacts"),r=a.split(",");isNull(r)&&(r=[]);for(var l=0;l<i.length;l++){var p=i[l];if(!(isNull(p)||p.length<1||p.indexOf(":")<0)){var s=Trim(p.substring(0,p.indexOf(":"))),c=Trim(p.substring(p.indexOf(":")+1));c=c.toLowerCase();var u=SaveReceivedPresence2(s,c);webphone_api._dialpad.PopulateListRecents(),!0===webphone_api.global.isContactdetailsStarted&&webphone_api._contactdetails.PopulateData(),!0===webphone_api.global.isMessageStarted&&webphone_api._message.DisplayPresence(u);for(var g=!0,m=0;m<r.length;m++)if(!isNull(r[m])&&r[m]===s){g=!1;break}g&&r.push(s)}}var b="";if(!isNull(r)&&r.length>0)for(var l=0;l<r.length;l++)isNull(r[l])||Trim(r[l]).length<1||(b.length>0&&(b+=","),b+=r[l]);SaveParameter("srvcontacts",b),webphone_api.global.waitforpresence=0}catch(h){PutToDebugLogException(2,"common: PresenceProcessUserlist2",h)}}function PresenceSelector(e,o){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120),PutToDebugLog(2,"EVENT, PresenceSelector called from: "+e);var t=GetParameter("presencestatus");(isNull(t)||t.length<1)&&(t="Online",SaveParameter("presencestatus",t));var i="",a="",r="",l="",p="";"Online"===t?i='checked="checked"':"Away"===t?a='checked="checked"':"DND"===t?r='checked="checked"':"Invisible"===t?l='checked="checked"':"Offline"===t&&(p='checked="checked"');var s='<form><fieldset data-role="controlgroup"><input name="presence_sel" id="radio_online" value="on" '+i+' type="radio"><label for="radio_online">'+webphone_api.stringres.get("presence_stat_online")+'</label><input name="presence_sel" id="radio_away" value="on" '+a+' type="radio"><label for="radio_away">'+webphone_api.stringres.get("presence_stat_away")+'</label><input name="presence_sel" id="radio_dnd" value="on" '+r+' type="radio"><label for="radio_dnd">'+webphone_api.stringres.get("presence_stat_dnd")+'</label><input name="presence_sel" id="radio_invisible" value="on" '+l+' type="radio"><label for="radio_invisible">'+webphone_api.stringres.get("presence_stat_invisible")+'</label><input name="presence_sel" id="radio_offline" value="on" '+p+' type="radio"><label for="radio_offline">'+webphone_api.stringres.get("presence_stat_offline")+"</label></fieldset></form>",c='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("presence_title")+'</h1></div><div role="main" class="ui-content">'+s+"</div></div>";o=o||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(c).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),o()}})),webphone_api.$(":radio").on("change",function(e){!1===IsSDK()&&webphone_api.$.mobile.activePage.find(".messagePopup").popup("close");var o=webphone_api.$(this).attr("id");if(!(isNull(o)||o.length<1)){var n=o.indexOf("_");n>0&&n<o.length&&(o=o.substring(n+1)),PutToDebugLog(2,"EVENT, PresenceSelector USER selected: "+o),SetSelectedPresence(o)}})}catch(u){PutToDebugLogException(2,"common: PresenceSelector",u)}}function SetSelectedPresence(e,o){try{(isNull(e)||e.length<1)&&(e=GetParameter("presencestatus"),PutToDebugLog(2,"WARNING, SetSelectedPresence invalid status: "+e)),CanLog(3)&&PutToDebugLog(3,"EVENT, SetSelectedPresence status: "+e+"; allow unregister: "+o),e=Trim(e.toLowerCase());var n='<img src="'+GetElementSource()+'images/presence_green.png" />';"offline"===e?(n='<img src="'+GetElementSource()+'images/presence_grey.png" />',SaveParameter("presencestatus","Offline"),!1!==o&&webphone_api.global.phonestarted>2&&(webphone_api.global.pres_unreg_called=!0,PutToDebugLog(2,"EVENT, mlogic API_Unregister SetSelectedPresence Offline"),webphone_api.unregister())):"invisible"===e?(n='<img src="'+GetElementSource()+'images/presence_white.png" />',SaveParameter("presencestatus","Invisible"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(webphone_api.global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence invisible"),webphone_api.register())):"away"===e?(n='<img src="'+GetElementSource()+'images/presence_yellow.png" />',SaveParameter("presencestatus","Away"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(webphone_api.global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence away"),webphone_api.register())):"dnd"===e?(n='<img src="'+GetElementSource()+'images/presence_red.png" />',SaveParameter("presencestatus","DND"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(webphone_api.global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence dnd"),webphone_api.register())):"online"===e&&(n='<img src="'+GetElementSource()+'images/presence_green.png" />',SaveParameter("presencestatus","Online"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence online"),webphone_api.register(),webphone_api.global.pres_unreg_called=!1));var t=document.getElementById("dialpad_presence"),i=document.getElementById("contactslist_presence"),a=document.getElementById("callhistorylist_presence");isNull(t)||(t.innerHTML=n,setTimeout(function(){"undefined"!=typeof webphone_api._dialpad&&null!==webphone_api._dialpad&&webphone_api._dialpad.MeasureDialPad()},10)),isNull(i)||(i.innerHTML=n,setTimeout(function(){"undefined"!=typeof webphone_api._contactslist&&null!==webphone_api._contactslist&&webphone_api._contactslist.MeasureContacslist()},10)),isNull(a)||(a.innerHTML=n,setTimeout(function(){"undefined"!=typeof webphone_api._callhistorylist&&null!==webphone_api._callhistorylist&&webphone_api._callhistorylist.MeasureCallhistorylist()},10)),webphone_api.global.phonestarted>2&&PresenceSet2()}catch(r){PutToDebugLogException(2,"common: SetSelectedPresence",r)}}function HelpWindow(e,o){try{if(60===GetConfigInt("brandid",-1))return void AboutWindow();var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120);var t="",i='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',a=ReplaceAll(webphone_api.stringres.get("help_text"),"[BRANDNAME]",GetBrandName()),r=GetBrandName();"cryptphone"!==r.toLowerCase()&&r.toLowerCase().indexOf("mizu")<0&&(a=ReplaceAll(webphone_api.stringres.get("help_text_custom"),"[BRANDNAME]",GetBrandName())),2===GetParameterInt("brandid",-1)&&(a=ReplaceAll('Contact GMSDIALER support:<br /><br /><a href="mailto:support@gmstechuk.com">support@gmstechuk.com</a>',"[BRANDNAME]",GetBrandName()));var l="";!0!==GetParameterBool("customizedversion",!0)&&!0===webphone_api.global.usestorage&&(l='<li id="#item_help"><a href="https://www.mizu-voip.com/Portals/0/Files/Webphone_Documentation.pdf" target="_blank">[ITEMTITLE]</a></li>',l=l.replace("[ITEMTITLE]",GetBrandName()+" "+webphone_api.stringres.get("help_help")),t+=l,l="");var p=GetParameter2("webcallme");!1!==IsWindowsSoftphone()||isNull(p)||1!==p.length||"0"===p||(l=i.replace("[ITEMID]","#item_webcallme"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("menu_webcallme")),t+=l,l=""),1===GetLogLevel()?(l=i.replace("[ITEMID]","#item_enablelog"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("help_enablelog")),t+=l,l=""):(l=i.replace("[ITEMID]","#item_logwindow"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("help_logwindow")),t+=l,l=""),l=i.replace("[ITEMID]","#item_reconnect"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("menu_reconnect")),t+=l,l="";webphone_api.global.usestorage&&(l=i.replace("[ITEMID]","#item_upgrade"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("btn_upgrade")),t+=l,l=""),l=i.replace("[ITEMID]","#item_about"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("help_about")),t+=l,l="";var s='<div id="help_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("menu_help")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="help_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+t+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";o=o||function(){},webphone_api.$.mobile.activePage.append(s).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#help_window_ul").off("click","li"),o()}}),webphone_api.$("#help_window_ul").on("click","li",function(e){var o=webphone_api.$(this).attr("id");"#item_help"===o&&(webphone_api.$("#help_window").popup("close"),AlertDialog(GetBrandName()+" "+webphone_api.stringres.get("help_help"),a,null,null,!1)),webphone_api.$("#help_window").on("popupafterclose",function(e){if(webphone_api.$("#help_window").off("popupafterclose"),"#item_proversion"===o)UpgradeToProVersion();else if("#item_upgrade"===o)Opu();else if("#item_loging"===o)LogWindow();else if("#item_rate"===o)alert("not implemented yet");else if("#item_about"===o)AboutWindow();else if("#item_webcallme"===o)GenerateWebcallmeLink();else if("#item_reconnect"===o)webphone_api.global.authenticated_displayed=!1,webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_Restart",null):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.webphone.Restart():(webphone_api.plhandler.Start(webphone_api.parameters,!1),webphone_api.plhandler.Stop(!0),setTimeout(function(){webphone_api.startInner()},1500));else if("#item_enablelog"===o){var n=GetLogLevel();n<webphone_api.global.predefLoglevel&&(n=webphone_api.global.predefLoglevel),SaveParameter("loglevel",n.toString()),SaveParameter("jsscriptevent","3"),webphone_api.setparameter("jsscriptevent","3"),webphone_api.global.loglevel=n}else"#item_logwindow"===o&&webphone_api.$.mobile.changePage("#page_logview",{transition:"pop",role:"page"})})})}catch(c){PutToDebugLogException(2,"common: HelpWindow",c)}}function GenerateWebcallmeLink(){var e=window.location.href;try{if(isNull(e))return;e=Trim(e);var o=e.indexOf("?");o>0&&(e=e.substring(0,o)),o=e.indexOf("#"),o>0&&(e=e.substring(0,o)),e=Trim(e),e+="?wp_serveraddress=YOURSIPDOMAIN&wp_username=USERNAME&wp_password=PASSWORD&wp_callto=CALLEDNUMBER";var n=GetParameter("serveraddress_user"),t=GetSipusername();e=e.replace("YOURSIPDOMAIN",n),e=e.replace("USERNAME","webcallme"),e=e.replace("PASSWORD","webcallme"),e=e.replace("CALLEDNUMBER",t);var i=webphone_api.stringres.get("webcallme_msg")+":";i=i+'<br /><br /><textarea id="webcallme_textarea" class="noshadow" data-theme="a">'+e+"</textarea>",AlertDialog(webphone_api.stringres.get("menu_webcallme"),i,null,null,!1)}catch(a){PutToDebugLogException(2,"common: GenerateWebcallmeLink",a)}}function AboutWindow(){try{if("warble"===GetBrandName().toLowerCase())return void OpenWebURL("https://support.warbleapp.com","");var e=GetBrandName();60===GetConfigInt("brandid",-1)&&(e="VoIPMuchPhone");var o=webphone_api.stringres.get("help_about")+" "+e,n="",t=[];t.push("m"),t.push("i"),t.push("z"),t.push("u"),t.push("-"),t.push("v"),t.push("o"),t.push("i"),t.push("p");var i=t.join("");!isNull(e)&&e.length>0&&(n=n+e+" "+GetVersionStr());var a=GetConfig("homepage");if(!isNull(a)&&a.length>0){var r=a.indexOf(",");r>0&&(a=Trim(a.substring(0,r))),n=n+'<div class="about_item"><a href="'+a+'" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\''+a+"')\">"+webphone_api.stringres.get("about_homepage")+"</a></div>"}else if(webphone_api.global.usestorage){var t="http://www."+i+".com/Software/WebPhone.aspx";n=n+'<div class="about_item"><a href="'+t+'" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\''+t+"')\">"+webphone_api.stringres.get("about_homepage")+"</a></div>"}var l=GetConfig("supporturl");if(!isNull(l)&&l.length>0)n=n+'<div class="about_item"><a href="'+l+'" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\''+l+"')\">"+webphone_api.stringres.get("about_support")+"</a></div>";else{var p=GetConfig("supportmail");!isNull(p)&&p.length>0?n=n+'<div class="about_item"><a href="mailto:'+p+'" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\''+p+"')\">"+webphone_api.stringres.get("about_support")+"</a></div>":webphone_api.global.usestorage&&(p="support@"+i+".com",n=n+'<div class="about_item"><a href="mailto:'+p+'" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\''+p+"')\">"+webphone_api.stringres.get("about_support")+"</a></div>")}var s=GetConfig("logo");!isNull(s)&&s.length>2&&(s.toLowerCase().indexOf(".jpg")>0||s.toLowerCase().indexOf(".jpeg")>0||s.toLowerCase().indexOf(".png")>0||s.toLowerCase().indexOf(".gif")>0)&&(n=n+'<br /><img src="'+GetElementSource()+"images/"+s+'" style="width: 100%; border: 0;">');var c=GetConfig("companyname"),u=new Date,g=u.getFullYear();if(!isNull(c)&&c.length>0)n=n+'<div class="about_item2"><i>'+webphone_api.stringres.get("about_copyright")+" "+g+" "+c+"<br />"+webphone_api.stringres.get("about_copyright2")+"</i></div>";else if(webphone_api.global.usestorage){var m=[];m.push("M"),m.push("i"),m.push("z"),m.push("u"),m.push("t"),m.push("e"),m.push("c"),m.push("h "),m.push("S"),m.push("R"),m.push("L"),c=m.join(""),n=n+'<div class="about_item2"><i>'+webphone_api.stringres.get("about_copyright")+" "+g+" "+c+"<br />"+webphone_api.stringres.get("about_copyright2")+"</i></div>"}var b=GetConfig("licenseurl");n=!isNull(b)&&b.length>0?n+'<div class="about_item2"><a href="'+b+'" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\''+b+"')\">"+webphone_api.stringres.get("about_license")+"</a></div>":n+'<div class="about_item2"><a href="javascript:;" onclick="webphone_api.common.LicenseAgreementWindow()">'+webphone_api.stringres.get("about_license")+"</a></div>",IsWindowsSoftphone()&&"true"==GetConfig("needactivation")&&!1===CanShowLicKeyInput()&&(n=n+'<div class="about_item2"><i>'+webphone_api.stringres.get("activated")+"</i></div>"),AlertDialog(o,n,null,null,!1)}catch(h){PutToDebugLogException(2,"common: AboutWindow",h)}}function Opu(){try{var e=[];e.push("h"),e.push("t"),e.push("t"),e.push("p"),e.push("s"),e.push(":"),e.push("/"),e.push("/"),e.push("w"),e.push("w"),e.push("w"),e.push("."),e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p"),e.push("."),e.push("c"),e.push("o"),e.push("m"),e.push("/"),e.push("S"),e.push("u"),e.push("p"),e.push("p"),e.push("o"),e.push("r"),e.push("t"),e.push("/"),e.push("W"),e.push("e"),e.push("b"),e.push("p"),e.push("h"),e.push("o"),e.push("n"),e.push("e"),e.push("p"),e.push("r"),e.push("i"),e.push("c"),e.push("i"),e.push("n"),e.push("g"),e.push("."),e.push("a"),e.push("s"),e.push("p"),e.push("x"),e.push("?"),e.push("S"),e.push("k"),e.push("i"),e.push("n"),e.push("S"),e.push("r"),e.push("c"),e.push("="),e.push("P"),e.push("o"),e.push("r"),e.push("t"),e.push("a"),e.push("l"),e.push("s"),e.push("/"),e.push("_"),e.push("d"),e.push("e"),e.push("f"),e.push("a"),e.push("u"),e.push("l"),e.push("t"),e.push("/"),e.push("S"),e.push("k"),e.push("i"),e.push("n"),e.push("s"),e.push("/"),e.push("D"),e.push("a"),e.push("r"),e.push("k"),e.push("K"),e.push("n"),e.push("i"),e.push("g"),e.push("h"),e.push("t"),e.push("M"),e.push("o"),e.push("b"),e.push("i"),e.push("l"),e.push("e"),e.push("/"),e.push("h"),e.push("o"),e.push("m"),e.push("e"),e.push("&"),e.push("C"),e.push("o"),e.push("n"),e.push("t"),e.push("a"),e.push("i"),e.push("n"),e.push("r"),e.push("S"),e.push("r"),e.push("c"),e.push("="),e.push("P"),e.push("o"),e.push("r"),e.push("t"),e.push("a"),e.push("l"),e.push("s"),e.push("/"),e.push("_"),e.push("d"),e.push("e"),e.push("f"),e.push("a"),e.push("u"),e.push("l"),e.push("t"),e.push("/"),e.push("C"),e.push("o"),e.push("n"),e.push("t"),e.push("a"),e.push("i"),e.push("n"),e.push("e"),e.push("r"),e.push("s"),e.push("/"),e.push("D"),e.push("a"),e.push("r"),e.push("k"),e.push("K"),e.push("n"),e.push("i"),e.push("g"),e.push("h"),e.push("t"),e.push("/"),e.push("P"),e.push("a"),e.push("g"),e.push("e"),e.push("T"),e.push("i"),e.push("T"),e.push("i"),e.push("t"),e.push("l"),e.push("l"),e.push("e"),e.push("_"),e.push("B"),e.push("l"),e.push("u"),e.push("e");var o=e.join(""),n=window.open(o);n&&!n.closed&&"undefined"!=typeof n.closed||OpenWebURL(o,"")}catch(t){PutToDebugLogException(2,"common: Abs",t)}}function LicenseAgreementWindow(){try{var e=GetConfig("companyname"),o=GetConfig("brandname");if((isNull(e)||e.length<2)&&webphone_api.global.usestorage){var n=[];n.push("M"),n.push("i"),n.push("z"),n.push("u"),n.push("t"),n.push("e"),n.push("c"),n.push("h "),n.push("S"),n.push("R"),n.push("L"),e=n.join("")}(isNull(e)||e.length<2)&&(e=o);var t="";t=!0===webphone_api.global.usestorage||Strl(60)?ReplaceAll(webphone_api.stringres.get("dlg_about_msg"),"[BRANDNAME]",o):ReplaceAll(webphone_api.stringres.get("dlg_about_msg2"),"[BRANDNAME]",o),t=ReplaceAll(t,"[APPVERSION]",GetVersionStr());var i=e;(isNull(i)||i.length<2)&&(i=o),t=ReplaceAll(t,"[COMPANY]",i),webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),setTimeout(function(){AlertDialog(webphone_api.stringres.get("about_license"),t.toString(),null,null,!1)},200)}catch(a){PutToDebugLogException(2,"common: LicenseAgreementWindow",a)}}function LogWindow(e){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120);var n="",t='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',i="";1!==GetParameterInt("loglevel",1)?(i=t.replace("[ITEMID]","#item_stoplog"),i=i.replace("[ITEMTITLE]",webphone_api.stringres.get("help_stoplog")),n+=i,i="",i=t.replace("[ITEMID]","#item_sendlog"),i=i.replace("[ITEMTITLE]",webphone_api.stringres.get("help_sendlog")),n+=i,i=""):(i=t.replace("[ITEMID]","#item_startlog"),i=i.replace("[ITEMTITLE]",webphone_api.stringres.get("help_startlog")),n+=i,i="");var a='<div id="log_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("help_loging")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="log_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+n+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";e=e||function(){},webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#log_window_ul").off("click","li"),e()}}),webphone_api.$("#log_window_ul").on("click","li",function(e){var o=webphone_api.$(this).attr("id");webphone_api.$("#log_window").on("popupafterclose",function(e){if(webphone_api.$("#log_window").off("popupafterclose"),"#item_startlog"===o){var n=GetLogLevel();n<webphone_api.global.predefLoglevel&&(n=webphone_api.global.predefLoglevel),SaveParameter("loglevel",n.toString()),SaveParameter("jsscriptevent","3"),webphone_api.setparameter("jsscriptevent","3"),webphone_api.global.loglevel=n}else"#item_stoplog"===o?(SaveParameter("loglevel","1"),SaveParameter("jsscriptevent","2"),webphone_api.setparameter("jsscriptevent","2"),webphone_api.global.loglevel=1,webphone_api.$("#log_text").html("")):"#item_sendlog"===o&&webphone_api.$.mobile.changePage("#page_logview",{transition:"pop",role:"page"})})})}catch(r){PutToDebugLogException(2,"common: LogWindow",r)}}function UpgradeToProVersion(e){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120);var n='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("help_proversion")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+webphone_api.stringres.get("proversion_content_text")+' </span><br /><button id="btn_buynow">Buy now</button><br />'+webphone_api.stringres.get("license_key")+': <input type="text" id="proversion_input" name="setting_item" data-theme="a" placeholder="'+webphone_api.stringres.get("enter_license_key")+'" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_upgrade" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_activate")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";e=e||function(){},webphone_api.$.mobile.activePage.append(n).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#btn_upgrade").off("click"),e()}}),webphone_api.$("#btn_upgrade").on("click",function(){var e=document.getElementById("proversion_input").value;if(isNull(e)||Trim(e).length<1)return void ShowToast("Invalid license key.");e=Trim(e),WinAPI("API_EnterLicKey",function(e){},e),setTimeout(function(){canshowlickeyinput=null,CanShowLicKeyInput()},1e4)}),webphone_api.$("#btn_buynow").on("click",function(){OpenLinkInExternalBrowser("https://www.mizu-voip.com/Support/Store.aspx")})}catch(t){PutToDebugLogException(2,"common: UpgradeToProVersion",t)}}function GetTickCount(){try{return(new Date).getTime()}catch(e){PutToDebugLogSpecial(2,"common: GetTickCount",!0,e)}return 0}function HoverCalc(e,o){try{var n=e,t=e.indexOf("#");if(t>=0&&(e=e.substring(t+1)),6===e.length){var i=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);i+o>255?i-=o:i+o<0?i-=o:i+=o,a+o>255?a-=o:a+o<0?a-=o:a+=o,r+o>255?r-=o:r+o<0?r-=o:r+=o,i=i.toString(16),a=a.toString(16),r=r.toString(16),i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),r.length<2&&(r="0"+r),e="#"+i+a+r}else{if(3!==e.length)return n;var i=parseInt(e.substring(0,1),16),a=parseInt(e.substring(1,2),16),r=parseInt(e.substring(2,3),16);i+o>255?i-=o:i+o<0?i-=o:i+=o,a+o>255?a-=o:a+o<0?a-=o:a+=o,r+o>255?r-=o:r+o<0?r-=o:r+=o,i=i.toString(16),a=a.toString(16),r=r.toString(16),i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),r.length<2&&(r="0"+r),e="#"+i+a+r}return e}catch(l){PutToDebugLogException(2,"common: HoverCalc",l)}return""}function IsIeLocal(){try{if(!0===lf_isconfigured)return isielocal;lf_isconfigured=!0;var e=GetBrowser();if(isNull(e))return;e=e.toLowerCase();var o=window.location.href;if(isNull(o))return;o=o.toLowerCase(),o=Trim(o),"msie"===e&&o.indexOf("http")<0&&o.indexOf("https")<0&&(isielocal=!0,PutToDebugLog(2,"EVENT, common: IsIeLocalFilesystem: IE from local file system"))}catch(n){PutToDebugLogException(2,"common: IsIeLocal",n)}return isielocal}function IsIeVersion(e){try{if(isNull(e))return!1;var o=navigator.userAgent,n=o.match(/MSIE\s?(\d+)(?:\.(\d+))?/i);if(!isNull(n)&&!isNull(n[0])&&n[0].indexOf(e)>=0)return!0}catch(t){PutToDebugLogException(2,"common: IsIeVersion",t)}return!1}function GetBrowser(){try{if(isNull(browserName)||isNull(browserName2)){var e=navigator.userAgent.toLowerCase();-1!==e.indexOf("edge")?(browserName="Edge",browserName2="Edge"):-1!==e.indexOf("msie")&&-1===e.indexOf("opera")?(browserName="MSIE",browserName2="MSIE"):-1!==e.indexOf("trident")||-1!==e.indexOf("Trident")?(browserName="MSIE",browserName2="MSIE"):-1!==e.indexOf("iphone")?(browserName2=-1!==e.indexOf("fxios")||-1!==e.indexOf("firefox")?"Firefox":-1!==e.indexOf("crios")||-1!==e.indexOf("chrome")?"Chrome":"iPhone",browserName="Netscape Family"):-1!==e.indexOf("firefox")&&-1===e.indexOf("opera")?(browserName="Netscape Family",browserName2="Firefox"):-1!==e.indexOf("chrome")?(browserName="Netscape Family",browserName2="Chrome","Android"===GetOs()&&(e=e.replace("mozilla/",""),browserName2=e.match(/\/\d\.\d /i)?"AndroidNative":"Chrome")):-1!==e.indexOf("safari")?(browserName="Netscape Family",browserName2="Safari"):-1!==e.indexOf("mozilla")&&-1===e.indexOf("opera")?(browserName="Netscape Family",browserName2="Other"):-1!==e.indexOf("opera")?(browserName="Netscape Family",browserName2="Opera"):(browserName="?",
browserName2="unknown")}}catch(o){PutToDebugLogException(2,"common: GetBrowser",o)}return browserName2}function GetBrowserVersion(){try{if(browserversion>0)return browserversion;var e=GetBrowser(),o=navigator.userAgent.toLowerCase();if("Chrome"===e){var n=o.indexOf("chrome");n>0&&(o=o.substring(n+6)),isNull(o)||(o=o.replace("/","")),n=o.indexOf("."),n>0&&(o=o.substring(0,n)),isNull(o)||(o=Trim(o),IsNumber(o)&&(browserversion=StrToInt(o)))}else if("Firefox"===e){var n=o.indexOf("firefox");n>0&&(o=o.substring(n+7)),isNull(o)||(o=o.replace("/","")),n=o.indexOf("."),n>0&&(o=o.substring(0,n)),isNull(o)||(o=Trim(o),IsNumber(o)&&(browserversion=StrToInt(o)))}else if("Safari"===e||"iPhone"===e){var n=o.indexOf("version");n>0?o=o.substring(n+7):o.indexOf("_")>0&&(o=o.substring(0,o.indexOf("_")),o=Trim(o),o=o.substring(o.lastIndexOf(" "))),isNull(o)||(o=o.replace("/","")),n=o.indexOf("."),n>0&&(o=o.substring(0,n)),isNull(o)||(o=Trim(o),IsNumber(o)&&(browserversion=StrToInt(o)))}else if("MSIE"===e){var t=window.navigator.userAgent,i=t.indexOf("MSIE ");i>0&&(browserversion=parseInt(t.substring(i+5,t.indexOf(".",i)),10));var a=t.indexOf("Trident/");if(a>0){var r=t.indexOf("rv:");browserversion=parseInt(t.substring(r+3,t.indexOf(".",r)),10)}var l=t.indexOf("Edge/");l>0&&(browserversion=parseInt(t.substring(l+5,t.indexOf(".",l)),10))}else if("Edge"===e){var n=o.indexOf("edge");n>0&&(o=o.substring(n+4)),isNull(o)||(o=o.replace("/","")),n=o.indexOf("."),n>0&&(o=o.substring(0,n)),isNull(o)||(o=Trim(o),IsNumber(o)&&(browserversion=StrToInt(o)))}!isNull(browserversion)&&IsNumber(browserversion)||(browserversion=-1),CanLog(2)&&PutToDebugLog(2,"EVENT, common: GetBrowserVersion Detected browser version: "+browserversion)}catch(p){PutToDebugLogException(2,"common: GetBrowserVersion",p)}return browserversion}function IsARM(){try{var e=navigator.userAgent.toLowerCase();if(e.indexOf("arm")>=0&&e.indexOf("x86")<0)return!0}catch(o){PutToDebugLogException(2,"common: IsARM",o)}return!1}function Is64BitBrowser(){try{var e=navigator.userAgent.toLowerCase();return"Firefox"===GetBrowser()&&e.indexOf("x64")>0&&!0,!(e.indexOf("64")<0)}catch(o){PutToDebugLogException(2,"common: Is64BitBrowser",o)}return!1}function GetOs(){var e="";try{if(!isNull(curros)&&curros.length>0)return curros;if(e=webphone_api.platform.os,isNull(e)||(e=e.toString()),isNull(e)||e.length<1)return curros;e=e.toLowerCase(),curros=e.indexOf("windows")>=0?"Windows":e.indexOf("mac")>=0||e.indexOf("os x")>=0?"Mac":e.indexOf("centos")>-1||e.indexOf("debian")>-1||e.indexOf("fedora")>-1||e.indexOf("gentoo")>-1||e.indexOf("ubuntu")>-1||e.indexOf("linux mint")>-1||e.indexOf("red hat")>-1||e.indexOf("suse")>-1||e.indexOf("linux")>-1||e.indexOf("x11")>-1?"Linux":e.indexOf("ios")>-1?"iOS":e.indexOf("android")>-1?"Android":Trim(e),(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(curros="iOS")}catch(o){PutToDebugLogException(2,"common: GetOs",o)}return curros}function PickContact(e,o){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120);var t=GetDeviceHeight();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.5):250;for(var i="",a=0;a<webphone_api.global.ctlist.length;a++){var r=webphone_api.global.ctlist[a];if(!(isNull(r)||r.length<1)){var l=r[CT_NAME];if(isNull(l)||l.length<1){var p=s[CT_NUMBER];if(isNull(p)||p.length<1||isNull(p[0])||p[0].length<1)continue;l=p[0]}var s='<li id="pickcontact_'+a+'"><a data-rel="back">'+l+"</a></li>";i+=s}}var c='<div id="pickcontact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("pick_ct")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontact_ul" data-role="listview" data-inset="true" data-icon="false" data-filter="true" data-filter-placeholder="Search Contacts" data-autodividers="true" style="margin: 0; max-height: '+t+'px;">'+i+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";o=o||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(c).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#pickcontact_ul").off("click","li"),o()}})),webphone_api.$("#pickcontact_ul").on("click","li",function(o){var n=webphone_api.$(this).attr("id"),t="",i=n.indexOf("_");if(i<2)return void PutToDebugLog(2,"ERROR, common PickContact OnListItemClick invalid id: "+n);t=Trim(n.substring(i+1));var a=webphone_api.global.ctlist[t];if(isNull(a)||a.length<1)return void PutToDebugLog(3,"ERROR, PickContact ctentry is NULL");var r=a[CT_NUMBER];webphone_api.$("#pickcontact_popup").on("popupafterclose",function(o){if(webphone_api.$("#pickcontact_popup").off("popupafterclose"),1===r.length)return void e(r[0],a[CT_NAME]);PickContactNumber(t,e)})})}catch(u){PutToDebugLogException(2,"common: PickContact",u)}}function PickContactNumber(e,o,n){try{if(!o||"function"!=typeof o)return void PutToDebugLog(2,"ERROR, PickContactNumber callback is NULL");var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120);var i=webphone_api.global.ctlist[e];if(isNull(i)||i.length<1)return void PutToDebugLog(3,"ERROR, PickContactNumber ctentry is NULL");for(var a=i[CT_NUMBER],r="",l=0;l<a.length;l++)if(!(isNull(a[l])||a[l].length<1)){var p='<li id="pickcontactnumber_'+l+'"><a data-rel="back">'+a[l]+"</a></li>";r+=p}var s='<div id="pickcontactnumber_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+i[CT_NAME]+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontactnumber_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+r+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";n=n||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(s).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#pickcontactnumber_ul").off("click","li"),n()}})),webphone_api.$("#pickcontactnumber_ul").on("click","li",function(e){var n=webphone_api.$(this).attr("id"),t="",r=n.indexOf("_");if(r<2)return void PutToDebugLog(2,"ERROR, common PickContactNumber OnListItemClick invalid nrid: "+n);t=Trim(n.substring(r+1)),webphone_api.$("#pickcontactnumber_popup").on("popupafterclose",function(e){webphone_api.$("#pickcontactnumber_popup").off("popupafterclose"),o(a[t],i[CT_NAME])})})}catch(c){PutToDebugLogException(2,"common: PickContactNumber",c)}}function NormalizeNumber(e){try{if(isNull(e))return"";if(e=Trim(e),e=NormalizeInput(e,0),!IsWindowsSoftphone()&&(getuseengine()===webphone_api.global.ENGINE_WEBRTC||getuseengine()===webphone_api.global.ENGINE_FLASH)){var o=GetParameter2("techprefix");(!isNull(o)||o.length>0)&&(o=Trim(o),e=o+e)}if(0==GetParameterInt("normalizenumber",-1))return ApplyFilters(e);if(e.length<6||e.length>20)return ApplyFilters(e);var n=GetSipusername();if(!isNull(n)&&n.length>0&&n!==NormalizeInput2(n,1))return ApplyFilters(e);for(var t=0,i=0;i<e.length;i++)e.charAt(i)>="0"&&e.charAt(i)<="9"&&t++;if(t<5)return ApplyFilters(e);for(var i=0;i<e.length;i++)if(e.charAt(i)>="a"&&e.charAt(i)<="z"||e.charAt(i)>="A"&&e.charAt(i)<="Z"||"@"==e.charAt(i))return ApplyFilters(e);for(var a="",i=0;i<e.length;i++)(e.charAt(i)>="0"&&e.charAt(i)<="9"||"*"==e.charAt(i)||","==e.charAt(i)||"#"==e.charAt(i)||0==i&&"+"==e.charAt(i))&&(a+=e.charAt(i));return ApplyFilters(e)}catch(r){PutToDebugLogException(2,"common: NormalizeNumber",r)}return ApplyFilters(e)}function NormalizeInputBasic(e,o){try{var n=e;return isNull(n)?"":(n=n.toString(),n=Trim(n),n=ReplaceAll(n,"WSS://","wss://"),n=ReplaceAll(n,"WS://","ws://"),n=ReplaceAll(n,"SIP:",""),n=ReplaceAll(n,"sip:",""),n=ReplaceAll(n,"SIPS:",""),n=ReplaceAll(n,"sips:",""),n=ReplaceAll(n,"UDP:",""),n=ReplaceAll(n,"udp:",""),n=ReplaceAll(n,"TCP:",""),n=ReplaceAll(n,"tcp:",""),n=ReplaceAll(n,"URL:",""),n=ReplaceAll(n,"url:",""),n=ReplaceAll(n,"TEL:",""),n=ReplaceAll(n,"tel:",""),n=ReplaceAll(n,"HTTPS://","https://"),n=ReplaceAll(n,"HTTP://","http://"),n=ReplaceAll(n,"'",""),n=ReplaceAll(n,'"',""))}catch(t){PutToDebugLogException(2,"common: NormalizeInputBasic",t)}return e}function NormalizeInput(e,o){try{var n=e;return isNull(n)?"":(n=n.toString(),n=Trim(n),o<1&&(n=ReplaceAll(n,"WSS://",""),n=ReplaceAll(n,"wss://",""),n=ReplaceAll(n,"WSS:",""),n=ReplaceAll(n,"wss:",""),n=ReplaceAll(n,"WS://",""),n=ReplaceAll(n,"ws://",""),n=ReplaceAll(n,"WS:",""),n=ReplaceAll(n,"ws:","")),n=ReplaceAll(n,"SIP:",""),n=ReplaceAll(n,"sip:",""),n=ReplaceAll(n,"SIPS:",""),n=ReplaceAll(n,"sips:",""),n=ReplaceAll(n,"UDP:",""),n=ReplaceAll(n,"udp:",""),n=ReplaceAll(n,"TCP:",""),n=ReplaceAll(n,"tcp:",""),n=ReplaceAll(n,"URL:",""),n=ReplaceAll(n,"url:",""),n=ReplaceAll(n,"TEL:",""),n=ReplaceAll(n,"tel:",""),n=ReplaceAll(n,"HTTPS://",""),n=ReplaceAll(n,"https://",""),n=ReplaceAll(n,"HTTPS:",""),n=ReplaceAll(n,"https:",""),n=ReplaceAll(n,"HTTP://",""),n=ReplaceAll(n,"http://",""),n=ReplaceAll(n,"HTTP:",""),n=ReplaceAll(n,"http:",""),n=ReplaceAll(n,"'",""),n=ReplaceAll(n,'"',""))}catch(t){PutToDebugLogException(2,"common: NormalizeInput",t)}return e}function NormalizeInput2(e,o){try{var n=e;if(isNull(n))return"";n=n.toString(),n=Trim(n),n=NormalizeInput(n,0);var t=n.split("");if(isNull(t)||t.length<1)return e;if(o<1){for(var i=0;i<t.length;i++)t[i]>="0"&&t[i]<="9"||(t[i]="");return t.join("")}if(1===o){for(var i=0;i<t.length;i++)t[i]>="0"&&t[i]<="9"||t[i]>="A"&&t[i]<="Z"||t[i]>="a"&&t[i]<="z"||"_"===t[i]||"."===t[i]||"-"===t[i]||(t[i]="_");return t.join("")}if(2===o){for(var i=0;i<t.length;i++)t[i]>="0"&&t[i]<="9"||t[i]>="A"&&t[i]<="Z"||t[i]>="a"&&t[i]<="z"||"_"===t[i]||"."===t[i]||"-"===t[i]||" "===t[i]||(t[i]="_");return t.join("")}for(var i=0;i<t.length;i++)t[i]>="0"&&t[i]<="9"||t[i]>="A"&&t[i]<="Z"||t[i]>="a"&&t[i]<="z"||"_"===t[i]||"."===t[i]||"-"===t[i]||" "===t[i]||"+"===t[i]||":"===t[i]||"@"===t[i]||(t[i]="_");return t.join("")}catch(a){PutToDebugLogException(2,"common: NormalizeInput2",a)}return e}function PasswordStringIsValidForServer(e){try{if(isNull(e)||e.length<1)return!1;for(var o=0;o<e.length;o++)if(e.charCodeAt(o)<33||e.charCodeAt(o)>126||"'"===e.charAt(o)||'"'===e.charAt(o)||"<"===e.charAt(o)||">"===e.charAt(o))return!1}catch(n){PutToDebugLogException(2,"common: PasswordStringIsValidForServer",n)}return!0}function UsernameStringIsValidForServer(e){try{if(isNull(e)||e.length<1)return!1;for(var o=0;o<e.length;o++)if(!(e.charAt(o)>="0"&&e.charAt(o)<="9"||e.charAt(o)>="a"&&e.charAt(o)<="z"||e.charAt(o)>="A"&&e.charAt(o)<="Z"||"#"===e.charAt(o)||"*"===e.charAt(o)||"("===e.charAt(o)||")"===e.charAt(o)||"["===e.charAt(o)||"]"===e.charAt(o)||"{"===e.charAt(o)||"}"===e.charAt(o)||"+"===e.charAt(o)||"."===e.charAt(o)||","===e.charAt(o)||"/"===e.charAt(o)||"\\"===e.charAt(o)||"_"===e.charAt(o)||"-"===e.charAt(o)||"^"===e.charAt(o)||"~"===e.charAt(o)||"!"===e.charAt(o)))return!1}catch(n){PutToDebugLogException(2,"common: UsernameStringIsValidForServer",n)}return!0}function ApplyFilters(e){try{if(isNull(e))return"";e=Trim(e),PutToDebugLog(4,"EVENT, normalized number: "+e);var o=GetParameter("filters");if(isNull(o)||o.length<3)return e;var n=o.split(";");if(isNull(n)||n.length<1)return e;for(var t=0;t<n.length;t++)if(!isNull(n[t])){var i=n[t].split(",");if(!isNull(i)&&4===i.length){var a="",r="",l=-1,p=-1;try{if(a=i[F_WHAT],r=i[F_WITH],isNull(a)&&(a=""),isNull(r)&&(r=""),a.length<1&&r.length<1)continue;!isNull(i[F_MIN])&&IsNumber(i[F_MIN])&&(l=StrToInt(i[F_MIN])),!isNull(i[F_MAX])&&IsNumber(i[F_MAX])&&(p=StrToInt(i[F_MAX])),0!==a.length&&0!==e.indexOf(a)||(l<0&&p<0?e=e.replace(a,r):l<0&&p>0&&e.length<=p?e=e.replace(a,r):p<0&&l>0&&e.length>l?e=e.replace(a,r):l>=0&&p>0&&p>=l&&e.length>=l&&e.length<=p&&(e=e.replace(a,r)))}catch(s){}}}PutToDebugLog(4,"EVENT, filtered number: "+e)}catch(c){PutToDebugLogException(2,"common: ApplyFilters",c)}return e}function InitializeSettings(){try{CanLog(2)&&PutToDebugLog(2,"EVENT, common: InitializeSettings called");var e="",o="2";!isNull(GetConfig("upperserverfromuser"))&&GetConfig("upperserverfromuser").length>0&&(o=Trim(GetConfig("upperserverfromuser"))),SettingItem("upperserverfromuser",o,"-1",GROUP_NOGROUP,"","","1","2"),"9999"!==GetConfig("brandid")&&(!1===RequestUserServerInput(o)&&!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(e=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress_user",e,"8",GROUP_LOGIN,"","","1","")),SettingItem("serveraddress_orig","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("upperserver","","-1","-1","","","1",""),SettingItem("sipusername","","1",GROUP_LOGIN,"","","1",""),SettingItem("password","","1",GROUP_LOGIN,"","","1",""),SettingItem("settlevelbasic","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("submenu_sipsettings","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_media","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_video","","6",GROUP_MEDIA,"","","1",""),SettingItem("submenu_calldivert","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_general","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_profile","","6",GROUP_MAIN,"","","1",""),SettingItem("advancedloginsettings2","","6",GROUP_SIP,"","","1",""),SettingItem("submenu_integrate","","6",GROUP_GENERAL,"","","1",""),SettingItem("submenu_screenshare","","6",GROUP_MEDIA,"","","1","");var n="true";!isNull(GetConfig("customizedversion"))&&GetConfig("customizedversion").length>0&&(n=Trim(GetConfig("customizedversion"))),SettingItem("customizedversion",n,"-1",GROUP_NOGROUP,"","","1","true");var t="1";!isNull(GetConfig("autoprovisioning"))&&GetConfig("autoprovisioning").length>0&&(t=Trim(GetConfig("autoprovisioning"))),!0!==t&&"true"!==t||(t="1"),!1!==t&&"false"!==t||(t="0"),SettingItem("autoprovisioning",t,"-1",GROUP_NOGROUP,"","","1","1");var i="Server";!isNull(GetConfig("server_label"))&&GetConfig("server_label").length>0&&(i=Trim(GetConfig("server_label"))),SettingItem("server_label",i,"-1",GROUP_NOGROUP,"","","1","Server");var a="false";!isNull(GetConfig("serverinputisupperserver"))&&GetConfig("serverinputisupperserver").length>0&&(a=Trim(GetConfig("serverinputisupperserver"))),SettingItem("serverinputisupperserver",a,"-1",GROUP_NOGROUP,"","","1","false");var r="";!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(r=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress",r,"-1",GROUP_NOGROUP,"","","1","");var l="";!isNull(GetConfig("webrtcserveraddress"))&&GetConfig("webrtcserveraddress").length>0&&(l=Trim(GetConfig("webrtcserveraddress"))),SettingItem("webrtcserveraddress",l,"-1",GROUP_NOGROUP,"","","1","");var p="";!isNull(GetConfig("rtmpserveraddress"))&&GetConfig("rtmpserveraddress").length>0&&(p=Trim(GetConfig("rtmpserveraddress"))),SettingItem("rtmpserveraddress",p,"-1",GROUP_NOGROUP,"","","1","");var s="";!isNull(GetConfig("realm"))&&GetConfig("realm").length>0&&(s=Trim(GetConfig("realm"))),SettingItem("realm",s,"1",GROUP_SIP,"","","1","");var c="1";!isNull(GetConfig("showserverinput"))&&GetConfig("showserverinput").length>0&&(c=Trim(GetConfig("showserverinput"))),SettingItem("showserverinput",c,"-1",GROUP_NOGROUP,"","","1","1");var u="";!isNull(GetConfig("apiv2md5salt"))&&GetConfig("apiv2md5salt").length>0&&(u=Trim(GetConfig("apiv2md5salt"))),SettingItem("apiv2md5salt",u,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("displaypopupdirectcalls","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("register","1","2",GROUP_SIP,webphone_api.stringres.get("register__no")+","+webphone_api.stringres.get("register__auto")+","+webphone_api.stringres.get("register__yes"),"0,1,2","1","1"),SettingItem("registerinterval","180","1",GROUP_SIP,"","","1","180"),SettingItem("cfgnetworkspeed","0","2",GROUP_MEDIA,"Auto guess,Slow (< 20 KBits on GPRS or 3G),Normal (20 - 60 kbits),Fast (> 60 KBits)","0,1,2,3","1","0"),SettingItem("prefcodec","","3",GROUP_NOGROUP,"","","1",""),SettingItem("dtmfmode","2","2",GROUP_SIP,webphone_api.stringres.get("dtmfmode_op_0")+","+webphone_api.stringres.get("dtmfmode_op_1")+","+webphone_api.stringres.get("dtmfmode_op_2")+","+webphone_api.stringres.get("dtmfmode_op_3")+","+webphone_api.stringres.get("dtmfmode_op_4")+","+webphone_api.stringres.get("dtmfmode_op_5")+","+webphone_api.stringres.get("dtmfmode_op_6"),"0,1,2,3,4,5,6","1","2"),SettingItem("audiorecorder","1","2",GROUP_MEDIA,"Default,Auto guess, Mic,Voice call,Voice downlink,Voice uplink,Voice communication","0,1,2,3,4,5,6","1","1"),SettingItem("audioplayer","-2147483648","2",GROUP_MEDIA,"Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call","-2147483648,4,3,5,2,1,0","1","-2147483648"),SettingItem("speakerphoneplayer","-2147483648","2",GROUP_MEDIA,"Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call,No change","-2147483648,4,3,5,2,1,0,6","1","-2147483648"),SettingItem("speakerphoneoutput","0","2",GROUP_MEDIA,"Auto guess,Speaker,Speaker and mode,VoIP,Bluetooth,Normal,Mode only,No changes","0,1,2,3,4,5,6,7","1","0"),SettingItem("autousebluetooth","0","2",GROUP_MEDIA,"Guess,No,Yes","0,1,2","1","0"),SettingItem("playring","2","2",GROUP_MEDIA,webphone_api.stringres.get("playring__no")+","+webphone_api.stringres.get("playring__incoming")+","+webphone_api.stringres.get("playring__both"),"0,1,2","1","2"),SettingItem("volumein","50","4",GROUP_MEDIA,"","","1","50"),SettingItem("volumeout","50","4",GROUP_MEDIA,"","","1","50"),SettingItem("agc","3","2",GROUP_MEDIA,webphone_api.stringres.get("agc__disabled")+","+webphone_api.stringres.get("agc__for_redcording")+","+webphone_api.stringres.get("agc__both_for_recording_and_playback")+","+webphone_api.stringres.get("agc__guess"),"0,1,2,3","1","3"),SettingItem("aec","1","8",GROUP_MEDIA,"No,Yes except if headset is guessed,Yes if supported,Forced yes even if not supported (might result in unexpected errors)","0,1,2,3","1","1"),SettingItem("denoise","3","2",GROUP_MEDIA,webphone_api.stringres.get("denoise__disabled")+","+webphone_api.stringres.get("denoise__recording")+","+webphone_api.stringres.get("denoise__both")+","+webphone_api.stringres.get("denoise__auto"),"0,1,2,3","1","3"),SettingItem("plc","1","2",GROUP_MEDIA,webphone_api.stringres.get("plc__no")+","+webphone_api.stringres.get("plc__auto")+","+webphone_api.stringres.get("plc__yes"),"0,1,2","1","1"),SettingItem("silencesupress","-1","2",GROUP_MEDIA,webphone_api.stringres.get("silencesupress__auto")+","+webphone_api.stringres.get("silencesupress__no")+","+webphone_api.stringres.get("silencesupress__yes"),"-1,0,1","1","-1"),SettingItem("hardwaremedia","0","2",GROUP_MEDIA,webphone_api.stringres.get("hardwaremedia__auto")+","+webphone_api.stringres.get("hardwaremedia__no")+","+webphone_api.stringres.get("hardwaremedia__yes"),"0,1,2","1","0"),SettingItem("mediaencryption","0","2",GROUP_MEDIA,webphone_api.stringres.get("mediaencryption__no")+","+webphone_api.stringres.get("mediaencryption__auto")+","+webphone_api.stringres.get("mediaencryption__srtp"),"0,1,2","1","0"),SettingItem("setqos","0","2",GROUP_MEDIA,webphone_api.stringres.get("setqos__auto")+","+webphone_api.stringres.get("setqos__no")+","+webphone_api.stringres.get("setqos__yes"),"0,1,2","1","0"),SettingItem("codecframecount","0","2",GROUP_MEDIA,webphone_api.stringres.get("codecframecount_auto")+",1,2,3,4,5,6","0,1,2,3,4,5,6","1","0"),SettingItem("doublesendrtp","0","2",GROUP_MEDIA,webphone_api.stringres.get("doublesendrtp__no")+","+webphone_api.stringres.get("doublesendrtp__yes"),"0,1","1","0"),SettingItem("ringtimeout","90000","1",GROUP_SIP,"","","1","90000"),SettingItem("calltimeout","10800000","1",GROUP_SIP,"","","1","10800000");var g="1";!isNull(GetConfig("displaynotification"))&&GetConfig("displaynotification").length>0&&(g=Trim(GetConfig("displaynotification"))),"2"===g&&(g="1"),SettingItem("displaynotification",g,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("displaynotification__never")+","+webphone_api.stringres.get("displaynotification__onevent"),"0,1","1",g);var m="false";!isNull(GetConfig("hasvolume"))&&GetConfig("hasvolume").length>0&&(0==GetConfigInt("hasvolume",-1)?m="false":GetConfigInt("hasvolume",-1)>1&&(m="true")),SettingItem("displayvolumecontrols",m,"0",GROUP_GENERAL,"","","1",m),SettingItem("displayaudiodevice","false","0",GROUP_GENERAL,"","","1","false"),SettingItem("use_fast_ice","1","2",GROUP_SIP,webphone_api.stringres.get("use_fast_ice__no")+","+webphone_api.stringres.get("use_fast_ice__auto")+","+webphone_api.stringres.get("use_fast_ice__yes")+","+webphone_api.stringres.get("use_fast_ice__always"),"0,1,2,3","1","1"),SettingItem("use_stun","1","2",GROUP_SIP,webphone_api.stringres.get("use_stun__force")+","+webphone_api.stringres.get("use_stun__no")+","+webphone_api.stringres.get("use_stun__stable_nat")+","+webphone_api.stringres.get("use_stun__all_symetric")+","+webphone_api.stringres.get("use_stun__always")+","+webphone_api.stringres.get("use_stun__public_ip"),"-1,0,1,2,3,4","1","1"),SettingItem("prack","false","0",GROUP_SIP,"","","1","false"),SettingItem("localip","","1",GROUP_SIP,"","","1",""),SettingItem("signalingport","","1",GROUP_SIP,"","","1",""),SettingItem("rtpport","","1",GROUP_SIP,"","","1","");var b="2";!isNull(GetConfig("earlymedia"))&&GetConfig("earlymedia").length>0&&(b=Trim(GetConfig("earlymedia"))),SettingItem("earlymedia",b,"2",GROUP_SIP,webphone_api.stringres.get("earlymedia__no")+","+webphone_api.stringres.get("earlymedia__reserved")+","+webphone_api.stringres.get("earlymedia__auto")+","+webphone_api.stringres.get("earlymedia__just_early")+","+webphone_api.stringres.get("earlymedia__null_packets")+","+webphone_api.stringres.get("earlymedia__yes")+","+webphone_api.stringres.get("earlymedia__always_force"),"0,1,2,3,4,5,6","1",b),SettingItem("jittersize","3","2",GROUP_MEDIA,webphone_api.stringres.get("jittersize__no")+","+webphone_api.stringres.get("jittersize__esmall")+","+webphone_api.stringres.get("jittersize__small")+","+webphone_api.stringres.get("jittersize__normal")+","+webphone_api.stringres.get("jittersize__big")+","+webphone_api.stringres.get("jittersize__ebig")+","+webphone_api.stringres.get("jittersize__max"),"0,1,2,3,4,5,6","1","3"),SettingItem("proxyaddress","","1",GROUP_SIP,"","","1",""),SettingItem("username","","1",GROUP_SIP,"","","1",""),SettingItem("displayname","","1",GROUP_SIP,"","","1",""),SettingItem("email","","1",GROUP_GENERAL,"","","1",""),SettingItem("textmessaging","-1","2",GROUP_SIP,webphone_api.stringres.get("chatsms__auto_guess_or_ask")+","+webphone_api.stringres.get("chatsms__sms_only")+","+webphone_api.stringres.get("chatsms__chat_only")+","+webphone_api.stringres.get("chatsms__disable"),"-1,3,6,0","1","-1"),SettingItem("savetocontacts","1","2",GROUP_GENERAL,webphone_api.stringres.get("savetocontacts__no")+","+webphone_api.stringres.get("savetocontacts__ask")+","+webphone_api.stringres.get("savetocontacts__yes"),"0,1,2","1","1"),SettingItem("call_access","","7",GROUP_GENERAL,"","","1","");var h="-1";!isNull(GetConfig("transfertype"))&&GetConfig("transfertype").length>0&&(h=Trim(GetConfig("transfertype"))),SettingItem("transfertype",h,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfertype__auto")+","+webphone_api.stringres.get("transfertype__unattended")+","+webphone_api.stringres.get("transfertype__withhold")+","+webphone_api.stringres.get("transfertype__attanded")+","+webphone_api.stringres.get("transfertype__with_no_hold")+","+webphone_api.stringres.get("transfertype__with_conf"),"-1,1,6,5,7,8","1",h),SettingItem("transfertype1",GetConfigInt("transfertype1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace1",GetConfigInt("transfwithreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace1",GetConfigInt("allowreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer1",GetConfigInt("discontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer1",GetConfigInt("disconincomingrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer1",GetConfigInt("inversetransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay1",GetConfigInt("transferdelay1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer1",GetConfigInt("newdialogforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer1",GetConfigInt("useserverdomainforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer1",GetConfigInt("holdontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype2",GetConfigInt("transfertype2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace2",GetConfigInt("transfwithreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace2",GetConfigInt("allowreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer2",GetConfigInt("discontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer2",GetConfigInt("disconincomingrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer2",GetConfigInt("inversetransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay2",GetConfigInt("transferdelay2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer2",GetConfigInt("newdialogforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer2",GetConfigInt("useserverdomainforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer2",GetConfigInt("holdontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype3",GetConfigInt("transfertype3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace3",GetConfigInt("transfwithreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace3",GetConfigInt("allowreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer3",GetConfigInt("discontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer3",GetConfigInt("disconincomingrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer3",GetConfigInt("inversetransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay3",GetConfigInt("transferdelay3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer3",GetConfigInt("newdialogforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer3",GetConfigInt("useserverdomainforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer3",GetConfigInt("holdontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype4",GetConfigInt("transfertype4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace4",GetConfigInt("transfwithreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace4",GetConfigInt("allowreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer4",GetConfigInt("discontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer4",GetConfigInt("disconincomingrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer4",GetConfigInt("inversetransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay4",GetConfigInt("transferdelay4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer4",GetConfigInt("newdialogforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer4",GetConfigInt("useserverdomainforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer4",GetConfigInt("holdontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype5",GetConfigInt("transfertype5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace5",GetConfigInt("transfwithreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace5",GetConfigInt("allowreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer5",GetConfigInt("discontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer5",GetConfigInt("disconincomingrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer5",GetConfigInt("inversetransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay5",GetConfigInt("transferdelay5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer5",GetConfigInt("newdialogforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer5",GetConfigInt("useserverdomainforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer5",GetConfigInt("holdontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype6",GetConfigInt("transfertype6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace6",GetConfigInt("transfwithreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace6",GetConfigInt("allowreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer6",GetConfigInt("discontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer6",GetConfigInt("disconincomingrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer6",GetConfigInt("inversetransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay6",GetConfigInt("transferdelay6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer6",GetConfigInt("newdialogforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer6",GetConfigInt("useserverdomainforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer6",GetConfigInt("holdontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype7",GetConfigInt("transfertype7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace7",GetConfigInt("transfwithreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace7",GetConfigInt("allowreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer7",GetConfigInt("discontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer7",GetConfigInt("disconincomingrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer7",GetConfigInt("inversetransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay7",GetConfigInt("transferdelay7",-1),"-1",GROUP_NOGROUP,"","","-1",""),
SettingItem("newdialogforrefer7",GetConfigInt("newdialogforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer7",GetConfigInt("useserverdomainforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer7",GetConfigInt("holdontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype8",GetConfigInt("transfertype8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace8",GetConfigInt("transfwithreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace8",GetConfigInt("allowreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer8",GetConfigInt("discontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer8",GetConfigInt("disconincomingrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer8",GetConfigInt("inversetransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay8",GetConfigInt("transferdelay8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer8",GetConfigInt("newdialogforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer8",GetConfigInt("useserverdomainforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer8",GetConfigInt("holdontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype9",GetConfigInt("transfertype9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace9",GetConfigInt("transfwithreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace9",GetConfigInt("allowreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer9",GetConfigInt("discontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer9",GetConfigInt("disconincomingrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer9",GetConfigInt("inversetransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay9",GetConfigInt("transferdelay9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer9",GetConfigInt("newdialogforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer9",GetConfigInt("useserverdomainforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer9",GetConfigInt("holdontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype10",GetConfigInt("transfertype10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace10",GetConfigInt("transfwithreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace10",GetConfigInt("allowreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer10",GetConfigInt("discontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer10",GetConfigInt("disconincomingrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer10",GetConfigInt("inversetransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay10",GetConfigInt("transferdelay10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer10",GetConfigInt("newdialogforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer10",GetConfigInt("useserverdomainforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer10",GetConfigInt("holdontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1","");var d="";!isNull(GetConfig("transfername1"))&&GetConfig("transfername1").length>0&&(d=Trim(GetConfig("transfername1"))),SettingItem("transfername1",d,"-1",GROUP_NOGROUP,"","","-1",d);var _="";!isNull(GetConfig("transfername2"))&&GetConfig("transfername2").length>0&&(_=Trim(GetConfig("transfername2"))),SettingItem("transfername2",_,"-1",GROUP_NOGROUP,"","","-1",_);var w="";!isNull(GetConfig("transfername3"))&&GetConfig("transfername3").length>0&&(w=Trim(GetConfig("transfername3"))),SettingItem("transfername3",w,"-1",GROUP_NOGROUP,"","","-1",w);var f="";!isNull(GetConfig("transfername4"))&&GetConfig("transfername4").length>0&&(f=Trim(GetConfig("transfername4"))),SettingItem("transfername4",f,"-1",GROUP_NOGROUP,"","","-1",f);var v="";!isNull(GetConfig("transfername5"))&&GetConfig("transfername5").length>0&&(v=Trim(GetConfig("transfername5"))),SettingItem("transfername5",v,"-1",GROUP_NOGROUP,"","","-1",v);var P="";!isNull(GetConfig("transfername6"))&&GetConfig("transfername6").length>0&&(P=Trim(GetConfig("transfername6"))),SettingItem("transfername6",P,"-1",GROUP_NOGROUP,"","","-1",P);var E="";!isNull(GetConfig("transfername7"))&&GetConfig("transfername7").length>0&&(E=Trim(GetConfig("transfername7"))),SettingItem("transfername7",E,"-1",GROUP_NOGROUP,"","","-1",E);var T="";!isNull(GetConfig("transfername8"))&&GetConfig("transfername8").length>0&&(T=Trim(GetConfig("transfername8"))),SettingItem("transfername8",T,"-1",GROUP_NOGROUP,"","","-1",T);var N="";!isNull(GetConfig("transfername9"))&&GetConfig("transfername9").length>0&&(N=Trim(GetConfig("transfername9"))),SettingItem("transfername9",N,"-1",GROUP_NOGROUP,"","","-1",N);var S="";!isNull(GetConfig("transfername10"))&&GetConfig("transfername10").length>0&&(S=Trim(GetConfig("transfername10"))),SettingItem("transfername10",S,"-1",GROUP_NOGROUP,"","","-1",S),SettingItem("startonboot","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("callforwardonbusy","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("rejectonvoipbusy","3","2",GROUP_CALLDIVERT,"Auto,Reject calls,Allow calls,Forward calls","3,0,1,2","1","3"),SettingItem("rejectonphonebusy","0","2",GROUP_CALLDIVERT,"Reject calls,Allow calls,Forward calls","0,1,2","1","0");var I="";!isNull(GetConfig("voicemailnum"))&&GetConfig("voicemailnum").length>0&&(I=Trim(GetConfig("voicemailnum"))),SettingItem("voicemailnum",I,"1",GROUP_CALLDIVERT,"","","1","");var R="2";!isNull(GetConfig("voicemail"))&&GetConfig("voicemail").length>0&&(R=Trim(GetConfig("voicemail"))),SettingItem("voicemail",R,"2",GROUP_CALLDIVERT,"Disabled,Only if NOTIFY is received,Auto-detect if SUBSCRIBE is needed,Subscribe for voicemail after registration,Subscribe for voicemail on startup","0,1,2,3,4","1","false"),SettingItem("techprefix","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("filters","","5",GROUP_CALLDIVERT,"","","1",""),SettingItem("startonboot","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("startwithos","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("startwithos_was_sent","false","-1",GROUP_NOGROUP,"","","1","false");var G="1";webphone_api.global.isdebugversion?(SettingItem("loglevel","5","0",GROUP_GENERAL,"","","1","1"),webphone_api.global.loglevel=5):(!isNull(webphone_api.parameters.loglevel)&&1===webphone_api.parameters.loglevel.length&&IsNumber(webphone_api.parameters.loglevel)&&(G=Trim(webphone_api.parameters.loglevel.length)),SettingItem("loglevel",G,"0",GROUP_GENERAL,"","","1","1")),SettingItem("loglevel_dbg",G,"1",GROUP_GENERAL,"","","1","1"),SettingItem("code_version","1","-1",GROUP_NOGROUP,"","","1","1");var O="";!isNull(GetConfig("brandname"))&&GetConfig("brandname").length>0&&(O=Trim(GetConfig("brandname"))),SettingItem("brandname",O,"-1",GROUP_NOGROUP,"","","1","");!isNull(GetConfig("brandid"))&&GetConfig("brandid").length>0&&(O=Trim(GetConfig("brandid"))),SettingItem("brandid","","-1",GROUP_NOGROUP,"","","1","");var L="";!isNull(GetConfig("companyname"))&&GetConfig("companyname").length>0&&(L=Trim(GetConfig("companyname"))),SettingItem("companyname",L,"-1",GROUP_NOGROUP,"","","1","");var C="";!isNull(GetConfig("newuser"))&&GetConfig("newuser").length>0&&(C=Trim(GetConfig("newuser"))),SettingItem("newuser",C,"-1",GROUP_NOGROUP,"","","1","");var D="";!isNull(GetConfig("homepage"))&&GetConfig("homepage").length>0&&(D=Trim(GetConfig("homepage"))),SettingItem("homepage",D,"-1",GROUP_NOGROUP,"","","1","");var y="";!isNull(GetConfig("accounturi"))&&GetConfig("accounturi").length>0&&(y=Trim(GetConfig("accounturi"))),SettingItem("accounturi",y,"-1",GROUP_NOGROUP,"","","1","");var x="";!isNull(GetConfig("recharge"))&&GetConfig("recharge").length>0&&(x=Trim(GetConfig("recharge"))),SettingItem("recharge",x,"-1",GROUP_NOGROUP,"","","1","");var A="";!isNull(GetConfig("p2p"))&&GetConfig("p2p").length>0&&(A=Trim(GetConfig("p2p"))),SettingItem("p2p",A,"1",GROUP_CALLDIVERT,"","","1","");var k="";!isNull(GetConfig("callback"))&&GetConfig("callback").length>0&&(k=Trim(GetConfig("callback"))),SettingItem("callback",k,"1",GROUP_CALLDIVERT,"","","1","");var U="";!isNull(GetConfig("sms"))&&GetConfig("sms").length>0&&(U=Trim(GetConfig("sms"))),SettingItem("sms",U,"1",GROUP_CALLDIVERT,"","","1","");var V="";!isNull(GetConfig("sms_recieve"))&&GetConfig("sms_recieve").length>0&&(V=Trim(GetConfig("sms_recieve"))),SettingItem("sms_recieve",V,"-1",GROUP_NOGROUP,"","","1","");var W="";!isNull(GetConfig("creditrequest"))&&GetConfig("creditrequest").length>0&&(W=Trim(GetConfig("creditrequest"))),SettingItem("creditrequest",W,"1",GROUP_CALLDIVERT,"","","1","");var M="";!isNull(GetConfig("ratingrequest"))&&GetConfig("ratingrequest").length>0&&(M=Trim(GetConfig("ratingrequest"))),SettingItem("ratingrequest",M,"1",GROUP_CALLDIVERT,"","","1","");var F="";!isNull(GetConfig("supportmail"))&&GetConfig("supportmail").length>0&&(F=Trim(GetConfig("supportmail"))),SettingItem("supportmail",F,"-1",GROUP_NOGROUP,"","","1","");var H="";!isNull(GetConfig("supporturl"))&&GetConfig("supporturl").length>0&&(H=Trim(GetConfig("supporturl"))),SettingItem("supporturl",H,"-1",GROUP_NOGROUP,"","","1","");var B=GetParameter("header");!isNull(GetConfig("header"))&&GetConfig("header").length>0&&(B=Trim(GetConfig("header"))),B.length<1&&!isNull(GetConfig("headertext"))&&GetConfig("headertext").length>0&&(B=GetConfig("headertext")),SettingItem("header",B,"-1",GROUP_NOGROUP,"","","1","");var $="";!isNull(GetConfig("footer"))&&GetConfig("footer").length>0&&($=Trim(GetConfig("footer"))),$.length<1&&!isNull(GetConfig("footertext"))&&GetConfig("footertext").length>0&&($=GetConfig("footertext")),SettingItem("footer",$,"-1",GROUP_NOGROUP,"","","1","");var j="";!isNull(GetConfig("logo"))&&GetConfig("logo").length>0&&(j=Trim(GetConfig("logo"))),SettingItem("logo",j,"-1",GROUP_NOGROUP,"","","1","");var q="";!isNull(GetConfig("version"))&&GetConfig("version").length>0&&(q=Trim(GetConfig("version"))),SettingItem("version",q,"-1",GROUP_NOGROUP,"","","1","");var z="";!isNull(GetConfig("messagedisplay"))&&GetConfig("messagedisplay").length>0&&(z=Trim(GetConfig("messagedisplay"))),SettingItem("messagedisplay",z,"-1",GROUP_NOGROUP,"","","1","");var K="";!isNull(GetConfig("messagepopup"))&&GetConfig("messagepopup").length>0&&(K=Trim(GetConfig("messagepopup"))),SettingItem("messagepopup",K,"-1",GROUP_NOGROUP,"","","1","");var J="";!isNull(GetConfig("advertisement"))&&GetConfig("advertisement").length>0&&(J=Trim(GetConfig("advertisement"))),SettingItem("advertisement",J,"-1",GROUP_NOGROUP,"","","1","");var X="";!isNull(GetConfig("helpurl"))&&GetConfig("helpurl").length>0&&(X=Trim(GetConfig("helpurl"))),SettingItem("helpurl",X,"-1",GROUP_NOGROUP,"","","1","");var Y="";!isNull(GetConfig("licenseurl"))&&GetConfig("licenseurl").length>0&&(Y=Trim(GetConfig("licenseurl"))),SettingItem("licenseurl",Y,"-1",GROUP_NOGROUP,"","","1","");var Q="";!isNull(GetConfig("extramenuurl"))&&GetConfig("extramenuurl").length>0&&(Q=Trim(GetConfig("extramenuurl"))),SettingItem("extramenuurl",Q,"-1",GROUP_NOGROUP,"","","1","");var Z="";!isNull(GetConfig("extramenutxt"))&&GetConfig("extramenutxt").length>0&&(Z=Trim(GetConfig("extramenutxt"))),SettingItem("extramenutxt",Z,"-1",GROUP_NOGROUP,"","","1","");var ee="";!isNull(GetConfig("extramenuurl1"))&&GetConfig("extramenuurl1").length>0&&(ee=Trim(GetConfig("extramenuurl1"))),SettingItem("extramenuurl1",ee,"-1",GROUP_NOGROUP,"","","1","");var oe="";!isNull(GetConfig("extramenutxt1"))&&GetConfig("extramenutxt1").length>0&&(oe=Trim(GetConfig("extramenutxt1"))),SettingItem("extramenutxt1",oe,"-1",GROUP_NOGROUP,"","","1","");var ne="";!isNull(GetConfig("extramenuurl2"))&&GetConfig("extramenuurl2").length>0&&(ne=Trim(GetConfig("extramenuurl2"))),SettingItem("extramenuurl2",ne,"-1",GROUP_NOGROUP,"","","1","");var te="";!isNull(GetConfig("extramenutxt2"))&&GetConfig("extramenutxt2").length>0&&(te=Trim(GetConfig("extramenutxt2"))),SettingItem("extramenutxt2",te,"-1",GROUP_NOGROUP,"","","1","");var ie="";!isNull(GetConfig("extramenuurl3"))&&GetConfig("extramenuurl3").length>0&&(ie=Trim(GetConfig("extramenuurl3"))),SettingItem("extramenuurl3",ie,"-1",GROUP_NOGROUP,"","","1","");var ae="";!isNull(GetConfig("extramenutxt3"))&&GetConfig("extramenutxt3").length>0&&(ae=Trim(GetConfig("extramenutxt3"))),SettingItem("extramenutxt3",ae,"-1",GROUP_NOGROUP,"","","1","");var re="";!isNull(GetConfig("extramenuurl4"))&&GetConfig("extramenuurl4").length>0&&(re=Trim(GetConfig("extramenuurl4"))),SettingItem("extramenuurl4",re,"-1",GROUP_NOGROUP,"","","1","");var le="";!isNull(GetConfig("extramenutxt4"))&&GetConfig("extramenutxt4").length>0&&(le=Trim(GetConfig("extramenutxt4"))),SettingItem("extramenutxt4",le,"-1",GROUP_NOGROUP,"","","1","");var pe="";!isNull(GetConfig("extramenuurl5"))&&GetConfig("extramenuurl5").length>0&&(pe=Trim(GetConfig("extramenuurl5"))),SettingItem("extramenuurl5",pe,"-1",GROUP_NOGROUP,"","","1","");var se="";!isNull(GetConfig("extramenutxt5"))&&GetConfig("extramenutxt5").length>0&&(se=Trim(GetConfig("extramenutxt5"))),SettingItem("extramenutxt5",se,"-1",GROUP_NOGROUP,"","","1","");var ce="0";!isNull(GetConfig("enablepresence"))&&GetConfig("enablepresence").length>0&&(ce=Trim(GetConfig("enablepresence"))),SettingItem("enablepresence",ce,"-1",GROUP_NOGROUP,"","","1","0"),SettingItem("presencestatus","Online","2",GROUP_PROFILE,"Online,Away,DND,Invisible,Offline","Online,Away,DND,Invisible,Offline","1","Online"),SettingItem("numexistscalled","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("servercontacts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("verifyuser","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("srvcontacts","","-1",GROUP_NOGROUP,"","","1","0");var ue="false";!isNull(GetConfig("contacttoggle"))&&GetConfig("contacttoggle").length>0&&(ue=Trim(GetConfig("contacttoggle"))),SettingItem("contacttoggle",ue,"-1",GROUP_NOGROUP,"","","1","false"),SettingItem("last_callback_nr","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("callback_mode","0","2",GROUP_CALLDIVERT,"No,Ask,On no internet,On no WIFI,Always","0,1,2,3,4","1","0"),SettingItem("accounts","","5",GROUP_SIP,"","","1",""),SettingItem("reset_settings","","8",GROUP_GENERAL,"","","1","");var ge="false";!isNull(GetConfig("voicerecording"))&&GetConfig("voicerecording").length>0&&("true"==ge||"false"==ge)&&(ge=Trim(GetConfig("voicerecording"))),SettingItem("voicerecording",ge,"0",GROUP_GENERAL,"","","1",ge),SettingItem("ringtone","","8",GROUP_GENERAL,"Ringtone1,Ringtone2,Ringtone3","0,1,2","1",""),SettingItem("changesptoring","2","2",GROUP_SIP,webphone_api.stringres.get("changesptoring__nothing")+","+webphone_api.stringres.get("changesptoring__disp_ringing")+","+webphone_api.stringres.get("changesptoring__start_media")+","+webphone_api.stringres.get("changesptoring__start_media_disp"),"0,1,2,3","1","2");var me="-1";isNull(GetConfig("transport"))||(me=GetConfigInt("transport",-1)),SettingItem("transport",me.toString(),"2",GROUP_SIP,"Auto,UDP,TCP,TLS","-1,0,1,2","1",me.toString()),SettingItem("defmute","0","2",GROUP_SIP,webphone_api.stringres.get("defmute__both")+","+webphone_api.stringres.get("defmute__speakers_only")+","+webphone_api.stringres.get("defmute__mic_only"),"0,1,2","1","2"),SettingItem("automute","0","2",GROUP_CALLDIVERT,webphone_api.stringres.get("automute__no")+","+webphone_api.stringres.get("automute__incoming")+","+webphone_api.stringres.get("automute__outgoing")+","+webphone_api.stringres.get("automute__both")+","+webphone_api.stringres.get("automute__other_line"),"0,1,2,3,4","1","0"),SettingItem("autohold","0","2",GROUP_CALLDIVERT,webphone_api.stringres.get("autohold__no")+","+webphone_api.stringres.get("autohold__incoming")+","+webphone_api.stringres.get("autohold__outgoing")+","+webphone_api.stringres.get("autohold__both")+","+webphone_api.stringres.get("autohold__other_line"),"0,1,2,3,4","1","0"),SettingItem("customsipheader","","1",GROUP_SIP,"","","1",""),SettingItem("sendrtponmuted","false","0",GROUP_SIP,"","","1","false"),SettingItem("capabilityrequest","false","0",GROUP_SIP,"","","1","false"),SettingItem("devtest","0,0,0,0,0,0,0,0,0","8",GROUP_SIP,"","","1","0,0,0,0,0,0,0,0,0"),SettingItem("enableaudio","true","0",GROUP_CALLDIVERT,"","","1","true"),SettingItem("settobasefunctionality","true","8",GROUP_MAIN,"","","1","true"),SettingItem("dialerintegration","false","0",GROUP_INTEGRATE,"","","1","false"),SettingItem("screenrotation","0","2",GROUP_GENERAL,"Auto,No,Yes","0,1,2","1","0"),SettingItem("audiobufferlength","-1","1",GROUP_MEDIA,"","","1","-1"),SettingItem("keepaliveival","28000","1",GROUP_SIP,"","","1","28000"),SettingItem("cpualwayspartiallock","false","0",GROUP_GENERAL,"","","1","false"),SettingItem("disablewbforpstn","1","2",GROUP_MEDIA,"No,Yes (check on first call),Yes (check always)","0,1,2","1","1"),SettingItem("storecallhistory","1","2",GROUP_GENERAL,"Local + Native,Local,Native,No history","0,1,2,3","1","1"),SettingItem("keepdeviceawakeincall","2","2",GROUP_GENERAL,"No,Basic only,Auto,Full then partial,Always full","0,1,2,3,4","1","2"),SettingItem("speakermode","0","2",GROUP_MEDIA,webphone_api.stringres.get("speakermode__auto")+","+webphone_api.stringres.get("speakermode__never")+","+webphone_api.stringres.get("speakermode__always"),"0,1,2","1","0"),SettingItem("focusaudio","1","2",GROUP_MEDIA,"Auto guess,No,Yes","0,1,2","1","1"),SettingItem("useroutingapi","0","2",GROUP_MEDIA,"Auto,No,Yes","0,1,2","1","0"),SettingItem("integrateifwifionly","false","0",GROUP_INTEGRATE,"","","1","false"),SettingItem("nativefilterallow","","1",GROUP_INTEGRATE,"","","1",""),SettingItem("nativefilterblock","","1",GROUP_INTEGRATE,"","","1",""),SettingItem("companyname","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("supportpageuri","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("proversioncallcount","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("magicnumber",SETT_MAGIC_NUMBER,"-1",GROUP_NOGROUP,"","","1",SETT_MAGIC_NUMBER),SettingItem("upgradesettfromdatabase","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("cfgvideo","4","2",GROUP_VIDEO,"Never,On Request,Ask,Autoaccept,Always","2,4,6,8,10","1","4"),SettingItem("video_profile","0","2",GROUP_VIDEO,"Auto,Low,Medium,High,Ultra,Extra","0,4,6,8,10,15","1","0"),SettingItem("cust_lastautoprov","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("lastautoprov","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("loglastusage","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("callfunctionsbtnusage","10,0,5,9,8,10,12,1,3,-2","-1",GROUP_NOGROUP,"","","1"),SettingItem("redial","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("vibrate","0","2",GROUP_GENERAL,"Auto,Never,Always","0,1,2","1","0"),SettingItem("video_fps","0","1",GROUP_VIDEO,"","","1","0"),SettingItem("setfinalcodec","1","2",GROUP_MEDIA,webphone_api.stringres.get("setfinalcodec__never")+","+webphone_api.stringres.get("setfinalcodec__auto")+","+webphone_api.stringres.get("setfinalcodec__multiple_codec")+","+webphone_api.stringres.get("setfinalcodec__always"),"0,1,2,3","1","1"),SettingItem("use_rport","1","2",GROUP_SIP,webphone_api.stringres.get("use_rport__no")+","+webphone_api.stringres.get("use_rport__simmetric_nat")+","+webphone_api.stringres.get("use_rport__always")+","+webphone_api.stringres.get("use_rport__public_ip")+","+webphone_api.stringres.get("use_rport__request"),"0,1,2,3,9","1","1"),SettingItem("natopenpackets","2","1",GROUP_SIP,"","","1","2"),SettingItem("video_accept_checkbox","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("successfulcalls","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webrtc_successfulcalls","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("wasrated","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("lastratedate","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("hidemyidentity","false","0",GROUP_SIP,"","","1","false"),SettingItem("last_transfer_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_conference_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_forward_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("validprovisioning","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("jsscriptevent","2","-1",GROUP_NOGROUP,"","","1","2"),SettingItem("devicetype",""+DEVICE_WEBPHONE(),"-1",GROUP_NOGROUP,"","","1",""+DEVICE_WEBPHONE()),SettingItem("extraoption","","1",GROUP_GENERAL,"","","1",""),SettingItem("enginepriority_java","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_webrtc","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_ns","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_flash","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_app","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_p2p","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_accessnum","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_nativedial","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_otherbrowser","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("engineoldavailable_java","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_webrtc","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_ns","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_flash","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_app","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_p2p","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_accessnum","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_nativedial","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("lastusedengine","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("ignoreengineselect","false","-1",GROUP_NOGROUP,"","","1","false");var be="";!isNull(GetConfig("pc_alternatebrowserurl"))&&GetConfig("pc_alternatebrowserurl").length>0&&(be=Trim(GetConfig("pc_alternatebrowserurl"))),SettingItem("pc_alternatebrowserurl",be,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("lccnr","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("vdnr","0","-1",GROUP_NOGROUP,"","","1","0");var he="";!isNull(GetConfig("ios_nativedialerurl"))&&GetConfig("ios_nativedialerurl").length>0&&(he=Trim(GetConfig("ios_nativedialerurl"))),SettingItem("ios_nativedialerurl",he,"-1",GROUP_NOGROUP,"","","1","");var de="";!isNull(GetConfig("android_nativedialerurl"))&&GetConfig("android_nativedialerurl").length>0&&(de=Trim(GetConfig("android_nativedialerurl"))),SettingItem("android_nativedialerurl",de,"-1",GROUP_NOGROUP,"","","1","");var _e="";!isNull(GetConfig("showsynccontactsmenu"))&&GetConfig("showsynccontactsmenu").length>0&&(_e=Trim(GetConfig("showsynccontactsmenu"))),SettingItem("showsynccontactsmenu",_e,"-1",GROUP_NOGROUP,"","","1","");var we="";!isNull(GetConfig("accessnumber"))&&GetConfig("accessnumber").length>0&&(we=Trim(GetConfig("accessnumber"))),SettingItem("accessnumber",we,"-1",GROUP_NOGROUP,"","","1","");var fe="0";!isNull(GetConfig("colortheme"))&&GetConfig("colortheme").length>0&&(fe=Trim(GetConfig("colortheme"))),SettingItem("theme",fe,"2",GROUP_GENERAL,"Default,Light Blue,Light Green,Light Orange,Light Purple,Dark Red,Yellow,Blue,Purple,Turquoise,Light Skin,Green Orange,Custom 1,Custom 2,Custom 3,Custom 4,Custom 5,Blue2,iPhone,MZ,WebPhone,Custom","0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,18,19,21,22,23,24,25","1","0");var ve="-1";!isNull(GetConfig("useloginpage"))&&GetConfig("useloginpage").length>0&&(ve=Trim(GetConfig("useloginpage"))),SettingItem("useloginpage",ve,"-1",GROUP_NOGROUP,"","","1","-1");var Pe="10";!isNull(GetConfig("featureset"))&&GetConfig("featureset").length>0&&(Pe=Trim(GetConfig("featureset"))),SettingItem("featureset",Pe,"-1",GROUP_NOGROUP,"","","1",Pe),SettingItem("wsusers","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("mainconfigs","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("notifications2","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("canshowlickeyinput","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("normalizenumber","-1","2",GROUP_CALLDIVERT,webphone_api.stringres.get("normalizenumber__auto")+","+webphone_api.stringres.get("normalizenumber__no")+","+webphone_api.stringres.get("normalizenumber__yes"),"-1,0,1","1","-1");var Ee="";!isNull(GetConfig("callforwardonbusy"))&&GetConfig("callforwardonbusy").length>0&&(Ee=Trim(GetConfig("callforwardonbusy"))),SettingItem("callforwardonbusy",Ee,"1",GROUP_CALLDIVERT,"","","1","");var Te="";!isNull(GetConfig("callforwardonnoanswer"))&&GetConfig("callforwardonnoanswer").length>0&&(Te=Trim(GetConfig("callforwardonnoanswer"))),SettingItem("callforwardonnoanswer",Te,"1",GROUP_CALLDIVERT,"","","1","");var Ne="15";!isNull(GetConfig("callforwardonnoanswertimeout"))&&GetConfig("callforwardonnoanswertimeout").length>0&&(Ne=Trim(GetConfig("callforwardonnoanswertimeout"))),SettingItem("callforwardonnoanswertimeout",Ne,"1",GROUP_CALLDIVERT,"","","1","");var Se="";!isNull(GetConfig("callforwardalways"))&&GetConfig("callforwardalways").length>0&&(Se=Trim(GetConfig("callforwardalways"))),SettingItem("callforwardalways",Se,"1",GROUP_CALLDIVERT,"","","1","");var Ie="";!isNull(GetConfig("calltransferalways"))&&GetConfig("calltransferalways").length>0&&(Ie=Trim(GetConfig("calltransferalways"))),SettingItem("calltransferalways",Ie,"1",GROUP_CALLDIVERT,"","","1","");var Re="0";!isNull(GetConfig("autoignore"))&&GetConfig("autoignore").length>0&&(Re=Trim(GetConfig("autoignore"))),SettingItem("autoignore",Re,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("autoignore__dont")+","+webphone_api.stringres.get("autoignore__silently")+","+webphone_api.stringres.get("autoignore__reject"),"0,1,2","1","0");var Ge="false";!isNull(GetConfig("autoaccept"))&&GetConfig("autoaccept").length>0&&(Ge=Trim(GetConfig("autoaccept"))),SettingItem("autoaccept",Ge,"0",GROUP_CALLDIVERT,"","","1","false"),SettingItem("filters","","5",GROUP_CALLDIVERT,"","","1",""),SettingItem("blocked_contacts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("usemizutlsproxy","1","-1",GROUP_NOGROUP,"No,Auto,Yes","0,1,2","1",""),SettingItem("usemizutlsproxy_userreload","","-1",GROUP_NOGROUP,"","0,1,2","1",""),SettingItem("notification_count2","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("autostart","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("displaypeerdetails","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("rejectonbusy","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("voicerecupload","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lastsessionsuccess","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("codec","-1","3",GROUP_MEDIA,"Optimal,PCMU,PCMA,GSM,iLBC,SPEEX,SPEEX-WB,G.729,Opus,OpusWB,OpusUWB","-1,1,2,3,4,5,6,8,10,11,13","1","-1"),GetCodecsFromApiParam(),SettingItem("videocodec","-1","3",GROUP_MEDIA,"Optimal,H264,VP8,VP9","-1","1","-1"),SettingItem("use_h264","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("use_vp8","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("use_vp9","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("blacklist","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("sel_rtc_audio_in","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("sel_rtc_audio_out","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("sel_rtc_video_in","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("audiodevices","","8",GROUP_MEDIA,"","","1",""),SettingItem("autoaction","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webcallme","1","-1",GROUP_NOGROUP,"","","1","1");var Oe=GetConfigInt("conferencetype",1);SettingItem("conferencetype",Oe.toString(),"2",GROUP_CALLDIVERT,webphone_api.stringres.get("conferencetype__disabled")+","+webphone_api.stringres.get("conferencetype__auto")+","+webphone_api.stringres.get("conferencetype__native")+","+webphone_api.stringres.get("conferencetype__server")+","+webphone_api.stringres.get("conferencetype__3way")+","+webphone_api.stringres.get("conferencetype__cr_msg_ref")+","+webphone_api.stringres.get("conferencetype__cr_msg")+","+webphone_api.stringres.get("conferencetype__cr_ref"),"0,1,2,3,4,5,6,7","1",Oe.toString()),SettingItem("received_confrooms","","-1",GROUP_NOGROUP,"","","1","");var Le="";!isNull(GetConfig("callbacknumber"))&&GetConfig("callbacknumber").length>0&&(Le=Trim(GetConfig("callbacknumber"))),SettingItem("callbacknumber",Le,"1",GROUP_CALLDIVERT,"","","1",""),SettingItem("iswebrtcuppersrvfromuser","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("java_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("ns_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("webrtc_worked","false","-1",GROUP_NOGROUP,"","","1","false");var Ce="-1";!isNull(GetConfig("video"))&&GetConfig("video").length>0&&(Ce=Trim(GetConfig("video"))),SettingItem("video",Ce,"2",GROUP_MEDIA,webphone_api.stringres.get("video__auto")+","+webphone_api.stringres.get("video__disable")+","+webphone_api.stringres.get("video__enable")+","+webphone_api.stringres.get("video__force"),"-1,0,1,2","1","1");var De="0";!isNull(GetConfig("video_bandwidth"))&&GetConfig("video_bandwidth").length>0&&(De=Trim(GetConfig("video_bandwidth"))),SettingItem("video_bandwidth",De,"1",GROUP_MEDIA,"","","1","0");var ye="640";!isNull(GetConfig("video_width"))&&GetConfig("video_width").length>0&&(ye=Trim(GetConfig("video_width"))),SettingItem("video_width",ye,"1",GROUP_MEDIA,"","","1","640");var xe="480";!isNull(GetConfig("video_height"))&&GetConfig("video_height").length>0&&(xe=Trim(GetConfig("video_height"))),SettingItem("video_height",xe,"1",GROUP_MEDIA,"","","1","480"),SettingItem("androidchromedisplayed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("conf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("transf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("filterchatduplicates","true","-1",GROUP_NOGROUP,"","","1","true");var Ae="true";!isNull(GetConfig("has_video"))&&GetConfig("has_video").length>0&&(Ae=Trim(GetConfig("has_video"))),"0"===GetParameter2("video")&&(Ae="false"),SettingItem("has_video",Ae,"1",GROUP_MEDIA,"","","1",Ae),SettingItem("sendchatonenter","true","0",GROUP_GENERAL,"","","1","true");var ke="-1";!isNull(GetConfig("transfwithreplace"))&&GetConfig("transfwithreplace").length>0&&(ke=Trim(GetConfig("transfwithreplace"))),SettingItem("transfwithreplace",ke,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfwithreplace__auto")+","+webphone_api.stringres.get("transfwithreplace__no")+","+webphone_api.stringres.get("transfwithreplace__yes"),"-1,0,1","1","-1"),SettingItem("acceptcall_onsharedevice","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("showratewhiletype_minlenth","3","-1",GROUP_NOGROUP,"","","1","3"),SettingItem("showratewhiletype_maxlenth","6","-1",GROUP_NOGROUP,"","","1","6");var Ue="1";!isNull(GetConfig("multilinegui"))&&GetConfig("multilinegui").length>0&&(Ue=Trim(GetConfig("multilinegui"))),SettingItem("multilinegui",Ue,"-1",GROUP_NOGROUP,"","","1",Ue),SettingItem("enginechecksum","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("redialonfail","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("autosrvupgrade","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("srvupgrade_count","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("srvupgrade_version","","-1",GROUP_NOGROUP,"","","1",""),
SettingItem("srvupgrade_currversion","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srvupgrade_currversion_extcmd_test","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srv_exe_version","0","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srv_java_version","0","-1",GROUP_NOGROUP,"","","1","-1");var Ve="1";!isNull(GetConfig("useaudiodevicerecord"))&&GetConfig("useaudiodevicerecord").length>0&&(Ve=Trim(GetConfig("useaudiodevicerecord"))),SettingItem("useaudiodevicerecord",Ve,"-1",GROUP_NOGROUP,"","","1",Ve),SettingItem("fasthold","0","-1",GROUP_NOGROUP,"","","1","-1");SettingItem("calldivertchecksum",Md5Hash(Ee+Te+Se+Ne),"-1",GROUP_NOGROUP,"","","1",""),SettingItem("calldivertsuccess","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("muteholdalllines","0","-1",GROUP_NOGROUP,"","","1","0");var We="1";!isNull(GetConfig("allowcallredirect"))&&GetConfig("allowcallredirect").length>0&&(We=Trim(GetConfig("allowcallredirect"))),SettingItem("allowcallredirect",We,"-1",GROUP_NOGROUP,"","","1",We);var Me="1";!isNull(GetConfig("playdtmfsound"))&&GetConfig("playdtmfsound").length>0&&(Me=Trim(GetConfig("playdtmfsound"))),SettingItem("playdtmfsound",Me,"-1",GROUP_NOGROUP,"","","1",Me);var Fe="en";"rigitel"===GetConfig("brandname").toLowerCase()&&(Fe="de"),isNull(GetConfig("language"))||2!==GetConfig("language").length||(Fe=Trim(GetConfig("language"))),SettingItem("language",Fe,"2",GROUP_GENERAL,"English,German,Hungarian,Portuguese","en,de,hu,pt","1","en"),SettingItem("chrome_local_alert_displayed","false","-1",GROUP_NOGROUP,"","","1","false");var He=GetConfig("telsearchurl");!isNull(He)&&He.length>0&&SettingItem("telsearchkey","3606e399f2ec49f31831949efba6daf1","1",GROUP_GENERAL,"","","1","3606e399f2ec49f31831949efba6daf1");var Be="1";!isNull(GetConfig("screensharing"))&&GetConfig("screensharing").length>0&&(Be=Trim(GetConfig("screensharing"))),SettingItem("screensharing",Be,"-1",GROUP_NOGROUP,"","","1",Be),SettingItem("extraregisteraccounts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lastsucc","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("enproblem","0","-1",GROUP_NOGROUP,"","","1","0");var $e="0";!isNull(GetConfig("audio_bandwidth"))&&GetConfig("audio_bandwidth").length>0&&($e=Trim(GetConfig("audio_bandwidth"))),SettingItem("audio_bandwidth",$e,"1",GROUP_MEDIA,"","","1","0");var je="1";!isNull(GetConfig("enablepres_httpapi"))&&GetConfig("enablepres_httpapi").length>0&&(je=Trim(GetConfig("enablepres_httpapi"))),SettingItem("enablepres_httpapi",je,"-1",GROUP_NOGROUP,"","","1","1");var qe="1";!isNull(GetConfig("enablepres_javaapi"))&&GetConfig("enablepres_javaapi").length>0&&(qe=Trim(GetConfig("enablepres_javaapi"))),SettingItem("enablepres_javaapi",qe,"-1",GROUP_NOGROUP,"","","1","1");var ze="1";!isNull(GetConfig("enablepres_webrtc"))&&GetConfig("enablepres_webrtc").length>0&&(ze=Trim(GetConfig("enablepres_webrtc"))),SettingItem("enablepres_webrtc",ze,"-1",GROUP_NOGROUP,"","","1","1");var Ke="1";!isNull(GetConfig("incomingcallpopup"))&&GetConfig("incomingcallpopup").length>0&&(Ke=Trim(GetConfig("incomingcallpopup"))),SettingItem("incomingcallpopup",Ke,"2",GROUP_GENERAL,webphone_api.stringres.get("incomingcallpopup__no")+","+webphone_api.stringres.get("incomingcallpopup__auto")+","+webphone_api.stringres.get("incomingcallpopup__yes")+","+webphone_api.stringres.get("incomingcallpopup__always"),"0,1,2,3","1","1"),SettingItem("wpfirststart","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("useragent","","-1",GROUP_NOGROUP,"","","1","");var Je="1";!isNull(GetConfig("allowsipuriasusername"))&&GetConfig("allowsipuriasusername").length>0&&(Je=Trim(GetConfig("allowsipuriasusername")));var Xe=GetConfigInt("enabledirectcalls",-5);Xe>=0&&(Je=Xe.toString()),SettingItem("allowsipuriasusername",Je,"-1",GROUP_NOGROUP,"","","1","0");var Ye="0";!isNull(GetConfig("beeponconnect"))&&GetConfig("beeponconnect").length>0&&(Ye=Trim(GetConfig("beeponconnect"))),SettingItem("beeponconnect",Ye,"-1",GROUP_NOGROUP,"","","1","0");var Qe="0";!isNull(GetConfig("disablepopups"))&&GetConfig("disablepopups").length>0&&(Qe=Trim(GetConfig("disablepopups"))),SettingItem("disablepopups",Qe,"-1",GROUP_NOGROUP,"","","1",Qe);var Ze="true";!isNull(GetConfig("showtoasts"))&&GetConfig("showtoasts").length>0&&(Ze=Trim(GetConfig("showtoasts"))),SettingItem("showtoasts",Ze,"-1",GROUP_NOGROUP,"","","1","true"),SettingItem("isfirstcallfwd","true","-1",GROUP_NOGROUP,"","","1","true");var eo="0";!isNull(GetConfig("beeponincoming"))&&GetConfig("beeponincoming").length>0&&(eo=Trim(GetConfig("beeponincoming"))),SettingItem("beeponincoming",eo,"0",GROUP_GENERAL,"","","1","0");var oo="2";!isNull(GetConfig("flash"))&&GetConfig("flash").length>0&&(oo=Trim(GetConfig("flash"))),SettingItem("flash",oo,"0",GROUP_GENERAL,"","","1","2");var no="1";!isNull(GetConfig("importonlywithnum"))&&GetConfig("importonlywithnum").length>0&&(no=Trim(GetConfig("importonlywithnum"))),SettingItem("importonlywithnum",no,"2",GROUP_GENERAL,webphone_api.stringres.get("importonlywithnum__no")+","+webphone_api.stringres.get("importonlywithnum__yes"),"0,1","1","1");var to="2";!isNull(GetConfig("videomode"))&&GetConfig("videomode").length>0&&(to=Trim(GetConfig("importonlywithnum"))),SettingItem("videomode",to,"2",GROUP_MEDIA,webphone_api.stringres.get("videomode__always")+","+webphone_api.stringres.get("videomode__noask")+","+webphone_api.stringres.get("videomode__askonce")+","+webphone_api.stringres.get("videomode__alwaysask")+","+webphone_api.stringres.get("videomode__disable"),"1,2,3,4,5","1","2");var io="2";!isNull(GetConfig("sscontrol"))&&GetConfig("sscontrol").length>0&&(io=Trim(GetConfig("sscontrol"))),SettingItem("sscontrol",io,"0",GROUP_SCRSHARE,"","","1","2");var ao="2";!isNull(GetConfig("ssscroll"))&&GetConfig("ssscroll").length>0&&(ao=Trim(GetConfig("ssscroll"))),SettingItem("ssscroll",ao,"0",GROUP_SCRSHARE,"","","1","2");var ro="1";!isNull(GetConfig("sstop"))&&GetConfig("sstop").length>0&&(ro=Trim(GetConfig("sstop"))),SettingItem("sstop",ro,"0",GROUP_SCRSHARE,"","","1","1");var lo="2";!isNull(GetConfig("ssquality"))&&GetConfig("ssquality").length>0&&(lo=Trim(GetConfig("ssquality"))),SettingItem("ssquality",lo,"2",GROUP_SCRSHARE,webphone_api.stringres.get("ssquality__low")+","+webphone_api.stringres.get("ssquality__medium")+","+webphone_api.stringres.get("ssquality__high"),"1,2,3","1","2");var po="";!isNull(GetConfig("bundlepolicy"))&&GetConfig("bundlepolicy").length>0&&(po=Trim(GetConfig("bundlepolicy"))),SettingItem("bundlepolicy",po,"-1",GROUP_NOGROUP,"","","1",po);var so="";!isNull(GetConfig("icecandidatepoolsize"))&&GetConfig("icecandidatepoolsize").length>0&&(so=Trim(GetConfig("icecandidatepoolsize"))),SettingItem("icecandidatepoolsize",so,"-1",GROUP_NOGROUP,"","","1",so);var co="";!isNull(GetConfig("icetransportpolicy"))&&GetConfig("icetransportpolicy").length>0&&(co=Trim(GetConfig("icetransportpolicy"))),SettingItem("icetransportpolicy",co,"-1",GROUP_NOGROUP,"","","1",co);var uo="0";!isNull(GetConfig("displayvideodevice"))&&GetConfig("displayvideodevice").length>0&&(uo=Trim(GetConfig("displayvideodevice"))),SettingItem("displayvideodevice",uo,"-1",GROUP_NOGROUP,"","","1",uo);var go="30000";!isNull(GetConfig("wskeepaliveival"))&&GetConfig("wskeepaliveival").length>0&&(go=Trim(GetConfig("wskeepaliveival"))),SettingItem("wskeepaliveival",go,"-1",GROUP_NOGROUP,"","","1",go);var mo="1";!isNull(GetConfig("enableblf"))&&GetConfig("enableblf").length>0&&(mo=Trim(GetConfig("enableblf"))),SettingItem("enableblf",mo,"-1",GROUP_SIP,"","","1",mo);var bo="";!isNull(GetConfig("profilestatustext"))&&GetConfig("profilestatustext").length>0&&(bo=Trim(GetConfig("profilestatustext"))),SettingItem("profilestatustext",bo,"1",GROUP_PROFILE,"","","1",bo);var ho="0";!isNull(GetConfig("share_location"))&&GetConfig("share_location").length>0&&(ho=Trim(GetConfig("share_location"))),SettingItem("share_location",ho,"2",GROUP_PROFILE,webphone_api.stringres.get("share_location__no")+","+webphone_api.stringres.get("share_location__yes"),"0,1","1",ho);var _o="";!isNull(GetConfig("profilepicture"))&&GetConfig("profilepicture").length>0&&(_o=Trim(GetConfig("profilepicture"))),SettingItem("profilepicture",_o,"1",GROUP_PROFILE,"","","1",_o),SettingItem("profilehistory","","-1",GROUP_NOGROUP,"","","1","");var wo="1";!isNull(GetConfig("p2psignaling"))&&GetConfig("p2psignaling").length>0&&(wo=Trim(GetConfig("p2psignaling"))),SettingItem("p2psignaling",wo,"-1",GROUP_NOGROUP,"","","1",wo),SettingItem("nsupdate","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("lastwpapixxx","","-1",GROUP_NOGROUP,"","","1","");var fo="1";!isNull(GetConfig("androidspeaker"))&&GetConfig("androidspeaker").length>0&&(fo=Trim(GetConfig("androidspeaker"))),SettingItem("androidspeaker",fo,"2",GROUP_MEDIA,webphone_api.stringres.get("androidspeaker__def")+","+webphone_api.stringres.get("androidspeaker__before_fcall")+","+webphone_api.stringres.get("androidspeaker__after_fcall")+","+webphone_api.stringres.get("androidspeaker__atstart"),"0,1,2,3","1",fo);var vo=[];vo.push(","),vo.push("w"),vo.push("s"),vo.push("s"),vo.push(":"),vo.push("/"),vo.push("/"),vo.push("e"),vo.push("c"),vo.push("h"),vo.push("o"),vo.push("."),vo.push("w"),vo.push("e"),vo.push("b"),vo.push("s"),vo.push("o"),vo.push("c"),vo.push("k"),vo.push("e"),vo.push("t"),vo.push("."),vo.push("o"),vo.push("r"),vo.push("g"),vo.push(",");var Po=vo.join("");SettingItem("wstestservers",Po,"-1",GROUP_NOGROUP,"","","1",Po),SettingItem("lastgood_wstest","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("domaintoip_cache","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_clientreset","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("last_clientresetall","-1","-1",GROUP_NOGROUP,"","","1","-1");var Eo="1";!isNull(GetConfig("alwaysallowlowcodec"))&&GetConfig("alwaysallowlowcodec").length>0&&(Eo=Trim(GetConfig("alwaysallowlowcodec"))),SettingItem("alwaysallowlowcodec",Eo,"2",GROUP_MEDIA,webphone_api.stringres.get("alwaysallowlowcodec__never")+","+webphone_api.stringres.get("alwaysallowlowcodec__auto")+","+webphone_api.stringres.get("alwaysallowlowcodec__always"),"0,1,2","1",Eo);var To="90";!isNull(GetConfig("keeprecfiles"))&&GetConfig("keeprecfiles").length>0&&(To=Trim(GetConfig("keeprecfiles"))),SettingItem("keeprecfiles",To,"1",GROUP_GENERAL,"","","1",To);var No="0";!isNull(GetConfig("sipprotocol"))&&GetConfig("sipprotocol").length>0&&(No=Trim(GetConfig("sipprotocol"))),SettingItem("sipprotocol",No,"-1",GROUP_NOGROUP,"","","1",No),SettingItem("resetsettings","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("wphoneappurl","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("needunregister","true","-1",GROUP_NOGROUP,"","","1","true");var So="-1";!isNull(GetConfig("holdtype"))&&GetConfig("holdtype").length>0&&(So=Trim(GetConfig("holdtype"))),SettingItem("holdtype",So,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("holdtype__never")+","+webphone_api.stringres.get("holdtype__auto")+","+webphone_api.stringres.get("holdtype__no")+","+webphone_api.stringres.get("holdtype__notused")+","+webphone_api.stringres.get("holdtype__hold")+","+webphone_api.stringres.get("holdtype__otherparty")+","+webphone_api.stringres.get("holdtype__both"),"-2,-1,0,1,2,3,4","1",So);var Io="0";!isNull(GetConfig("colorizelog"))&&GetConfig("colorizelog").length>0&&(Io=Trim(GetConfig("colorizelog"))),SettingItem("colorizelog",Io,"-1",GROUP_NOGROUP,"","","1",Io);var Ro="1";!isNull(GetConfig("forcereregister"))&&GetConfig("forcereregister").length>0&&(Ro=Trim(GetConfig("forcereregister"))),SettingItem("forcereregister",Ro,"-1",GROUP_NOGROUP,"","","1",Ro);var Go="0";!isNull(GetConfig("enablepush"))&&GetConfig("enablepush").length>0&&(Go=Trim(GetConfig("enablepush"))),SettingItem("enablepush",Go,"2",GROUP_GENERAL,webphone_api.stringres.get("enablepush__auto")+","+webphone_api.stringres.get("enablepush__no")+","+webphone_api.stringres.get("enablepush__yes"),"-1,0,1","1",Go);var Oo="-1";!isNull(GetConfig("callreceiver"))&&GetConfig("callreceiver").length>0&&(Oo=Trim(GetConfig("callreceiver"))),SettingItem("callreceiver",Oo,"-1",GROUP_NOGROUP,webphone_api.stringres.get("callreceiver__auto")+","+webphone_api.stringres.get("callreceiver__noincoming")+","+webphone_api.stringres.get("callreceiver__enablewhilerunning")+","+webphone_api.stringres.get("callreceiver__enablebackgroud"),"-1,0,1,2","1",Oo),SettingItem("appinstalltime",GetTickCount().toString(),"-1",GROUP_NOGROUP,"","","1",GetTickCount().toString()),SettingItem("lastincalltime","0","-1",GROUP_NOGROUP,"","","1","0");var mo="1";!isNull(GetConfig("enableblf"))&&GetConfig("enableblf").length>0&&(mo=Trim(GetConfig("enableblf"))),SettingItem("enableblf",mo,"2",GROUP_SIP,webphone_api.stringres.get("enableblf__no")+","+webphone_api.stringres.get("enableblf__auto")+","+webphone_api.stringres.get("enableblf__always")+","+webphone_api.stringres.get("enableblf__must"),"0,1,2,3","1",mo),SettingItem("firststart_webrtc","true","-1",GROUP_NOGROUP,"","","1","true");var Lo="2";!isNull(GetConfig("dropsameoldcall"))&&GetConfig("dropsameoldcall").length>0&&(Lo=Trim(GetConfig("dropsameoldcall"))),SettingItem("dropsameoldcall",Lo,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("dropsameoldcall__no")+","+webphone_api.stringres.get("dropsameoldcall__requested")+","+webphone_api.stringres.get("dropsameoldcall__reqvideo")+","+webphone_api.stringres.get("dropsameoldcall__forall"),"0,1,2,3","1",Lo),SettingItem("wseverconnected","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("sortcontacts","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("filtercontacts","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("lastfilterval","0","-1",GROUP_NOGROUP,"","","1","0");var Co="";!isNull(GetConfig("serveraddressbook_url"))&&GetConfig("serveraddressbook_url").length>0&&(Co=Trim(GetConfig("serveraddressbook_url"))),SettingItem("serveraddressbook_url",Co,"-1",GROUP_NOGROUP,"","","1",Co);var Do="0";!isNull(GetConfig("serveraddressbook_sync"))&&GetConfig("serveraddressbook_sync").length>0&&(Do=Trim(GetConfig("serveraddressbook_sync"))),SettingItem("serveraddressbook_sync",Do,"-1",GROUP_NOGROUP,"","","1",Do),SettingItem("serveraddressbook_status","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("last_good_webrtc_gw","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_login_failed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("startpage_disp_count","0","-1",GROUP_NOGROUP,"","","1","0");var yo="false";!isNull(GetConfig("mustconnect"))&&GetConfig("mustconnect").length>0&&(yo=Trim(GetConfig("mustconnect"))),SettingItem("mustconnect",yo,"-1",GROUP_NOGROUP,"","","1",yo),SettingItem("reloadalertdisplayed","false","-1",GROUP_NOGROUP,"","","1","false");var xo="1";!isNull(GetConfig("networkchecks"))&&GetConfig("networkchecks").length>0&&(xo=Trim(GetConfig("networkchecks"))),SettingItem("networkchecks",xo,"-1",GROUP_NOGROUP,"","","1",xo);var Ao="0";!isNull(GetConfig("qrcode_login"))&&GetConfig("qrcode_login").length>0&&(Ao=Trim(GetConfig("qrcode_login"))),SettingItem("qrcode_login",Ao,"-1",GROUP_NOGROUP,"","","1",Ao);var ko="2000";!isNull(GetConfig("icetimeout"))&&GetConfig("icetimeout").length>0&&(ko=Trim(GetConfig("icetimeout"))),SettingItem("icetimeout",ko,"1",GROUP_SIP,"","","1",ko);var Uo="1";!isNull(GetConfig("normalize_contact"))&&GetConfig("normalize_contact").length>0&&(Uo=Trim(GetConfig("normalize_contact"))),SettingItem("normalize_contact",Uo,"1",GROUP_SIP,"","","1",Uo);var Vo="300";!isNull(GetConfig("nspollinterval"))&&GetConfig("nspollinterval").length>0&&(Vo=Trim(GetConfig("nspollinterval"))),SettingItem("nspollinterval",Vo,"-1",GROUP_NOGROUP,"","","1",Vo),SettingItem("cache_audio_rec_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_play_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_ring_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_video_rec_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_rec_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_play_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_ring_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_video_rec_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lnsengine","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("cancelonnsdownload","0","-1",GROUP_NOGROUP,"","","1","0");var Wo="0";!isNull(GetConfig("autogenpassword"))&&GetConfig("autogenpassword").length>0&&(Wo=Trim(GetConfig("autogenpassword"))),SettingItem("autogenpassword",Wo,"-1",GROUP_NOGROUP,"","","1",Wo);var Mo="2";!isNull(GetConfig("appengine_startat"))&&GetConfig("appengine_startat").length>0&&(Mo=Trim(GetConfig("appengine_startat"))),SettingItem("appengine_startat",Mo,"-1",GROUP_NOGROUP,"","","1",Mo);var Fo="";!isNull(GetConfig("customautoprov_url"))&&GetConfig("customautoprov_url").length>0&&(Fo=Trim(GetConfig("customautoprov_url"))),SettingItem("customautoprov_url",Fo,"-1",GROUP_NOGROUP,"","","1",Fo);var Ho="1";!isNull(GetConfig("customautoprov_when"))&&GetConfig("customautoprov_when").length>0&&(Ho=Trim(GetConfig("customautoprov_when"))),SettingItem("customautoprov_when",Ho,"-1",GROUP_NOGROUP,"","","1",Ho);var Bo="1";!isNull(GetConfig("customautoprov_repeat"))&&GetConfig("customautoprov_repeat").length>0&&(Bo=Trim(GetConfig("customautoprov_repeat"))),SettingItem("customautoprov_repeat",Bo,"-1",GROUP_NOGROUP,"","","1",Bo),SettingItem("custautoprov_exectimes","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("storagecookiefailback","1","-1",GROUP_NOGROUP,"","","1","0");var $o="1";!isNull(GetConfig("quick_access_list"))&&GetConfig("quick_access_list").length>0&&($o=Trim(GetConfig("quick_access_list"))),SettingItem("quick_access_list",$o,"-1",GROUP_NOGROUP,"","","1",$o);var jo="1";!isNull(GetConfig("nsupgrademode"))&&GetConfig("nsupgrademode").length>0&&(jo=Trim(GetConfig("nsupgrademode"))),SettingItem("nsupgrademode",jo,"2",GROUP_SIP,webphone_api.stringres.get("nsupgrademode__background")+","+webphone_api.stringres.get("nsupgrademode__delayed")+","+webphone_api.stringres.get("nsupgrademode__immediate"),"0,1,2","1",jo),SettingItem("last_good_ns_plugin_url","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("app_popup_displayed","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("allow_start_app_engine","1","-1",GROUP_NOGROUP,"","","1","1");var qo="0";!isNull(GetConfig("logmanualemail"))&&GetConfig("logmanualemail").length>0&&(qo=Trim(GetConfig("logmanualemail"))),SettingItem("logmanualemail",qo,"-1",GROUP_NOGROUP,"","","1",qo);var zo="";!isNull(GetConfig("logmanualemail_adress"))&&GetConfig("logmanualemail_adress").length>0?zo=Trim(GetConfig("logmanualemail_adress")):!isNull(GetConfig("logmanualemail_address"))&&GetConfig("logmanualemail_address").length>0&&(zo=Trim(GetConfig("logmanualemail_address"))),SettingItem("logmanualemail_adress",zo,"-1",GROUP_NOGROUP,"","","1",zo);var Ko="";!isNull(GetConfig("logmanualemail_subject"))&&GetConfig("logmanualemail_subject").length>0&&(Ko=Trim(GetConfig("logmanualemail_subject"))),SettingItem("logmanualemail_subject",Ko,"-1",GROUP_NOGROUP,"","","1",Ko);var Jo="1";!isNull(GetConfig("safaricookie"))&&GetConfig("safaricookie").length>0&&(Jo=Trim(GetConfig("safaricookie"))),SettingItem("safaricookie",Jo,"-1",GROUP_NOGROUP,"","","1",Jo);var Xo="-1";!isNull(GetConfig("useurlshortener"))&&GetConfig("useurlshortener").length>0&&IsNumber(GetConfig("useurlshortener"))&&(Xo=Trim(GetConfig("useurlshortener"))),SettingItem("useurlshortener",Xo,"-1",GROUP_NOGROUP,"","","1",Xo);var Yo="https://www.mizu-voip.com/G";!isNull(GetConfig("urlshortener_orig"))&&GetConfig("urlshortener_orig").length>0&&(Yo=Trim(GetConfig("urlshortener_orig"))),SettingItem("urlshortener_orig",Yo,"-1",GROUP_NOGROUP,"","","1",Yo);var Qo="https://tinyurl.com/qm6oja3";!isNull(GetConfig("urlshortener_replace"))&&GetConfig("urlshortener_replace").length>0&&(Qo=Trim(GetConfig("urlshortener_replace"))),SettingItem("urlshortener_replace",Qo,"-1",GROUP_NOGROUP,"","","1",Qo);var Zo="";!isNull(GetConfig("contactimport_url"))&&GetConfig("contactimport_url").length>0&&(Zo=Trim(GetConfig("contactimport_url"))),SettingItem("contactimport_url",Zo,"-1",GROUP_NOGROUP,"","","1",Zo);var en="";!isNull(GetConfig("backupserver"))&&GetConfig("backupserver").length>0&&(en=Trim(GetConfig("backupserver"))),SettingItem("backupserver",en,"-1",GROUP_NOGROUP,"","","1",en),58===GetConfigInt("brandid",-1)&&(SaveParameter("dtmfmode","1"),SaveParameter("aec","0"),SaveParameter("agc","0"),SaveParameter("silencesupress","0"),SaveParameter("voicemailnum","*97")),SaveParameter("code_version",webphone_api.global.code_version),"undefined"==typeof webphone_api.plhandler||webphone_api.plhandler}catch(on){PutToDebugLogException(2,"common: InitializeSettings",on)}}function DoVersioning(){try{var e=GetParameterInt("code_version",0);if(PutToDebugLog(2,"EVENT, common: DoVersioning called, oldversion: "+e),!isNull(e)&&IsNumber(e)||(e=0),e<webphone_api.global.code_version){if(GetConfig("autoprovisioning").length<1||"0"===GetConfig("autoprovisioning")||"false"===GetConfig("autoprovisioning")||!1===GetConfig("autoprovisioning")){var o=GetParameter("customizedversion");!isNull(GetConfig("customizedversion"))&&GetConfig("customizedversion").length>0&&(o=Trim(GetConfig("customizedversion"))),SettingItem("customizedversion",o,"-1",GROUP_NOGROUP,"","","1","true");var n=GetParameter("serveraddress");!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(n=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress",n,"-1",GROUP_NOGROUP,"","","1","");var t=GetParameter("server_label");!isNull(GetConfig("server_label"))&&GetConfig("server_label").length>0&&(t=Trim(GetConfig("server_label"))),SettingItem("server_label",t,"-1",GROUP_NOGROUP,"","","1","Server");var i=GetParameter("showserverinput");!isNull(GetConfig("showserverinput"))&&GetConfig("showserverinput").length>0&&(i=Trim(GetConfig("showserverinput"))),SettingItem("showserverinput",i,"-1",GROUP_NOGROUP,"","","1","1");var a=GetParameter("brandname");!isNull(GetConfig("brandname"))&&GetConfig("brandname").length>0&&(a=Trim(GetConfig("brandname"))),SettingItem("brandname",a,"-1",GROUP_NOGROUP,"","","1","");var r=GetParameter("brandid");!isNull(GetConfig("brandid"))&&GetConfig("brandid").length>0&&(a=Trim(GetConfig("brandid"))),SettingItem("brandid",r,"-1",GROUP_NOGROUP,"","","1","");var l=GetParameter("companyname");!isNull(GetConfig("companyname"))&&GetConfig("companyname").length>0&&(l=Trim(GetConfig("companyname"))),SettingItem("companyname",l,"-1",GROUP_NOGROUP,"","","1","");var p=GetParameter("newuser");!isNull(GetConfig("newuser"))&&GetConfig("newuser").length>0&&(p=Trim(GetConfig("newuser"))),SettingItem("newuser",p,"-1",GROUP_NOGROUP,"","","1","");var s=GetParameter("homepage");!isNull(GetConfig("homepage"))&&GetConfig("homepage").length>0&&(s=Trim(GetConfig("homepage"))),SettingItem("homepage",s,"-1",GROUP_NOGROUP,"","","1","");var c=GetParameter("accounturi");!isNull(GetConfig("accounturi"))&&GetConfig("accounturi").length>0&&(c=Trim(GetConfig("accounturi"))),SettingItem("accounturi",c,"-1",GROUP_NOGROUP,"","","1","");var u=GetParameter("recharge");!isNull(GetConfig("recharge"))&&GetConfig("recharge").length>0&&(u=Trim(GetConfig("recharge"))),SettingItem("recharge",u,"-1",GROUP_NOGROUP,"","","1","");var g=GetParameter("p2p");!isNull(GetConfig("p2p"))&&GetConfig("p2p").length>0&&(g=Trim(GetConfig("p2p"))),SettingItem("p2p",g,"1",GROUP_CALLDIVERT,"","","1","");var m=GetParameter("callback");!isNull(GetConfig("callback"))&&GetConfig("callback").length>0&&(m=Trim(GetConfig("callback"))),SettingItem("callback",m,"1",GROUP_CALLDIVERT,"","","1","");var b=GetParameter("sms");!isNull(GetConfig("sms"))&&GetConfig("sms").length>0&&(b=Trim(GetConfig("sms"))),SettingItem("sms",b,"1",GROUP_CALLDIVERT,"","","1","");var h=GetParameter("sms_recieve");!isNull(GetConfig("sms_recieve"))&&GetConfig("sms_recieve").length>0&&(h=Trim(GetConfig("sms_recieve"))),SettingItem("sms_recieve",h,"-1",GROUP_NOGROUP,"","","1","");var d=GetParameter("creditrequest");!isNull(GetConfig("creditrequest"))&&GetConfig("creditrequest").length>0&&(d=Trim(GetConfig("creditrequest"))),SettingItem("creditrequest",d,"1",GROUP_CALLDIVERT,"","","1","");var _=GetParameter("ratingrequest");!isNull(GetConfig("ratingrequest"))&&GetConfig("ratingrequest").length>0&&(_=Trim(GetConfig("ratingrequest"))),SettingItem("ratingrequest",_,"1",GROUP_CALLDIVERT,"","","1","");var w=GetParameter("supportmail");!isNull(GetConfig("supportmail"))&&GetConfig("supportmail").length>0&&(w=Trim(GetConfig("supportmail"))),SettingItem("supportmail",w,"-1",GROUP_NOGROUP,"","","1","");var f=GetParameter("supporturl");!isNull(GetConfig("supporturl"))&&GetConfig("supporturl").length>0&&(f=Trim(GetConfig("supporturl"))),SettingItem("supporturl",f,"-1",GROUP_NOGROUP,"","","1","");var v=GetParameter("header");!isNull(GetConfig("header"))&&GetConfig("header").length>0&&(v=Trim(GetConfig("header"))),v.length<1&&!isNull(GetConfig("headertext"))&&GetConfig("headertext").length>0&&(v=GetConfig("headertext")),SettingItem("header",v,"-1",GROUP_NOGROUP,"","","1","");var P="";!isNull(GetConfig("footer"))&&GetConfig("footer").length>0&&(P=Trim(GetConfig("footer"))),P.length<1&&!isNull(GetConfig("footertext"))&&GetConfig("footertext").length>0&&(P=GetConfig("footertext")),SettingItem("footer",P,"-1",GROUP_NOGROUP,"","","1","");var E=GetParameter("logo");!isNull(GetConfig("logo"))&&GetConfig("logo").length>0&&(E=Trim(GetConfig("logo"))),SettingItem("logo",E,"-1",GROUP_NOGROUP,"","","1","");var T=GetParameter("version");!isNull(GetConfig("version"))&&GetConfig("version").length>0&&(T=Trim(GetConfig("version"))),SettingItem("version",T,"-1",GROUP_NOGROUP,"","","1","");var N=GetParameter("messagedisplay");!isNull(GetConfig("messagedisplay"))&&GetConfig("messagedisplay").length>0&&(N=Trim(GetConfig("messagedisplay"))),SettingItem("messagedisplay",N,"-1",GROUP_NOGROUP,"","","1","");var S=GetParameter("messagepopup");!isNull(GetConfig("messagepopup"))&&GetConfig("messagepopup").length>0&&(S=Trim(GetConfig("messagepopup"))),SettingItem("messagepopup",S,"-1",GROUP_NOGROUP,"","","1","");var I=GetParameter("advertisement");!isNull(GetConfig("advertisement"))&&GetConfig("advertisement").length>0&&(I=Trim(GetConfig("advertisement"))),SettingItem("advertisement",I,"-1",GROUP_NOGROUP,"","","1","");var R=GetParameter("helpurl");!isNull(GetConfig("helpurl"))&&GetConfig("helpurl").length>0&&(R=Trim(GetConfig("helpurl"))),SettingItem("helpurl",R,"-1",GROUP_NOGROUP,"","","1","");var G=GetParameter("licenseurl");!isNull(GetConfig("licenseurl"))&&GetConfig("licenseurl").length>0&&(G=Trim(GetConfig("licenseurl"))),SettingItem("licenseurl",G,"-1",GROUP_NOGROUP,"","","1","");var O=GetParameter("extramenuurl");!isNull(GetConfig("extramenuurl"))&&GetConfig("extramenuurl").length>0&&(O=Trim(GetConfig("extramenuurl"))),SettingItem("extramenuurl",O,"-1",GROUP_NOGROUP,"","","1","");var L=GetParameter("extramenutxt");!isNull(GetConfig("extramenutxt"))&&GetConfig("extramenutxt").length>0&&(L=Trim(GetConfig("extramenutxt"))),SettingItem("extramenutxt",L,"-1",GROUP_NOGROUP,"","","1","")}if(e<12){var C=GetParameter("username"),D=GetParameter("password"),y=GetParameter("serveraddress_orig"),x=GetParameter("serveraddress_user"),A=GetParameter("proxyaddress"),k=GetParameter("sipusername"),U=GetParameter("displayname"),V=GetParameter("email"),W=GetParameter("voicemailnum"),M=GetParameter("callforwardonbusy"),F=GetParameter("wsusers");for(var H in webphone_api.global.settmap)delete webphone_api.global.settmap[H];PutToDebugLog(2,"WARNING, DoVersioning, Initializesettings, because older version"),HandleSettings("","",function(){}),SaveParameter("username",C),SaveParameter("password",D),SaveParameter("serveraddress_orig",y),SaveParameter("serveraddress_user",x),SaveParameter("proxyaddress",A),SaveParameter("sipusername",k),SaveParameter("displayname",U),SaveParameter("email",V),SaveParameter("voicemailnum",W),SaveParameter("callforwardonbusy",M),SaveParameter("wsusers",F)}if(e<13){var B="";!isNull(GetConfig("rtmpserveraddress"))&&GetConfig("rtmpserveraddress").length>0&&(B=Trim(GetConfig("rtmpserveraddress"))),SettingItem("rtmpserveraddress",B,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("audiodevices","","8",GROUP_MEDIA,"","","1",""),SettingItem("autoaction","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webcallme","1","-1",GROUP_NOGROUP,"","","1","1");var $="";!isNull(GetConfig("callbacknumber"))&&GetConfig("callbacknumber").length>0&&($=Trim(GetConfig("callbacknumber"))),SettingItem("callbacknumber",$,"1",GROUP_CALLDIVERT,"","","1",""),SettingItem("received_confrooms","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("iswebrtcuppersrvfromuser","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("java_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("ns_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("webrtc_worked","false","-1",GROUP_NOGROUP,"","","1","false");var j="-1";!isNull(GetConfig("video"))&&GetConfig("video").length>0&&(j=Trim(GetConfig("video"))),SettingItem("video",j,"2",GROUP_MEDIA,webphone_api.stringres.get("video__auto")+","+webphone_api.stringres.get("video__disable")+","+webphone_api.stringres.get("video__enable")+","+webphone_api.stringres.get("video__force"),"-1,0,1,2","1","1");var q="0";!isNull(GetConfig("video_bandwidth"))&&GetConfig("video_bandwidth").length>0&&(q=Trim(GetConfig("video_bandwidth"))),SettingItem("video_bandwidth",q,"1",GROUP_MEDIA,"","","1","0");var z="640";!isNull(GetConfig("video_width"))&&GetConfig("video_width").length>0&&(z=Trim(GetConfig("video_width"))),SettingItem("video_width",z,"1",GROUP_MEDIA,"","","1","640");var K="480";!isNull(GetConfig("video_height"))&&GetConfig("video_height").length>0&&(K=Trim(GetConfig("video_height"))),SettingItem("video_height",K,"1",GROUP_MEDIA,"","","1","480"),SettingItem("androidchromedisplayed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("conf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("transf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("filterchatduplicates","true","-1",GROUP_NOGROUP,"","","1","true");var J="true";!isNull(GetConfig("has_video"))&&GetConfig("has_video").length>0&&(J=Trim(GetConfig("has_video"))),"0"===GetParameter2("video")&&(J="false"),SettingItem("has_video",J,"1",GROUP_MEDIA,"","","1",J),SettingItem("sendchatonenter","true","0",GROUP_GENERAL,"","","1","true");var X="-1";!isNull(GetConfig("transfwithreplace"))&&GetConfig("transfwithreplace").length>0&&(X=Trim(GetConfig("transfwithreplace"))),SettingItem("transfwithreplace",X,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfwithreplace__auto")+","+webphone_api.stringres.get("transfwithreplace__no")+","+webphone_api.stringres.get("transfwithreplace__yes"),"-1,0,1","1","-1"),SettingItem("showratewhiletype_minlenth","3","-1",GROUP_NOGROUP,"","","1","3"),SettingItem("showratewhiletype_maxlenth","6","-1",GROUP_NOGROUP,"","","1","6")}if(e<14&&(SettingItem("enginechecksum","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("redialonfail","1","-1",GROUP_NOGROUP,"","","1","1")),e<15&&(SettingItem("calldivertsuccess","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("enginepriority_otherbrowser",GetParameter("enginepriority_otherbrowser"),"2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2")),e<16){var Y="en";"rigitel"===GetConfig("brandname").toLowerCase()&&(Y="de"),isNull(GetConfig("language"))||2!==GetConfig("language").length||(Y=Trim(GetConfig("language"))),SettingItem("language",Y,"2",GROUP_GENERAL,"English,German,Hungarian,Portuguese","en,de,hu,pt","1","en");var Q=GetParameter("extraregisteraccounts");isNull(Q)&&(Q=""),SettingItem("extraregisteraccounts",Q,"-1",GROUP_NOGROUP,"","","1","");var Z="0";!isNull(GetConfig("audio_bandwidth"))&&GetConfig("audio_bandwidth").length>0&&(Z=Trim(GetConfig("audio_bandwidth"))),
SettingItem("audio_bandwidth",Z,"1",GROUP_MEDIA,"","","1","0")}if(e<18){SettingItem("normalizenumber",GetParameterInt("normalizenumber",-1).toString(),"2",GROUP_CALLDIVERT,webphone_api.stringres.get("normalizenumber__auto")+","+webphone_api.stringres.get("normalizenumber__no")+","+webphone_api.stringres.get("normalizenumber__yes"),"-1,0,1","1","-1"),SettingItem("nsupgrademode",GetParameterInt("nsupgrademode",1),"2",GROUP_SIP,webphone_api.stringres.get("nsupgrademode__background")+","+webphone_api.stringres.get("nsupgrademode__delayed")+","+webphone_api.stringres.get("nsupgrademode__immediate"),"0,1,2","1","1");var ee=GetParameterInt("transfertype",-1);SettingItem("transfertype",ee,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfertype__auto")+","+webphone_api.stringres.get("transfertype__unattended")+","+webphone_api.stringres.get("transfertype__withhold")+","+webphone_api.stringres.get("transfertype__attanded")+","+webphone_api.stringres.get("transfertype__with_no_hold")+","+webphone_api.stringres.get("transfertype__with_conf"),"-1,1,6,5,7,8","1",ee),SettingItem("transfertype1",GetParameterInt("transfertype1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace1",GetParameterInt("transfwithreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace1",GetParameterInt("allowreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer1",GetParameterInt("discontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer1",GetParameterInt("disconincomingrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer1",GetParameterInt("inversetransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay1",GetParameterInt("transferdelay1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer1",GetParameterInt("newdialogforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer1",GetParameterInt("useserverdomainforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer1",GetParameterInt("holdontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype2",GetParameterInt("transfertype2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace2",GetParameterInt("transfwithreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace2",GetParameterInt("allowreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer2",GetParameterInt("discontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer2",GetParameterInt("disconincomingrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer2",GetParameterInt("inversetransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay2",GetParameterInt("transferdelay2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer2",GetParameterInt("newdialogforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer2",GetParameterInt("useserverdomainforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer2",GetParameterInt("holdontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype3",GetParameterInt("transfertype3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace3",GetParameterInt("transfwithreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace3",GetParameterInt("allowreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer3",GetParameterInt("discontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer3",GetParameterInt("disconincomingrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer3",GetParameterInt("inversetransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay3",GetParameterInt("transferdelay3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer3",GetParameterInt("newdialogforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer3",GetParameterInt("useserverdomainforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer3",GetParameterInt("holdontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype4",GetParameterInt("transfertype4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace4",GetParameterInt("transfwithreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace4",GetParameterInt("allowreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer4",GetParameterInt("discontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer4",GetParameterInt("disconincomingrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer4",GetParameterInt("inversetransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay4",GetParameterInt("transferdelay4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer4",GetParameterInt("newdialogforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer4",GetParameterInt("useserverdomainforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer4",GetParameterInt("holdontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype5",GetParameterInt("transfertype5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace5",GetParameterInt("transfwithreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace5",GetParameterInt("allowreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer5",GetParameterInt("discontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer5",GetParameterInt("disconincomingrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer5",GetParameterInt("inversetransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay5",GetParameterInt("transferdelay5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer5",GetParameterInt("newdialogforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer5",GetParameterInt("useserverdomainforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer5",GetParameterInt("holdontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype6",GetParameterInt("transfertype6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace6",GetParameterInt("transfwithreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace6",GetParameterInt("allowreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer6",GetParameterInt("discontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer6",GetParameterInt("disconincomingrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer6",GetParameterInt("inversetransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay6",GetParameterInt("transferdelay6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer6",GetParameterInt("newdialogforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer6",GetParameterInt("useserverdomainforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer6",GetParameterInt("holdontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype7",GetParameterInt("transfertype7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace7",GetParameterInt("transfwithreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace7",GetParameterInt("allowreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer7",GetParameterInt("discontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer7",GetParameterInt("disconincomingrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer7",GetParameterInt("inversetransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay7",GetParameterInt("transferdelay7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer7",GetParameterInt("newdialogforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer7",GetParameterInt("useserverdomainforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer7",GetParameterInt("holdontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype8",GetParameterInt("transfertype8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace8",GetParameterInt("transfwithreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace8",GetParameterInt("allowreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer8",GetParameterInt("discontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer8",GetParameterInt("disconincomingrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer8",GetParameterInt("inversetransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay8",GetParameterInt("transferdelay8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer8",GetParameterInt("newdialogforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer8",GetParameterInt("useserverdomainforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer8",GetParameterInt("holdontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype9",GetParameterInt("transfertype9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace9",GetParameterInt("transfwithreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace9",GetParameterInt("allowreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer9",GetParameterInt("discontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer9",GetParameterInt("disconincomingrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer9",GetParameterInt("inversetransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay9",GetParameterInt("transferdelay9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer9",GetParameterInt("newdialogforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer9",GetParameterInt("useserverdomainforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer9",GetParameterInt("holdontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype10",GetParameterInt("transfertype10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace10",GetParameterInt("transfwithreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace10",GetParameterInt("allowreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer10",GetParameterInt("discontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer10",GetParameterInt("disconincomingrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer10",GetParameterInt("inversetransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay10",GetParameterInt("transferdelay10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer10",GetParameterInt("newdialogforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer10",GetParameterInt("useserverdomainforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer10",GetParameterInt("holdontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername1",GetParameter("transfername1"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername2",GetParameter("transfername2"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername3",GetParameter("transfername3"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername4",GetParameter("transfername4"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername5",GetParameter("transfername5"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername6",GetParameter("transfername6"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername7",GetParameter("transfername7"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername8",GetParameter("transfername8"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername9",GetParameter("transfername9"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername10",GetParameter("transfername10"),"-1",GROUP_NOGROUP,"","","-1","");var oe=GetParameter("useaudiodevicerecord");(isNull(oe)||"-1"!==oe&&"0"!==oe&&"1"!==oe||"2"!==oe)&&(oe="1");var ne=GetParameter("checkmicrophone");!isNull(ne)&&ne.length>0&&("-1"===ne||"0"===ne||"1"===ne||"2"===ne?oe=ne:"true"===ne?oe="2":"false"===ne&&(oe="-1"));var te=oe;!isNull(GetConfig("useaudiodevicerecord"))&&GetConfig("useaudiodevicerecord").length>0&&(te=Trim(GetConfig("useaudiodevicerecord"))),SettingItem("useaudiodevicerecord",te,"-1",GROUP_NOGROUP,"","","1",te);var ie=GetParameterInt("useurlshortener",-1);!isNull(GetConfig("useurlshortener"))&&GetConfig("useurlshortener").length>0&&IsNumber(GetConfig("useurlshortener"))&&(ie=Trim(GetConfig("useurlshortener"))),SettingItem("useurlshortener",ie,"-1",GROUP_NOGROUP,"","","1",ie);var ae=GetParameter("urlshortener_orig");(isNull(ae)||ae.length<1)&&(ae="https://www.mizu-voip.com/G"),!isNull(GetConfig("urlshortener_orig"))&&GetConfig("urlshortener_orig").length>0&&(ae=Trim(GetConfig("urlshortener_orig"))),SettingItem("urlshortener_orig",ae,"-1",GROUP_NOGROUP,"","","1",ae);var re=GetParameter("urlshortener_replace");(isNull(re)||re.length<1)&&(re="https://tinyurl.com/qm6oja3"),!isNull(GetConfig("urlshortener_replace"))&&GetConfig("urlshortener_replace").length>0&&(re=Trim(GetConfig("urlshortener_replace"))),SettingItem("urlshortener_replace",re,"-1",GROUP_NOGROUP,"","","1",re),SettingItem("contactimport_url",GetParameter("contactimport_url"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("backupserver",GetParameter("backupserver"),"-1",GROUP_NOGROUP,"","","-1","")}}SaveParameter("code_version",webphone_api.global.code_version)}catch(le){PutToDebugLogException(2,"_settings: DoVersioning",le)}}function SettingItem(e,o,n,t,i,a,r,l,p){try{if(isNull(e))return void PutToDebugLog(2,"WARNING, _settings: SettingItem invalid setting: "+e+", "+o+", "+n+", "+t+", "+i+", "+a+", "+r+", "+l);"DEF"===o?o=l:"NULL"===o&&(o="");var s=[];s[SETT_VALUE]=o,s[SETT_TYPE]=n,s[SETT_GROUP]=t,s[SETT_ALLNAMES]=i,s[SETT_ALLVALUES]=a,s[SETT_ISDEFAULT]=r,s[SETT_DEF_VALUE]=l,!0===p?webphone_api.global.settmap2[e]=s:webphone_api.global.settmap[e]=s}catch(c){PutToDebugLogException(2,"common: SettingItem",c)}}function ParamAsBool(e){try{if(isNull(e)||e.length<1)return!1;if(e=e.toString(),e=e.toLowerCase(),e.indexOf("false")>=0)return!1;if(e.indexOf("true")>=0)return!0;if(IsNumber(e)){if(StrToInt(e)>0)return!0}}catch(o){PutToDebugLogException(2,"common: ParamAsBool",o)}return!1}function ParamAsInt(e,o){try{if(isNull(e)||e.length<1)return!isNull(o)&&IsNumber(o)?StrToInt(o):o;if(e=e.toString(),e=e.toLowerCase(),e.indexOf("false")>=0)return 0;if(e.indexOf("true")>=0)return 1;if(IsNumber(e))return StrToInt(e)}catch(n){PutToDebugLogException(2,"common: ParamAsInt",n)}return e}function GetParameter2(e,o){try{if(isNull(e)&&(e=""),e=e.toString(),e.length<1)return PutToDebugLogSpecial(2,"WARNING, common: GetParameter2 no input param",!0,""),"";e.indexOf(",")>=0&&(e=ReplaceAll(e,",",""));var n=webphone_api.parameters[e];return isNull(n)&&(n=GetParameter(e,o)),isNull(n)&&(n=""),n=n.toString(),0===n.indexOf("encrypted__3__")&&(n=StrDc(n,GetPassphrase())),"NULL"===n&&(n=""),isNull(n)&&(n=""),Trim(n)}catch(t){PutToDebugLogSpecial(2,"ERROR, common: GetParameter2",!0,t)}return""}function GetParameter(e,o){var n=0;try{if(isNull(e)&&(e=""),e=e.toString(),e.length<1)return n=2,PutToDebugLogSpecial(2,"WARNING, common: GetParameter no input param",!1,""),"";if(e.indexOf(",")>=0&&(e=ReplaceAll(e,",","")),(isNull(webphone_api.global.settmap2)||isNull(webphone_api.global.settmap2.magicnumber))&&"loglevel"!==e)return n=8,PutToDebugLogSpecial(6,"EVENT, common GetParameter no settings: "+e,!1,""),"";if(n=9,!(e in webphone_api.global.settmap2))return"";var t=webphone_api.global.settmap2[e];"serveraddress"===e&&(t[SETT_VALUE]=StripServeraddress(t[SETT_VALUE])),"username"!==e&&"sipusername"!==e||0===GetParameterInt("allowsipuriasusername",0)&&(t[SETT_VALUE]=StripUsername(t[SETT_VALUE]));var i;return i=isNull(o)||!0!==o?t[SETT_VALUE]:t[SETT_DEF_VALUE],n=10,isNull(i)||(i=i.toString(),0===i.indexOf("encrypted__3__")&&(i=StrDc(i,GetPassphrase()))),isNull(i)||i.indexOf("CRLF")>=0&&(i=ReplaceAll(i,"CRLF","\r\n")),i}catch(a){PutToDebugLogSpecial(2,"common: GetParameter ("+n+"), parameter: "+e,!0,a)}return""}function ParameterIsDefault(e){try{if(isNull(e)||e.length<1)return 2,PutToDebugLogSpecial(2,"WARNING, common: ParameterIsDefault no input param",!1,""),!1;if(isNull(webphone_api.global.settmap)||isNull(webphone_api.global.settmap.magicnumber))return 8,PutToDebugLogSpecial(2,"WARNING, common: ParameterIsDefault no settings param: "+e,!1,""),!1;if(9,!(e in webphone_api.global.settmap))return!1;return"1"===webphone_api.global.settmap[e][SETT_ISDEFAULT]}catch(o){PutToDebugLogSpecial(2,"ERROR, common: ParameterIsDefault",!0,o)}return!1}function GetParameterInt(e,o){function n(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(o){alert("ERROR, common: IsNumberInnerInt"+o)}return!1}try{var t=GetParameter(e);if(isNull(t)||(t=t.toString()),!isNull(t)&&t.length>0){var i=null;return t=t.toLowerCase(),"true"===t||"yes"===t?i=1:"false"===t||"no"===t?i=0:n(Trim(t))&&(i=StrToInt(t)),isNull(i)?isNull(o)?0:n(o)?o:"true"===o||"yes"===o?1:0:i}}catch(a){PutToDebugLogSpecial(2,"ERROR, common: GetParameterInt parameter: "+e,!0,a)}return o}function GetParameterBool(e,o){try{(isNull(o)||"true"!==o.toString()&&"false"!==o.toString())&&(o=!1);var n=GetParameter(e);if(!isNull(n)){var t=null;return n=n.toString(),n=n.toLowerCase(),"true"===n||"1"===n||"2"===n||"3"===n||"yes"===n?t=!0:"false"!==n&&"0"!==n&&"no"!==n||(t=!1),isNull(t)?!isNull(o)&&("true"===o||"1"===o||"2"===o||"3"===o||"yes"===o||"false"!==o&&"0"!==o&&"no"!==o&&o):t}}catch(i){PutToDebugLogException(3,"common: GetParameterBool parameter: "+e,i)}return o}function SaveParameter(e,o,n){try{if(isNull(e)&&(e=""),e=e.toString(),e.length<1)return PutToDebugLog(3,"WARNING, common: SaveParameter no input param"),!1;if(isNull(webphone_api.global.settmap))return PutToDebugLog(2,"WARNING, common: SaveParameter no settings"),!1;if(e.indexOf(",")>=0&&(e=ReplaceAll(e,",","")),!isNull(o)&&o.toString().indexOf(",")>=0&&"codec"!=e&&(o=ReplaceAll(o,",","")),e.indexOf("server")>=0){if("YOURSIPDOMAIN.COM"===o||"YOURSIPSERVER.COM"===o||"SIPSERVER"===o||"VOIPSERVER"===o||"SERVERADDRESS"===o)return!1}else if(e.indexOf("username")>=0){if("USERNAME"===o||"SIPUSERNAME"===o)return!1}else if(e.indexOf("password")>=0){if("PASSWORD"===o||"SIPPASSWORD"===o||"SIPASSWORD"===o)return!1}else if(e.indexOf("callto")>=0&&("DESTINATION"===o||"CALLTO"===o))return!1;if("lastsessionsuccess"===e&&GetParameter("lastsessionsuccess")===o)return;if(isNull(o)||(o=o.toString()),isNull(o)||0!==o.indexOf("encrypted__3__")||(o=StrDc(o,GetPassphrase())),isNull(o)||(o.indexOf("\r\n")>=0?o=ReplaceAll(o,"\r\n","CRLF"):o.indexOf("\n")>=0?o=ReplaceAll(o,"\n","CRLF"):o.indexOf("\r")>=0&&(o=ReplaceAll(o,"\n","CRLF"))),"webrtcserver"!==e&&"webrtcaddress"!==e&&"rtcserver"!==e&&"rtcaddress"!==e||(e="webrtcserveraddress"),"webrtcserveraddress"===e)"undefined"!=typeof webphone_api.parameters.webrtcserveraddress&&null!==webphone_api.parameters.webrtcserveraddress&&webphone_api.parameters.webrtcserveraddress.length>0&&("undefined"==typeof webphone_api.parameters.origwebrtcserveraddress||null==webphone_api.parameters.origwebrtcserveraddress||webphone_api.parameters.origwebrtcserveraddress.length>0&&webphone_api.parameters.webrtcserveraddress.length>0&&webphone_api.parameters.origwebrtcserveraddress!==webphone_api.parameters.webrtcserveraddress&&o!==webphone_api.parameters.webrtcserveraddress)&&(webphone_api.parameters.origwebrtcserveraddress=webphone_api.parameters.webrtcserveraddress),webphone_api.parameters.webrtcserveraddress=o,selectedwserver="";else{if("callto"===e)return webphone_api.parameters.callto=o,!0;if(("username"===e||"sipusername"===e)&&!isNull(o)&&o.indexOf("@")>0){if(0===GetParameterInt("allowsipuriasusername",0)){var t=webphone_api.global.settmap.serveraddress_user;t[SETT_VALUE]=Trim(o.substring(o.indexOf("@")+1)),webphone_api.global.settmap.serveraddress_user=t}}else if(e===Ssidcode()&&(PutToDebugLog(2,"EVENT,"+Ssidcode()+"_1: "+o),!isNull(o)&&o.length>0&&unlockcodetricktogled<1)){var i=StrDc(unlockcodetrick,alsvkey);PutToDebugLog(2,"EVENT,"+Ssidcode()+"_2: "+i),Trim(o)===i&&(PutToDebugLog(2,"EVENT,"+Ssidcode()+"_3: "+o),unlockcodetricktogled=1)}}var a;if(e in webphone_api.global.settmap2){var r="0";a=webphone_api.global.settmap2[e],"DEF"===o?(o=a[SETT_DEF_VALUE],r="1"):"NULL"===o&&(o=""),a[SETT_VALUE]=o,a[SETT_ISDEFAULT]=r,webphone_api.global.settmap2[e]=a,webphone_api.global.wasSettModified=!0}else SettingItem(e,o,"-1","-1","","","0",o,!0),webphone_api.global.wasSettModified=!0;if(!0!==n)if(a=null,e in webphone_api.global.settmap){var r="0";a=webphone_api.global.settmap[e],"DEF"===o?(o=a[SETT_DEF_VALUE],r="1"):"NULL"===o&&(o=""),a[SETT_VALUE]=o,a[SETT_ISDEFAULT]=r,webphone_api.global.settmap[e]=a,webphone_api.global.wasSettModified=!0}else SettingItem(e,o,"-1","-1","","","0",o),webphone_api.global.wasSettModified=!0;return"extraregisteraccounts"===e&&ParseSipAccounts(),!0}catch(l){PutToDebugLogException(3,"common: SaveParameter",l)}return!1}function Ssidcode(){if(null!==ssidcode_string)return ssidcode_string;var e=[];return e.push("s"),e.push("s"),e.push("i"),e.push("d"),e.push("c"),e.push("o"),e.push("d"),e.push("e"),ssidcode_string=e.join("")}function GetConfigAll(e){var o=webphone_api.mwphonecfg.getAll();try{if(void 0!==o&&null!==o&&!0===e&&GetPassphrase().length>0){var n=GetPassphrase();for(var t in o)void 0===t||null===t||t.length<1||"undefined"==typeof o[t]||null===o[t]||o[t].toString().indexOf("encrypted__3__")<0||(o[t]=StrDc(o[t],n))}}catch(i){PutToDebugLogException(3,"common: GetConfigAll",i)}return o}function GetConfig(e,o){try{if(isNull(e)||e.length<1)return PutToDebugLog(3,"WARNING, common: GetConfig no input param"),"";isNull(o)&&(o=!0);var n=webphone_api.mwphonecfg.get(e);return isNull(n)?(PutToDebugLog(3,"WARNING, common: GetConfig value is NULL"),""):(n=n.toString(),o&&GetPassphrase().length>0&&(n=StrDc(n,GetPassphrase())),0===n.indexOf("encrypted__3__")&&GetPassphrase().length>0&&(n=StrDc(n,GetPassphrase())),"serveraddress"===e&&(n=StripServeraddress(n)),"username"!==e&&"sipusername"!==e||(n=StripUsername(n)),n)}catch(t){PutToDebugLogException(3,"common: GetConfig",t)}return""}function GetConfigInt(e,o){try{!isNull(o)&&IsNumber(o)||(o=0);var n=GetConfig(e);if(!isNull(n)&&n.length>0){var t=null;return n=n.toLowerCase(),"true"===n||"yes"===n?t=1:"false"===n||"no"===n?t=0:IsNumber(Trim(n))&&(t=StrToInt(n)),isNull(t)?o:t}}catch(i){PutToDebugLogException(3,"common: GetConfigInt parameter: "+e,i)}return o}function GetConfigBool(e,o){try{(isNull(o)||"true"!==o.toString()&&"false"!==o.toString())&&(o=!1);var n=GetConfig(e);if(!isNull(n)){var t=null;return"true"===n.toLowerCase()||"1"===n||"2"===n||"3"===n||"yes"===n.toLowerCase()?t=!0:"false"!==n.toLowerCase()&&"0"!==n&&"no"!==n.toLowerCase()||(t=!1),isNull(t)?o:t}}catch(i){PutToDebugLogException(3,"common: GetConfigBool parameter: "+e,i)}return o}function SaveSettingsFile(e,o,n){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveSettingsFile do not save because preferred_storage is 0 from "+e.toString()),void n(!0);if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return PutToDebugLog(2,"EVENT, SaveSettingsFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1)+" from: "+e.toString()),void n(!0);if(!n||"function"!=typeof n)return PutToDebugLog(2,"ERROR, common: SaveSettingsFile callback not defined from "+e.toString()),!1;if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, common: SaveSettingsFile filename is NULL from "+e.toString()),n(!1),!1;if(isNull(webphone_api.global.settmap)||isNull(webphone_api.global.settmap.magicnumber))return PutToDebugLog(2,"WARNING, common: SaveSettingsFile no setings to be saved from "+e.toString()),n(!1),!1;webphone_api.global.dispSaveSettMsg++,webphone_api.global.dispSaveSettMsg<3&&PutToDebugLog(2,"EVENT, SaveSettingsFile filename: "+o+" from "+e.toString());var t="",i="";if(!0===GetParameterBool("serverinputisupperserver",!1)){var a=GetParameter("upperserver"),r=GetParameter("serveraddress_user");if((a.length<0||r.indexOf(".")>0)&&ShowServerInput()){var l=GetConfigInt("upperserverfromuser",2),p=GetConfig("upperserver");l<2&&p.length>0?SaveParameter("upperserver",p):SaveParameter("upperserver",r),webphone_api.global.wasSettModified=!1}}var s=GetSafariCookie();for(var c in webphone_api.global.settmap)if(!(isNull(c)||c.length<1)&&"clientreset"!==c&&"clientresetall"!==c){var u=webphone_api.global.settmap[c];t=t+c+";"+u[SETT_VALUE]+";"+u[SETT_TYPE]+";"+u[SETT_GROUP]+";"+u[SETT_ALLNAMES]+";"+u[SETT_ALLVALUES]+";"+u[SETT_ISDEFAULT]+";"+u[SETT_DEF_VALUE]+"\r\n","username"===c||"sipusername"===c||"password"===c||"serveraddress_user"===c||"serveraddress_orig"===c||"upperserver"===c||"loglevel"===c||"code_version"===c||"lastusedengine"===c?i=i+c+";"+u[SETT_VALUE]+"\r\n":1===s&&("server_label"!==c&&"realm"!==c&&"register"!==c&&"registerinterval"!==c&&"enginepriority_java"!==c&&"enginepriority_webrtc"!==c&&"enginepriority_ns"!==c&&"enginepriority_flash"!==c&&"enginepriority_app"!==c&&"enginepriority_p2p"!==c&&"enginepriority_accessnum"!==c&&"enginepriority_nativedial"!==c&&"enginepriority_otherbrowser"!==c&&"last_good_webrtc_gw"!==c&&"volumein"!==c&&"volumeout"!==c&&"codecframecount"!==c&&"displaynotification"!==c&&"signalingport"!==c&&"proxyaddress"!==c&&"displayname"!==c&&"email"!==c&&"chatsms"!==c&&"textmessaging"!==c&&"savetocontacts"!==c&&"transfertype"!==c&&"techprefix"!==c&&"callforwardonbusy"!==c&&"voicemail"!==c&&"filters"!==c&&"startwithos"!==c&&"brandname"!==c&&"brandid"!==c&&"enablepresence"!==c&&"presencestatus"!==c&&"accounts"!==c&&"transport"!==c&&"accessnumber"!==c&&"theme"!==c&&"autostart"!==c&&"conferencetype"!==c&&"sendchatonenter"!==c&&"language"!==c&&"extraregisteraccounts"!==c&&"incomingcallpopup"!==c&&"enablepush"!==c&&"serveraddressbook_url"!==c&&"quick_access_list"!==c||(i=i+c+";"+u[SETT_VALUE]+"\r\n"))}if(1!==GetParameterInt("storagecookiefailback",1)&&1!==s||webphone_api.global.dispSaveSettMsg<3&&webphone_api.global.loglevel>6&&PutToDebugLog(2,"EVENT, SaveSettingsFile save coockie backup = "+i+" from: "+e.toString()),isNull(webphone_api.File))return CanLog(2)&&PutToDebugLog(2,"EVENT, SaveSettingsFile File handling module not loaded yet from: "+e.toString()),n(!1),!1;1!==GetParameterInt("storagecookiefailback",1)&&1!==s||webphone_api.File.SaveFile(o+"_backup",i,webphone_api.global.STORAGE_COOKIE,function(o){webphone_api.global.dispSaveSettMsg<3&&PutToDebugLog(3,"EVENT, SaveSettingsFile save coockie backup: "+o.toString()+" from: "+e.toString())}),IsWindowsSoftphone()?ApiWinSaveFile(o,t,function(e){n(!0)}):webphone_api.File.SaveFile(o,t,webphone_api.global.STORAGE_LOCAL,function(e){n(!0)})}catch(g){PutToDebugLogException(2,"common: SaveSettingsFile",g)}}function ReadSettingsFile(e,o){try{if(PutToDebugLogSpecial(3,"EVENT, common ReadSettingsFile called; filename: "+e,!1,""),!o||"function"!=typeof o)return void PutToDebugLog(2,"ERROR, common: ReadSettingsFile callback not defined");if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, common: ReadSettingsFile filename is NULL");if(isNull(webphone_api.File))return PutToDebugLog(2,"ERROR, ReadSettingsFile File handling module not loaded yet"),o(!1),!1;if(!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===settdeleted&&(settdeleted=!0,webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(GetActiveAccSettingsFilename(),function(e){PutToDebugLog(2,"EVENT, delete settings file resetsettings: "+GetActiveAccSettingsFilename()+" result: "+e)})),PutToDebugLog(2,"EVENT, ReadSettingsFile not read because resetsettings"),InitializeSettings(),o(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(e,function(n){n+="",(isNull(n)||Trim(n).length<2||"null"==n)&&(PutToDebugLog(4,"EVENT, common: ReadSettingsFile no content WinApi"),webphone_api.File.ReadFile(e+"_backup",webphone_api.global.STORAGE_COOKIE,function(n){(isNull(n)||Trim(n).length<1)&&(n=""),PutToDebugLog(2,"READ contentfromcookie WinApi = "+HideClearPassword(n)),HandleSettings("",e,o),webphone_api.plhandler.ConfigChanged();var t=n.split("\r\n");(isNull(t)||t.length<1)&&(t=[]);for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<2||t[i].indexOf(";")<0)){var a=t[i].indexOf(";");if(!(a<1)){var r=Trim(t[i].substring(0,a)),l=Trim(t[i].substring(a+1));SaveParameter(r,l)}}PutToDebugLog(2,"EVENT, common: ReadSettingsFile important settings restored from cookie WinApi: "+n)})),HandleSettings(n,e,o),webphone_api.plhandler.ConfigChanged()}):webphone_api.File.ReadFile(e,webphone_api.global.STORAGE_LOCAL,function(n){isNull(n)||Trim(n).length<1?(PutToDebugLog(4,"EVENT, common: ReadSettingsFile no content"),1!==GetParameterInt("storagecookiefailback",1)&&1!==GetSafariCookie()||webphone_api.File.ReadFile(e+"_backup",webphone_api.global.STORAGE_COOKIE,function(n){(isNull(n)||Trim(n).length<1)&&(n=""),PutToDebugLog(2,"READ contentfromcookie = "+HideClearPassword(n)),HandleSettings("",e,o),webphone_api.plhandler.ConfigChanged();var t=n.split("\r\n");(isNull(t)||t.length<1)&&(t=[]);for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<2||t[i].indexOf(";")<0)){var a=t[i].indexOf(";");if(!(a<1)){var r=Trim(t[i].substring(0,a)),l=Trim(t[i].substring(a+1));"lastusedengine"===r?l.length>0&&(SaveParameter(r,l),webphone_api.global.last_used_engine_cache=l):SaveParameter(r,l)}}PutToDebugLog(2,"EVENT, common: ReadSettingsFile important settings restored from cookie: "+HideClearPassword(n))})):(HandleSettings(n,e,o),webphone_api.plhandler.ConfigChanged())})}catch(n){PutToDebugLogException(2,"common: ReadSettingsFile",n)}}function ClientReset(e,o,n,t){try{if(!0===webphone_api.global.flagclientreset)return;if((isNull(n)||n.length<1)&&(n=!0===IsSDK()?GetSettFilenameSDK():GetActiveAccSettingsFilename()),!0===t){webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, ClientReset delete call history file: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),webphone_api.global.chlist=[],webphone_api.global.recentlist=[];var i=GetParameter("messagefiles");if(!isNull(i)){for(var a=i.split(","),r=0;r<a.length;r++)if(!(isNull(a[r])||a[r].length<3)){var l=a[r].indexOf("[#");l>0&&(a[r]=a[r].substring(0,l));a[r]}SaveParameter("messagefiles","")}var p=GetConfig("brandid");(isNull(p)||p.length<1||"-1"==p)&&(p=GetBrandName().toLowerCase()),webphone_api.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, ClientReset delete accounts file result: "+e)}),webphone_api.global.aclist=[],webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME+p,function(e){PutToDebugLog(2,"EVENT, ClientReset delete contacts file result: "+e)}),webphone_api.global.ctlist=[]}!isNull(n)&&n.length>0&&(webphone_api.global.flagclientreset=!0,webphone_api.global.flag_delsett=1,webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(filename,function(n){PutToDebugLog(2,"EVENT, ClientReset delete settings file result: "+n),webphone_api.global.flag_delsett=0,HandleSettings("","",function(){}),webphone_api.global.flagclientreset=!1,
SaveParameter("last_clientreset",e),SaveParameter("last_clientresetall",o),!1===IsSDK()&&OpenSettings(!0,1)}))}catch(s){PutToDebugLogException(2,"common: ClientReset",s)}}function HandleSettings(e,o,n){try{if(PutToDebugLogSpecial(1,"EVENT,HandleSettings",!1,""),isNull(webphone_api.global.settmap))webphone_api.global.settmap={};else for(var t in webphone_api.global.settmap)delete webphone_api.global.settmap[t];if(isNull(webphone_api.global.settmap2))webphone_api.global.settmap2={};else for(var t in webphone_api.global.settmap2)delete webphone_api.global.settmap2[t];InitializeSettings();var i=GetConfigAll(!0);if(!isNull(i)){CanLog(3)&&PutToDebugLog(3,"EVENT,HandleSettings cfg "+i.length);for(var a in i)if(!(isNull(a)||a.length<1||a.indexOf("overwrite_")>=0)){var r=i[a];"NULL"===r&&(r=""),SaveParameter(a,r)}}var l=e.split("\r\n");if(isNull(l)||l.length<1)PutToDebugLog(2,"ERROR, common: ParseSettingsReadFromFile empty content");else if(e.indexOf("magicnumber")<0&&e.length>30)PutToDebugLog(3,"ERROR, common ParseSettingsReadFromFile settings file is corrupt "+e.length),webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(o,function(e){PutToDebugLog(2,"EVENT, ParseSettingsReadFromFile delete settings file result: "+e)});else{CanLog(3)&&PutToDebugLog(3,"EVENT,HandleSettings file "+e.length);for(var p=!1,s=!1,c="",u="",g="",m="",b="",h="",d=-1,_=-1,w=0;w<l.length;w++)if(!(isNull(l[w])||l[w].length<2||l[w].indexOf(";")<0)){var f=l[w].split(";");isNull(f)||8!==f.length||("serveraddress"===f[0]&&(c=f[1]),"webrtcserveraddress"===f[0]&&(u=f[1]),"upperserver"===f[0]&&(g=f[1]),"proxyaddress"===f[0]&&(m=f[1]),"lastsettcrc"===f[0]&&(b=f[1]),"last_clientreset"===f[0]&&IsNumber(f[1])&&(d=StrToInt(f[1])),"last_clientresetall"===f[0]&&IsNumber(f[1])&&(_=StrToInt(f[1])))}!isNull(webphone_api.parameters.last_clientreset)&&IsNumber(webphone_api.parameters.last_clientreset)&&(d=StrToInt(webphone_api.parameters.last_clientreset)),!isNull(webphone_api.parameters.last_clientresetall)&&IsNumber(webphone_api.parameters.last_clientresetall)&&(_=StrToInt(webphone_api.parameters.last_clientresetall));var v=-1,P=-1;if(!isNull(webphone_api.parameters.clientreset)&&IsNumber(webphone_api.parameters.clientreset)&&(v=StrToInt(webphone_api.parameters.clientreset)),!isNull(webphone_api.parameters.clientresetall)&&IsNumber(webphone_api.parameters.clientresetall)&&(P=StrToInt(webphone_api.parameters.clientresetall)),P>_&&(ClientReset(v,P,o,!0),p=!0),v>d&&(ClientReset(v,P,o,!1),p=!0),!isNull(webphone_api.parameters.serveraddress)&&webphone_api.parameters.serveraddress.length>0&&(c=webphone_api.parameters.serveraddress),!isNull(webphone_api.parameters.webrtcserveraddress)&&webphone_api.parameters.webrtcserveraddress.length>0&&(u=webphone_api.parameters.webrtcserveraddress),!isNull(webphone_api.parameters.upperserver)&&webphone_api.parameters.upperserver.length>0&&(g=webphone_api.parameters.upperserver),!isNull(webphone_api.parameters.proxyaddress)&&webphone_api.parameters.proxyaddress.length>0&&(m=webphone_api.parameters.proxyaddress),isNull(c)&&(c=""),isNull(u)&&(u=""),isNull(g)&&(g=""),isNull(m)&&(m=""),isNull(b)&&(b=""),h=Md5Hash(c+u+g+m),b.length>0&&!isNull(h)&&h!==b&&(s=!0,PutToDebugLog(2,"EVENT, HandleSettings: key settings changed, omit them from local storage"),SaveParameter("autostart",0)),setTimeout(function(){SaveParameter("lastsettcrc",h)},500),!1===p)for(var E="",T="",N="",S="",I="",R="",G="",O="",L=0;L<l.length;L++)if(!(isNull(l[L])||l[L].length<2||l[L].indexOf(";")<0)){var C=l[L].split(";");if(isNull(C))PutToDebugLog(2,"WARNING, common ReadSettingsFile can't parse. clen: "+e.length+", alen: "+l.length+", setting: "+l[L]);else if(8===C.length||"get"===C[0]||"getAll"===C[0])E=C[0],(!0!==s||"serveraddress"!==E&&"serveraddress_orig"!==E&&"serveraddress_user"!==E&&"webrtcserveraddress"!==E&&"upperserver"!==E&&"proxyaddress"!==E&&"realm"!==E&&"lastsettcrc"!==E)&&(T=C[1],N=C[2],S=C[3],I=C[4],R=C[5],G=C[6],O=C[7],SettingItem(E,T,N,S,I,R,G,O),"loglevel"===E&&SettingItem(E,T,N,S,I,R,G,O,!0),E="",T="",N="",S="",I="",R="",G="",O="");else{PutToDebugLog(2,"WARNING, common ReadSettingsFile broken or invalid setting after parse. clen: "+e.length+", alen: "+l.length+", len: "+C.length)}}}if(!isNull(i))for(var a in i)if(!(isNull(a)||a.length<1||a.indexOf("overwrite_")<0)){a=a.replace("overwrite_","");var r=i[a];"NULL"===r&&(r=""),SaveParameter(a,r)}for(var t in webphone_api.global.settmap)isNull(t)||t.length<1||(webphone_api.global.settmap2[t]=webphone_api.global.settmap[t]);if(!isNull(webphone_api.parameters)){for(var t in webphone_api.parameters)if(!(isNull(t)||t.length<1||"codec"===t||"extraregisteraccounts"==t)){var T=webphone_api.parameters[t];if(isNull(T)&&(T=""),"object"==typeof T)try{T=JSON.stringify(T)}catch(x){}T=isNull(T)?"":T.toString(),T.length<1||0===t.indexOf("ucfg_")&&!isNull(GetParameter(t))&&GetParameter(t).length>0||(t=t.replace("ucfg_",""),"NULL"===T&&(T=""),"webrtcserver"!==t&&"webrtcaddress"!==t&&"rtcserver"!==t&&"rtcaddress"!==t||(t="webrtcserveraddress"),"loglevel"===t?!isNull(StrToInt(T))&&StrToInt(T)>1&&SaveParameter(t,T,!0):SaveParameter(t,T,!0),"username"!==t||"undefined"!=typeof webphone_api.parameters.sipusername&&null!==webphone_api.parameters.sipusername?"sipusername"!==t||"undefined"!=typeof webphone_api.parameters.username&&null!==webphone_api.parameters.username||SaveParameter("username",T,!0):SaveParameter("sipusername",T,!0))}var D=webphone_api.parameters.serveraddress;!isNull(D)&&D.length>1&&(SaveParameter("serveraddress",D,!0),SaveParameter("serveraddress_user",D,!0),SaveParameter("serveraddress_orig",D,!0)),GetCodecsFromApiParam()}GetSettingsFromUrl();var y=GetParameter("serveraddress");return!isNull(y)&&y.length>0&&SaveParameter("serveraddress",NormalizeInput(y,0)),y=GetParameter("serveraddress_user"),!isNull(y)&&y.length>0&&SaveParameter("serveraddress_user",NormalizeInput(y,0)),y=GetParameter("serveraddress_orig"),!isNull(y)&&y.length>0&&SaveParameter("serveraddress_orig",NormalizeInput(y,0)),y=GetParameter("webrtcserveraddress"),!isNull(y)&&y.length>0&&SaveParameter("webrtcserveraddress",NormalizeInputBasic(y,0)),y=GetParameter("turnserveraddress"),!isNull(y)&&y.length>0&&SaveParameter("turnserveraddress",NormalizeInput(y,0)),y=GetParameter("sipusername"),!isNull(y)&&y.length>0&&SaveParameter("sipusername",NormalizeInput(y,0)),y=GetParameter("username"),!isNull(y)&&y.length>0&&SaveParameter("username",NormalizeInput(y,0)),IsCExt(),SetLanguage(),SetCurrTheme(),HandleScurlSetparameters(),ParseSipAccounts(),void n(!0)}catch(A){PutToDebugLog(2,"EVENT, common: HandleSettings er1")}HandleScurlSetparameters(),ParseSipAccounts(),n(!1)}function GetSettingsFromUrl(){var e=!1;try{var o=window.location.href,n="",t="",i="";if(isNull(o)||o.length<1)return;o=decodeURIComponent(o),o=Trim(o),CanLog(3)&&PutToDebugLog(3,"EVENT, GetSettingsFromUrl url: "+o);var a=o.indexOf("?");if(a<0)return;o=o.substring(a+1,o.length),a=o.indexOf("#page_"),a>0&&(o=o.substring(0,a));for(var r=0;o.length>3&&r<100;){r++,a=o.indexOf("&"),a<0&&(a=o.length);var l=o.substring(0,a);if(o=o.substring(a,o.length),0===o.indexOf("&")&&(o=o.substring(1,o.length)),!(isNull(l)||l.length<1))if(l=Trim(l),(a=l.indexOf("="))<1)PutToDebugLog(3,"EVENT, GetSettingsFromUrl invalid settings: "+l);else{var p=Trim(l.substring(0,a)),s=Trim(l.substring(a+1,l.length));s=StrDc(s,"1AzbNh5FdLT9m"),"platform"!==p||"windesktop"!==s?0===p.indexOf("wp_")&&((p.indexOf("serveraddres")>0||p.indexOf("username")>0||p.indexOf("sipusername")>0||p.indexOf("password")>0)&&(webphone_api.global.sipaccounts=[],SaveSipAccounts()),p=p.substring(p.indexOf("wp_")+3,p.length),"brandnamestr"===p&&s.length>0?p="brandname":"resetsettings"===p&&s.length>0&&("1"===s.toLowerCase()||"true"===s.toLowerCase())?e=!0:"serveraddress"===p&&s.length>0&&(SaveParameter("iswebrtcuppersrvfromuser","true",!0),SaveParameter("serveraddress_user",Trim(s),!0),SaveParameter("serveraddress_orig",Trim(s),!0)),"video"===p&&!0===CanIUseWebRTC()&&(PutToDebugLog(2,"WARNING, Enginepriority_WebRTC is set manually to 4 because video is forced"),SaveParameter("enginepriority_webrtc","4")),"callto"===p&&!isNull(s)&&s.length>0?n=s:"sendchat"===p&&!isNull(s)&&s.length>0?t=s:"to"===p&&!isNull(s)&&s.length>0?i=s:SaveParameter(p,Trim(s),!0)):(p="devicetype",s=""+DEVICE_WIN_SOFTPHONE(),SaveParameter(p,s,!0))}}if(!0===e)return PutToDebugLog(2,"EVENT, mlogic Delsettings GetSettingsFromUrl"),void webphone_api.delsettings(2);(isNull(n)||n.length<1)&&(n=GetParameter("callto")),!isNull(n)&&n.length>0&&!1===autocall_called&&(autocall_called=!0,webphone_api.global.aua_handled=!0,setTimeout(function(){3===GetParameterInt("autoaction",0)?(PutToDebugLog(2,"EVENT,GetSettingsFromUrl initiate autoaction video call to: "+n),PutToDebugLog(2,"EVENT, mlogic API_VideoCall GetSettingsFromUrl"),webphone_api.videocall(decodeURIComponent(n))):(PutToDebugLog(2,"EVENT,GetSettingsFromUrl initiate autoaction call to: "+n),PutToDebugLog(2,"EVENT, mlogic API_Call GetSettingsFromUrl"),webphone_api.call(decodeURIComponent(n)))},200)),!isNull(t)&&t.length>0&&!isNull(i)&&i.length>0&&!1===sendchat_called&&(sendchat_called=!0,webphone_api.global.aua_handled=!0,setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_SendChat GetSettingsFromUrl"),webphone_api.sendchat(decodeURIComponent(i),decodeURIComponent(t))},200))}catch(c){PutToDebugLogException(2,"common: GetSettingsFromUrl",c)}}function GetOverWriteSettings(){try{var e=GetConfigAll(!0);if(isNull(e))return;for(var o in e)isNull(o)||o.length<1||o.indexOf("overwrite_")<0||(o=o.replace("overwrite_",""),SaveParameter(o,e[o]))}catch(n){PutToDebugLogException(2,"common: GetOverWriteSettings",n)}}function OpenSettings(e,o){try{3===o&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)||8===o?PutToDebugLog(2,"EVENT, mlogic OpenSettings: "+o):(PutToDebugLog(2,"EVENT, mlogic API_Unregister OpenSettings: "+o),webphone_api.unregister(),PutToDebugLog(2,"EVENT, mlogic API_Stop OpenSettings: "+o),webphone_api.stop()),!1===IsSDK()&&(isNull(e)||!0!==e||(webphone_api.global.intentsettings[0]="startedfrom=app"),"undefined"!=typeof webphone_api.$&&null!==webphone_api.$&&"undefined"!=typeof webphone_api.$.mobile&&null!==webphone_api.$.mobile&&webphone_api.$.mobile.changePage("#page_settings",{transition:"pop",role:"page"})),IsWindowsSoftphone()||"Android"===GetOs()||setTimeout(function(){ChooseEngineLogic(function(){PutToDebugLog(3,"ChooseEngineLogic called on goind to settings page")},!1)},350)}catch(n){PutToDebugLogException(2,"common: OpenSettings",n)}}function GetIntentParam(e,o){try{if(isNull(e)||isNull(o))return"";if(o=Trim(o),e.length<1||o.length<1)return"";for(var n=0;n<e.length;n++)if(!isNull(e[n])&&0===e[n].indexOf(o)&&e[n].indexOf("=")>0){var t=e[n].substring(e[n].indexOf("=")+1);return Trim(t)}}catch(i){PutToDebugLogException(2,"common: GetIntentParam",i)}return""}function SaveContactsFile(e){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveContactsFile do not save because preferred_storage is 0"),void e(!0);if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveContactsFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveContactsFile callback not defined");if(isNull(webphone_api.global.ctlist))return PutToDebugLog(2,"EVENT, SaveContactsFile no contacts to be saved"),e(!1),!1;if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, SaveContactsFile File handling module not loaded yet"),e(!1),!1;for(var o="",n=null,t=0;t<webphone_api.global.ctlist.length;t++)if(n=webphone_api.global.ctlist[t],!isNull(n)){var i=n[CT_EMAIL],a=n[CT_ADDRESS],r=n[CT_NOTES],l=n[CT_WEBSITE],p=n[CT_LASTACTIVE],s=n[CT_ISFROMSYNC];isNull(i)&&(i=""),isNull(a)&&(a=""),isNull(r)&&(r=""),isNull(l)&&(l=""),(isNull(p)||p.length<1||!1===IsNumber(p))&&(p="0"),(isNull(s)||s.length<1||!1===IsNumber(s))&&(s="1"),o=o+n[CT_NAME]+",[",o=o+n[CT_NUMBER].join(";")+"],[",o=o+n[CT_PTYPE].join(";")+"],",o=o+n[CT_USAGE]+","+n[CT_LASTMODIF]+","+n[CT_DELFLAG]+","+n[CT_FAV]+","+i+","+a+","+r+","+l+","+p+","+s+"\r\n"}var c=GetConfig("brandid");(isNull(c)||c.length<1||"-1"==c)&&(c=GetBrandName().toLowerCase()),IsWindowsSoftphone()?ApiWinSaveFile(webphone_api.global.CONTACTS_FILENAME+c,o,function(o){webphone_api.global.wereCtModified=!1,e(!0)}):webphone_api.File.SaveFile(webphone_api.global.CONTACTS_FILENAME+c,o,webphone_api.global.STORAGE_LOCAL,function(o){webphone_api.global.wereCtModified=!1,e(o)})}catch(u){PutToDebugLogException(2,"common: SaveContactsFile",u)}}function ReadContactsFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadContactsFile callback not defined");if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, ReadContactsFile File handling module not loaded yet"),e(!1),!1;var o=GetConfig("brandid");if((isNull(o)||o.length<1||"-1"==o)&&(o=GetBrandName().toLowerCase()),!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===contactsdeleted&&(contactsdeleted=!0,webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME+o,function(e){PutToDebugLog(2,"EVENT, delete contacts file resetsettings result: "+e)}),webphone_api.global.ctlist=[]),PutToDebugLog(2,"EVENT, ReadContactsFile not read because resetsettings"),e(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(webphone_api.global.CONTACTS_FILENAME+o,function(o){if(isNull(o)||Trim(o).length<1)return PutToDebugLog(2,"EVENT, common: ReadContactsFile no content WinApi"),e(!1),!1;ParseContactsReadFromFile(o,!0,e)}):webphone_api.File.ReadFile(webphone_api.global.CONTACTS_FILENAME+o,webphone_api.global.STORAGE_LOCAL,function(o){if(isNull(o)||Trim(o).length<1)return PutToDebugLog(2,"EVENT, common: ReadContactsFile no content"),e(!1),!1;ParseContactsReadFromFile(o,!0,e)})}catch(n){PutToDebugLogException(2,"common: ReadContactsFile",n)}}function ParseContactsReadFromFile(e,o,n){try{var t=e.split("\r\n");if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, common: ParseContactsReadFromFile empty content"),n&&n(!1),!1;if(!0===o&&!isNull(webphone_api.global.ctlist))for(var i in webphone_api.global.ctlist)delete webphone_api.global.ctlist[i];for(var a="",r="",l=0;l<t.length;l++)if(isNull(t[l])||t[l].length<2||t[l].indexOf(",")<0)PutToDebugLog(2,"EVENT, common ParseContactsReadFromFile broken or invalid contact (1): "+t[l]);else if(a=t[l].split(","),r="",r=a[CT_NUMBER],isNull(r)||r.length<2||r.indexOf("[")<0)PutToDebugLog(2,"EVENT, common ParseContactsReadFromFile broken or invalid contact: (2)"+t[l]);else{r=r.substring(1,r.length-1);var p=r.split(";");if(isNull(p)&&(p=[]),r="",r=a[CT_PTYPE],isNull(r)||r.length<2||r.indexOf("[")<0)PutToDebugLog(2,"WARNING, common ParseContactsReadFromFile broken or invalid contact: (3)"+t[l]);else{r=r.substring(1,r.length-1);var s=r.split(";");isNull(s)&&(s=[]);var c=a[CT_EMAIL],u=a[CT_ADDRESS],g=a[CT_NOTES],m=a[CT_WEBSITE],b="0";a.length>CT_LASTACTIVE&&(b=a[CT_LASTACTIVE]);var h="1";a.length>CT_ISFROMSYNC&&(h=a[CT_ISFROMSYNC]),isNull(c)&&(c=""),isNull(u)&&(u=""),isNull(g)&&(g=""),isNull(m)&&(m="");var d=[];d[CT_NAME]=a[CT_NAME],d[CT_NUMBER]=p,d[CT_PTYPE]=s,d[CT_USAGE]=a[CT_USAGE],d[CT_LASTMODIF]=a[CT_LASTMODIF],d[CT_DELFLAG]=a[CT_DELFLAG],d[CT_FAV]=a[CT_FAV],d[CT_EMAIL]=c,d[CT_ADDRESS]=u,d[CT_NOTES]=g,d[CT_WEBSITE]=m,d[CT_LASTACTIVE]=b,d[CT_ISFROMSYNC]=h,webphone_api.global.ctlist.push(d)}}SortContacts(),n&&n(!0)}catch(_){PutToDebugLogException(2,"common: ParseContactsReadFromFile",_)}}function ParseContactsFromServer(e,o,n){try{var t=e.split("\r\n");if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, common: ParseContactsFromServer empty content"),n(!1),!1;if(!0===o&&!isNull(webphone_api.global.ctlist))for(var i in webphone_api.global.ctlist)delete webphone_api.global.ctlist[i];for(var a="",r=0;r<t.length;r++)if(isNull(t[r])||t[r].length<2||t[r].indexOf(",")<0)PutToDebugLog(2,"EVENT, common ParseContactsFromServer broken or invalid contact ["+r.toString()+"] (1): "+t[r]);else if(a=t[r].split(","),isNull(a)||a.length<7)PutToDebugLog(2,"EVENT, common ParseContactsFromServer broken or invalid contact ["+r.toString()+"] (2): "+t[r]);else{var l=a[0];isNull(l)&&(l=""),l=Trim(l);for(var p=[],s=[],c=1;c<=5;){var u=a[c];!isNull(u)&&u.length>0&&(u=ReplaceAll(u," ",""),u=ReplaceAll(u,"-",""),u=ReplaceAll(u,"(",""),u=ReplaceAll(u,")",""),p.indexOf(u)<0&&(p.push(a[c]),!0===IsNumeric(a[c],"+")&&a[c].length>6?s.push("phone"):s.push("sip"))),c++}var g=[];g[CT_NAME]=l,g[CT_NUMBER]=p,g[CT_PTYPE]=s,g[CT_USAGE]="0",g[CT_LASTMODIF]="0",g[CT_DELFLAG]="0",g[CT_FAV]="0",g[CT_EMAIL]="",g[CT_ADDRESS]="",g[CT_NOTES]="",g[CT_WEBSITE]="",g[CT_LASTACTIVE]="0",g[CT_ISFROMSYNC]="1",webphone_api.global.ctlist.push(g)}SortContacts(),n(!0)}catch(m){PutToDebugLogException(2,"common: ParseContactsFromServer",m)}}function GetContacts(e){try{isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1||webphone_api.common.GetParameter("lastfilterval")!==webphone_api.common.GetParameter("filtercontacts")?ReadContactsFile(function(o){SortContacts(),e&&e(o)}):webphone_api.global.wasCtModified?(SortContacts(),e&&e(!0)):e&&e(!0)}catch(o){PutToDebugLogException(2,"common: GetContacts",o)}}function SortContacts(){try{var e=GetParameterInt("sortcontacts",0);0===e?webphone_api.global.ctlist.sort(function(e,o){return e[CT_NAME].toLowerCase()<o[CT_NAME].toLowerCase()?-1:e[CT_NAME].toLowerCase()>o[CT_NAME].toLowerCase()?1:0}):1===e?webphone_api.global.ctlist.sort(function(e,o){return StrToInt(e[CT_USAGE])<StrToInt(o[CT_USAGE])?1:StrToInt(e[CT_USAGE])>StrToInt(o[CT_USAGE])?-1:0}):2===e&&webphone_api.global.ctlist.sort(function(e,o){for(var n=0,t=0,i=0;i<e[CT_NUMBER].length;i++){var a=webphone_api.global.presenceHM[e[CT_NUMBER][i]];if(!isNull(a)&&"5"===a[PRES_STATUS]){n=5;break}}for(var r=0;r<o[CT_NUMBER].length;r++){var l=webphone_api.global.presenceHM[e[CT_NUMBER][r]];if(!isNull(l)&&"5"===l[PRES_STATUS]){t=5;break}}return n<t?1:n>t?-1:0})}catch(o){PutToDebugLogException(2,"common: SortContacts",o)}}function UpdateContactLastActive(e){try{if(isNull(e)||e.length<1)return;var o=GetContactIdFromNumber(e);if(o>=0){var n=webphone_api.global.ctlist[o];n[CT_LASTACTIVE]=GetTickCount().toString(),webphone_api.global.ctlist[o]=n}}catch(t){PutToDebugLogException(2,"common: UpdateContactLastActive",t)}}function GetContactIdFromNumber(e){var o=-1;try{if(isNull(e)||Trim(e).length<1||isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return-1;e=Trim(e.replace("+",""));var n=e;n.length>4&&(n=Trim(n.substring(1))),n.length>4&&"0"===n.charAt(0)&&(n=Trim(n.substring(1)));var t=n;t=t.replace("-",""),t=t.replace(" ",""),t=t.replace("(",""),t=t.replace(")",""),t=Trim(t);for(var i=0;i<webphone_api.global.ctlist.length;i++){var a=webphone_api.global.ctlist[i];if(!isNull(a)){var r=a[CT_NUMBER];if(!isNull(r))for(var l=0;l<r.length;l++)if(!isNull(r[l])&&(r[l].indexOf(e)>-1||r[l].indexOf(n)>-1||r[l].indexOf(t)>-1)){o=i;break}}}}catch(p){PutToDebugLogException(2,"common: GetContactIdFromNumber",p)}return o}function GetContactNameFromNumber(e){var o=e;try{if(isNull(e)||Trim(e).length<1)return"";if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return e;e=Trim(e),e=e.replace("-",""),e=e.replace(" ",""),e=e.replace("(",""),e=e.replace(")","");for(var n=!1,t=0;t<webphone_api.global.ctlist.length;t++){var i=webphone_api.global.ctlist[t];if(!isNull(i)){var a=i[CT_NUMBER];if(!isNull(a))for(var r=0;r<a.length;r++)if(!isNull(a[r])&&a[r]===e){o=i[CT_NAME],n=!0;break}}}if(!1===n)for(var t=0;t<webphone_api.global.ctlist.length;t++){var i=webphone_api.global.ctlist[t];if(!isNull(i)){var a=i[CT_NUMBER];if(!isNull(a))for(var r=0;r<a.length;r++)if(!isNull(a[r])&&(a[r].length>6&&e.length>5&&a[r].indexOf(e)>=0||a[r].length>5&&e.length>6&&e.indexOf(a[r])>=0||e==="+"+a[r]||e==="00"+a[r]||a[r]==="+"+e||a[r]==="00"+e)){o=i[CT_NAME],n=!0;break}}}}catch(l){PutToDebugLogException(2,"common: GetContactNameFromNumber",l)}return o}function ContactExists(e,o){try{if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return!1;isNull(e)&&(e=""),e=Trim(e),isNull(o)&&(o=""),o=Trim(o);var n=!1,t=!1;if(e.length>0&&(n=!0),o.length>0&&(t=!0),(isNull(e)||e.length<1)&&(isNull(o)||o.length<1)||!1===n&&!1===t)return PutToDebugLog(2,"ERROR, ContactExists invalid name and number"),!1;for(var i=0;i<webphone_api.global.ctlist.length;i++){var a=webphone_api.global.ctlist[i];if(!(isNull(a)||a.length<4)){if(!0===n&&a[CT_NAME]===e)return!0;if(!0===t){var r=a[CT_NUMBER];if(isNull(r)||r.length<1)continue;for(var l=0;l<r.length;l++)if(r[l]===o)return!0}}}}catch(p){PutToDebugLogException(2,"common: ContactExists",p)}return!1}function SaveCallhistoryFile(e){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveCallhistoryFile do not save because preferred_storage is 0"),void e(!0);if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveCallhistoryFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveCallhistoryFile callback not defined");if(isNull(webphone_api.global.chlist))return PutToDebugLog(2,"EVENT, SaveCallhistoryFile no contacts to be saved"),e(!1),!1;if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, SaveCallhistoryFile File handling module not loaded yet"),e(!1),!1;for(var o="",n=null,t=0;t<webphone_api.global.chlist.length;t++)if(n=webphone_api.global.chlist[t],!isNull(n)){var i="";n.length>6&&(i=n[CH_REASON]),o.length>3&&(o+="\r\n"),o=o+n[CH_TYPE]+","+n[CH_NAME]+","+n[CH_NUMBER]+","+n[CH_DATE]+","+n[CH_DURATION]+","+n[CH_RECORDING]+","+i}IsWindowsSoftphone()?ApiWinSaveFile(GetActiveAccCallhistoryFilename(),o,function(o){webphone_api.global.wasChModified=!1,e(!0)}):webphone_api.File.SaveFile(GetActiveAccCallhistoryFilename(),o,webphone_api.global.STORAGE_LOCAL,function(o){webphone_api.global.wasChModified=!1,e(o)})}catch(a){PutToDebugLogException(2,"common: SaveCallhistoryFile",a)}}function ReadCallhistoryFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadCallhistoryFile callback not defined");if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, ReadCallhistoryFile File handling module not loaded yet"),e(!1),!1;if(!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===callhdeleted&&(callhdeleted=!0,webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, delete call history file resetsettings: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),webphone_api.global.chlist=[],webphone_api.global.recentlist=[]),PutToDebugLog(2,"EVENT, ReadCallhistoryFile not read because resetsettings"),e(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(GetActiveAccCallhistoryFilename(),function(o){if(isNull(o)||Trim(o).length<1)return PutToDebugLog(2,"EVENT, common: ReadCallhistoryFile no content WinApi"),e(!1),!1;ParseCallhistoryReadFromFile(o,e)}):webphone_api.File.ReadFile(GetActiveAccCallhistoryFilename(),webphone_api.global.STORAGE_LOCAL,function(o){if(isNull(o)||Trim(o).length<1)return PutToDebugLog(2,"EVENT, common: ReadCallhistoryFile no content"),e(!1),!1;ParseCallhistoryReadFromFile(o,e)})}catch(o){PutToDebugLogException(2,"common: ReadCallhistoryFile",o)}}function ParseCallhistoryReadFromFile(e,o){try{var n=e.split("\r\n");if(isNull(n)||n.length<1)return PutToDebugLog(2,"ERROR, common: ReadCallhistoryFile empty content"),o(!1),!1;if(!isNull(webphone_api.global.chlist))for(var t in webphone_api.global.chlist)delete webphone_api.global.chlist[t];for(var i=null,a=0;a<n.length;a++)isNull(n[a])?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact (1a): "+n.length.toString()+":"+n[a]):n[a].length<2||n[a].indexOf(",")<0?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact (1): "+n.length.toString()+":"+n[a].length.toString()+":"+n[a]):(i=n[a].split(","),isNull(i)||i.length<2?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact: (2): "+n.length.toString()+":"+n[a].length.toString()+":"+n[a]):(i.length<7&&i.push(""),webphone_api.global.chlist.push(i)));o(!0)}catch(r){PutToDebugLogException(2,"common: ParseCallhistoryReadFromFile",r)}}function StartMsg(e,o,n){try{e=NormalizeNumber(e);var t="",i=GetParameter("sms"),a=webphone_api.common.GetParameterInt("textmessaging",-2);if(a<-1){switch(webphone_api.common.GetParameterInt("chatsms",-2)){case 0:a=-1;break;case 1:a=3;break;case 2:a=6;break;case 3:a=0}if(a<-1){switch(webphone_api.common.GetParameterInt("haschat",-2)){case 0:a=0;break;case 1:a=3;break;case 2:a=5;break;case 3:a=6;break;case 4:a=-1}}}if(!isNull(i)&&i.length>0)if(3===a||4===a||5===a)t="sms",PutToDebugLog(4,"EVENT, StartMsg called action: "+t+"; number: "+e+"; fromclass: "+n+" (1)"),StartMsgActivity(e,o,t,n);else if(6===a)t="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+t+"; number: "+e+"; fromclass: "+n+" (2)"),StartMsgActivity(e,o,t,n);else{var r=e;r.indexOf("+")>=0&&(r=r.substring(r.indexOf("+")+1,r.length)),IsNumber(r)&&r.length>6&&r.length<20?(t="sms",PutToDebugLog(4,"EVENT, StartMsg called action: "+t+"; number: "+e+"; fromclass: "+n+" (3)"),StartMsgActivity(e,o,t,n)):(t="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+t+"; number: "+e+"; fromclass: "+n+" (4)"),StartMsgActivity(e,o,t,n))}else t=3===a||4===a||5===a?"sms":"chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+t+"; number: "+e+"; fromclass: "+n+" (5)"),StartMsgActivity(e,o,t,n)}catch(l){PutToDebugLogException(2,"common: StartMsg",l)}}function ChooseChatOrSms(e,o,n,t){try{var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220,i>400?i=400:i<120&&(i=120);var a="",r='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',l="";l=r.replace("[ITEMID]","#item_chat"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("chat")),a+=l,l="",l=r.replace("[ITEMID]","#item_sms"),l=l.replace("[ITEMTITLE]",webphone_api.stringres.get("sms")),a+=l,l="";var p='<div id="chatsms_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+"px; min-width: "+Math.floor(.6*i)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("chat_sms_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="chatsms_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+a+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";t=t||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(p).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#chatsms_ul").off("click","li"),t()}}));var s="";webphone_api.$("#chatsms_ul").on("click","li",function(t){var i=webphone_api.$(this).attr("id");"#item_chat"===i&&(s="chat"),"#item_sms"===i&&(s="sms"),webphone_api.$("#chatsms_popup").on("popupafterclose",function(t){webphone_api.$("#chatsms_popup").off("popupafterclose"),PutToDebugLog(5,"EVENT, ChooseChatOrSms: action: "+s+"; number: "+e+"; fromclass: "+n+"; msg: "+o),StartMsgActivity(e,o,s,n)})})}catch(c){PutToDebugLogException(2,"common: ChooseChatOrSms",c)}}function StartMsgActivity(e,o,n,t){try{if("_messagelist"!==t&&(isNull(e)||e.length<1)){var i=GetParameter("messagefiles");isNull(i)||i.length<3?(isNull(o)&&(o=""),webphone_api.global.intentmsg[0]="action="+n,webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+o,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})):webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})}else isNull(o)&&(o=""),webphone_api.global.intentmsg[0]="action="+n,webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+o,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}catch(a){PutToDebugLogException(2,"common: StartMsgActivity",a)}}function OpenLinkInExternalBrowser(e){try{!isNull(e)&&e.length>0&&GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()&&(PutToDebugLog(2,"EVENT, OpenLinkInExternalBrowser: "+e),WinAPI("API_BrowserOpenExtern",null,e))}catch(o){PutToDebugLogException(2,"common: OpenLinkInExternalBrowser",o)}}function OpenLinkInInternalBrowser(e){try{!isNull(e)&&e.length>0&&GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()&&WinAPI("API_BrowserOpen",null,e)}catch(o){PutToDebugLogException(2,"common: OpenLinkInInternalBrowser",o)}}function OpenWebURL(e,o,n){try{if(isNull(e)||e.length<3)return void PutToDebugLog(2,"WARNING, common OpenWebURL no url passed");var t=GetSipusername(),i=GetParameter("password"),a="",r="",l="",p="",s="",c="",u="",g=RandomInt(1e4,9999999).toString();return l=Md5Hash("C8y5:"+t+":"+i+":"+g),p=Md5Hash(t+":"+i),s=Md5Hash(t+":"+i+":"+g),c=Md5Hash("rD58s:"+t+":"+i+":"+g),u=Md5Hash("ck5Gp"+t+i+GetParameter("apiv2md5salt")+g),1===GetParameter("brandid")&&(a=Md5Hash("C8y5:"+t+":"+i+":8294032567")),e.indexOf("mvapireq")>0&&(t=encodeURIComponent(t),i=encodeURIComponent(i),a=encodeURIComponent(a),r=encodeURIComponent(r),l=encodeURIComponent(l),p=encodeURIComponent(p),s=encodeURIComponent(s),g=encodeURIComponent(g),c=encodeURIComponent(c),u=encodeURIComponent(u)),e=Trim(e),e=e.replace("[USERNAME]",t),e=e.replace("USERNAME",t),e=e.replace("USRNAME",t),e=e.replace("[PASSWORD]",i),e=e.replace("PASSWORD",i),e=e.replace("PWD",i),e=e.replace("[MD5AUTH]",a),e=e.replace("[SHA1HASH]",r),e=e.replace("SHA1CHECKSUM",r),e=e.replace("MD5WEB",l),e=e.replace("MD5SIMPLE",p),e=e.replace("MD5NORMAL",s),e=e.replace("MD5SALT",g),e=e.replace("MD5CHECKSUM",c),e=e.replace("MD5VALUE",u),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("SERVERAPIKEY",GetConfig("serverapikey")),Trim(e.toLowerCase()).indexOf("http")<0&&o!==webphone_api.stringres.get("np_download")&&(e="http://"+e),!1!==n&&(IsHttps()&&e.indexOf("https:")<0&&(e=GetTlsProxyUrl(e)),PutToDebugLog(3,"EVENT, OpenWebURL = "+e),webphone_api.global.intentbrowser[0]="url="+e,webphone_api.global.intentbrowser[1]="lastpage="+webphone_api.$.mobile.activePage.attr("id"),isNull(o)&&(o=""),webphone_api.global.intentbrowser[2]="title="+o,webphone_api.$.mobile.changePage("#page_internalbrowser",{transition:"pop",role:"page"})),e}catch(m){PutToDebugLogException(2,"common: OpenWebURL",m)}return e}function Md5Hash(e){var o="";try{return isNull(e)||Trim(e).length<1?(PutToDebugLog(2,"EVENT, common: Md5Hash string to hash is NULL"),""):(o=Md5Lib(e),isNull(o)&&(o=""),o)}catch(n){PutToDebugLogException(2,"common: Md5Hash",n)}return""}function Md5Lib(e){function o(e,o){var n=e[0],l=e[1],p=e[2],s=e[3];n=t(n,l,p,s,o[0],7,-680876936),s=t(s,n,l,p,o[1],12,-389564586),p=t(p,s,n,l,o[2],17,606105819),l=t(l,p,s,n,o[3],22,-1044525330),n=t(n,l,p,s,o[4],7,-176418897),s=t(s,n,l,p,o[5],12,1200080426),p=t(p,s,n,l,o[6],17,-1473231341),l=t(l,p,s,n,o[7],22,-45705983),n=t(n,l,p,s,o[8],7,1770035416),
s=t(s,n,l,p,o[9],12,-1958414417),p=t(p,s,n,l,o[10],17,-42063),l=t(l,p,s,n,o[11],22,-1990404162),n=t(n,l,p,s,o[12],7,1804603682),s=t(s,n,l,p,o[13],12,-40341101),p=t(p,s,n,l,o[14],17,-1502002290),l=t(l,p,s,n,o[15],22,1236535329),n=i(n,l,p,s,o[1],5,-165796510),s=i(s,n,l,p,o[6],9,-1069501632),p=i(p,s,n,l,o[11],14,643717713),l=i(l,p,s,n,o[0],20,-373897302),n=i(n,l,p,s,o[5],5,-701558691),s=i(s,n,l,p,o[10],9,38016083),p=i(p,s,n,l,o[15],14,-660478335),l=i(l,p,s,n,o[4],20,-405537848),n=i(n,l,p,s,o[9],5,568446438),s=i(s,n,l,p,o[14],9,-1019803690),p=i(p,s,n,l,o[3],14,-187363961),l=i(l,p,s,n,o[8],20,1163531501),n=i(n,l,p,s,o[13],5,-1444681467),s=i(s,n,l,p,o[2],9,-51403784),p=i(p,s,n,l,o[7],14,1735328473),l=i(l,p,s,n,o[12],20,-1926607734),n=a(n,l,p,s,o[5],4,-378558),s=a(s,n,l,p,o[8],11,-2022574463),p=a(p,s,n,l,o[11],16,1839030562),l=a(l,p,s,n,o[14],23,-35309556),n=a(n,l,p,s,o[1],4,-1530992060),s=a(s,n,l,p,o[4],11,1272893353),p=a(p,s,n,l,o[7],16,-155497632),l=a(l,p,s,n,o[10],23,-1094730640),n=a(n,l,p,s,o[13],4,681279174),s=a(s,n,l,p,o[0],11,-358537222),p=a(p,s,n,l,o[3],16,-722521979),l=a(l,p,s,n,o[6],23,76029189),n=a(n,l,p,s,o[9],4,-640364487),s=a(s,n,l,p,o[12],11,-421815835),p=a(p,s,n,l,o[15],16,530742520),l=a(l,p,s,n,o[2],23,-995338651),n=r(n,l,p,s,o[0],6,-198630844),s=r(s,n,l,p,o[7],10,1126891415),p=r(p,s,n,l,o[14],15,-1416354905),l=r(l,p,s,n,o[5],21,-57434055),n=r(n,l,p,s,o[12],6,1700485571),s=r(s,n,l,p,o[3],10,-1894986606),p=r(p,s,n,l,o[10],15,-1051523),l=r(l,p,s,n,o[1],21,-2054922799),n=r(n,l,p,s,o[8],6,1873313359),s=r(s,n,l,p,o[15],10,-30611744),p=r(p,s,n,l,o[6],15,-1560198380),l=r(l,p,s,n,o[13],21,1309151649),n=r(n,l,p,s,o[4],6,-145523070),s=r(s,n,l,p,o[11],10,-1120210379),p=r(p,s,n,l,o[2],15,718787259),l=r(l,p,s,n,o[9],21,-343485551),e[0]=g(n,e[0]),e[1]=g(l,e[1]),e[2]=g(p,e[2]),e[3]=g(s,e[3])}function n(e,o,n,t,i,a){return o=g(g(o,e),g(t,a)),g(o<<i|o>>>32-i,n)}function t(e,o,t,i,a,r,l){return n(o&t|~o&i,e,o,a,r,l)}function i(e,o,t,i,a,r,l){return n(o&i|t&~i,e,o,a,r,l)}function a(e,o,t,i,a,r,l){return n(o^t^i,e,o,a,r,l)}function r(e,o,t,i,a,r,l){return n(t^(o|~i),e,o,a,r,l)}function l(e){var n,t=e.length,i=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=e.length;n+=64)o(i,p(e.substring(n-64,n)));e=e.substring(n-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<e.length;n++)a[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(o(i,a),n=0;n<16;n++)a[n]=0;return a[14]=8*t,o(i,a),i}function p(e){var o,n=[];for(o=0;o<64;o+=4)n[o>>2]=e.charCodeAt(o)+(e.charCodeAt(o+1)<<8)+(e.charCodeAt(o+2)<<16)+(e.charCodeAt(o+3)<<24);return n}function s(e){for(var o="",n=0;n<4;n++)o+=m[e>>8*n+4&15]+m[e>>8*n&15];return o}function c(e){for(var o=0;o<e.length;o++)e[o]=s(e[o]);return e.join("")}function u(e){return c(l(e))}function g(e,o){return e+o&4294967295}function g(e,o){var n=(65535&e)+(65535&o);return(e>>16)+(o>>16)+(n>>16)<<16|65535&n}try{var m="0123456789abcdef".split("");return u("hello"),u(e)}catch(b){PutToDebugLogException(2,"common: Md5Lib",b)}return""}function UriParser(e,o,n,t,i,a){try{if(isNull(e)||Trim(e).length<1)return void PutToDebugLog(2,"WARNING, common: UriParser uri is NULL");var r=GetSipusername(),l=GetParameter("password"),p="";!isNull(l)&&l.length>0&&(p=Md5Hash(l));var s="",c="",u="",g="",m="",b="",h=RandomInt(1e4,9999999).toString();c=Md5Hash("C8y5:"+r+":"+l+":"+h),u=Md5Hash(r+":"+l),g=Md5Hash(r+":"+l+":"+h),m=Md5Hash("rD58s:"+r+":"+l+":"+h),b=Md5Hash("ck5Gp"+r+l+GetParameter("apiv2md5salt")+h),0===Trim(e).indexOf("*")&&(e=e.substring(1));var d=e,_=d.indexOf("authpwd=");if(_>0&&GetLogLevel()<5){var w=d.substring(0,_+8);d=d.substring(_+8),_=d.indexOf("&"),_<0&&(_=d.length),d=d.substring(_),d=w+"*****"+d}PutToDebugLog(3,"EVENT, uri = "+d),e.indexOf("mvapireq")>0&&(r=encodeURIComponent(r),l=encodeURIComponent(l),p=encodeURIComponent(p),o=encodeURIComponent(o),n=encodeURIComponent(n),t=encodeURIComponent(t),s=encodeURIComponent(s),c=encodeURIComponent(c),u=encodeURIComponent(u),g=encodeURIComponent(g),h=encodeURIComponent(h),m=encodeURIComponent(m),b=encodeURIComponent(b)),e=Trim(e),e=e.replace("[USERNAME]",r),e=e.replace("USERNAME",r),e=e.replace("USRNAME",r),e=e.replace("[PASSWORD]",l),e=e.replace("PASSWORD",l),e=e.replace("PWD",l),e=e.replace("[MD5AUTH]",p),e=e.replace("MD5AUTH",p),e=e.replace("[PIN]",o),e=e.replace("PINCODE",o),e=e.replace("[ANUM]",n),e=e.replace("ANUM",n),e=e.replace("MYNUMBER",n),e=e.replace("PHONE1",n),e=e.replace("PREFIX_OR_NUMBER",n),e=e.replace("CALLEDNUMBER",n),e=e.replace("[CALLBACKNR]",GetParameter("callbacknumber")),e=e.replace("CALLBACKNR",GetParameter("callbacknumber")),e=e.replace("[BNUM]",t),e=e.replace("BNUM",t),e=e.replace("PHONE2",t),e=e.replace("TARGETMOBILE",t),e=e.replace("[TXT]",i),e=e.replace("TEXT",i),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("[SHA1HASH]",s),e=e.replace("SHA1CHECKSUM",s),e=e.replace("MD5WEB",c),e=e.replace("MD5SIMPLE",u),e=e.replace("MD5NORMAL",g),e=e.replace("MD5SALT",h),e=e.replace("SALT",h),e=e.replace("MD5CHECKSUM",m),e=e.replace("MD5VALUE",b),e=e.replace("BRANDNAME",encodeURIComponent(GetBrandName()));var f=GetParameter("upperserver");if((isNull(f)||f.length<1)&&(f=GetWebrtcUpperServer()),e=e.replace("UPPERSERVER",f),e=e.replace("SERVERAPIKEY",GetConfig("serverapikey")),e=e.replace("KEY",GetConfig("serverapikey")),e.indexOf("tel.search")>0){var v=GetParameter2("telsearchkey");isNull(v)&&(v=""),e=e.replace("TELSEARCHKEY",v)}Trim(e.toLowerCase()).indexOf("http")<0&&(e=UseSecureSrvConnection()?"https://"+e:"http://"+e),!1===P&&IsMizuServerOrGateway()&&e.indexOf("mvapireq")>0&&e.indexOf("?")>0&&(e=e+"&requestid="+GetRequestId());var d=e,_=d.indexOf("authpwd=");if(_>0){var w=d.substring(0,_+8);d=d.substring(_+8),_=d.indexOf("&"),_<0&&(_=d.length),d=d.substring(_),d=w+"*****"+d}if(PutToDebugLog(5,"EVENT,httpRequestUri = "+d+";   action = "+a),"return_uri"===a)return e;var P=!1,E="";e.indexOf("[POST]")>0?(P=!0,E=e.substring(e.indexOf("[POST]")+6),e=e.substring(0,e.indexOf("[POST]"))):(E=GetUrlParamVal(e,"POSTDATA"),!isNull(E)&&E.length>2&&(P=!0,e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?"))))),!1===webphone_api.global.isdebugversion&&!1===P&&IsMizuServerOrGateway()&&e.indexOf("mvapireq")>0&&(e=McrfsEnc(e,a)),HttpRequest(e,a,P,E)}catch(T){PutToDebugLogException(2,"common: UriParser",T)}}function McrfsEnc(e,o){try{if(isNull(e)||e.length<1)return e;var n=e,t=n.indexOf("?");if(t<0)return n;var i=n.substring(t+1);n=n.substring(0,t+1);var a="",r="",l=i.split("&");if(!isNull(l)&&l.length>0){i="";for(var p=0;p<l.length;p++)if(!isNull(l[p])){var s=l[p].indexOf("=");if(!(s<1)){var c=l[p].substring(0,s+1),u=l[p].substring(s+1);i.length>0&&(i+="&"),i=i+c+encodeURIComponent(u),"authkey="===c||"authid="===c||"authpwd="===c?(r.length>0&&(r+="&"),r=r+c+encodeURIComponent(u)):(a.length>0&&(a+="&"),a=a+c+encodeURIComponent(u))}}}var g=StrEc(i,webphone_api.global.ec_apikey,!0);if(i===StrDc("mcrfs_"+g,webphone_api.global.ec_apikey,!0))return n=n+"mcrfs="+g,PutToDebugLog(5,"EVENT,httpRequestUri ENC All = "+n+";   action = "+o),n;if(!isNull(r)&&r.length>0){var m=StrEc(r,webphone_api.global.ec_apikey,!0);if(r===StrDc("mcrfs_"+m,webphone_api.global.ec_apikey,!0))return!isNull(a)&&a.length>0&&(n=n+a+"&"),n=n+"mcrfs="+m,PutToDebugLog(5,"EVENT,httpRequestUri ENC main = "+n+";   action = "+o),n}}catch(b){PutToDebugLogException(2,"common: McrfsEnc",b)}return e}function ConfigureRequestEngine(e,o,n){try{if(e&&("jsonp"===webphone_api.global.httpmehod||"ws"===webphone_api.global.httpmehod))return void ReConfigureRequestEngine(e);if(!1===e&&o.indexOf("mvapireq")<1&&o.indexOf("mcrfs=")<1&&"ws"===webphone_api.global.httpmehod)return GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?void(webphone_api.global.httpmehod="win"):void(webphone_api.global.httpmehod="jsonp");if(o.indexOf("mvapireq")>=0||o.indexOf("mcrfs=")>=0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void(webphone_api.global.httpmehod="ws");if(webphone_api.global.httpmehod.length>0)return;return"waitforparameters"===n?void(webphone_api.global.httpmehod="cors"):(IsMizuServerOrGateway()&&window.WebSocket&&!0!==e&&(webphone_api.global.wssupported=!0),!0===webphone_api.global.wssupported?void(webphone_api.global.httpmehod="ws"):GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?void(webphone_api.global.httpmehod="win"):getuseengine()===webphone_api.global.ENGINE_JAVA?void(webphone_api.global.httpmehod="java"):IsMizuServerOrGateway()||!isNull(o)&&o.indexOf("xautoprov")>=0?void(webphone_api.global.httpmehod="cors"):void(webphone_api.global.httpmehod="jsonp"))}catch(t){PutToDebugLogException(2,"common: ConfigureRequestEngine",t)}}function ReConfigureRequestEngine(e){try{if(!1===webphone_api.global.currhttpmehodworking&&"ws"===webphone_api.global.httpmehod&&CheckInternetConnectionWS(),!0===e)return void(webphone_api.global.httpmehod="cors");if(!0===webphone_api.global.currhttpmehodworking)return;GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()?"win"===webphone_api.global.httpmehod?!0===webphone_api.global.wssupported&&(webphone_api.global.httpmehod="ws"):"ws"===webphone_api.global.httpmehod&&getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.global.httpmehod="java":"ws"===webphone_api.global.httpmehod||"java"===webphone_api.global.httpmehod?webphone_api.global.httpmehod="cors":"cors"===webphone_api.global.httpmehod?webphone_api.global.httpmehod="jsonp":webphone_api.global.httpmehod="win":"ws"===webphone_api.global.httpmehod?getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.global.httpmehod="java":getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.global.httpmehod="win":webphone_api.global.httpmehod="cors":"java"===webphone_api.global.httpmehod||"win"===webphone_api.global.httpmehod?webphone_api.global.httpmehod="cors":"cors"===webphone_api.global.httpmehod&&(webphone_api.global.httpmehod="jsonp"),PutToDebugLog(4,"EVENT, common:ReConfigureRequestEngine called. HTTP method: "+webphone_api.global.httpmehod)}catch(o){PutToDebugLogException(2,"common: ReConfigureRequestEngine",o)}}function HttpRequest(e,o,n,t){var i=0;try{if(isNull(t)&&(t=""),"downloadcontacts"===o&&"cors"!==webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: cors downloadcontacts");var a=CORSRequest(e,o,n,t);return void(!1===a&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available downloadcontacts; retry with other method"),ReConfigureRequestEngine(),HttpRequest(e,o,n,t)))}if(ConfigureRequestEngine(n,e,o),setTimeout(function(){ReConfigureRequestEngine(n)},3500),isNull(n)||!0!==n||"post",i=1,"telsearchname"===o){PutToDebugLog(2,"EVENT, HttpRequest method: cors telsearchname");var a=CORSRequest(e,o,n,t);return void(!1===a&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available telsearchname"),ReConfigureRequestEngine(),HttpRequest(e,o,n,t)))}if(i=2,50===GetConfigInt("brandid",-1)&&(webphone_api.global.httpmehod="win"),"win"===webphone_api.global.httpmehod){if(i=10,PutToDebugLog(2,"EVENT, HttpRequest method: win"),e=e.replace("[POST]",""),(isNull(t)||t.length<1)&&(t="data=dummy"),50===GetConfigInt("brandid",-1))return void WinAPI("API_HTTPReqAsyncFavafone",function(e){PutToDebugLog(2,"EVENT, common: API_HTTPReqAsyncFavafone returned (4): "+e+" waiting for response in notifications")},e,t);i=11,WinAPI("API_HTTPReqAsync",function(e){PutToDebugLog(2,"EVENT, common: API_HTTPReqAsync returned (4): "+e+" waiting for response in notifications")},e,t)}else if("ws"===webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: ws");var a=WSRequest(e,o,n);!1===a&&(i=20,PutToDebugLog(2,"WARNING, HttpRequest method: ws not available"),ReConfigureRequestEngine(),i=21,HttpRequest(e,o,n,t))}else if("java"===webphone_api.global.httpmehod)PutToDebugLog(2,"EVENT, HttpRequest method: java"),i=25,webphone_api.webphone_handle.API_HTTPReqAsync(e,t),i=26;else if("cors"===webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: cors"),i=30;var a=CORSRequest(e,o,n,t);i=31,!1===a&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available"),ReConfigureRequestEngine(),i=32,HttpRequest(e,o,n,t))}else if("jsonp"===webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: jsonp"),i=40;var r=decodeURIComponent(e);if(r=encodeURIComponent(r),r.toLowerCase().indexOf("wsuser")>0||r.toLowerCase().indexOf("wsload")>0)return PutToDebugLog(2,"WARNING, will not send wsuser/wsload over jsonp"),void(webphone_api.global.sendwsuserjsonp=!0);i=41;var l="http://";IsHttps()&&(l="https://"),r.toLowerCase().indexOf("wsuser")>0&&(l="https://");var p="rtc.mizu-voip.com";if("us"===webphone_api.global.usuk&&(p="usrtcx.webvoipphone.com"),i=42,IsMizuServerOrGateway()&&webphone_api.global.usuk.length<1&&(r.toLowerCase().indexOf("wsuser")<0||r.toLowerCase().indexOf("wsload")<0))if(i=45,GetWsAddressCfg().length>3){p=GetWsAddressCfg();var s=p.indexOf("://");s>=0&&(p=p.substring(s+3)),s=p.indexOf("/"),s>0&&(p=p.substring(0,s))}else GetConfig("serveraddress").length>1?p=GetConfig("serveraddress"):!isNull(webphone_api.parameters)&&!isNull(webphone_api.parameters.serveraddress)&&webphone_api.parameters.serveraddress.length>1&&(p=Trim(webphone_api.parameters.serveraddress),p=NormalizeInput(p,0),p.indexOf(":")>0&&(p=p.substring(0,p.indexOf(":"))));i=46,IsHttps()&&IsIPAddrress(p)&&jsonpmaxloop<3&&(jsonpmaxloop++,ReConfigureRequestEngine(n),HttpRequest(e,o,n,t)),jsonpmaxloop=0,i=50;var c=GetConfig("mainaport");!isNull(c)&&c.length>0&&(p.indexOf(":")>0&&(p=p.substring(0,p.indexOf(":"))),p+=c);var u=l+p+"/mvapireq/jppget?url="+r+"&callback=cbf";PutToDebugLog(4,"EVENT, jsonpurl: "+u),i=51,webphone_api.$.getJSON(u,function(e){var n="";isNull(e)?PutToDebugLog(2,"ERROR, HttpRequest jsonp response is NULL"):n=e.contents,HttpResponseHandler(n,o)})}else PutToDebugLog(2,"ERROR, common: HttpRequest NO supported http request method");i=59}catch(g){PutToDebugLogException(2,"common: HttpRequest ("+i.toString()+")",g);try{"creditrequest"===o&&(webphone_api.global.creditRequestIval<3e4?webphone_api.global.creditRequestIval=2*webphone_api.global.creditRequestIval:webphone_api.global.creditRequestIval=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL)}catch(m){}}}function CORSRequest(e,o,n,t){try{var i="GET";n&&(i="POST"),e=e.replace("[POST]","");var a=new XMLHttpRequest;if(PutToDebugLog(2,"EVENT, CORSRequest url: "+e+"; action: "+o+"; ispost: "+n+"; postdata: "+t),"withCredentials"in a)a.open(i,e,!0);else{if("undefined"==typeof XDomainRequest)return a=null,PutToDebugLog(2,"ERROR, common: CORSRequest, CORS not supported"),webphone_api.global.httpmehod="jsonp",!1;a=new XDomainRequest,a.open(i,e)}var r=0;a.onload=function(){try{if(PutToDebugLog(4,"EVENT, CORSRequest.onload"),r=19,!1===webphone_api.global.httpheaderslogged&&a.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 1: "+a.getAllResponseHeaders())}var e=a.responseText,n="";n=!isNull(e)&&e.length>250?e.substring(0,250)+"....":e,isNull(n)&&(n="NULL"),r=20,PutToDebugLog(2,"EVENT, CORSRequest response: "+n);return r=21,isNull(e)||e.length<1?(r=23,PutToDebugLog(2,"ERROR, CORSRequest response is NULL"),!1):(HttpResponseHandler(e,o),e)}catch(t){PutToDebugLogException(2,"common: CORSRequest.onload inner ("+r+")",t)}},a.onerror=function(e){var o="";isNull(e)||(o=e.toString(),isNull(e.target)||(o=isNull(e.target.status)?o+" "+e.target.toString():o+" "+e.target.status.toString())),PutToDebugLog(2,"ERROR, common: CORSRequest: onerror: "+o)};var l=reqtimeout;!0===n&&(l+=2e3),e.indexOf("xautoprov")>=0&&(l+=15e3),a.timeout=l,a.ontimeout=function(e){PutToDebugLog(2,"ERROR, common: CORSRequest: Timeout")},n?(isNull(t)&&(t=""),t=Trim(t),0===t.indexOf("?")&&(t=t.replace("?","")),a.send(t)):a.send()}catch(p){PutToDebugLogException(2,"common: CORSRequest",p)}}function ResetWsapisocket(e){try{isNull(e)&&(e=""),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, ResetWsapisocket, websocketNS close from: "+e),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen&&(wsapisocket.onopen=null),wsapisocket.onclose&&(wsapisocket.onclose=null),wsapisocket.onerror&&(wsapisocket.onerror=null))}catch(o){PutToDebugLogException(2,"common: ResetWsapisocket",o)}wsapisocket=null}function WSAPIRequest(method,data,apiname,callback){try{if(!callback||"function"!=typeof callback)return void PutToDebugLog(2,"ERROR, webphone_api.common.WSAPIRequest websocketNS callback is NULL");if(!1===Glsp())return void PutToDebugLog(2,"WARNING, WSAPIRequest websocketNS do not send");if(!isNull(apiname)&&apiname.length>0&&(apiname=Trim(apiname),0===apiname.indexOf("API_")&&"API_Poll"!==apiname&&"API_Stop"!==apiname)){srv_cb.push(callback),srv_apiname.push(apiname.toLowerCase());var finalparam="";if(!isNull(data)&&data.indexOf("param1=")>0){var tmp=ReplaceAll(data,"BOFLINE","");tmp=ReplaceAll(tmp,"EOFLINE","");var param1=tmp.substring(tmp.indexOf("param1=")+7),param2="";param1.indexOf("param2=")>=0?(param2=param1.substring(param1.indexOf("param2=")+7),param2=param2.indexOf("param3=")>=0?param2.substring(0,param2.indexOf("param3=")):param2.substring(0,param2.indexOf("EOFCOMMAND")),param2=Trim(param2),param1=param1.substring(0,param1.indexOf("param2=")),param1=Trim(param1)):(param1=param1.substring(0,param1.indexOf("EOFCOMMAND")),param1=Trim(param1)),finalparam=param1+param2}var sparamtmp=finalparam;sparamtmp.indexOf("requestid=")>=0&&(sparamtmp=sparamtmp.replace("requestid=","")),srv_params.push(sparamtmp)}if(!0===TestNSPolling()&&(webphone_api.global.useajax_forservice=!0),wsapimaxloop>15&&!IsMacLin()&&!IsWinMacLinNsTest()&&(webphone_api.global.useajax_forservice=!0),!0===webphone_api.global.useajax_forservice||"API_Poll"===apiname)WSAPIReqHTTP(method,data,callback);else if(!0===webphone_api.global.flagnsreconnect&&(PutToDebugLog(2,"EVENT,WSAPIReconnect websocketNS because engine was stopped"),webphone_api.global.flagnsreconnect=!1,void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null),void 0===wsapisocket||null===wsapisocket){var url=GetParameter("last_good_ns_plugin_url");(isNull(url)||url.length<5)&&!isNull(lastgoodnspluginurl)&&lastgoodnspluginurl.length>0?url=lastgoodnspluginurl:lastgoodnspluginurl=url,"API_Poll"!==apiname&&"API_Stop"!==apiname&&"API_HTTPKeepAlive"!==apiname&&(wsapi_method.push(method),wsapi_data.push(data),wsapi_cb.push(callback)),isNull(url)||url.length<5?IsServiceInstalled(function(e){PutToDebugLog(2,"EVENT WSAPIRequest IsServiceInstalled returned: "+e)}):WSAPIConnect(url,method,data,callback)}else{if((!1===wsapiready||wsapi_method.length>0)&&"API_Poll"!==apiname&&"API_Stop"!==apiname&&"API_HTTPKeepAlive"!==apiname){"API_SetParameters"===apiname||"API_Start"===apiname||"API_SetDIDChange"===apiname?RemoveFromWsapiQueue(apiname):RemoveFromWsapiQueue(apiname,data),wsapi_method.push(method),wsapi_data.push(data),wsapi_cb.push(callback);var toprint=data;return isNull(toprint)&&(toprint=""),toprint.length>100&&(toprint=toprint.substring(0,99)),void(!0===wsapiready&&wsapi_method.length>0?(CanLog(2)&&PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS attempt to start sending out cached data: "+wsapiready+"("+wsapi_method.length+"): "+toprint),HandleWsapiQueue()):CanLog(2)&&PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS cached for later execution: Websocket not ready: "+wsapiready+"("+wsapi_method.length+"): "+toprint))}if("API_Start"!==apiname&&"API_SetParameters"!==apiname&&"API_Poll"!==apiname&&"API_Stop"!==apiname&&webphone_api.global.apistartstate<2&&webphone_api.global.apistarttick>0&&GetTickCount()-webphone_api.global.apistarttick<3e3){if("API_Poll"!==apiname){wsapi_method.push(method),wsapi_data.push(data),wsapi_cb.push(callback);var toprint=data;isNull(toprint)&&(toprint=""),toprint.length>100&&(toprint=toprint.substring(0,99)),CanLog(2)&&PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS cached for later execution: no API_Start feedback: "+toprint)}return}CanLog(4)&&PutToDebugLog(4,"EVENT, _common: WSAPIRequest websocketNS SEND data: "+data),void 0!==wsapisocket&&null!==wsapisocket||PutToDebugLog(2,"ERROR, _common: WSAPIRequest websocketNS wsapisocket is NULL 1"),wsapisocket.send(data),wsapisocket.onmessage=function(evt){var recdata=null;if(isNull(evt)||(recdata=evt.data),isNull(recdata))return void PutToDebugLog(2,"ERROR, common: WSAPIRequest.onmessage websocketNS, received data is NULL");webphone_api.webphone_pollstatus=!1;var resp=ArrayBufferToString(recdata);if((resp.indexOf("WPNOTIFICATION,")>=0||0==resp.indexOf("STATUS,"))&&!0===webphone_api.global.cansetuseengine&&(webphone_api.global.useengine=webphone_api.global.ENGINE_SERVICE,webphone_api.global.cansetuseengine=!1),isNull(resp)||(resp=Trim(resp)),0!==resp.indexOf("webphone_api.")||resp.lastIndexOf(")")!==resp.length-1&&resp.lastIndexOf(");")!==resp.length-2)ProcessServiceReqResponse(resp,callback);else{resp=Trim(resp),PutToDebugLog(2,"EVENT, Process service command: "+resp);try{eval(resp)}catch(errp){PutToDebugLogException(2,"ERROR, Process service command failed: "+resp,errp)}}}}}catch(err){PutToDebugLogException(2,"common: WSAPIRequest websocketNS",err)}}function WSAPIHandleReConnect(){try{WinAPI("extcmd_version",function(e){isNull(e)||e.indexOf("ERROR:")>=0||(webphone_api.global.last_ns_ws_succwss=GetTickCount())}),setTimeout(function(){webphone_api.global.last_ns_ws_succwss<1||GetTickCount()-webphone_api.global.last_ns_ws_succwss>1200?(webphone_api.common.PutToDebugLog(2,"ERROR, exec WSAPIReConnect from timer (1)"),WSAPIReConnect()):!0===webphone_api.isincall()?(webphone_api.common.PutToDebugLog(2,"ERROR, exec WSAPIReConnect from timer (2) incall"),WSAPIReConnect()):WinAPI("API_Start2",function(e){PutToDebugLog(2,"EVENT, exec API_Start2 because NS engine is not responsive: answer: "+e)})},1e3)}catch(e){PutToDebugLogException(2,"common: WSAPIHandleReConnect",e)}}function WSAPIReConnect(){try{wsar_count++;var e=GetTickCount();if(e-wsar_lastcalled<100)return;if(wsar_lastcalled=e,(!0===wsa_ever_connected&&wsar_count<150||wsar_count<50)&&null===wsar_timer){wsar_delay>2e3&&getuseengine()===webphone_api.global.ENGINE_SERVICE&&webphone_api.global.phonestarted>1&&(PutToDebugLog(1,"STATUS,"+webphone_api.stringres.get("ns_engine_unreachable")),webphone_api.global.display_last_status=!0),wsar_delay<32e3&&(wsar_delay*=2);return PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS after: "+(wsar_delay/1e3).toString()+" sec"),wsar_timer=setTimeout(function(){wsar_delay>3e4?(PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS whole SIPStack restart"),WSAPIConnect(wsapi_reconnect_address,"","",function(){})):(PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS reconnecting..."),WSAPIConnect(wsapi_reconnect_address,"","",function(){})),isNull(wsar_timer)||clearTimeout(wsar_timer),wsar_timer=null},wsar_delay),wsar_delay<10&&(wsar_delay=500),!0}}catch(o){PutToDebugLogException(2,"common: WSAPIReConnect websocketNS",o)}}function WSAPIConnect(e,o,n,t){try{if(isNull(e)||e.length<1){PutToDebugLog(2,"EVENT, load WSAPIConnect websocketNS url from scratch c");var i=GetNsPluginWsUrl();if(null===i||i.length<1)return void PutToDebugLog(2,"ERROR, WSAPIReqHTTP could not find a valid URL c");e=i[0]}0!==e.indexOf("ws")&&(e="ws://"+e),CanLog(3)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS url: "+e),wsapi_reconnect_address=e,wsapiskt_closedmanually=!1;var a=!1;0===e.toLowerCase().indexOf("wss:")&&(a=!0),(e.indexOf("/mvstwebsock")>0||e.indexOf("/mfstwebsock")>0)&&e.indexOf("requestid=")<0&&(e=e.indexOf("?")>0?e+"&requestid="+GetRequestId():e+"?requestid="+GetRequestId());var r=!1;if(!1===TestNSPolling()){try{CanLog(2)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (1)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (1)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError,r=!0,webphone_api.global.cansetuseengine=!0}catch(l){PutToDebugLogException(2,"common: WSAPIConnect websocketNS failed to connect to: "+e,l)}if(!1===r&&!1===a){e=GetParameter("nsdomain",webphone_api.global.NATIVE_PLUGIN_URL_SECURE),0!=e.indexOf("ws")&&(e="wss://"+e),(e.indexOf("/mvstwebsock")>0||e.indexOf("/mfstwebsock")>0)&&e.indexOf("requestid=")<0&&(e=e.indexOf("?")>0?e+"&requestid="+GetRequestId():e+"?requestid="+GetRequestId());try{CanLog(2)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (2)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (2)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError,r=!0}catch(p){PutToDebugLogException(2,"WSAPIConnect failed to connect on 2nd attempt to (on SECURE connection) : "+e,p)}}}if(!1===r)return void(IsMacLin()||IsWinMacLinNsTest()||(WSAPIReqHTTP(o,n,t),webphone_api.global.useajax_forservice=!0));(isNull(wsapisocket)||!1===r)&&(CanLog(2)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (3)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (3)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen&&(wsapisocket.onopen=null),wsapisocket.onclose&&(wsapisocket.onclose=null),wsapisocket.onerror&&(wsapisocket.onerror=null)),(e.indexOf("/mvstwebsock")>0||e.indexOf("/mfstwebsock")>0)&&e.indexOf("requestid=")<0&&(e=e.indexOf("?")>0?e+"&requestid="+GetRequestId():e+"?requestid="+GetRequestId()),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError),wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError}catch(s){PutToDebugLogException(2,"common: WSAPIConnect websocketNS",s)}}function WsapisktOnOpen(){CanLog(2)&&PutToDebugLog(2,"EVENT, common: WSAPIConnect.onopen websocketNS, connection ready"),wsapiready=!0,wsapimaxloop=0,wsa_ever_connected=!0,wsar_delay=1,webphone_api.global.display_last_status&&(webphone_api.global.display_last_status=!1,PutToDebugLog(2,"EVENT, Display last good status to hide Engine unreachable"),PutToDebugLog(1,"EVENT, "+webphone_api.global.last_good_status)),HandleWsapiQueue()}function WsapisktOnClose(){CanLog(2)&&PutToDebugLog(2,"EVENT, common: WSAPIConnect.onclose websocketNS, connection closed"),wsapisocket=null,wsapiready=!1,!1===wsapiskt_closedmanually&&(PutToDebugLog(2,"ERROR, common: WSAPIConnect.onclose connection interrupted"),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onclose websocketNS, call WSAPIReConnect"),WSAPIReConnect())}function WsapisktOnError(){var e="";"undefined"!=typeof wserr&&null!==wserr&&(e=wserr.toString()),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onerror websocketNS, connection onerror: "+e),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onerror websocketNS, call WSAPIReConnect"),WSAPIReConnect(),setTimeout(function(){void 0!==wsapisocket&&null!==wsapisocket&&!0===wsapiready&&(webphone_api.global.wnotstartedsession=!1)},1500),wsapiready=!1,wsapimaxloop++}function RemoveFromWsapiQueue(e,o){try{if(isNull(e)||e.length<1)return;if(isNull(wsapi_method)||wsapi_method.length<1)return;for(var n=wsapi_method.length-1;n>=0;n--)wsapi_method[n]===e&&(isNull(o)||o.length<1||wsapi_data[n]===o)&&(delete wsapi_method[n],delete wsapi_data[n],delete wsapi_cb[n])}catch(t){PutToDebugLogException(2,"common: RemoveFromWsapiQueue",t)}}function HandleWsapiQueue(){try{if(isNull(wsapi_data)||wsapi_data.length<1)return wsapi_method=[],wsapi_data=[],void(wsapi_cb=[]);if(!isNull(hwqueue_timer))return;CanLog(5)&&PutToDebugLog(5,"EVENT, HandleWsapiQueue "+wsapi_data.length),hwqueue_timer=setInterval(function(){try{if(isNull(wsapi_data)||wsapi_data.length<1)return isNull(hwqueue_timer)||clearInterval(hwqueue_timer),hwqueue_timer=null,wsapi_method=[],wsapi_data=[],void(wsapi_cb=[]);if(void 0===wsapisocket||null===wsapisocket)return void PutToDebugLog(2,"WANING, _common: WSAPIRequest websocketNS HandleWsapiQueue wsapisocket is NULL 2");var e=wsapi_data[0],o="",n=e.indexOf("function=");if(n>0&&(o=e.substring(n+9),n=o.indexOf("EOFLINE"),o=n>0?o.substring(0,n):""),"API_Start"!==o&&"API_SetParameters"!==o&&webphone_api.global.apistartstate<2&&webphone_api.global.apistarttick>0&&GetTickCount()-webphone_api.global.apistarttick<3e3)return;e=wsapi_data.shift();var t=(wsapi_method.shift(),wsapi_cb.shift());CanLog(4)&&PutToDebugLog(4,"EVENT, _common: WSAPIRequest websocketNS HandleWsapiQueue SEND data: "+e),wsapisocket.send(e),wsapisocket.onmessage=function(e){var o=null;if(isNull(e)||(o=e.data),isNull(o))return void PutToDebugLog(2,"ERROR, common: WSAPIRequest.onmessage websocketNS HandleWsapiQueue, received data is NULL");ProcessServiceReqResponse(ArrayBufferToString(o),t)}}catch(i){PutToDebugLogException(2,"common: HandleWsapiQueue Timer, skip all cached requests",i),wsapi_method=[],wsapi_data=[],wsapi_cb=[]}},2)}catch(e){PutToDebugLogException(2,"common: HandleWsapiQueue",e)}}function WSAPIReqHTTP(e,o,n){try{if(isNull(wreqhttp)||wreqhttp.length<1){if(wreqhttp=GetParameter("last_good_ns_plugin_url"),isNull(wreqhttp)||wreqhttp.length<5){var t=GetNsPluginWsUrl();if(null===t||t.length<1)return void PutToDebugLog(2,"ERROR, WSAPIReqHTTP could not find a valid URL");wreqhttp=t[0],t.length>1&&UseSecureSrvConnection()&&t[0].indexOf("wss://")<0&&t[1].indexOf("wss://")>=0&&(wreqhttp=t[1])}wreqhttp=wreqhttp.toLowerCase(),wreqhttp=wreqhttp.replace("wss:","https:"),wreqhttp=wreqhttp.replace("ws:","http:"),wreqhttp=wreqhttp.replace("msstwebsock",""),PutToDebugLog(2,"EVENT, WSAPIReqHTTP url: "+wreqhttp)}PollServiceStatus(e,wreqhttp);var i="POST";"get"===e.toLowerCase()&&(i="GET"),webphone_api.$.ajax({url:wreqhttp,data:o,timeout:2500,method:i}).done(function(e,o,t){if(PutToDebugLog(2,"EVENT, common: WSAPIReqHTTP response: "+e),isNull(e))return void PutToDebugLog(2,"ERROR, common: WSAPIReqHTTP received data is NULL");ProcessServiceReqResponse(e,n)}).fail(function(e,o,n){PutToDebugLog(2,"ERROR, common: WSAPIReqHTTP ajax failed, status: "+o+"; error: "+n)})}catch(a){PutToDebugLogException(2,"common: WSAPIReqHTTP",a)}}function PollServiceStatus(e,o){try{if(!0!==webphone_api.global.useajax_forservice)return;if(!isNull(webphone_api.global.serviceStatusPollTimer))return;nspollinterval<1&&(nspollinterval=GetParameterInt("nspollinterval",300)),webphone_api.global.serviceStatusPollTimer=setInterval(function(){pollreqcount++,!0===TestNSPolling()&&PutToDebugLog(2,"EVENT, common: PollServiceStatus: send extcmd_poll; request sent count: "+pollreqcount),webphone_api.$.ajax({url:o,data:"extcmd_poll",timeout:1e3,method:e.toUpperCase()}).done(function(e,o,n){isNull(e)&&(e="");var t=e.indexOf("APIRESULT:");t>0&&(e=e.substring(t+10),e.indexOf("nomessage")<0&&(t=e.indexOf("message:"))>0&&(e=Trim(e.substring(t+8)),webphonetojs(e)))}).fail(function(e,o,n){PutToDebugLog(2,"ERROR, common: PollServiceStatus ajax failed, status: "+o+"; error: "+n)})},nspollinterval)}catch(n){PutToDebugLogException(2,"common: WSAPIReqHTTP",n)}}function ProcessServiceReqResponse(e,o){var n=0;try{var t="";if(n=11,
isNull(e)||e.length<1)return n=13,CanLog(4)&&PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(1) is null: "+e),o(null),o=null,"";if(CanLog(7)&&PutToDebugLog(7,"PROCESSING_SRVRESPONSE: "+e),e=e.replace("NORETRY",""),e.indexOf("webphone_api.")>=0&&(")"===e.charAt(e.length-1)||")"===e.charAt(e.length-2)&&";"===e.charAt(e.length-1)))return CanLog(2)&&PutToDebugLog(2,"EVENT, common: ServiceResponse exec function received form websocket: "+e),void ExecFunction(e);if(e.indexOf("OK: pending")>=0)return void(CanLog(2)&&PutToDebugLog(2,"EVENT, common: ServiceResponse received pending, waiting for answer"));if(e.indexOf("WPNOTIFICATION")>=0)return webphonetojs(e),!0;if(!(e.indexOf("APIREQUEST:")>=0))return CanLog(4)&&PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(3): "+e),n=46,void 0!==o&&null!==o&&IsFunction(o)&&o(t),o=null,t;if(CanLog(4)){var i=e;i.indexOf("ERROR: header not found")>=0&&i.replace("ERROR: header not found","EVENT: (warn) header not found"),PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(2): "+i)}n=14;var a="",r="",l="";if(e.indexOf("APIRESULT:")>0&&(n=15,getuseengine()===webphone_api.global.ENGINE_SERVICE&&(webphone_api.global.service_last_life_signal=GetTickCount()),e.indexOf("RPARAM1")>0?(a=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("RPARAM1:")),e.indexOf("RPARAM2")>0?(r=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("RPARAM2")),l=e.substring(e.indexOf("RPARAM2:")+8,e.indexOf("APIRESULT:"))):r=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("APIRESULT:")),t=e.substring(e.indexOf("APIRESULT:")+10,e.length)):(a=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("APIRESULT:")),t=e.substring(e.indexOf("APIRESULT:")+10,e.length))),n=18,isNull(a)?a="":(a=Trim(a),a=a.toLowerCase()),t=isNull(t)?"":Trim(t),n=19,50===GetConfigInt("brandid",-1)&&(isNull(r)&&(r=""),r=r.toLowerCase(),r.indexOf("ww.favafone")>0))return r.indexOf("countries-list")>0?HttpResponseHandler(t,"get_new_user_countrylist"):r.indexOf("registration-form")>0?HttpResponseHandler(t,"get_new_user_form_fields"):r.indexOf("create-account")>0&&HttpResponseHandler(t,"newuser_dynamic"),t;if(n=20,"api_poll"===a)n=21,webphonetojs(t),n=22;else{if(0!==a.indexOf("api_"))return t.indexOf("ERROR")>=0?(n=30,PutToDebugLog(2,"ERROR, "+t),n=31,o&&IsFunction(o)&&(n=32,o(t),o=null),""):"true"===t.toLowerCase()?(n=35,o(!0),o=null,!0):"false"===t.toLowerCase()?(n=36,o(!1),o=null,!1):IsNumber(t)?(n=37,o(StrToInt(t)),o=null,StrToInt(t)):t.indexOf("OK")>=0&&t.length<12?(n=40,o(!0),o=null,!0):(n=41,o(t),o=null,t);if(n=23,t.indexOf("ERROR")>=0)if(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE)t.indexOf("wphone")>0&&t.indexOf("not")>0&&t.indexOf("started")>0&&!1===webphone_api.global.wnotstartedsession&&webphone_api.global.apistartstate>0&&webphone_api.global.apistarttick>0&&GetTickCount()-webphone_api.global.apistarttick>3e3&&(webphone_api.global.wnotstartedsession=!0,PutToDebugLog(2,"WARNING, mlogic API_Sart because: wphone not started received"),WinAPI("API_Start",function(e){PutToDebugLog(2,"ERROR, API_Start because: wphone not started answer: "+e)}));else if("api_call"===a){n=24;var p=t.replace("ERROR","");p=p.replace(":",""),PutToDebugLog(1,"ERROR, "+p)}else n=25,PutToDebugLog(2,"ERROR, "+t);n=26;var s=null,c=!1;if(!isNull(srv_cb)&&srv_cb.length>0){var u=r+l;!isNull(u)&&u.length>85&&(u=u.substring(0,85));for(var g=0;g<srv_apiname.length;g++)if(srv_apiname[g]===a){!isNull(srv_params[g])&&srv_params[g].length>85&&(srv_params[g]=srv_params[g].substring(0,85));var m=srv_params[g],b=u,h=m.indexOf("\r");if(h>0&&(m=m.substring(0,h)),m=Trim(m),h=b.indexOf("\r"),h>0&&(b=b.substring(0,h)),b=Trim(b),srv_params[g]===u||!isNull(m)&&m.length>0&&m===b){srv_apiname[g],s=srv_cb[g],isNull(s)||IsFunction(s)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC ("+typeof s+") ("+srv_apiname+"): "+e),s=null),srv_apiname.splice(g,1),srv_cb.splice(g,1),srv_params.splice(g,1),c=!0;break}}if(!c)for(var g=0;g<srv_apiname.length;g++)if(srv_apiname[g]===a){!isNull(srv_params[g])&&srv_params[g].length>10&&(srv_params[g]=srv_params[g].substring(0,10)),!isNull(u)&&u.length>10&&(u=u.substring(0,10));var m=srv_params[g],b=u,h=m.indexOf("\r");if(h>0&&(m=m.substring(0,h)),m=Trim(m),h=b.indexOf("\r"),h>0&&(b=b.substring(0,h)),b=Trim(b),srv_params[g]===u||!isNull(m)&&m.length>0&&m===b||!isNull(m)&&m.length>0&&(0==m.indexOf(b)||0==b.indexOf(m))){srv_apiname[g],s=srv_cb[g],isNull(s)||IsFunction(s)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC2 ("+typeof s+") ("+srv_apiname+"): "+e),s=null),srv_apiname.splice(g,1),srv_cb.splice(g,1),srv_params.splice(g,1),c=!0;break}}if(!c)for(var g=0;g<srv_apiname.length;g++)if(srv_apiname[g]===a){!isNull(srv_params[g])&&srv_params[g].length>1&&(srv_params[g]=srv_params[g].substring(0,1)),!isNull(u)&&u.length>1&&(u=u.substring(0,1));var m=srv_params[g],b=u,h=m.indexOf("\r");if(h>0&&(m=m.substring(0,h)),m=Trim(m),h=b.indexOf("\r"),h>0&&(b=b.substring(0,h)),b=Trim(b),srv_params[g]===u||!isNull(m)&&m.length>0&&m===b){srv_apiname[g],s=srv_cb[g],isNull(s)||IsFunction(s)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC3 ("+typeof s+") ("+srv_apiname+"): "+e),s=null),srv_apiname.splice(g,1),srv_cb.splice(g,1),srv_params.splice(g,1),c=!0;break}}if(!c)for(var g=0;g<srv_apiname.length;g++)if(srv_apiname[g]===a){srv_apiname[g],s=srv_cb[g],isNull(s)||IsFunction(s)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC4 ("+typeof s+") ("+srv_apiname+"): "+e),s=null),srv_apiname.splice(g,1),srv_cb.splice(g,1),srv_params.splice(g,1),c=!0;break}}if(n=27,!isNull(s)&&IsFunction(s)){if(n=28,isNull(t)&&(n=102,t=""),n=103,t=t.toString(),n=104,"true"===t.toLowerCase())return n=105,s(!0),n=106,!0;if("false"===t.toLowerCase())return n=107,s(!1),n=108,!1;if(t.toString&&IsNumber(t.toString().replace("OK:","")))return n=109,s(StrToInt(t.toString().replace("OK:",""))),StrToInt(t.toString().replace("OK:",""));if(t.indexOf("OK")>=0&&t.length<15)return n=110,s(!0),n=111,!0;n=112;try{"function"==typeof s?(n=1120101,s(t)):PutToDebugLog(2,"WARNING, ProcessServiceResponse cb_tmp is not a functionA ("+n+") ("+srv_apiname+"): "+e)}catch(f){PutToDebugLogException(2,"common: ProcessServiceReqResponseInner ("+n.toString()+") res: "+t+", cb: "+s,f)}return n=113,t}var d="";d=isNull(s)?"NULL":s.toString(),"api_setparameters"===a||"api_setdidchange"===a||"api_httpkeepalive"===a||"api_checkconnection"===a||"api_isnewbrowserconnection"===a||"api_setachange"===a||"api_setbchange"===a?PutToDebugLog(5,"EVENT, ProcessServiceResponse cb_tmp is not a functionB1 "+a):PutToDebugLog(2,"WARNING, ProcessServiceResponse cb_tmp is not a functionB. req: "+a+", cb: "+d+", list: "+srv_apiname+", received: "+e),n=29}n=45}catch(f){if(void 0!==f&&null!==f){var _=f.toString(),w="";if("undefined"!=typeof f.message&&null!==f.message&&(w=f.message),_.toLowerCase().indexOf("is not a function")>=0||w.toLowerCase().indexOf("is not a function")>=0)return void PutToDebugLog(2,"EVENT, common: ProcessServiceReqResponse ("+n.toString()+")"+_+" "+w)}PutToDebugLogException(2,"common: ProcessServiceReqResponse ("+n.toString()+")",f)}}function WSRequest(e,o,n){var t=0;try{if(isNull(wssocket)){PutToDebugLog(2,"EVENT, WSRequest need WsConnect websocketAPI, url: "+e),t=1;var i=GetWebrtcSrvAddr();if(t=2,isNull(i)||i.length<2){if(i=GetWp(),IsLocalServer(!0))return void PutToDebugLog(2,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+" (1)")}else PutToDebugLog(2,"EVENT, WSRequest webrtcserveraddress found: "+i);if(i=i.replace("*",""),t=11,IsMizuServerOrGateway()){t=12;var a=i.indexOf("/mfst");a>0&&(i=i.substring(0,a)),i+="/mvstwebsock"}if(i=i.replace("/mfstwebsock","/mvstwebsock"),ws_inurl.push(e),ws_action.push(o),ws_ispost.push(n),HandleQueueOverload(),IsMizuPublicWebRTCGatewayUsed()&&!1===webphone_api.global.decideusuk_finished&&getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void PutToDebugLog(2,"EVENT, WSRequest decideusuk not yet finished");PutToDebugLog(2,"EVENT, WSRequest call WsConnect websocketAPI "+e+" / "+i),WSConnect(e,o,n,i),t=17}else{if(!1===wsready||ws_inurl.length>0)return ws_inurl.push(e),ws_action.push(o),ws_ispost.push(n),HandleQueueOverload(),void PutToDebugLog(2,"EVENT, webphone_api.common.WSRequest request cached for later execution "+wsready.toString()+" "+ws_inurl.length);var r=e;r=r.replace("mvapireq","mvstwebsock/mvapireq"),r=HandleApiKey(r),!isNull(r)&&r.indexOf("google.com")>0?PutToDebugLog(4,"EVENT, _common: WSRequest initialized"):PutToDebugLog(4,"EVENT, _common: WSRequest url: "+r);try{t=30,isNull(ws_action_sent)&&(ws_action_sent=[]),isNull(o)&&(o=""),ws_action_sent.push(o),void 0!==wssocket&&null!==wssocket||PutToDebugLog(2,"ERROR, _common: WSRequest wssocket is NULL 1"),webphone_api.global.wsc_reqtimeout=GetTickCount(),wssocket.send(r+"\r\n"),t=34}catch(l){PutToDebugLogWarning(3,"WARNING, common: WSRequest",l)}t=35}}catch(p){PutToDebugLogException(2,"common: WSRequest ("+t.toString()+")",p)}}function HandleQueueOverload(){try{var e=0,o=0;if(!isNull(ws_inurl)&&ws_inurl.length>0)for(;o<ws_inurl.length&&e<15;)"webrtcload"===ws_action[o]||"webrtccreateuser"===ws_action[o]?o++:(ws_inurl.splice(o,1),ws_action.splice(o,1),ws_ispost.splice(o,1),e++)}catch(n){PutToDebugLogException(2,"common: HandleQueueOverload",n)}}function WSConnect(e,o,n,t){var i=0;try{if(isNull(t)||t.length<2)PutToDebugLog(2,"ERROR, common: WSConnect websocketAPI address is NULL");else{i=2,0!==t.indexOf("ws")&&(t=BrowserRequiresHttps()?"wss://"+t:"ws://"+t);var a="";try{a=location.host.toLowerCase()}catch(l){}if(UseSecureSrvConnection()||a.indexOf("localhost")>=0||a.indexOf("127.0.0.1")>=0){var r=GetWsAddressCfg();(isNull(r)||void 0===r||r.length<4||r.indexOf("wss:")<0&&r.indexOf("ws:")<0)&&(r=GetParameter("webrtcserveraddress"),(isNull(r)||void 0===r||r.length<4||r.indexOf("wss:")<0&&r.indexOf("ws:")<0)&&"undefined"!=typeof webphone_api.parameters.origwebrtcserveraddress&&null!==webphone_api.parameters.origwebrtcserveraddress&&webphone_api.parameters.origwebrtcserveraddress.length>3&&(r=webphone_api.parameters.origwebrtcserveraddress)),!isNull(r)&&void 0!==r&&null!==r&&r.length>4&&r.indexOf("ws:")>=0||(t=t.replace("ws:","wss:"))}t=t.toString(),(t.indexOf("/mvstwebsock")>0||t.indexOf("/mfstwebsock")>0)&&t.indexOf("requestid=")<0&&(t=t.indexOf("?")>0?t+"&requestid="+GetRequestId():t+"?requestid="+GetRequestId()),PutToDebugLog(2,"EVENT, WSConnect websocketAPI address: "+t),webphone_api.global.wsc_contimeout=GetTickCount(),wsconnect_address=t,wssocket=new WebSocket(t,"api"),wssocket.binaryType="arraybuffer",i=5}wssocket.onopen=function(){webphone_api.global.wsc_contimeout=0;var e="";isNull(wssocket)||isNull(wssocket.url)||(e=wssocket.url.toString()),PutToDebugLog(2,"EVENT, common: WSConnect.onopen websocketAPI, connection ready "+e),SaveParameter("wseverconnected","true"),wsready=!0,HandleWsQueue()},wssocket.onclose=function(){var e="";isNull(wssocket)||isNull(wssocket.url)||(e=wssocket.url.toString()),PutToDebugLog(2,"EVENT, common: WSConnect.onclose websocketAPI, connection closed "+e),wssocket=null,wsready=!1},wssocket.onerror=function(e){var o="";isNull(e)||(o=e.toString());var n="";isNull(wssocket)||isNull(wssocket.url)||(n=wssocket.url.toString()),PutToDebugLog(2,"ERROR, common: WSConnect.onerror websocketAPI, connection onerror: "+o+" url: "+n),wsready=!1,wssocket=null,PutToDebugLog(2,"ERROR, common: WSConnect.onerror websocketAPI, call WSReConnect"),WSReConnect()},i=20,wssocket.onmessage=function(e){webphone_api.global.wsc_reqtimeout=0;var o=null;if(isNull(e)||(o=e.data),isNull(o))return void PutToDebugLog(2,"ERROR, common: WSConnect.onmessage websocketAPI, received data is NULL");var n="";isNull(ws_action_sent)||isNull(ws_action_sent[0])||(n=ws_action_sent.shift()),HttpResponseHandler(ArrayBufferToString(o),n)}}catch(p){PutToDebugLogException(2,"common: WSConnect websocketAPI ("+i.toString()+")",p)}}function WSReConnect(){try{if(++wsr_count<80&&null===wsr_timer){wsr_delay<32e3&&(wsr_delay*=2);return PutToDebugLog(2,"EVENT, WSReConnect websocketAPI after: "+(wsr_delay/1e3).toString()+" sec"),wsr_timer=setTimeout(function(){PutToDebugLog(2,"EVENT, WSReConnect websocketAPI reconnecting..."),WSConnect("","","",wsconnect_address),isNull(wsr_timer)||clearTimeout(wsr_timer),wsr_timer=null},wsr_delay),wsr_delay<10&&(wsr_delay=500),!0}}catch(e){PutToDebugLogException(2,"common: WSReConnect websocketAPI",e)}}function HandleWsQueue(){try{if(isNull(ws_inurl)||ws_inurl.length<1)return;if(!isNull(hawsqueue_timer))return;hawsqueue_timer=setInterval(function(){if(isNull(ws_inurl)||ws_inurl.length<1)return isNull(hawsqueue_timer)||clearInterval(hawsqueue_timer),void(hawsqueue_timer=null);if(void 0===wssocket||null===wssocket)return void PutToDebugLog(2,"WARNING, _common: WSRequest HandleWsQueue wssocket is NULL 2");var e=ws_inurl.shift(),o=ws_action.shift();ws_ispost.shift();ws_action_sent.push(o),e=HandleApiKey(e),PutToDebugLog(4,"EVENT, _common: WSRequest HandleWsQueue SEND data: "+e),webphone_api.global.wsc_reqtimeout=GetTickCount(),wssocket.send(e+"\r\n")},200)}catch(e){PutToDebugLogException(2,"common: HandleWsQueue",e)}}function HandleApiKey(e){try{if(isNull(e))return e;var o=e,n=o.indexOf("mcrfs=");if(n>0&&(o=StrDc("mcrfs_"+o.substring(n+6),webphone_api.global.ec_apikey)),!isNull(webphone_api.global.selected_apikey)&&webphone_api.global.selected_apikey.length>0){var t=o.indexOf("authkey=");if(t>0){var i=o.substring(0,t+8),a="";o=o.substring(t+8),t=o.indexOf("&"),t>0&&(a=o.substring(t+1)),e=i+webphone_api.global.selected_apikey+a}n>0&&(e=e.substring(0,n+6)+StrEc(o,webphone_api.global.ec_apikey,!0))}else{if(o.indexOf("1568108399")>0)return e;if(o.indexOf("authkey=1568108345")>0&&"us"===webphone_api.global.usuk)o=o.replace("authkey=1568108345","authkey=1552303117"),e=n>0?e.substring(0,n+6)+StrEc(o,webphone_api.global.ec_apikey,!0):o;else if(o.indexOf("authkey=1552303117")>0&&"uk"===webphone_api.global.usuk)o=o.replace("authkey=1552303117","authkey=1568108345"),e=n>0?e.substring(0,n+6)+StrEc(o,webphone_api.global.ec_apikey,!0):o;else if(!isNull(wsconnect_address)&&wsconnect_address.length>3&&webphone_api.global.usuk.length>0){var r=0;if(wsuk_ip.length<1&&(wsuk_ip=StrDc(wip_uk,alsvkey),wsuk_domain=StrDc(wips_uk,alsvkey),wsus_ip=StrDc(wip_us,alsvkey),wsus_domain=StrDc(wips_us,alsvkey),n=-1,wsuk_ip=wsuk_ip.replace("ws://",""),n=wsuk_ip.lastIndexOf("/"),n>0&&(wsuk_ip=wsuk_ip.substring(0,n)),n=wsuk_ip.lastIndexOf(":"),n>0&&(wsuk_ip=wsuk_ip.substring(0,n)),wsus_ip=wsus_ip.replace("ws://",""),n=wsus_ip.lastIndexOf("/"),n>0&&(wsus_ip=wsus_ip.substring(0,n)),n=wsus_ip.lastIndexOf(":"),n>0&&(wsus_ip=wsus_ip.substring(0,n)),wsuk_domain=wsuk_domain.replace("wss://",""),n=wsuk_domain.lastIndexOf("/"),n>0&&(wsuk_domain=wsuk_domain.substring(0,n)),n=wsuk_domain.lastIndexOf(":"),n>0&&(wsuk_domain=wsuk_domain.substring(0,n)),wsus_domain=wsus_domain.replace("wss://",""),n=wsus_domain.lastIndexOf("/"),n>0&&(wsus_domain=wsus_domain.substring(0,n)),(n=wsus_domain.lastIndexOf(":"))>0&&(wsus_domain=wsus_domain.substring(0,n))),o.indexOf("authkey=1552303117")<0&&o.indexOf("authkey=1568108345")<0&&(wsconnect_address.indexOf(wsuk_ip)>=0||wsconnect_address.indexOf(wsuk_domain)>=0?r=1:(wsconnect_address.indexOf(wsus_ip)>=0||wsconnect_address.indexOf(wsus_domain)>=0)&&(r=2),r>0)){var l="";if(n=e.indexOf("mcrfs="),n>0&&(l=e.substring(0,e.indexOf("mcrfs=")+6)),(n=o.indexOf("authkey="))>0){var p=o.substring(0,n),s="";o=o.substring(n),n=o.indexOf("&"),n<0&&(n=o.length),n>0&&(s=o.substring(n)),isNull(s)&&(s="");var c="";c=1===r?"authkey=1568108345":"authkey=1552303117",o=p+c+s,e.indexOf("mcrfs=")>0&&(o=StrEc(o,webphone_api.global.ec_apikey,!0)),e=l+o}}}}}catch(u){PutToDebugLogException(2,"common: HandleApiKey",u)}return e}function HttpAsyncHandler(e){try{if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, HttpAsyncHandler notification is NULL");e=Trim(e),webphone_api.global.currhttpmehodworking=!0;var o="",n="";if(IsMizuServerOrGateway()){var t=e.indexOf("oenc1_");t>0&&(e=e.substring(t+6),e=StrDc(e,webphone_api.global.ec_apikey))}var t=e.indexOf("REQUEST:");if(t>0&&(n=e.substring(t+8,e.length),n=Trim(n)),(t=e.indexOf("RESULT:"))>=0){var i=e.indexOf("REQUEST:");i<1&&(i=e.length),o=e.substring(t+7,i),o=Trim(o),o.lastIndexOf(",")===o.length-1&&(o=Trim(o.substring(0,o.length-1)))}if(isNull(o)||o.length<1)return void PutToDebugLog(2,"WARNING, HttpAsyncHandler response is NULL");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"WARNING, HttpAsyncHandler request is NULL");if(n.indexOf("AUTOPROVISIONING")>=0){if(isNull(o)||!(o.toLowerCase().indexOf("endofautoprovisioning")>0))return void PutToDebugLog(2,"ERROR, HttpAsyncHandler autoprovidioning error: "+o);PutToDebugLog(2,"EVENT, HttpAsyncHandler autoprovidioning succeded: "+o),ParseAutoprovisioning(o),"false"===GetParameter("serverinputisupperserver")&&RestartPhone()}n.toLowerCase().indexOf("balance")>0||n.toLowerCase().indexOf("includecurrency")>0?HttpResponseHandler(o,"creditrequest"):n.toLowerCase().indexOf("rating")>0||n.toLowerCase().indexOf("tariffs")>0?HttpResponseHandler(o,"getrating"):n.toLowerCase().indexOf("=callback")>0?HttpResponseHandler(o,"callback"):n.toLowerCase().indexOf("=wsload")>0?HttpResponseHandler(o,"webrtcload"):n.toLowerCase().indexOf("srvct")>0?HttpResponseHandler(o,"downloadcontacts"):n.toLowerCase().indexOf("lastcalldetails")>0?HttpResponseHandler(o,"lastcalldetails"):n.toLowerCase().indexOf("wrtcload_uk")>0?HttpResponseHandler(o,"wrtcload_uk"):n.toLowerCase().indexOf("wrtcload_us")>0?HttpResponseHandler(o,"wrtcload_us"):n.toLowerCase().indexOf("scurl_displaypeerdetails")>0?HttpResponseHandler(o,"scurl_displaypeerdetails"):n.toLowerCase().indexOf("getconfroom")>0?HttpResponseHandler(o,"getconferenceroom"):n.toLowerCase().indexOf("waitforparameters")>0?HttpResponseHandler(o,"waitforparameters"):n.toLowerCase().indexOf("recharge")>0?HttpResponseHandler(o,"recharge"):n.toLowerCase().indexOf("tel.search.ch")>0?HttpResponseHandler(o,"telsearchname"):n.toLowerCase().indexOf("calldivert")>0?HttpResponseHandler(o,"calldivertapi"):n.toLowerCase().indexOf("presence_set")>0?HttpResponseHandler(o,"presence_set"):(n.toLowerCase().indexOf("get_custom_menu")>0||n.toLowerCase().indexOf("logincheck")>0)&&HttpResponseHandler(o,"get_custom_menu")}catch(a){PutToDebugLogException(2,"common: HttpAsyncHandler",a)}}function HttpResponseHandler(e,o){try{if(webphone_api.global.currhttpmehodworking=!0,!isNull(e)&&e.toString().indexOf("auth failed: wrong key")>=0){var n=e.toString();n=n.substring(0,n.indexOf("wrong key")+9)}if(isNull(e))return void PutToDebugLog(3,"ERROR, common: httpResponse is NULL");var t=e.toString(),i="";i=t.length>600?t.substring(0,600)+" ...":t;var a=t.toLowerCase();if(a.indexOf("wsuser")>=0||"webrtccreateuser"===o){var r=t;if(r.indexOf("DISPLAY")>0)return r=Trim(r.replace("DISPLAY","")),PutToDebugLog(1,r),void ShowToast(r);if(a.indexOf("ok:")>=0){var l=GetParameter("wsusers"),p=GetSipusername();if(webphone_api.iswebrtcengineworking=1,webphone_api.global.last_wsu_tick=GetTickCount(),p.length>0)l.indexOf(p)<0&&(l.length>0&&","!==l.charAt(l.length-1)&&(l+=","),l+=p,SaveParameter("wsusers",l));else{a.indexOf(" ")>0&&(a=Trim(a),p=a.substring(a.lastIndexOf(" ")+1),p=Trim(p),p.length>0&&l.indexOf(p)<0&&(l.length>0&&","!==l.charAt(l.length-1)&&(l+=","),l+=p,SaveParameter("wsusers",l)))}PutToDebugLog(3,"EVENT, common wsuser response: "+i),webphone_api.global.wsuser_succeded=!0}else PutToDebugLog(3,"ERROR, common wsuser failed, response: "+i);return}if(PutToDebugLog(3,"EVENT, common: httpResponse: "+i+"; action: "+o),isNull(o)||Trim(o).length<1)return void PutToDebugLog(2,"ERROR, common: HttpResponseHandler action is NULL");if("creditrequest"===o){var s=t.toLowerCase();if(s.indexOf("error")>=0&&50!==GetConfigInt("brandid",-1)||s.indexOf("postpaid")>=0||s.indexOf("invalid")>=0||s.indexOf("not found")>=0)webphone_api.global.creditRequestIval<3e4?webphone_api.global.creditRequestIval=2*webphone_api.global.creditRequestIval:webphone_api.global.creditRequestIval=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL;else{if(50===GetConfigInt("brandid",-1)){var c=JSON.parse(t),u=c.data,g=c.error;if(!isNull(g)&&g.length>0)return void PutToDebugLog(2,"ERROR, Favafone creditrequest error: "+g);if(isNull(u))return void PutToDebugLog(3,"ERROR, Favafone creditrequest httpresponsehandler data is NULL");var m=u.balance,b=u.currency_sign;return m.length>0&&(webphone_api.global.credit="Credit: "+b+" "+m),void PutToDebugLog(4,"EVENT, Favafone received credit balance: "+webphone_api.global.credit)}t=t.replace("{",""),t=t.replace("}",""),t=ReplaceAll(t,'"',"");webphone_api.global.credit=""+t,webphone_api.global.credit.indexOf("Your credit is")>=0&&(webphone_api.global.credit=webphone_api.global.credit.replace("Your credit is","Credit:")),webphone_api.global.creditRequestIval=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL}}else if("getrating"===o){if((t.toLowerCase().indexOf("error")>=0||t.indexOf("postpaid")>=0||t.indexOf("invalid")>=0||t.indexOf("not found")>=0)&&50!==GetConfigInt("brandid",-1))return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: Call, error: "+t);var h=t;if(50===GetConfigInt("brandid",-1)){var c=JSON.parse(t),d=c.data,g=c.error;if(!isNull(g)&&g.length>0)return void PutToDebugLog(2,"ERROR, Favafone getrating error: "+g);if(isNull(d)||isNull(d[0]))return void PutToDebugLog(3,"ERROR, Favafone getrating httpresponsehandler data is NULL");var _=d[0].voice_rate,w=d[0].description,b=d.currency_sign;if(_.length<1||"null"===_.toLowerCase())return void PutToDebugLog(2,"ERROR, Favafone getrating, rating request respose2: "+t);h=b+" "+_+" / min ("+w+")"}50!==GetConfigInt("brandid",-1)&&(h+=webphone_api.stringres.get("rating_minute")),ShowRatingWhyleType(h),webphone_api.global.rating=" ("+h+webphone_api.stringres.get("rating_minute")+")"}else if("get_custom_menu"===o)ProcessCustomMenu(t);else if("waitforparameters"===o)webphone_api.plhandler.ParseReceivedParameters(t);else if("presence_set"===o)HandleOfflineMessages(t);else if("webrtcload"===o){if(t.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: webrtcload, error: "+t);var f=t.toLowerCase(),v=f.indexOf("ws load:");if(v>=0){if(f.indexOf("type:")>0){var P=f.substring(f.indexOf("type:")+5);P=Trim(P),!isNull(P)&&IsNumber(P)&&(webphone_api.global.wsload_type=StrToInt(P))}f=f.substring(v+8),f=Trim(f);var E=-1;webphone_api.iswebrtcengineworking=1;try{E=parseInt(f,10)}catch(A){PutToDebugLogException(2,"common: HttpResponseHandler parse webrtc load",A)}var T=GetEngine("webrtc");if(T.serversupport_cache=E,SetEngine("webrtc",T),webphone_api.global.recwsload=E,E>2)if(E>3){if(!1===webphone_api.global.usestorage&&!1===Strl(60)&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&!0===CanIUseService()){SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var N=GetEngine("ns");N.clicked=2,SetEngine("ns",N),EngineSelect(1,6),PutToDebugLog(2,"WARNING, common wsload: offer ns engine because webrtc load is too high: "+E.toString()),EngineForcedInstall("ns",webphone_api.stringres.get("serviceengine_msg"),function(){webphone_api.startInner()})}}else webphone_api.global.presenceinterval=244e4,getuseengine()===webphone_api.global.ENGINE_WEBRTC?(SaveParameter("enablepresence","0"),PutToDebugLog(2,"EVENT, disable presence because wsload is high: "+E.toString())):setTimeout(function(){getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(SaveParameter("enablepresence","0"),PutToDebugLog(2,"EVENT, disable presence because wsload is high: "+E.toString()))},5e3);else 2===E?webphone_api.global.presenceinterval=144e4:0===E&&(webphone_api.global.presenceinterval=36e4)}}else if("wrtcload_uk"===o||"wrtcload_us"===o){if(t.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: webrtcload, error: "+t);var f=t.toLowerCase(),v=f.indexOf("ws load:");if(v>=0){var S=0;if(f.indexOf("pmsec:")>0){var I=f.substring(f.indexOf("pmsec:")+6);I=Trim(I),!isNull(I)&&IsNumber(I)&&(S=StrToInt(I))}f=f.substring(v+8),f=Trim(f);var E=-1;try{E=parseInt(f,10)}catch(A){PutToDebugLogException(2,"common: HttpResponseHandler parse webrtc load",A)}var R=GetParameter("last_good_webrtc_gw");"wrtcload_uk"===o?(wsl_uk=E,wsl_uk_time=GetTickCount()-S,isNull(R)||"uk"!==R||(wsl_uk_time-=15),webphone_api.global.wsl_uk_rec=!0,wsloadanswersreceived=1==wsloadanswersreceived?3:2):(wsl_us=E,wsl_us_time=GetTickCount()-S,isNull(R)||"us"!==R||(wsl_us_time-=15),webphone_api.global.wsl_us_rec=!0,wsloadanswersreceived=2==wsloadanswersreceived?3:1),DecideUsUk()}}else if("recharge"===o)t.toLowerCase().indexOf("error")>=0&&PutToDebugLog(2,"ERROR, HttpResponseHandler action: recharge, error: "+t),ShowToast(t);else if("newuserreg"===o)webphone_api._newuser.HttpResponseHandler(t,o);else if("get_new_user_form_fields"===o||"newuser_dynamic"===o||"get_new_user_countrylist"===o)webphone_api._newuser.HttpResponseHandler(t,o);else if("verifysmscode"===o)webphone_api._smscodeverify.HttpResponseHandler(t,o);else if("phone2phone"===o)t.toLowerCase().indexOf("error")>=0&&PutToDebugLog(2,"ERROR, HttpResponseHandler action: phone2phone, error: "+t),ShowToast(t);else if("callback"===o){if(t.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: callback, error: "+t);isNull(t)&&(t=""),t=Trim(t),ShowToast(t)}else if("presence_verify"===o||"presence_get"===o)PresenceProcessUserlist2(Trim(t),o);else if("downloadcontacts"===o){if(t.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+o+", error: "+t);ParseContactsFromServer(t,!1,function(e){e?(PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("sync_succeded")),PutToDebugLog(1,"EVENT, POPUP, "+webphone_api.stringres.get("sync_succeded")),webphone_api.global.reloadcontactsaftersync=!0):(PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("sync_failed")),PutToDebugLog(1,"EVENT, POPUP, "+webphone_api.stringres.get("sync_failed")))})}else if("lastcalldetails"===o)webphone_api.global.lastcalldetails=t;else if("additional_info"===o){if(t.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+o+", error: "+t);var G=t;G=ReplaceAll(G,"\r\n","<br>"),G=ReplaceAll(G,"\n","<br>"),isNull(document.getElementById("page_call_additional_info"))||(PutToDebugLog(4,"EVENT, HttpResponseHandler Display additional call info: "+G),document.getElementById("page_call_additional_info").innerHTML=G)}else if("scurl_displaypeerdetails"===o){if(t.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+o+", error: "+t);DisplayPeerDetails(t)}else if("getconferenceroom"===o)ConferenceRoomReceived(t);else if("webcontactsearch"===o)WebContactReceived(t);else if("telsearchname"===o)TelSearchNameReceived(t);else if("calldivertapi"===o){var O=t.toLowerCase();if(O.indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+o+", error: "+t);if(O.indexOf("ok")>=0){SaveParameter("calldivertsuccess","1");var L=GetParameter2("callforwardonbusy"),C=GetParameter2("callforwardonnoanswer"),D=GetParameter2("callforwardalways"),y=GetParameter2("callforwardonnoanswertimeout"),x=Md5Hash(L+C+D+y);SaveParameter("calldivertchecksum",x)}}else if("get_custom_menu"===o){var O=t.toLowerCase();if(O.indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+o+", error: "+t);ProcessCustomMenu(t)}}catch(k){PutToDebugLogException(2,"common: HttpResponseHandler",k)}}function WinAPI(e,o,n,t,i,a,r,l,p,s,c){var u="BOFLINE",g="EOFLINE";try{if(o&&"function"==typeof o||(o=function(e){isNull(e)||(e=e.toString(),e.indexOf("OK:")>=0&&e.indexOf("wphone")>0&&e.indexOf("started")>0&&setTimeout(function(){webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2)},2e3)),PutToDebugLog(2,"EVENT, common: WinAPI NO callback specified; result: "+e)}),isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: WinAPI: apiname is NULL"),o(!1),!1;var m="BOFCOMMAND";m=m+u+"function="+e+g,!isNull(n)&&n.toString().length>0&&(n=Trim(n),m=m+u+"param1="+n+g),!isNull(t)&&t.toString().length>0&&(t=Trim(t),m=m+u+"param2="+t+g),!isNull(i)&&i.toString().length>0&&(i=Trim(i),m=m+u+"param3="+i+g),!isNull(a)&&a.toString().length>0&&(a=Trim(a),m=m+u+"param4="+a+g),!isNull(r)&&r.toString().length>0&&(r=Trim(r),m=m+u+"param5="+r+g),!isNull(l)&&l.toString().length>0&&(l=Trim(l),m=m+u+"param6="+l+g),!isNull(p)&&p.toString().length>0&&(p=Trim(p),m=m+u+"param7="+p+g),!isNull(s)&&s.toString().length>0&&(s=Trim(s),m=m+u+"param8="+s+g),!isNull(c)&&c.toString().length>0&&(c=Trim(c),m=m+u+"param9="+c+g),m=m+u+"requestid="+GetRequestId()+g,m+="EOFCOMMAND";var b="";webphone_api.global.httpkatimer=GetTickCount(),IsWindowsSoftphone()?(b=AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+b,CanLog(7)&&PutToDebugLog(7,"EVENT, WinAPI windows url: "+b),WinSoftphoneHttpReq(b,"POST","data="+m,e,function(e){return o(e),e})):getuseengine()===webphone_api.global.ENGINE_SERVICE||!0===webphone_api.global.onunload_flag?WSAPIRequest("POST","data="+m,e,function(e){return o(e),e}):PutToDebugLog(2,"ERROR, common: winapi invalid engine/device: "+getuseengine()+"; apiname: "+e+"; data="+m)}catch(h){PutToDebugLogException(2,"common: WinAPI",h)}return!1}function WinSoftphoneHttpReq(e,o,n,t,i){var a=0;try{var r="";if(isNull(n)||(r=n.length>300?n.substring(0,300)+"....":n),CanLog(5)&&PutToDebugLog(5,"EVENT, WinSoftphoneHttpReq called "+o+" url: "+e+"; data: "+r),(isNull(o)||o.length<1)&&(a=1,PutToDebugLog(2,"WARNING, common: WinSoftphoneHttpReq: method not specified; fallback to GET"),o="GET"),a=2,isNull(n))return a=3,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: data is NULL "),cbexecuted=!0,i(null),"";a=4,n.indexOf("API_CallEOFLINE"),a=5,setTimeout(function(){if(a=6,!isNull(i)&&i&&"function"==typeof i)return a=7,PutToDebugLog(3,"EVENT, common: WinSoftphoneHttpReq: manual Timeout"),i(null),i=null,""},reqtimeout+1e3);var l=!1;if(!isNull(t)&&t.length>0&&!isNull(i)&&"function"==typeof i&&(t=Trim(t),0===t.indexOf("API_")&&"API_Poll"!==t&&"API_Stop"!==t&&t.indexOf("extcmd_")<0)){srv_cb.push(i),srv_apiname.push(t.toLowerCase()),l=!0;var p="";if(!isNull(n)&&n.indexOf("param1=")>0){var s=ReplaceAll(n,"BOFLINE","");s=ReplaceAll(s,"EOFLINE","");var c=s.substring(s.indexOf("param1=")+7),u="";c.indexOf("param2=")>=0?(u=c.substring(c.indexOf("param2=")+7),u=u.indexOf("param3=")>=0?u.substring(0,u.indexOf("param3=")):u.substring(0,u.indexOf("EOFCOMMAND")),u=Trim(u),c=c.substring(0,c.indexOf("param2=")),c=Trim(c)):(c=c.substring(0,c.indexOf("EOFCOMMAND")),c=Trim(c)),p=c+u}var g=p;g.indexOf("requestid=")>=0&&(g=g.replace("requestid=","")),srv_params.push(g)}var m;window.XMLHttpRequest?(a=8,m=new XMLHttpRequest):(a=9,m=new ActiveXObject("Microsoft.XMLHTTP")),"get"===o.toLowerCase()?(a=10,m.open("GET",e+n,!0)):(m.open("POST",e,!0),a=11),m.onreadystatechange=function(){try{if(CanLog(7)&&PutToDebugLog(7,"EVENT, WinSoftphoneHttpReq: xmlhttp.readyState: "+m.readyState+";  xmlhttp.status: "+m.status),a=19,4==m.readyState&&200==m.status){if(!1===webphone_api.global.httpheaderslogged&&m.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;var e=m.getAllResponseHeaders();CanLog(5)&&PutToDebugLog(5,"EVENT, HTTP request answer headers 2: "+e)}var o=m.responseText,n="";n=!isNull(o)&&o.length>250?o.substring(0,250)+"....":o,isNull(n)&&(n="NULL"),a=20,CanLog(5)&&PutToDebugLog(5,"EVENT, WinSoftphoneHttpReq response ("+o.length.toString()+"): "+n),cbexecuted=!0;var t="";if(a=21,isNull(o)||o.length<1)return a=23,isNull(i)?PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__1"):i(null),i=null,"";if(l&&0==o.indexOf("OK: pending"));else{if(!(o.indexOf("APIREQUEST:")>=0))return a=42,
isNull(i)?PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__3"):i(t),i=null,t;a=24;var r="",p="";if(o.indexOf("APIRESULT:")>0&&(a=25,o.indexOf("RPARAM1")>0?(r=o.substring(o.indexOf("APIREQUEST:")+11,o.indexOf("RPARAM1:")),o.indexOf("RPARAM2")>0?(p=o.substring(o.indexOf("RPARAM1:")+8,o.indexOf("RPARAM2")),o.substring(o.indexOf("RPARAM2:")+8,o.indexOf("APIRESULT:"))):p=o.substring(o.indexOf("RPARAM1:")+8,o.indexOf("APIRESULT:")),t=o.substring(o.indexOf("APIRESULT:")+10,o.length)):(r=o.substring(o.indexOf("APIREQUEST:")+11,o.indexOf("APIRESULT:")),t=o.substring(o.indexOf("APIRESULT:")+10,o.length))),a=28,isNull(r)?r="":(r=Trim(r),r=r.toLowerCase()),t=isNull(t)?"":Trim(t),a=29,50===GetConfigInt("brandid",-1)&&(isNull(p)&&(p=""),p=p.toLowerCase(),p.indexOf("ww.favafone")>0))return p.indexOf("countries-list")>0?HttpResponseHandler(t,"get_new_user_countrylist"):p.indexOf("registration-form")>0?HttpResponseHandler(t,"get_new_user_form_fields"):p.indexOf("create-account")>0&&HttpResponseHandler(t,"newuser_dynamic"),t;if(isNull(i)&&PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__2"),a=30,"api_poll"!==r){if(t.indexOf("ERROR")>=0){if(a=33,"api_call"===r){var s=t.replace("ERROR","");s=s.replace(":",""),PutToDebugLog(1,"ERROR, "+s)}else PutToDebugLog(2,"ERROR, "+t);return a=34,isNull(i)||i(null),i=null,""}return"true"===t.toLowerCase()?(isNull(i)||i(!0),i=null,!0):"false"===t.toLowerCase()?(isNull(i)||i(!1),i=null,!1):IsNumber(t)?(isNull(i)||i(StrToInt(t)),i=null,StrToInt(t)):t.indexOf("OK")>=0&&t.length<12?(a=37,isNull(i)||i(!0),i=null,!0):(a=3888,isNull(i)||i(t),i=null,t)}a=31,webphonetojs(t),a=32,a=40}a=48}}catch(c){PutToDebugLogException(2,"common: WinSoftphoneHttpReq inner_1 ("+a+")",c)}},m.timeout=reqtimeout,m.ontimeout=function(e){if(!isNull(i)&&i&&"function"==typeof i)return a=49,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: Timeout"),cbexecuted=!0,i(null),i=null,""},"get"===o.toLowerCase()?(n.length>0&&(n="?"+n),a=50,m.send()):(a=51,50===GetConfigInt("brandid",-1)&&PutToDebugLog(2,"EVENT, WinSoftphoneHttpReq SEND post request with data: "+n),m.send(n))}catch(b){PutToDebugLogException(2,"common: WinSoftphoneHttpReq ("+a+")",b)}}function GetNotifications2(){try{if(!0===nread)return;nread=!0;var e=GetParameter("notifications2");if(webphone_api.global.notifs=[],isNull(e)||e.length<10)return;var o=e.split(not_linesep);if(isNull(o)||o.length<1)return;for(var n=0;n<o.length;n++)if(!(isNull(o[n])||o[n].length<1||o[n].indexOf(",")<0)){var t=o[n].split(not_sep);isNull(t)||t.length<4||webphone_api.global.notifs.push(t)}}catch(i){PutToDebugLogException(2,"common: GetNotifications2",i)}}function SaveNotifications2(){var e="";try{if(!isNull(webphone_api.global.notifs)&&webphone_api.global.notifs.length>0)for(var o=0;o<webphone_api.global.notifs.length;o++)if(!(isNull(webphone_api.global.notifs[o])||webphone_api.global.notifs[o].length<1)){var n=webphone_api.global.notifs[o];isNull(n)||n.length<4||(e.length>0&&(e+=not_linesep),e=e+n[0]+not_sep+n[1]+not_sep+n[2]+not_sep+n[3])}SaveParameter("notifications2",e)}catch(t){PutToDebugLogException(2,"common: SaveNotifications2",t)}}function PutNotifications2(e,o,n,t){try{if(GetParameterInt("displaynotification",0)<1)return;if(isNull(e)||!IsNumber(e))return void PutToDebugLog(4,"ERROR, common: PutNotifications2 invalid type");GetNotifications2(),isNull(o)&&(o=""),isNull(n)&&(n=""),(isNull(t)||!IsNumber(t)||t<1e3)&&(t=GetTickCount());var i=[];i[0]=e,i[1]=o,i[2]=n,i[3]=t.toString(),webphone_api.global.notifs.unshift(i),SaveNotifications2(),ShowNotifications2();var a=GetParameterInt("notification_count2",0);a<0&&(a=0),a++,SaveParameter("notification_count2",a)}catch(r){PutToDebugLogException(2,"common: PutNotifications2",r)}}function GetDateForNotifications(e){try{if(isNull(e)||!IsNumber(e)||e<1)return"";var o=new Date(e),n=o.getMinutes();n<10&&(n="0"+n);var t=o.getDate();t<10&&(t="0"+t);return month[o.getMonth()]+", "+t+" "+o.getHours()+":"+n}catch(i){PutToDebugLogException(2,"common: GetDateForNotifications",i)}return""}function ShowNotifications2(){try{if(GetNotifications2(),isNull(webphone_api.global.notifs)||webphone_api.global.notifs.length<1)return void HideNotificationsElements();for(var e="",o="",n="",t="",i='<li class="mlistitem"><a id="[PAGE]_notitem_[NOTID]" class="nt_anchor"><div class="nt_title">[TITLE]</div><div class="nt_desc">[DESC]</div><div class="nt_date">[DATE]</div></a><a id="[PAGE]_notmenu_[NOTID]" class="ui-btn ui-btn-inline ui-icon-delete nt_menu">'+webphone_api.stringres.get("hint_notif_clear")+"</a></li>",a=0;a<webphone_api.global.notifs.length;a++)if(!(isNull(webphone_api.global.notifs[a])||webphone_api.global.notifs[a].length<1)){var r=webphone_api.global.notifs[a],l=i;"0"===r[0]?(l=l.replace("[TITLE]",webphone_api.stringres.get("not_missed_call")+":"),l=l.replace("[DESC]",r[2])):"1"===r[0]&&(l=l.replace("[TITLE]",webphone_api.stringres.get("not_missed_chat")+":"),l=l.replace("[DESC]",r[2]));var p=StrToInt(r[3]);isNull(p)&&(p=0);var s=GetDateForNotifications(p);l=l.replace("[DATE]",s),l=ReplaceAll(l,"[NOTID]",a.toString()),e+=ReplaceAll(l,"[PAGE]","dialpad"),o+=ReplaceAll(l,"[PAGE]","contactslist"),n+=ReplaceAll(l,"[PAGE]","callhistorylist"),t+=ReplaceAll(l,"[PAGE]","message")}var c=GetParameterInt("notification_count2",0);e.length>0?(webphone_api.$(".not_panel_title").html(webphone_api.stringres.get("not_panel_title")),webphone_api.$(".not_close_btn").html(webphone_api.stringres.get("btn_close")),webphone_api.$("#dialpad_notification_list").html(""),webphone_api.$("#dialpad_notification_list").hasClass("ui-listview")&&webphone_api.$("#dialpad_notification_list").append(e).listview("refresh"),c>0?(webphone_api.$("#dialpad_not_counter").html(c),webphone_api.$("#dialpad_not_counter").show()):(webphone_api.$("#dialpad_not_counter").html(""),webphone_api.$("#dialpad_not_counter").hide()),webphone_api.$("#dialpad_not_btn").show(),webphone_api.$("#contactslist_notification_list").html(""),webphone_api.$("#contactslist_notification_list").hasClass("ui-listview")&&webphone_api.$("#contactslist_notification_list").append(o).listview("refresh"),c>0?(webphone_api.$("#contactslist_not_counter").html(c),webphone_api.$("#contactslist_not_counter").show()):(webphone_api.$("#contactslist_not_counter").html(""),webphone_api.$("#contactslist_not_counter").hide()),webphone_api.$("#contactslist_not_btn").show(),webphone_api.$("#callhistorylist_notification_list").html(""),webphone_api.$("#callhistorylist_notification_list").hasClass("ui-listview")&&webphone_api.$("#callhistorylist_notification_list").append(n).listview("refresh"),c>0?(webphone_api.$("#callhistorylist_not_counter").html(c),webphone_api.$("#callhistorylist_not_counter").show()):(webphone_api.$("#callhistorylist_not_counter").html(""),webphone_api.$("#callhistorylist_not_counter").hide()),webphone_api.$("#callhistorylist_not_btn").show(),webphone_api.$("#messagelist_notification_list").html(""),webphone_api.$("#messagelist_notification_list").hasClass("ui-listview")&&webphone_api.$("#messagelist_notification_list").append(t).listview("refresh"),c>0?(webphone_api.$("#messagelist_not_counter").html(c),webphone_api.$("#messagelist_not_counter").show()):(webphone_api.$("#messagelist_not_counter").html(""),webphone_api.$("#messagelist_not_counter").hide()),webphone_api.$("#messagelist_not_btn").show()):HideNotificationsElements()}catch(u){PutToDebugLogException(2,"common: ShowNotifications2",u)}}function HideNotificationsElements(){webphone_api.$("#dialpad_notification_list").html(""),webphone_api.$("#dialpad_not_counter").html(""),webphone_api.$("#dialpad_not_counter").hide(),webphone_api.$("#dialpad_not_btn").hide(),webphone_api.$("#contactslist_notification_list").html(""),webphone_api.$("#contactslist_not_counter").html(""),webphone_api.$("#contactslist_not_counter").hide(),webphone_api.$("#contactslist_not_btn").hide(),webphone_api.$("#callhistorylist_notification_list").html(""),webphone_api.$("#callhistorylist_not_counter").html(""),webphone_api.$("#callhistorylist_not_counter").hide(),webphone_api.$("#callhistorylist_not_btn").hide(),webphone_api.$("#messagelist_notification_list").html(""),webphone_api.$("#messagelist_not_counter").html(""),webphone_api.$("#messagelist_not_counter").hide(),webphone_api.$("#messagelist_not_btn").hide()}function HideCallNotifications2(){try{if(!isNull(webphone_api.global.notifs)||webphone_api.global.notifs.length>0){for(var e=0;e<webphone_api.global.notifs.length&&webphone_api.global.notifs.length>0;){var o=webphone_api.global.notifs[e];!isNull(o)&&o.length>0&&"0"===o[0]?webphone_api.global.notifs.splice(e,1):e++}SaveNotifications2()}ShowNotifications2()}catch(n){PutToDebugLogException(2,"common: HideCallNotifications2",n)}}function HideMessageNotifications2(){try{if(!isNull(webphone_api.global.notifs)||webphone_api.global.notifs.length>0){for(var e=0;e<webphone_api.global.notifs.length&&webphone_api.global.notifs.length>0;){var o=webphone_api.global.notifs[e];!isNull(o)&&o.length>0&&"1"===o[0]?webphone_api.global.notifs.splice(e,1):e++}SaveNotifications2()}ShowNotifications2()}catch(n){PutToDebugLogException(2,"common: HideMessageNotifications2",n)}}function NotificationOnClick2(e,o){try{if(isNull(e)||e.indexOf("notitem_")<0&&e.indexOf("notmenu_")<0)return void PutToDebugLog(4,"ERROR, common: NotificationOnClick2 invalid id: "+e);if(o){if(e=e.substring(e.indexOf("notmenu_")+8),isNull(e)||!IsNumber(e))return;var n=StrToInt(e);if(n>=0&&n<webphone_api.global.notifs.length)return webphone_api.global.notifs.splice(n,1),void ShowNotifications2()}else{if(e=e.substring(e.indexOf("notitem_")+8),isNull(e)||!IsNumber(e))return;var n=StrToInt(e);if(n>=0&&n<webphone_api.global.notifs.length){var t=webphone_api.global.notifs[n],i=t[0];"0"===i?webphone_api.$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"}):"1"===i&&webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})}}}catch(a){PutToDebugLogException(2,"common: NotificationOnClick2",a)}}function PutNotifications(e,o,n){try{if(GetParameterInt("displaynotification",0)<1)return;if(isNull(n)&&(n=!0),isNull(o))return void PutToDebugLog(2,"ERROR, common: PutNotifications number is NULL");var t=GetParameter("call_notifications"),i=GetParameter("message_notifications");if(t=isNull(t)?"":Trim(t),i=isNull(i)?"":Trim(i),n)if(t.length>2)if(IsNumber(t.charAt(0))){var a=StrToInt(t.charAt(0));t=t.replace(a.toString(),(a+1).toString())}else t="2 "+webphone_api.stringres.get("calls");else t=webphone_api.stringres.get("call_from")+": "+e+", "+o;else if(i.length>2)if(IsNumber(i.charAt(0))){var a=StrToInt(i.charAt(0));i=i.replace(a.toString(),(a+1).toString())}else i="2 "+webphone_api.stringres.get("messages");else i=webphone_api.stringres.get("message_from")+": "+e+", "+o;SaveParameter("call_notifications",t),SaveParameter("message_notifications",i),ShowNotifications()}catch(r){PutToDebugLogException(2,"common: PutNotifications",r)}}function ShowNotifications(){try{var e=GetParameter("call_notifications"),o=GetParameter("message_notifications"),n="";!isNull(e)&&e.length>2&&(n=e+"<br>"),n+=o,PutToDebugLog(2,"EVENT, ShowNotifications: "+n),webphone_api.$("#dialpad_notification").html(n),webphone_api.$("#contactslist_notification").html(n),webphone_api.$("#callhistorylist_notification").html(n),webphone_api.$("#messagelist_notification").html(n),!isNull(n)&&n.length>2?(webphone_api.$("#msglist_title").hide(),webphone_api.$("#messagelist_notification").show(),webphone_api.$("#ctlist_title").hide(),webphone_api.$("#contactslist_notification").show(),webphone_api.$("#chlist_title").hide(),webphone_api.$("#callhistorylist_notification").show(),webphone_api.$("#dialpad_title").hide(),webphone_api.$("#dialpad_notification").show()):(webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide())}catch(t){PutToDebugLogException(2,"common: ShowNotifications",t)}}function HideCallNotifications(){try{SaveParameter("call_notifications","");var e=GetParameter("message_notifications");webphone_api.$("#dialpad_notification").html(e),webphone_api.$("#contactslist_notification").html(e),webphone_api.$("#callhistorylist_notification").html(e),webphone_api.$("#messagelist_notification").html(e),!isNull(e)&&e.length>2?(webphone_api.$("#msglist_title").hide(),webphone_api.$("#messagelist_notification").show(),webphone_api.$("#ctlist_title").hide(),webphone_api.$("#contactslist_notification").show(),webphone_api.$("#chlist_title").hide(),webphone_api.$("#callhistorylist_notification").show(),webphone_api.$("#dialpad_title").hide(),webphone_api.$("#dialpad_notification").show()):(webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide())}catch(o){PutToDebugLogException(2,"common: HideCallNotifications",o)}}function HideMessageNotifications(){try{SaveParameter("message_notifications","");var e=GetParameter("call_notifications");webphone_api.$("#dialpad_notification").html(e),webphone_api.$("#contactslist_notification").html(e),webphone_api.$("#callhistorylist_notification").html(e),webphone_api.$("#messagelist_notification").html(e),!isNull(e)&&e.length>2?(webphone_api.$("#msglist_title").hide(),webphone_api.$("#messagelist_notification").show(),webphone_api.$("#ctlist_title").hide(),webphone_api.$("#contactslist_notification").show(),webphone_api.$("#chlist_title").hide(),webphone_api.$("#callhistorylist_notification").show(),webphone_api.$("#dialpad_title").hide(),webphone_api.$("#dialpad_notification").show()):(webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide())}catch(o){PutToDebugLogException(2,"common: HideMessageNotifications",o)}}function HideAllNotifications(){try{SaveParameter("call_notifications",""),SaveParameter("message_notifications",""),webphone_api.$("#dialpad_notification").html(""),webphone_api.$("#contactslist_notification").html(""),webphone_api.$("#callhistorylist_notification").html(""),webphone_api.$("#messagelist_notification").html(""),webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide()}catch(e){PutToDebugLogException(2,"common: HideAllNotifications",e)}}function NotificationOnClick(e){try{var o=GetParameter("call_notifications"),n=GetParameter("message_notifications");if(isNull(o)&&(o=""),isNull(n)&&(n=""),o.length<2&&n.length<2)return;if(o.length>2&&n.length<2)webphone_api.$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"});else if(o.length<2&&n.length>2)webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"});else{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120);var i="",a='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',r="";r=a.replace("[ITEMID]","#item_call_history"),r=r.replace("[ITEMTITLE]",webphone_api.stringres.get("callhistory")),i+=r,r="",r=a.replace("[ITEMID]","#item_message_history"),r=r.replace("[ITEMTITLE]",webphone_api.stringres.get("messagehistory")),i+=r,r="";var l='<div id="notification_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("goto")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="notifications_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+i+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";e=e||function(){},webphone_api.$.mobile.activePage.append(l).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#notifications_ul").off("click","li"),e()}}),webphone_api.$("#notifications_ul").on("click","li",function(e){var o=webphone_api.$(this).attr("id");webphone_api.$("#notification_popup").on("popupafterclose",function(e){webphone_api.$("#notification_popup").off("popupafterclose"),"#item_call_history"===o?webphone_api.$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"}):"#item_message_history"===o&&webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})})})}}catch(p){PutToDebugLogException(2,"common: NotificationOnClick",p)}}function RestartPhone(){try{OpenSettings(!0,2),webphone_api.global.flagWaitforautoprov=!1,!1===IsSDK()&&webphone_api.$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"}),webphone_api.startInner()}catch(e){PutToDebugLogException(2,"common: RestartPhone",e)}}function ApiWinSaveFile(e,o,n){try{if(!n||"function"!=typeof n)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile: filename is NULL"),n(!1),!1;if(isNull(o))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile: content is NULL"),n(!1),!1;o="BOFFILE"+o+"EOFFILE",e=Trim(e);WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_savedata="+e,"POST","data="+o,"",function(e){return n(e),e})}catch(t){PutToDebugLogException(2,"common: ApiWinSaveFile",t)}}function ApiWinLoadFile(e,o){try{if(!o||"function"!=typeof o)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFile: filename is NULL"),o(null),!1;e=Trim(e);WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_loaddata="+e,"GET","","",function(e){return isNull(e)||(e=StrDc(e,webphone_api.global.ec_apikey)),o(e),e})}catch(n){PutToDebugLogException(2,"common: ApiWinLoadFile",n)}}function ApiWinSaveFileNew(e,o,n,t){try{if(!n||"function"!=typeof n)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew callback not defined"),!1;var i=document.getElementById("EXTERNREQUESTELEM");if(isNull(i))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: html element: EXTERNREQUESTELEM is NULL"),n(!1),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: filename is NULL"),n(!1),!1;if(isNull(o))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: content is NULL"),n(!1),!1;o="BOFFILE"+o+"EOFFILEEOFCOMMAND",e=Trim(e);var a="";a=!isNull(t)&&t.length>0?t:"extcmd_savedata="+e,webphone_api.global.bwanswerINCNUMBER++,a=a+"&now="+webphone_api.global.bwanswerINCNUMBER.toString()+"\r\n",PutToDebugLog(2,"EVENT, common: ApiWinSaveFileNew cmd: "+a);var r=a+encodeURIComponent(o);return PutToDebugLog(2,"EVENT, common: ApiWinSaveFileNew encoded: "+r),i.innerHTML=r,n(!0),!0}catch(l){PutToDebugLogException(2,"common: ApiWinSaveFileNew",l)}}function bwanswer(e){try{if(PutToDebugLog(2,"ERROR, bwanswer called; answer: "+e),webphone_api.global.bwanswercallback&&"function"==typeof webphone_api.global.bwanswercallback)if(isNull(e)||e.length<1||e.indexOf("ERROR")>=0)webphone_api.global.bwanswercallback(null),webphone_api.global.bwanswercallback=null;else if(e.length>100||tempfile.length>10){if(tempfile=tempfile=e,tempfile.indexOf("EOFFILE")){var o=decodeURIComponent(tempfile);webphone_api.global.bwanswercallback(o),webphone_api.global.bwanswercallback=null}}else{var o=decodeURIComponent(e);webphone_api.global.bwanswercallback(o),webphone_api.global.bwanswercallback=null}else PutToDebugLog(2,"ERROR, bwanswer: bwanswercallback is NULL")}catch(n){PutToDebugLogException(2,"common: bwanswer",n)}}function ApiWinLoadFileNew(e,o){try{if(!o||"function"!=typeof o)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew callback not defined"),!1;var n=document.getElementById("EXTERNREQUESTELEM");if(isNull(n))return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew: html element: EXTERNREQUESTELEM is NULL"),o(!1),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew: filename is NULL"),o(null),!1;e=Trim(e),webphone_api.global.bwanswerINCNUMBER++;var t="extcmd_loaddata="+e+"&now="+webphone_api.global.bwanswerINCNUMBER.toString()+"\r\n";PutToDebugLog(2,"EVENT, common: ApiWinLoadFileNew cmd: "+t+"EOFCOMMAND"),webphone_api.global.bwanswercallback=o,n.innerHTML=t+"EOFCOMMAND",PutToDebugLog(2,"EVENT, common: ApiWinLoadFileNew  element.innerHTML: "+n.innerHTML)}catch(i){PutToDebugLogException(2,"common: ApiWinLoadFileNew",i)}}function Exit(){WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_exit=true","GET","","",function(e){PutToDebugLog(2,"EVENT, common: Exit response: "+e)})}function CallNumberProtocolHandler(e,o){try{if(isNull(e)||e.length<2||e.length>10)return void PutToDebugLog(2,"ERROR, CallNumberProtocolHandler invalid protocol: "+e);if(isNull(o)||o.length<1)return void PutToDebugLog(2,"ERROR, CallNumberProtocolHandler invalid number: "+o);var n=e+"://"+encodeURIComponent(o),t='<a href="'+n+'" id="make_native_call" style="display: none;">call</a>';webphone_api.$("body").append(t),webphone_api.$("#make_native_call").on("click",function(){var e=webphone_api.$("#make_native_call").attr("href");webphone_api.$("#make_native_call").remove(),window.location=e}),webphone_api.$("#make_native_call").click(),ShowToast(webphone_api.stringres.get("native_call"))}catch(i){PutToDebugLogException(2,"common: CallNumberProtocolHandler",i)}}function EnterKeyPress(){try{return"page_dialpad"===webphone_api.$.mobile.activePage.attr("id")?webphone_api.$("#btn_call").click():"page_settings"===webphone_api.$.mobile.activePage.attr("id")&&webphone_api.$("#adialog_positive").click(),!0}catch(e){PutToDebugLogException(2,"common: EnterKeyPress",e)}return!1}function GetNrOfAcc(){try{if(!isNull(webphone_api.global.sipaccounts))return webphone_api.global.sipaccounts.length}catch(e){PutToDebugLogException(2,"common: GetNrOfAcc",e)}return 1}function SaveAccountsFile(e){try{if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveAccountsFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveAccountsFile callback not defined");var o=GetAccountsFilename();if(isNull(webphone_api.global.aclist))return PutToDebugLog(2,"EVENT, SaveAccountsFile no accounts to be saved"),e(!1),!1;if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, SaveAccountsFile File handling module not loaded yet"),e(!1),!1;for(var n="",t=null,i=0;i<webphone_api.global.aclist.length;i++)t=webphone_api.global.aclist[i],isNull(t)||(n.length>2&&(n+="\r\n"),n=n+t[AC_NAME]+","+t[AC_SIPUSERNAME]+","+t[AC_SETTFILE]+","+t[AC_CHFILE]+","+t[AC_ISACTIVE]);PutToDebugLog(2,"EVENT, acfile = "+n),IsWindowsSoftphone()&&(ApiWinSaveFile(o,n,function(o){e(!0)}),webphone_api.File.SaveFile(o,n,webphone_api.global.STORAGE_COOKIE,function(e){PutToDebugLog(2,"EVENT, SaveAccountsFile saved in cookie")})),webphone_api.File.SaveFile(o,n,webphone_api.global.STORAGE_LOCAL,function(o){e(o)})}catch(a){PutToDebugLogException(2,"common: SaveAccountsFile",a)}}function ReadAccountsFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadAccountsFile callback not defined");var o=GetAccountsFilename();if(isNull(webphone_api.File))return PutToDebugLog(2,"ERROR, ReadAccountsFile File handling module not loaded yet"),e(!1),!1;IsWindowsSoftphone()?ApiWinLoadFile(o,function(n){isNull(n)||Trim(n).length<1?(PutToDebugLog(2,"WARNING, common: ReadAccountsFile no content WinApi"),webphone_api.File.ReadFile(o,webphone_api.global.STORAGE_COOKIE,function(o){if(isNull(o)||Trim(o).length<1){var n=[],t="Account"+GetSipusername(),i=Md5Hash(t+GetParameter("serveraddress_user")+GetSipusername()+webphone_api.global.SALT+GetParameter("password")+GetLocationPathName());n[AC_NAME]=t,n[AC_SIPUSERNAME]=GetSipusername(),n[AC_SETTFILE]=i,n[AC_CHFILE]=i+"_ch",n[AC_ISACTIVE]="true",(isNull(n)||n.length<2||n.indexOf(",")<0||n.indexOf("true")<0&&n.indexOf("false")<0)&&PutToDebugLog(2,"WARNING, trying to save invalid acc : "+n),webphone_api.global.aclist.push(n),PutToDebugLog(3,"EEVENT, common ReadAccountsFile(2) save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ReadAccountsFile(2) saved successfully"):PutToDebugLog(3,"EVENT, common ReadAccountsFile(2) failed to saved")}),o=t+","+GetSipusername()+","+i+","+i+"_ch,true"}ParseAccountsReadFromFile(o,e)})):ParseAccountsReadFromFile(n,e)}):webphone_api.File.ReadFile(o,webphone_api.global.STORAGE_LOCAL,function(o){if(isNull(o)||Trim(o).length<1){var n=[],t=GetSipusername(),i="Account"+t,a=Md5Hash(i+GetParameter("serveraddress_user")+t+webphone_api.global.SALT+GetParameter("password")+GetLocationPathName());n[AC_NAME]=i,n[AC_SIPUSERNAME]=t,n[AC_SETTFILE]=a,n[AC_CHFILE]=a+"_ch",n[AC_ISACTIVE]="true",webphone_api.global.aclist.push(n),PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) saved successfully"):PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) failed to saved")}),o=i+","+t+","+a+","+a+"_ch,true"}ParseAccountsReadFromFile(o,e)})}catch(n){PutToDebugLogException(2,"common: ReadAccountsFile",n)}}function ParseAccountsReadFromFile(e,o){try{var n=e.split("\r\n");if(isNull(n)||n.length<1)return PutToDebugLog(2,"ERROR, common: ParseAccountsReadFromFile empty content"),o(!1),!1;if(!isNull(webphone_api.global.aclist))for(var t in webphone_api.global.aclist)delete webphone_api.global.aclist[t];for(var i=1,a=0;a<n.length;a++)if(isNull(n[a])||n[a].length<2||n[a].indexOf(",")<0||n[a].indexOf("true")<0&&n[a].indexOf("false")<0)i=2,PutToDebugLog(2,"WARNING, common ParseAccountsReadFromFile broken or invalid account (1) ("+GetAccountsFilename()+":"+parseInt(a,10)+"): "+n[a]);else{if(i=i<2?0:1){for(var r=!0,l=n[a],p=0;p<l.length;p++)if(l[p].charCodeAt(0)<32||l[p].charCodeAt(0)>122){r=!1;break}if(!r)continue;PutToDebugLog(2,"EVENT, broken account file but allowing ("+parseInt(a,10)+"): "+l)}var s=n[a].split(",");webphone_api.global.aclist.push(s)}return i>0&&(2==i?PutToDebugLog(3,"ERROR, common ParseAccountsReadFromFile accounts is corrupt"):PutToDebugLog(3,"WARNING, common ParseAccountsReadFromFile accounts missing"),webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, delsettings accounts result: "+e);var o=[],n="Account"+GetSipusername(),t=Md5Hash(n+GetParameter("serveraddress_user")+GetSipusername()+webphone_api.global.SALT+GetParameter("password")+GetLocationPathName());o[AC_NAME]=n,o[AC_SIPUSERNAME]=GetSipusername(),o[AC_SETTFILE]=t,o[AC_CHFILE]=t+"_ch",o[AC_ISACTIVE]="true",webphone_api.global.aclist.push(o),PutToDebugLog(3,"EVENT, common ParseAccountsReadFromFile save new account file "+t),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ParseAccountsReadFromFile Accounts file saved successfully"):PutToDebugLog(2,"ERROR, common ParseAccountsReadFromFile Accounts file save failed")})})),o(!0),!0}catch(c){PutToDebugLogException(2,"common: ParseAccountsReadFromFile",c)}}function GetActiveAccount(){try{if(isNull(webphone_api.global.aclist)||webphone_api.global.aclist.length<1)return PutToDebugLog(2,"EVENT, common GetActiveAccount no available accounts"),null;for(var e=0;e<webphone_api.global.aclist.length;e++)if(!(isNull(webphone_api.global.aclist[e])||webphone_api.global.aclist[e].length<2)){var o=webphone_api.global.aclist[e];if("true"===o[AC_ISACTIVE])return o}}catch(n){PutToDebugLogException(2,"common: GetActiveAccount",n)}return null}function GetActiveAccSettingsFilename(){try{var e=GetActiveAccount();return isNull(e)||e.length<2?(PutToDebugLog(2,"EVENT, common GetActiveAccSettingsFilename cant get filename, probably doesn't exist"),""):isNull(e[AC_SETTFILE])||e[AC_SETTFILE].length<1?(PutToDebugLog(2,"ERROR, common GetActiveAccSettingsFilename no filename"),""):e[AC_SETTFILE]}catch(o){PutToDebugLogException(2,"common: GetActiveAccount",o)}return""}function GetActiveAccCallhistoryFilename(){try{var e=GetActiveAccSettingsFilename();return isNull(e)||e.length<1?"":e+"_ch"}catch(o){PutToDebugLogException(2,"common: GetActiveAccCallhistoryFilename",o)}return""}function GetActiveAccUsername(){try{var e=GetActiveAccount();return isNull(e)||e.length<2?(PutToDebugLog(2,"EVENT, common GetActiveAccUsername cant get active account"),""):isNull(e[AC_SIPUSERNAME])||e[AC_SIPUSERNAME].length<1?GetSipusername():e[AC_SIPUSERNAME]}catch(o){PutToDebugLogException(2,"common: GetActiveAccUsername",o)}return""}function GetAccountsFilename(){try{if(!isNull(sessionaccfilename)&&sessionaccfilename.length>0)return sessionaccfilename;var e=GetConfig("brandid");return(isNull(e)||e.length<1||"-1"==e)&&(e=GetBrandName().toLowerCase()),sessionaccfilename=webphone_api.global.ACCOUNTS_FILENAME+"_"+Md5Hash(GetLocationPathName()+e)}catch(o){PutToDebugLogException(2,"common: GetAccountsFilename",o)}return""}function GetLocationPathName(){try{if(!isNull(lpname)&&lpname.length>0)return lpname;if(upfn_fname<0)if("undefined"!=typeof webphone_api.parameters.usepathinfilenames&&null!==webphone_api.parameters.usepathinfilenames)"false"===webphone_api.parameters.usepathinfilenames.toString()?upfn_fname=0:"true"===webphone_api.parameters.usepathinfilenames.toString()?upfn_fname=3:IsNumber(webphone_api.parameters.usepathinfilenames)&&(upfn_fname=StrToIntDef(webphone_api.parameters.usepathinfilenames,3));else{var e=GetConfig("usepathinfilenames");void 0!==e&&null!==e&&("false"===e.toString()?upfn_fname=0:"true"===e.toString()?upfn_fname=3:IsNumber(e)&&(upfn_fname=StrToIntDef(e,3)))}if((upfn_fname<0||upfn_fname>3)&&(upfn_fname=3),0===upfn_fname)return"";var o=GetProfile();isNull(o)&&(o="");var n=location.href;isNull(n)&&(n=""),n=Trim(n),n=n.toLowerCase();var t=n.indexOf("file:");if(t>=0&&t<5){t=n.indexOf("?"),t>0&&(n=n.substring(0,t)),t=n.indexOf("#"),t>0&&(n=n.substring(0,t));var i="";t=n.lastIndexOf("/"),t>0&&(i=n.substring(t+1),n=n.substring(0,t),(isNull(i)||i.indexOf(".")>0)&&(i="")),lpname=n+i,isNull(lpname)&&(lpname=""),lpname=ReplaceAll(lpname,"/",""),o.length>0&&(lpname=lpname+"_"+o),PutToDebugLog(2,"EVENT, LPname local and profile: "+lpname)}else{var a=location.hostname;if(isNull(a)&&(a=""),
1===upfn_fname);else{!isNull(location.pathname)&&location.pathname.toString().length>0&&(2===upfn_fname?a+=location.pathname:a=location.pathname),a=Trim(a);var t=a.indexOf("://");t>0&&(a=a.substring(t+3)),a=Trim(a);var t=a.indexOf("/");if(0===t&&(a=a.substring(1)),(t=a.lastIndexOf("/"))>0){var r=a.substring(t);!isNull(r)&&r.indexOf(".")>0&&(a=a.substring(0,t))}t=a.lastIndexOf("?"),t>0&&(a=a.substring(0,t)),t=a.lastIndexOf("#"),t>0&&(a=a.substring(0,t)),a=ReplaceAll(a,"/",""),isNull(a)&&(a=""),a=Trim(a)}lpname=a,o.length>0&&(lpname=lpname+"_"+o),CanLog(2)&&PutToDebugLog(2,"EVENT, LPname: "+lpname)}return lpname}catch(l){PutToDebugLogException(2,"common: GetLocationPathName",l)}return""}function GetProfile(){try{if(!isNull(currprofile))return currprofile;currprofile="";var e=window.location.href;e=decodeURIComponent(e),e=e.toLowerCase();var o=e.indexOf("profile=");o>0&&(e=e.substring(o+8),o=e.indexOf("&"),o>0&&(e=e.substring(0,o)),o=e.indexOf("#"),o>0&&(e=e.substring(0,o)),e=Trim(e),currprofile=e),currprofile.length<1&&!isNull(webphone_api.parameters)&&!isNull(webphone_api.parameters.profile)&&webphone_api.parameters.profile.length>0&&(currprofile=webphone_api.parameters.profile),currprofile.length<1&&!isNull(GetConfig("profile"))&&GetConfig("profile").length>0&&(currprofile=GetConfig("profile"))}catch(n){PutToDebugLogException(2,"common: GetProfile",n)}return currprofile}function GetSettFilenameSDK(){try{var e=Md5Hash("sdksettfilename"+GetLocationPathName()),o=GetConfig("brandid");return(isNull(o)||o.length<1||"-1"==o)&&(o=GetBrandName().toLowerCase()),e+=o}catch(n){PutToDebugLogException(2,"common: GetSettFilenameSDK",n)}return""}function Encrypt(e,o){try{if(isNull(o)||o.length<1||isNull(e))return PutToDebugLog(2,"ERROR, file: common no key or value"),null;for(var n="",t=0;t<o.length;t++)n+=o.charCodeAt(t).toString();var i=Math.floor(n.length/5),a=parseInt(n.charAt(i)+n.charAt(2*i)+n.charAt(3*i)+n.charAt(4*i)+n.charAt(5*i)),r=Math.ceil(o.length/2),l=Math.pow(2,31)-1;if(a<2)return PutToDebugLog(2,"ERROR, Algorithm cannot find a suitable hash. Please choose a different key. \nPossible considerations are to choose a more complex or longer key."),null;var p=Math.round(1e9*Math.random())%1e8;for(n+=p;n.length>10;)n=(parseInt(n.substring(0,10))+parseInt(n.substring(10,n.length))).toString();n=(a*n+r)%l;for(var s,c="",t=0;t<e.length;t++)s=parseInt(e.charCodeAt(t)^Math.floor(n/l*255)),c+=s<16?"0"+s.toString(16):s.toString(16),n=(a*n+r)%l;for(p=p.toString(16);p.length<8;)p="0"+p;return c+=p}catch(u){PutToDebugLogException(2,"common: Encrypt",u)}return null}function Decrypt(e,o){try{if(isNull(e)||e.length<8)return PutToDebugLog(2,"ERROR, A salt value could not be extracted from the encrypted message because it's length is too short. The message cannot be decrypted."),null;if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, Please enter a key with which to decrypt the message."),null;var n="",t=e.indexOf("almakorte_2_");t>=0&&(e=e.substring(t+12));for(var i=0;i<o.length;i++)n+=o.charCodeAt(i).toString();var a=Math.floor(n.length/5),r=parseInt(n.charAt(a)+n.charAt(2*a)+n.charAt(3*a)+n.charAt(4*a)+n.charAt(5*a)),l=Math.round(o.length/2),p=Math.pow(2,31)-1,s=parseInt(e.substring(e.length-8,e.length),16);for(e=e.substring(0,e.length-8),n+=s;n.length>10;)n=(parseInt(n.substring(0,10))+parseInt(n.substring(10,n.length))).toString();n=(r*n+l)%p;for(var c,u="",i=0;i<e.length;i+=2)c=parseInt(parseInt(e.substring(i,i+2),16)^Math.floor(n/p*255)),u+=String.fromCharCode(c),n=(r*n+l)%p;return u}catch(g){PutToDebugLogException(2,"common: Decrypt",g)}return null}function B64Enc(e){try{if(isNull(e))return PutToDebugLog(2,"ERROR, B6 value could not be extracted"),null;if(e.length<1)return"";var o=e;return o=Base64.encode(o),o=ReplaceAll(o,"=","-"),o=ReplaceAll(o,"+","_"),o=ReplaceAll(o,"/",".")}catch(n){PutToDebugLogException(2,"common: B64Enc",n)}return e}function B64Dec(e){try{if(isNull(e))return"";if(e.indexOf("_BASE64_")<0)return e;var o=e.replace("_BASE64_","");return o=ReplaceAll(o,"-","="),o=ReplaceAll(o,"_","+"),o=ReplaceAll(o,".","/"),o=Base64.decode(o)}catch(n){PutToDebugLogException(2,"common: B64Dec",n)}return e}function StrEc(e,o,n){var t="";try{if(isNull(e))return PutToDebugLog(2,"ERROR, A salt value could not be extracted(2)"),"";if(e.length<1)return"";if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, Please enter a correct key(2)"),e;if(0===e.indexOf("encrypted")||0===e.indexOf("oenc1_")||0===e.indexOf("alenc1_")||0===e.indexOf("dcid_")||0===e.indexOf("wetrt_")||0===e.indexOf("mcrfs_"))return e;for(var i=0,a=o.length,r=0,l=0;l<e.length;l++){r=e.charCodeAt(l)^o.charCodeAt(i),!0===n&&(r%=128)<0&&(r=95);t+=String.fromCharCode(r),i<a-1?i++:i=0}return t=Base64.encode(t),t=ReplaceAll(t,"=","-"),t=ReplaceAll(t,"+","_"),t=ReplaceAll(t,"/",".")}catch(p){PutToDebugLogException(2,"common: StrEc",p)}return e}function StrDc(e,o,n){var t="";try{if(isNull(e))return PutToDebugLog(2,"ERROR, A salt value could not be extracted(3)"),"";if(e.lenght<1)return e;if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, Please enter a correct key(3)"),e;if(e=e.toString(),e=Trim(e),0!==e.indexOf("encrypted")&&0!==e.indexOf("oenc1_")&&0!==e.indexOf("alenc1_")&&0!==e.indexOf("dcid_")&&0!==e.indexOf("wetrt_")&&0!==e.indexOf("mcrfs_"))return e;if(e=e.replace("oenc1_",""),e=e.replace("alenc1_",""),e=e.replace("dcid_",""),e=e.replace("wetrt_",""),e=e.replace("encrypted__3__",""),e=e.replace("encrypted__16__",""),e=e.replace("mcrfs_",""),e.lenght<1)return e;if(e.indexOf("encrypted__4")>=0)return e=e.replace("encrypted__4__",""),e=Base64.decode(e);var i=e.indexOf("__");i>0&&(e=e.substring(i+2));i=e.indexOf("__"),i>=0&&(e.substring(0,i),e=e.substring(i+2)),e=ReplaceAll(e,"-","="),e=ReplaceAll(e,"_","+"),e=ReplaceAll(e,".","/"),e=Base64.decode(e);for(var a=0,r=o.length,l=0,p=0;p<e.length;p++){l=e.charCodeAt(p)^o.charCodeAt(a),!0===n&&(l%=128)<0&&(l=95);t+=String.fromCharCode(l),a<r-1?a++:a=0}return t}catch(s){PutToDebugLogException(2,"common: StrDc",s)}return e}function delsettings(e){try{if(isNull(e)||e<1)return void PutToDebugLog(4,"WARNING, delsettings invalid level parameter");if(PutToDebugLog(2,"EVENT, common delsettings called, level: "+e.toString()),e>2&&(e=2),webphone_api.global.flag_delsett=e,webphone_api.global.resetsett_handled=!0,!isNull(webphone_api.origparameters)&&!isNull(webphone_api.parameters))if(webphone_api.parameters={},Object.assign)Object.assign(webphone_api.parameters,webphone_api.origparameters);else for(var o in webphone_api.origparameters)webphone_api.parameters[o]=webphone_api.origparameters[o];if(2===e){webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, delete call history file: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),webphone_api.global.chlist=[],webphone_api.global.recentlist=[];var n=GetParameter("messagefiles");if(!isNull(n)){for(var t=n.split(","),i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<3)){var a=t[i].indexOf("[#");a>0&&(t[i]=t[i].substring(0,a));t[i]}SaveParameter("messagefiles","")}var r=GetConfig("brandid");(isNull(r)||r.length<1||"-1"==r)&&(r=GetBrandName().toLowerCase()),webphone_api.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, delete accounts file result: "+e)}),webphone_api.global.aclist=[],webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME+r,function(e){PutToDebugLog(2,"EVENT, delete contacts file result: "+e)}),webphone_api.global.ctlist=[]}webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(GetActiveAccSettingsFilename(),function(e){PutToDebugLog(2,"EVENT, delete settings file: "+GetActiveAccSettingsFilename()+" result: "+e)}),webphone_api.global.settmap={},HandleSettings("","",function(){}),setTimeout(function(){webphone_api.global.flag_delsett=0,PutToDebugLog(2,"EVENT, delete settings flag delsett is reset to: 0")},250),OpenSettings(!0,3)}catch(l){PutToDebugLogException(2,"common: delsettings",l)}}function HideClearPassword(e){var o=e,n="";try{if(isNull(e))return PutToDebugLog(2,"WARNING, common: HideClearPassword textin is NULL"),"";var t=o.indexOf("password");if(t>0)return n=o.substring(0,t)+"password: *****",o=o.substring(t,o.length),t=o.indexOf("\r\n"),t<0&&(t=("password "+GetParameter("password")).length)>o.length&&(t=o.length-1),o=o.substring(t,o.length),n+=o}catch(i){PutToDebugLogException(2,"common: HideClearPassword",i)}return e}function UseCustomAutoprov(e){try{var o=GetParameter("customautoprov_url");if(isNull(o)||o.length<3)return!1;if(1==GetParameterInt("customautoprov_repeat",1)&&GetParameterInt("custautoprov_exectimes",0)>0)return!1;var n=GetParameterInt("customautoprov_when",1);return!(!0===e&&2==n||!1===e&&1==n)}catch(t){PutToDebugLogException(2,"common: UseCustomAutoprov",t)}return!1}function GetCustomAutoprov(e){try{var o=GetParameter("customautoprov_url");if(isNull(o)||o.length<5)return PutToDebugLog(2,"ERROR, GetCustomAutoprov invalid url"),void e("ERROR, GetCustomAutoprov invalid url");IsHttps()&&(o=o.replace("http:","https:")),o=UriParser(o,"","","","","return_uri"),PutToDebugLog(3,"EVENT, GetCustomAutoprov url: "+o),acploop++;var n=new XMLHttpRequest;if("withCredentials"in n)n.open("GET",o,!0);else{if("undefined"==typeof XDomainRequest)return PutToDebugLog(2,"ERROR, common: GetCustomAutoprov, CORS not supported"),void e("ERROR, GetCustomAutoprov CORS not supported callback");n=new XDomainRequest,n.open("GET",o)}var t=0;n.onload=function(){try{if(PutToDebugLog(4,"EVENT, GetCustomAutoprov.onload"),t=19,!1===webphone_api.global.httpheaderslogged&&n.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, GetCustomAutoprov: HTTP request answer headers 3: "+n.getAllResponseHeaders())}var o=n.responseText;return t=20,PutToDebugLog(2,"EVENT, GetCustomAutoprov response: "+o),t=21,isNull(o)||o.length<1?(t=23,PutToDebugLog(2,"ERROR, GetCustomAutoprov response is NULL"),void e("")):void e(o)}catch(i){PutToDebugLogException(2,"common: GetCustomAutoprov.onload inner ("+t+")",i),e("ERROR, catch on: common: GetCustomAutoprov.onload inner ("+t+")")}},n.onerror=function(o){var n="";isNull(o)||(n=o.toString(),isNull(o.target)||(n=isNull(o.target.status)?n+" "+o.target.toString():n+" "+o.target.status.toString())),PutToDebugLog(2,"ERROR, common: GetCustomAutoprov: onerror: "+n),e("ERROR, common: GetCustomAutoprov: onerror FAILED")},n.timeout=9e3,n.ontimeout=function(o){PutToDebugLog(2,"ERROR, common: GetCustomAutoprov: Timeout"),e("ERROR, common: GetCustomAutoprov: ontimeout FAILED")},n.send()}catch(i){PutToDebugLogException(2,"common: GetCustomAutoprov",i),e("ERROR, common: GetCustomAutoprov: global failure")}}function RecAutoprovCustom(e){try{PutToDebugLog(3,"EVENT, RecAutoprovCustom: "+e);if(isNull(e)||Trim(e).length<=0||e.toLowerCase().indexOf("error")>=0&&e.length<160)return void PutToDebugLog(3,"ERROR, can't get custom autoprovisioning: "+e);if(e.indexOf("AUTOPROVISIONINGSTART")<0||e.indexOf("AUTOPROVISIONINGEND")<0)return void PutToDebugLog(3,"ERROR, custom autoprovisioning: no AUTOPROVISIONINGSTART and AUTOPROVISIONINGEND found: "+e);e=e.substring(e.indexOf("AUTOPROVISIONINGSTART")+21,e.indexOf("AUTOPROVISIONINGEND")),e=Trim(e);var o=e.split("\n");if(isNull(o)||o.length<1)return void PutToDebugLog(3,"ERROR, custom autoprovisioning invalid received data: "+e);var n=[];n.push("s"),n.push("e"),n.push("r"),n.push("v"),n.push("e"),n.push("r"),n.push("a"),n.push("d"),n.push("d"),n.push("r"),n.push("e"),n.push("s"),n.push("s");for(var t=n.join(""),i=0,a=0;a<o.length;a++)if(!(isNull(o[a])||o[a].length<3||o[a].indexOf(":")<1)){o[a]=Trim(o[a]);var r=Trim(o[a].substring(0,o[a].indexOf(":"))),l=Trim(o[a].substring(o[a].indexOf(":")+1));r=r.toLowerCase(),PutToDebugLog(5,"EVENT, custom autoprovisioning set: "+r+" = "+l),r!==t&&0!==Trim(r).indexOf(t)&&(SaveParameter(r,l),i++)}if(PutToDebugLog(2,"EVENT, RecAutoprovCustom number of configs received: "+i),i>1){var p=GetParameterInt("custautoprov_exectimes",0);p+=1,SaveParameter("custautoprov_exectimes",p.toString())}else PutToDebugLog(5,"WARNING, custom autoprovisioning probably failed because too few parameters found: "+i)}catch(s){PutToDebugLogException(2,"common: RecAutoprovCustom",s)}}function GetAutoprovisioning(e,o){try{if(getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&getuseengine()!==webphone_api.global.ENGINE_FLASH)return PutToDebugLog(2,"ERROR, GetAutoprovisioning invalid engine: "+getuseengine()),void o("");(isNull(e)||e.length<1)&&(e=webphone_api.global.autoprovsrv_1);var n=GetParameter("serveraddress_user");if(isNull(n)||Trim(n).length<1)return PutToDebugLog(2,"ERROR, GetAutoprovisioning no serveraddress_user specified"),void o("ERROR, GetAutoprovisioning no serveraddress_user specified callback");e=e+n+".txt",IsHttps()&&(e=e.replace("http:","https:")),PutToDebugLog(3,"EVENT, GetAutoprovisioning url: "+e),aploop++;var t=new XMLHttpRequest;if("withCredentials"in t)t.open("GET",e,!0);else{if("undefined"==typeof XDomainRequest)return PutToDebugLog(2,"ERROR, common: GetAutoprovisioning, CORS not supported"),void o("ERROR, GetAutoprovisioning CORS not supported callback");t=new XDomainRequest,t.open("GET",e)}var i=0;t.onload=function(){try{if(PutToDebugLog(4,"EVENT, GetAutoprovisioning.onload"),i=19,!1===webphone_api.global.httpheaderslogged&&t.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 3: "+t.getAllResponseHeaders())}var e=t.responseText;return i=20,PutToDebugLog(2,"EVENT, GetAutoprovisioning response: "+e),i=21,isNull(e)||e.length<1?(i=23,PutToDebugLog(2,"ERROR, GetAutoprovisioning response is NULL"),void o("")):void o(e)}catch(n){PutToDebugLogException(2,"common: GetAutoprovisioning.onload inner ("+i+")",n),o("ERROR, catch on: common: GetAutoprovisioning.onload inner ("+i+")")}},t.onerror=function(e){var n="";isNull(e)||(n=e.toString(),isNull(e.target)||(n=isNull(e.target.status)?n+" "+e.target.toString():n+" "+e.target.status.toString())),PutToDebugLog(2,"ERROR, common: GetAutoprovisioning: onerror: "+n),o("ERROR, common: GetAutoprovisioning: onerror FAILED")},t.timeout=9e3,t.ontimeout=function(e){PutToDebugLog(2,"ERROR, common: GetAutoprovisioning: Timeout"),o("ERROR, common: GetAutoprovisioning: ontimeout FAILED")},t.send()}catch(a){PutToDebugLogException(2,"common: GetAutoprovisioning",a),o("ERROR, common: GetAutoprovisioning: global failure")}}function ParseAutoprovisioning(e,o){try{!0===o?SaveParameter("cust_lastautoprov",GetTickCount().toString()):SaveParameter("lastautoprov",GetTickCount().toString()),e.lastIndexOf("EOFLINE")>0&&(e=ReplaceAll(e,"EOFLINE","\r\n")),SaveParameter("serveraddress_orig",GetAPparam("server",e)),SaveParameter("proxyaddress",GetAPparam("proxyserver",e)),SaveParameter("cfgusetunneling",GetAPparam("encryption",e)),SaveParameter("cfgusetunneling",GetAPparam("cfgusetunneling",e)),SaveParameter("techprefix",GetAPparam("techprefix",e)),SaveParameter("creditrequest",GetAPparam("creditrequest",e)),SaveParameter("ratingrequest",GetAPparam("ratingrequest",e)),SaveParameter("accounturi",GetAPparam("accounturi",e)),SaveParameter("newuser",GetAPparam("newuser",e)),SaveParameter("callback",GetAPparam("callback",e)),SaveParameter("p2p",GetAPparam("p2p",e)),SaveParameter("sms",GetAPparam("sms",e)),SaveParameter("brandname",GetAPparam("brandname",e)),SaveParameter("companyname",GetAPparam("companyname",e)),SaveParameter("homepage",GetAPparam("website",e)),SaveParameter("recharge",GetAPparam("recharge",e)),SaveParameter("brandtext",GetAPparam("brandtext",e)),SaveParameter("voicemail",GetAPparam("voicemail",e)),SaveParameter("voicemailnum",GetAPparam("voicemailnum",e)),SaveParameter("messagepopup",GetAPparam("messagepopup",e)),SaveParameter("messagedisplay",GetAPparam("messagedisplay",e)),SaveParameter("encryptionseries",GetAPparam("encryptionseries",e)),SaveParameter("directserveraddress",GetAPparam("directserveraddress",e)),SaveParameter("consoleaddress",GetAPparam("consoleaddress",e)),SaveParameter("httptunnelport",GetAPparam("httptunnelport",e)),SaveParameter("tcptunnelingport",GetAPparam("tcptunnelingport",e)),SaveParameter("rsakey_public_k",GetAPparam("rsakey_public_k",e)),SaveParameter("fastencryptkey",GetAPparam("fastencryptkey",e)),SaveParameter("autotransportdetect",GetAPparam("autotransportdetect",e)),SaveParameter("remotehttpport",GetAPparam("remotehttpport",e)),SaveParameter("encryptionmethod",GetAPparam("encryptionmethod",e)),SaveParameter("cantryudpdirectep",GetAPparam("cantryudpdirectep",e)),SaveParameter("usingmizuserver",GetAPparam("usingmizuserver",e)),SaveParameter("upperserver",GetAPparam("upperserver",e)),SaveParameter("serverinputisupperserver",GetAPparam("serverinputisupperserver",e)),SaveParameter("version",GetAPparam("version",e)),SaveParameter("header",GetAPparam("header",e)),SaveParameter("footer",GetAPparam("footer",e)),SaveParameter("logo",GetAPparam("logo",e)),SaveParameter("supportmail",GetAPparam("supportmail",e)),SaveParameter("supporturl",GetAPparam("supporturl",e)),SaveParameter("advertisement",GetAPparam("advertisement",e)),SaveParameter("helpurl",GetAPparam("helpurl",e)),SaveParameter("licenseurl",GetAPparam("licenseurl",e)),SaveParameter("extramenuurl",GetAPparam("extramenuurl",e)),SaveParameter("extramenutxt",GetAPparam("extramenutxt",e)),SaveParameter("extramenuurl1",GetAPparam("extramenuurl1",e)),SaveParameter("extramenutxt1",GetAPparam("extramenutxt1",e)),SaveParameter("extramenuurl2",GetAPparam("extramenuurl2",e)),SaveParameter("extramenutxt2",GetAPparam("extramenutxt2",e)),SaveParameter("extramenuurl3",GetAPparam("extramenuurl3",e)),SaveParameter("extramenutxt3",GetAPparam("extramenutxt3",e)),SaveParameter("extramenuurl4",GetAPparam("extramenuurl4",e)),SaveParameter("extramenutxt4",GetAPparam("extramenutxt4",e)),SaveParameter("extramenuurl5",GetAPparam("extramenuurl5",e)),SaveParameter("extramenutxt5",GetAPparam("extramenutxt5",e))}catch(n){PutToDebugLogException(2,"common: ParseAutoprovisioning",n)}}function GetAPparam(e,o){try{if(isNull(e)||e.length<1||isNull(o)||o.indexOf(e)<0)return"";var n=o.split("\r\n");if(isNull(n)||n.length<1)return"";for(var t=0;t<n.length;t++)if(!isNull(n[t])&&0===Trim(n[t]).indexOf(e+":")){var i=n[t].substring(n[t].indexOf(e+":")+e.length+1,n[t].length);return Trim(i)}}catch(a){PutToDebugLogException(2,"common: GetAPparam",a)}return""}function RandomInt(e,o){try{var n=o-e+1,t=Math.round(Math.random()*n)%n;return t+=Math.round(e)}catch(i){PutToDebugLogException(2,"common: RandomInt",i)}return 0}function RandomStr(e,o,n){try{if(isNull(e)||e<1)return"";isNull(o)&&(o=!1),isNull(n)&&(n=!1);var t=48;!1===n&&(t=65);for(var i="",a=0;a<5e3;a++){var r=RandomInt(t,122);if(!1===o?ASCII_NRLOWER.indexOf(r)>-1&&(i+=String.fromCharCode(r)):ASCII_ALL.indexOf(r)>-1&&(i+=String.fromCharCode(r)),i.length>=e)return i}return i}catch(l){PutToDebugLogException(2,"common: RandomStr",l)}return 0}function ShowModalLoader(e){try{if(!0===webphone_api.common.IsSDK())return;webphone_api.$("body").append('<div class="modalWindow"/>'),!1===IsSDK()&&webphone_api.$.mobile.loading("show",{text:e,textVisible:!0,theme:"b",html:""})}catch(o){PutToDebugLogException(2,"common: ShowModalLoader",o)}}function HideModalLoader(){try{webphone_api.$(".modalWindow").remove(),!1===IsSDK()&&webphone_api.$.mobile.loading("hide")}catch(e){PutToDebugLogException(2,"common: HideModalLoader",e)}}function GetDefaultFontSize(e){var o=0;try{e=e||document.body;var n=document.createElement("span");return n.style.cssText="display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em",n.appendChild(document.createTextNode("M")),e.appendChild(n),o=n.offsetHeight,e.removeChild(n),isNull(o)&&(o=0),o}catch(t){PutToDebugLogException(2,"common: GetDefaultFontSize",t)}return 0}function ShowServerInput(){try{var e=GetParameter("showserverinput");if("0"===e)return!1;if("2"===e)return!0;if("1"===e){var o=webphone_api.parameters.serveraddress,n=GetConfig("serveraddress");return isNull(o)&&(o=""),isNull(n)&&(n=""),!(o.length>0||n.length>0)||"false"!==GetParameter("serverinputisupperserver")}}catch(t){PutToDebugLogException(2,"common: ShowServerInput",t)}return!1}function RequestUserServerInput(e){try{if(isNull(e)&&(e=GetParameter("upperserverfromuser")),"0"===e||"1"===e)return!1;if("3"===e)return!0;if("2"===e)return!!ShowServerInput()}catch(o){PutToDebugLogException(2,"common: RequestUserServerInput",o)}return!1}function GetAllContactsNumbersSipuris(){var e="";try{if(isNull(webphone_api.global.ctlist))return PutToDebugLog(2,"WARNING, common: GetAllContactsNumbersSipuris no numbers to return"),"";if(webphone_api.global.ctlist.length<1)return PutToDebugLog(2,"EVENT, common: GetAllContactsNumbersSipuris no numbers to return"),"";for(var o=0;o<webphone_api.global.ctlist.length;o++){var n=webphone_api.global.ctlist[o];if(!(isNull(n)||n.length<1)){var t=n[CT_NUMBER];if(!(isNull(t)||t.length<1))for(var i=0;i<t.length;i++)!isNull(t[i])&&t[i].length>0&&(e.length>0&&(e+=","),e+=t[i])}}return e}catch(a){PutToDebugLogException(2,"common: GetAllContactsNumbersSipuris",a)}return""}function SetDID(){try{if(sdcalled)return;sdt++,sdt>3&&(sdcalled=!0),setTimeout(function(){SetDID()},8e3);var e=RandomInt(1e4,99999999);WinAPI("API_SetDIDChange",null,e,Md5Hash("didchange"+e))}catch(o){PutToDebugLogException(2,"common: SetDIDX",o)}}function GtUc(){return unlockcodetrick}function GtUct(){return unlockcodetricktogled}function Hasesw(){return!isNull(alsv)&&alsv.length>0||!isNull(alsww)&&alsww.length>0}function Us(){return webphone_api.global.usestorage}function Alwr(){var e=!1;try{if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC||isNull(alswrt)||Trim(alswrt).length<1)return!0;var o=GetWebrtcSrvAddr();o=o.toLowerCase();var n=[];n.push("l"),n.push("o"),n.push("c"),n.push("a"),n.push("l"),n.push("f"),n.push("i"),n.push("l"),n.push("e");var t=n.join("");n=[],n.push("l"),n.push("o"),n.push("c"),n.push("a"),n.push("l");var i=n.join("");n=[],n.push("1"),n.push("2"),n.push("7"),n.push("."),n.push("0"),n.push("."),n.push("0"),n.push("."),n.push("1");var a=n.join("");n=[],n.push("l"),n.push("o"),n.push("c"),n.push("a"),n.push("l"),n.push("h"),n.push("o"),n.push("s"),n.push("t");var r=n.join(""),l=o.indexOf("//");if(l>0&&(o=o.substring(l+2,o.length)),l=o.indexOf("/"),l>0&&(o=o.substring(0,l)),l=o.indexOf(":"),l>0&&(o=o.substring(0,l)),o=o.replace("www.",""),isNull(o)||Trim(o).length<1)return!1;o=Trim(o);var p=StrDc(alswrt,alsvkey);if(!isNull(p)&&p.length>0){var s=p.split(",");if(!isNull(s)&&s.length>0)for(var c=0;c<s.length;c++)if(!(isNull(s[c])||s[c].length<1)){if(s[c]=Trim(s[c]),s[c]=s[c].toLowerCase(),o.indexOf(s[c])>=0){e=!0;break}if(s[c]===t&&!0===IsLocalFileSys()||s[c]===r&&(o.indexOf(a)>=0||o.indexOf(r)>=0)||s[c]===i&&(!0===IsLocalFileSys()||o.indexOf(a)>=0||o.indexOf(r)>=0)){e=!0;break}}}return e}catch(u){PutToDebugLogException(2,"common: Alwr",u)}return!1}function Awre(){if(!1===Alwr()){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("w"),e.push("e"),e.push("b"),e.push("r"),e.push("t"),e.push("c"),e.push(" "),e.push("s"),e.push("e"),e.push("r"),e.push("v"),e.push("e"),e.push("r"),e.push(" "),e.push("n"),e.push("o"),e.push("t"),e.push(" "),e.push("a"),e.push("l"),e.push("l"),e.push("o"),e.push("w"),e.push("e"),e.push("d"),e.push("_"),e.push("1");var o=e.join("");setTimeout(function(){PutToDebugLog(1,o)},1881)}}function Alwm(){var e=!1,o=!1;try{if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC)return!0;if(void 0===alsww||isNull(alsww)||null==alsww||Trim(alsww).length<2)return void 0!==malsx2&&null!=malsx2&&44===malsx2;al_isreliable=!1,al2_isreliable=!1;var n=GetParameter("aldm");(isNull(n)||Trim(n).length<2)&&(n=window.location.href),isNull(n)||Trim(n).length<2?n="":(n=decodeURIComponent(n),al_isreliable=!0,0!=n.toLowerCase().indexOf("http")&&0!=n.toLowerCase().indexOf("file")&&(al_isreliable=!1),n=GetDomainFromURL(n),isNull(n)&&(n=""),n=n.toLowerCase(),n=Trim(n));var t=webphone_api.getbasedir2();if(isNull(t)&&(t=""),t.length>1&&(t=decodeURIComponent(t),al2_isreliable=!0,0!=t.toLowerCase().indexOf("http")&&0!=t.toLowerCase().indexOf("file")&&(al2_isreliable=!1),t=GetDomainFromURL(t),isNull(t)&&(t=""),t=t.toLowerCase(),t=Trim(t)),(isNull(t)||t.length<2)&&(t=n),(isNull(t)||t.length<2)&&(o=!0),(isNull(n)||n.length<2)&&(n=t),isNull(n)||n.length<2)return!0;al_isreliable||!IsIPAddrress(n)&&!IsDomainName(n)||(al_isreliable=!0),al2_isreliable||!IsIPAddrress(t)&&!IsDomainName(t)||(al2_isreliable=!0);var i=[];i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("f"),i.push("i"),i.push("l"),i.push("e");var a=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l");var r=i.join("");i=[],i.push("1"),i.push("2"),i.push("7"),i.push("."),i.push("0"),i.push("."),i.push("0"),i.push(".");var l=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("h"),i.push("o"),i.push("s"),i.push("t");var p=i.join("");if((n.indexOf("localhost")>=0||n.indexOf("127.0.0.1")>=0)&&(!al2_isreliable||t.indexOf("localhost")>=0||t.indexOf("127.0.0.1")>=0))return!0;if((t.indexOf("localhost")>=0||t.indexOf("127.0.0.1")>=0)&&(!al_isreliable||n.indexOf("localhost")>=0||n.indexOf("127.0.0.1")>=0))return!0;var s=StrDc(alsww,alsvkey);if(!isNull(s)&&s.length>0){var c=s.split(",");if(!isNull(c)&&c.length>0)for(var u=0;u<c.length;u++)isNull(c[u])||c[u].length<2||(c[u]=Trim(c[u]),c[u]=c[u].toLowerCase(),!1===e&&(n.indexOf(c[u])>=0&&(e=!0),(c[u]===a&&!0===IsLocalFileSys()||c[u]===p&&(n.indexOf(l)>=0||n.indexOf(p)>=0)||c[u]===r&&(!0===IsLocalFileSys()||n.indexOf(l)>=0||n.indexOf(p)>=0))&&(e=!0)),!1===o&&(t.indexOf(c[u])>=0&&(o=!0),(c[u]===a&&!0===IsLocalFileSys()||c[u]===p&&(t.indexOf(l)>=0||t.indexOf(p)>=0)||c[u]===r&&(!0===IsLocalFileSys()||t.indexOf(l)>=0||t.indexOf(p)>=0))&&(o=!0)))}return!(!0!==e||!0!==o&&al2_isreliable)||!(!0!==o||!0!==e&&a1_isreliable)}catch(g){PutToDebugLogException(2,"common: Alwm",g)}return!0}function Awe(){if(!1===Alwm()){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("W"),e.push("e"),e.push("b"),e.push("s"),e.push("e"),e.push("r"),e.push("v"),e.push("e"),e.push("r"),e.push(" "),e.push("n"),e.push("o"),e.push("t"),e.push(" "),e.push("a"),e.push("l"),e.push("l"),e.push("o"),e.push("w"),e.push("e"),e.push("d"),e.push("_"),e.push("1");var o=e.join(""),n=o,t=o;try{var i=GetParameter("aldm");(isNull(i)||Trim(i).length<1)&&(i=window.location.href),isNull(i)||Trim(i).length<1?i="":(i=decodeURIComponent(i),i=GetDomainFromURL(i),isNull(i)&&(i=""),i=i.toLowerCase(),i=Trim(i));var a=webphone_api.getbasedir2();isNull(a)&&(a=""),a=decodeURIComponent(a),a=GetDomainFromURL(a),isNull(a)&&(a=""),a=a.toLowerCase(),a=Trim(a),t+=" ",t+="(",t+="a ",t+=": ",t+=alsww,t+=")",o+=" ",o+="(",o+="d ",o+=": ",o+=i,o+=",",o+=al_isreliable.toString(),o+=",",o+=a,o+=",",o+=al2_isreliable.toString(),o+=",",o+=webphone_api.getbasedir2(),o+=",",o+=window.location.href,o+=",",o+=window.location,o+=",",o+=window.location.domain,o+=")"}catch(r){PutToDebugLogException(2,"common: CheckDIDXInnerA",r)}setTimeout(function(){PutToDebugLog(2,o)},1881),setTimeout(function(){PutToDebugLog(2,t)},1889),setTimeout(function(){PutToDebugLog(1,n)},1353),setTimeout(function(){ShowToast(n)},1246)}}function Awb(){var e=Alwm();return!1===e&&Awe(),e=Alwr(),!1===e&&Awre(),e}function Awb2(){var e=Alwm();return!1===e&&Awe(),e}function CheckDID(e,o){var n=!1;try{if(isNull(e)||e.length<1)return!0!==o;e=e.toLowerCase();var t=e.indexOf(":");if(t>0&&(e=e.substring(0,t)),e=Trim(e),e.indexOf(".")<1)return!0;var i=[];i.push("l"),i.push("a"),i.push("n"),i.push("i"),i.push("p");var a=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("f"),i.push("i"),i.push("l"),i.push("e");var r=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l");var l=i.join("");i=[],i.push("1"),i.push("2"),i.push("7"),i.push("."),i.push("0"),i.push("."),i.push("0"),i.push("."),i.push("1");var p=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("h"),i.push("o"),i.push("s"),i.push("t");var s=i.join(""),c=[];c.push("w"),c.push("e"),c.push("b"),c.push("s"),c.push("e"),c.push("r"),c.push("v"),c.push("e"),c.push("r");var u=c.join("");if(void 0===alsv||null==alsv||Trim(alsv).length<1)return void 0!==malsx1&&null!=malsx1&&77===malsx1;if(!(!isNull(alsv)&&alsv.length>0||!isNull(alsvir1)&&alsvir1.length>0||!isNull(alsvir2)&&alsvir2.length>0||!isNull(alsvir3)&&alsvir3.length>0))return!0!==o;var g=StrDc(alsv,alsvkey);if(!isNull(g)&&g.length>0){var m=g.split(",");if(!isNull(m)&&m.length>0){for(var b=0;b<m.length;b++)if(!(isNull(m[b])||m[b].length<1)&&(m[b]=Trim(m[b]),m[b]=m[b].toLowerCase(),u===m[b])){var h=e.indexOf("sip.");0===h&&(e=e.substring(h+4));var d=GetDomainFromURL(window.location.href);return!(isNull(d)||d.length<3)&&(d=d.toLowerCase(),d=Trim(d),h=d.indexOf("www."),0===h&&(d=d.substring(h+4)),e===d)}for(var b=0;b<m.length;b++)if(!(isNull(m[b])||m[b].length<1)){if(m[b]=Trim(m[b]),m[b]=m[b].toLowerCase(),e.indexOf(m[b])>=0){n=!0;break}if(m[b]===a&&IsLanIP(e)){n=!0;break}if(m[b]===r&&!0===IsLocalFileSys()||m[b]===s&&(e.indexOf(p)>=0||e.indexOf(s)>=0)||m[b]===l&&(!0===IsLocalFileSys()||e.indexOf(p)>=0||e.indexOf(s)>=0)){n=!0;break}}}}if(!isNull(alsvir1)&&Trim(alsvir1).length>2){var _=StrDc(alsvir1,alsvkey);_=Trim(_),_=_.toLowerCase(),0===e.indexOf(_)&&(n=!0)}if(!isNull(alsvir2)&&Trim(alsvir2).length>2){var w=StrDc(alsvir2,alsvkey);w=Trim(w),w=w.toLowerCase(),0===e.indexOf(w)&&(n=!0)}if(!isNull(alsvir3)&&Trim(alsvir3).length>2){var f=StrDc(alsvir3,alsvkey);f=Trim(f),f=f.toLowerCase(),0===e.indexOf(f)&&(n=!0)}}catch(v){PutToDebugLogException(2,"common: CheckDIDX",v)}return n}function Ch(){try{if(alsvu1.length<1&&alsvu2.length<1&&alsvu3.length<1)return!0;if(hua.length<1&&(hua=GetSipHeader("User-agent")),hsrv.length<1&&(hsrv=GetSipHeader("Server")),hsrvx.length<1&&(hsrvx=GetSipHeader("X-Server")),webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC)return!0;if(hua.length<1&&hsrv.length<1)return!1;hua=hua.toLowerCase(),hsrv=hsrv.toLowerCase(),hsrvx=hsrvx.toLowerCase();var e=alsvu1,o=alsvu2,n=alsvu3;isNull(e)&&(e=""),isNull(o)&&(o=""),isNull(n)&&(n=""),e=StrDc(e,alsvkey),o=StrDc(o,alsvkey),n=StrDc(n,alsvkey),e=e.toLowerCase(),o=o.toLowerCase(),n=n.toLowerCase();var t=!1;if(hua.length>0&&(e.length>0&&hua.indexOf(e)>=0?t=!0:o.length>0&&hua.indexOf(o)>=0?t=!0:n.length>0&&hua.indexOf(n)>=0&&(t=!0)),hsrv.length>0&&(e.length>0&&hsrv.indexOf(e)>=0?t=!0:o.length>0&&hsrv.indexOf(o)>=0?t=!0:n.length>0&&hsrv.indexOf(n)>=0&&(t=!0)),hsrvx.length>0&&(e.length>0&&hsrvx.indexOf(e)>=0?t=!0:o.length>0&&hsrvx.indexOf(o)>=0?t=!0:n.length>0&&hsrvx.indexOf(n)>=0&&(t=!0)),void 0===alsv||null==alsv||Trim(alsv).length<1)return void 0!==malsx1&&null!=malsx1&&77===malsx1;if(!1===t&&!isNull(alsv)&&alsv.length>2){var i=GetParameter("serveraddress_user");(isNull(i)||i.length<2)&&(i=GetParameter("serveraddress")),t=CheckDID(i,!0)}return t}catch(a){PutToDebugLogException(2,"common: Ch",a)}return!0}function Loa(){if(lic_onlyandroidvideo<1)return!0;if(null===myLoaCachedvalueFrom){var e=[];e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push("e"),e.push("r"),e.push("e"),e.push("x"),e.push("t"),e.push("e"),e.push("n"),e.push("s"),e.push("i"),e.push("o"),e.push("n"),e.push("="),e.push("3"),e.push("4"),e.push("5");var o=e.join("");e=[],e.push("A"),e.push("n"),e.push("d"),e.push("r"),e.push("o"),e.push("i"),e.push("d");var n=e.join("");e=[],e.push("w"),e.push("e"),e.push("b"),e.push("v"),e.push("o"),e.push("i"),e.push("p"),e.push("p"),e.push("h"),e.push("o"),e.push("n"),e.push("e"),e.push("."),e.push("c"),e.push("o"),e.push("m");var t=e.join("");e=[],e.push("a"),e.push("r"),e.push("t"),e.push("c"),e.push("v"),e.push("i"),e.push("d"),e.push("e"),e.push("o"),e.push("c"),e.push("a"),e.push("l"),e.push("l")
;var i=e.join(""),a=window.location.href;myLoaCachedvalueFrom=!(GetOs()!==n||a.indexOf(t)<1||a.indexOf(i)<1||a.indexOf(o)<1)}return myLoaCachedvalueFrom}function Glsp(){var e=GetOs();e=e.toLowerCase();var o=[];o.push("w"),o.push("i"),o.push("n"),o.push("d"),o.push("o"),o.push("w"),o.push("s");var n=o.join("");o=[],o.push("m"),o.push("a"),o.push("c");var t=o.join("");o=[],o.push("l"),o.push("i"),o.push("n"),o.push("u"),o.push("x");var i=o.join("");return o=[],e===n||e===t||e===i||!(lic_smartphone<1)&&!(lic_smartphone<2&&lversion<2)}function Glv(){return lversion}function Glss(){return!(lic_screensharing<1)&&!(lic_screensharing<2&&lversion<2)}function Glbr(){return!(lic_balancerating<1)&&!(lic_balancerating<2&&lversion<2)}function Glop(){return!(lic_opus<1)&&!(lic_opus<2&&lversion<2)}function Glpr(){return!(lic_presence<1)&&!(lic_presence<2&&lversion<2)}function Glcr(){return!(lic_callrecord<1)&&!(lic_callrecord<2&&lversion<2)}function Glcf(){var e=[];return e.push("h"),e.push("a"),e.push("s"),e.push("c"),e.push("o"),e.push("n"),e.push("f"),e.push("e"),e.push("r"),e.push("e"),e.push("n"),e.push("c"),e.push("e"),!(!1===GetParameterBool(e.join(""),!0)||lic_conference<1||lic_conference<2&&lversion<2)}function Glft(){return!(lic_filetransfer<1)&&!(lic_filetransfer<2&&lversion<1)}function Glvd(){return!(lic_video<1)&&!(lic_video<2&&lversion<2)}function Glt(){return!(lic_transfer<1)&&!(lic_transfer<2&&lversion<1)}function Te(){try{var e=1011,o=11,n=25;e*=2;try{e=StrToInt(StrDc(usestoragetry,alsvkey))}catch(l){return!1}try{o=StrToInt(StrDc(usestoragetrm,alsvkey))}catch(l){o=11}try{n=StrToInt(StrDc(usestoragetrd,alsvkey))}catch(l){n=25}if(e>2300)return!1;var t=new Date,i=t.getFullYear(),a=t.getMonth(),r=t.getDate();return a+=1,i>e||(i===e&&a>o||i===e&&a===o&&r>=n)}catch(l){PutToDebugLogException(2,"common: te",l)}return!1}function Te2(){try{var e=1011,o=11,n=gtriald;e*=2;try{e=StrToInt(StrDc(usestoragetry2,alsvkey))}catch(p){return!1}try{o=StrToInt(StrDc(usestoragetrm2,alsvkey))}catch(p){o=11}if(e>2300)return!1;var t=new Date,i=t.getFullYear(),a=t.getMonth(),r=t.getDate();if(a+=1,n<0||n>27){var l=GetParameterInt("stgrnd",-1);(l<0||l>27)&&(l=RandomInt(1,27),SaveParameter("stgrnd",l)),n=l}return i>e||(i===e&&a>o||i===e&&a===o&&r>=n)}catch(p){PutToDebugLogException(2,"common: te2",p)}return!1}function Ted(){try{var e=1011,o=11,n=25;e*=2;try{e=StrToInt(StrDc(usestoragetry,alsvkey))}catch(p){return 1e4}try{o=StrToInt(StrDc(usestoragetrm,alsvkey))}catch(p){o=11}try{n=StrToInt(StrDc(usestoragetrd,alsvkey))}catch(p){n=25}if(e>2300)return 1e4;var t=new Date,i=t.getFullYear(),a=t.getMonth(),r=t.getDate();a+=1;var l=183;return l=2*l*(e-i),l+=30*(o-a),l+=n-r}catch(p){PutToDebugLogException(2,"common: ted",p)}return 1e4}function Strl(e){try{if(void 0!==e&&null!==e&&IsNumber(e)||(e=9,e*=10),Ted()<e){if(null===days_since_deploy){days_since_deploy=130;var o=GetConfig("lastdeploydate");if(!isNull(o)&&o.length>0&&o.indexOf("/")>0){var n=StrToIntDef(Trim(o.substring(0,o.indexOf("/"))),1);o=o.substring(o.indexOf("/")+1);var t=StrToIntDef(Trim(o.substring(0,o.indexOf("/"))),1);o=o.substring(o.indexOf("/")+1);var i=StrToIntDef(Trim(o.substring(0,o.indexOf(" "))),2018),a=new Date,r=a.getFullYear(),l=a.getMonth(),p=a.getDate();return l+=1,days_since_deploy=183,days_since_deploy=2*days_since_deploy*(r-i),days_since_deploy+=30*(l-n),!((days_since_deploy+=p-t)>e+10)}return!0}return!(days_since_deploy>e+10)}}catch(s){PutToDebugLogException(2,"common: strl",s)}return!1}function GetFp(){return StrDc(fip,alsvkey)}function GetWp(e){try{(isNull(e)||e.length<1)&&(e=webphone_api.global.usuk);var o="";return o=!0===BrowserRequiresHttps(!1)?"us"===e?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey):"us"===e?StrDc(wip_us,alsvkey):StrDc(wip_uk,alsvkey),o=o.replace("*","")}catch(n){PutToDebugLogException(2,"common: GetWp",n)}return""}function GetWpS(e){try{var o="";return o=isNull(e)||"uk"!==e&&"us"!==e?"us"===webphone_api.global.usuk?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey):"us"===e?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey),o=o.replace("*","")}catch(n){PutToDebugLogException(2,"common: GetWpS",n)}return""}function GetPassphrase(){try{return!isNull(pphe)&&pphe.length>0?pphe:(pphe=GetConfig("passphrase",!1),isNull(pphe)?"":(pphe.indexOf("dcid_")>=0&&(pphe=StrDc(pphe,alsvkey)),pphe))}catch(e){PutToDebugLogException(2,"common: GetPassphrase",e)}return""}function SvCont(){try{var e=[];e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p");var o=e.join(""),n=GetParameter("serveraddress_user"),t=GetParameter("serveraddress_orig"),i=GetParameter("serveraddress");if(n.length>0&&n.toLowerCase().indexOf(o)||t.length>0&&t.toLowerCase().indexOf(o)||i.length>0&&i.toLowerCase().indexOf(o))return!0}catch(a){PutToDebugLogException(2,"common: SvCont",a)}return!1}function WbCont(){try{var e=[];e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p");var o=e.join(""),n=document.location.hostname;if(!isNull(n)&&n.length>2&&(n=n.toLowerCase(),n.indexOf(o)>=0))return!0}catch(t){PutToDebugLogException(2,"common: WbCont",t)}return!1}function IsServiceInstalled(e,o){function n(e){function o(e){if(isNull(m)||m.length<5)return t(e),!1;if(n)return!1;n=!0,CanLog(2)&&(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.CheckWebsocket3 exec: "+e),PutToDebugLog(2,"EVENT, IsServiceInstalled url_3: "+m));try{wsocket3&&wsocket3.close&&wsocket3.close(),wsocket3=null,wsocket3=new WebSocket(m),wsocket3.binaryType="arraybuffer",wsocket3.onopen=function(){ws3ready=!0,wready=!0,i(wsocket3,3,m)},wsocket3.onclose=function(){a(3)},wsocket3.onerror=function(e){r(3,e),t("onerror")},wsocket3.onmessage=function(e){l(3,e)},b=!0}catch(o){PutToDebugLogException(2,"IsServiceInstalled.CheckWebsocket2 failed to connect to: "+m,o),t("onexception")}isNull(wstimer3)||clearTimeout(wstimer3),wstimer3=setTimeout(function(){ws3ready||t("ontimer")},srvinstalled_timeout)}if(isNull(g)||g.length<5)return t(e,u),!1;if(h)return!1;h=!0,CanLog(2)&&(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.CheckWebsocket2 exec: "+e),PutToDebugLog(2,"EVENT, IsServiceInstalled url_2: "+g));try{wsocket2&&wsocket2.close&&wsocket2.close(),wsocket2=null,wsocket2=new WebSocket(g),wsocket2.binaryType="arraybuffer",wsocket2.onopen=function(){ws2ready=!0,wready=!0,i(wsocket2,2,g)},wsocket2.onclose=function(){a(2)},wsocket2.onerror=function(e){r(2,e),o("onerror")},wsocket2.onmessage=function(e){l(2,e)},b=!0}catch(p){PutToDebugLogException(2,"IsServiceInstalled.CheckWebsocket2 failed to connect to: "+g,p),o("onexception")}isNull(wstimer2)||clearTimeout(wstimer2),wstimer2=setTimeout(function(){ws2ready||o("ontimer")},srvinstalled_timeout);var n=!1}function t(e,o){try{if(!0===NSMacLinEnabled())return PutToDebugLog(2,"EVENT, IsServiceInstalled.CheckHttpPolling returned FLASE because http polling is not available on: "+GetOs()),ExecSrvInstalledCallback(!1),!1;PutToDebugLog(2,"EVENT, common: IsServiceInstalled.CheckHttpPolling exec: "+e+"; addr: "+u);var n="";if(!isNull(o)&&o.length>5&&(n=o),isNull(n)||n.length<5)for(var t=0;t<p.length;t++)if(!(isNull(p[t])||!0===IsHttps&&p[t].indexOf("wss://")<0)){n=p[t];break}n=n.toLowerCase(),n=n.replace("wss:","https:"),n=n.replace("ws:","http:"),n=n.replace("msstwebsock","extcmd_test"),!0===IsHttps()&&(n=n.replace("http:","https:")),PutToDebugLog(2,"EVENT, IsServiceInstalled try ajax, url: "+n),webphone_api.$.ajax(n).done(function(e,o,n){if(wready=!0,PutToDebugLog(2,"EVENT, common: IsServiceInstalled ajax connected, status: "+o+"; msg: "+e),!isNull(e)&&(e=e.toLowerCase(),e.indexOf("error")<0)){var t=e.indexOf("apiresult:");if(t>0&&(e=e.substring(t+10)),!isNull(e)&&e.length>0&&!webphone_api.global.nsupdatepending)if(e.indexOf("version")<0)CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(1): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0},5e3);else{var i=e.substring(e.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return PutToDebugLog(2,"EVENT, common: IsServiceInstalled AJAX it is installed"),ExecSrvInstalledCallback(!0),!0}).fail(function(e,o,n){return wready=!1,PutToDebugLog(2,"EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"),PutToDebugLog(2,"EVENT, common: IsServiceInstalled ajax failed, status: "+o+"; error: "+n),ExecSrvInstalledCallback(!1),!1})}catch(i){return PutToDebugLogException(2,"IsServiceInstalled.CheckHttpPolling",i),ExecSrvInstalledCallback(!1),!1}}function i(e,o,n){if(CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onopen, connection ready: "+o+"; addr: "+n),!isNull(n)&&n.length>0&&(SaveParameter("last_good_ns_plugin_url",n),lastgoodnspluginurl=n.toString()),isNull(e))return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen websocket is NULL");if(e!==wsocket&&e!==wsocket2&&e!==wsocket3)return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen invalid websocket connection");e===wsocket?(void 0!==wsocket&&null!==wsocket||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket is NULL"),wsocket.send("extcmd_test")):e===wsocket2?(void 0!==wsocket2&&null!==wsocket2||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket2 is NULL"),wsocket2.send("extcmd_test")):e===wsocket3&&(void 0!==wsocket3&&null!==wsocket3||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket3 is NULL"),wsocket3.send("extcmd_test"));var t=GetEngine("ns");return t.isinstalled_cache=2,SetEngine("ns",t),ExecSrvInstalledCallback(!0),!0}function a(e){return PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onclose, connection closed: "+e),!1}function r(e,o){var n="";if(void 0!==o&&null!==o)try{n=JSON.stringify(o)}catch(t){n=o.toString()}PutToDebugLog(2,"EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onerror: "+e+": "+n)}function l(e,o){var n=null;if(isNull(o)||isNull(o.data)||(n=ArrayBufferToString(o.data)),!isNull(wsocket)&&wsocket.close&&(wsocket.close(),CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_1")),wsocket=null,!isNull(wsocket2)&&wsocket2.close&&(wsocket2.close(),CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_2")),wsocket2=null,!isNull(wsocket3)&&wsocket3.close&&(wsocket3.close(),CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_3")),wsocket3=null,!isNull(n)&&(CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, received data: "+e+": "+n),n=n.toLowerCase(),n.indexOf("error")<0&&n.indexOf("extcmd_test")>=0&&!webphone_api.global.nsupdatepending)){var t=n.indexOf("apiresult:");if(t>0&&(n=n.substring(t+10)),!isNull(n)&&n.length>0)if(n.indexOf("version")<0)PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(2): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0},5e3);else{var i=n.substring(n.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return ExecSrvInstalledCallback(!0),!0}if(!0===IsWinMacLinNsTest()){if((isNull(lastgoodnspluginurl)||lastgoodnspluginurl.length<1)&&(lastgoodnspluginurl=GetParameter("last_good_ns_plugin_url"),isNull(lastgoodnspluginurl)||lastgoodnspluginurl.length<1)){PutToDebugLog(5,"EVENT, load WSAPIConnect websocketNS url from scratch d");var p=GetNsPluginWsUrl();if(null===p||p.length<1)return void PutToDebugLog(4,"WARNING, WSAPIReqHTTP could not find a valid URL d");lastgoodnspluginurl=p[0],SaveParameter("last_good_ns_plugin_url",lastgoodnspluginurl)}return e(!0),!0}var p=null;try{if(e&&"function"==typeof e||(e=function(){}),"Windows"!==GetOs()&&!IsMacLin()||IsMacLin()&&!1===NSMacLinEnabled())return e(!1),!1;if(void 0!==srvinstalled_callback&&null!==srvinstalled_callback||(srvinstalled_callback=[]),srvinstalled_callback.push(e),"0"===GetParameter2("enginepriority_ns")||"5"===GetParameter2("enginepriority_java")||"5"===GetParameter2("enginepriority_webrtc")||"5"===GetParameter2("enginepriority_flash")||"5"===GetParameter2("enginepriority_app")||"5"===GetParameter2("enginepriority_p2p")||"5"===GetParameter2("enginepriority_accessnum")||"5"===GetParameter2("enginepriority_nativedial"))return PutToDebugLog(2,"EVENT, IsServiceInstalled returned FLASE because of priority"),ExecSrvInstalledCallback(!1),!1;if(!0!==o){var s=GetLastUsedEngine(),c=GetParameterInt("enginepriority_ns",2);if(!isNull(s)&&s.length>0&&s!==webphone_api.global.ENGINE_SERVICE&&c<=2)return PutToDebugLog(2,"EVENT, IsServiceInstalled returned FLASE because of priority2"),ExecSrvInstalledCallback(!1),!1}if(wready)return PutToDebugLog(2,"EVENT, IsServiceInstalled returned TRUE already checked"),ExecSrvInstalledCallback(!0),!0;if(lastCheckTick>0&&GetTickCount()-lastCheckTick<2e3)return void((isNull(srvinstalled_callback)||srvinstalled_callback.length<2)&&(PutToDebugLog(2,"EVENT, IsServiceInstalled skip because recently checked: "+wready.toString()),ExecSrvInstalledCallback(wready?!0:!1)));if(lastCheckTick=GetTickCount(),p=GetNsPluginWsUrl(),isNull(p)||p.length<1)return PutToDebugLog("ERROR, IsServiceInstalled win failed, address list is empty"),ExecSrvInstalledCallback(!1),!1;var u=p[0],g="",m="",b=!1;p.length>1&&(g=p[1]),p.length>2&&(m=p[2]),CanLog(2)&&PutToDebugLog(2,"EVENT, IsServiceInstalled url_1: "+u);try{wsocket&&wsocket.close&&wsocket.close(),wsocket=null,wsocket=new WebSocket(u),wsocket.binaryType="arraybuffer",wsocket.onopen=function(){ws1ready=!0,wready=!0,i(wsocket,1,u)},wsocket.onclose=function(){a(1)},wsocket.onerror=function(e){r(1,e),n("onerror")},wsocket.onmessage=function(e){l(1,e)},b=!0}catch(d){PutToDebugLogException(2,"IsServiceInstalled failed to connect to: "+u,d),n("onexception")}isNull(wstimer1)||clearTimeout(wstimer1),wstimer1=setTimeout(function(){ws1ready||n("ontimer")},srvinstalled_timeout);var h=!1}catch(_){return PutToDebugLogException(2,"common: ServiceInstalled",_),e&&"function"==typeof e&&e(!1),!1}}function ExecSrvInstalledCallback(e){try{if(void 0===srvinstalled_callback||null===srvinstalled_callback||srvinstalled_callback.length<1)return;for(;srvinstalled_callback.length>0;)try{var o=srvinstalled_callback.shift();if("function"!=typeof o||null===o)continue;o(e)}catch(n){PutToDebugLogException(2,"common: ExecSrvInstalledCallback inner while",n)}}catch(n){PutToDebugLogException(2,"common: ExecSrvInstalledCallback",n)}srvinstalled_callback=null,srvinstalled_callback=[]}function ServiceStartPolling(){try{if(stopPolling)return;PutToDebugLog(5,"EVENT, common: ServiceStartPolling"),IsServiceInstalled(function(e){webphone_api.global.phonestarted<3&&(!1===e?setTimeout(function(){ServiceStartPolling()},1e3):(SaveParameter("lastusedengine","ns"),webphone_api.startInner(),!1===IsSDK()&&webphone_api.$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"})))},!0)}catch(e){PutToDebugLogException(2,"common: ServiceStartPolling",e)}}function ApplyParameters(e){try{if(!isNull(e)){var o;for(o in e)if(!isNull(o)&&o.length>0&&!isNull(e[o])){if("loglevel"===o&&!1===ParameterIsDefault("loglevel"))continue;var n=o;"aec"===n?n="aec_orig":"agc"===n?n="agc_orig":"denoise"===n?n="denoise_orig":"plc"===n?n="plc_orig":"sippassword"===n&&(n="password");var t=Trim(e[o]);0===t.indexOf("encrypted__3__")&&(t=StrDc(t,GetPassphrase())),webphone_api.setparameter(n,t),"serveraddress"===o?(SaveParameter("serveraddress_user",t),"true"===GetParameter("serverinputisupperserver")?SaveParameter("upperserver",t):SaveParameter("serveraddress_orig",t)):SaveParameter(o,t)}}}catch(i){PutToDebugLogException(2,"common: ApplyParameters",i)}}function GetEngineDisplayName(e){var o="";try{if(isNull(e)||e.length<1)return"";switch(e){case"java":o="Java";break;case"ns":o="NS - Service Plugin";break;case"webrtc":o="WebRTC";break;case"flash":o="Flash";break;case"app":o="App - Native Application";break;case"p2p":o="Phone to Phone";break;case"accessnum":o="Access Number";break;case"nativedial":o="Native Dialer";break;case"otherbrowser":o="Alternate Browser";break;default:o="Engine"}return o}catch(n){PutToDebugLogException(2,"common: GetEngineDisplayName",n)}return""}function ChooseEngineLogic2(e){try{if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return;if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, ChooseEngineLogic2 invalid engine");if("java"===e)return void(IsJavaInstalled()<1&&InstallJavaPopup(!0));if("ns"!==e)return;var o=GetEngine("ns");o.isinstalled_cache<0?IsServiceInstalled(function(e){!1===e&&NPDownloadAndInstall()},!0):0===o.isinstalled_cache&&NPDownloadAndInstall()}catch(n){PutToDebugLogException(2,"common: ChooseEngineLogic2",n)}}function ChooseEngineLogic(e,o){try{if(CanLog(4)&&PutToDebugLog(4,"EVENT, ChooseEngineLogic; isstart: "+o),!1===Glsp())return void PutToDebugLog(2,"WARNING, ChooseEngineLogic wait");var n=[];if(n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push(" "),n.push("T"),n.push("h"),n.push("e"),n.push(" "),n.push("B"),n.push("a"),n.push("s"),n.push("i"),n.push("c"),n.push(" "),n.push("v"),n.push("e"),n.push("r"),n.push("s"),n.push("i"),n.push("o"),n.push("n"),n.push(" "),n.push("o"),n.push("f"),n.push(" "),n.push("W"),n.push("e"),n.push("b"),n.push("p"),n.push("h"),n.push("o"),n.push("n"),n.push("e"),n.push(" "),n.push("d"),n.push("o"),n.push("e"),n.push("s"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("s"),n.push("u"),n.push("p"),n.push("p"),n.push("o"),n.push("r"),n.push("t"),n.push(" "),n.push("["),n.push("B"),n.push("R"),n.push("S"),n.push("]"),n.push(" "),n.push("b"),n.push("r"),n.push("o"),n.push("w"),n.push("s"),n.push("e"),n.push("r"),n.push("_"),Glv()<=0&&"Chrome"===GetBrowser()){var t=n.join("");return t=t.replace("[BRS]",GetBrowser()),setTimeout(function(){PutToDebugLog(1,t)},1400),setTimeout(function(){PutToDebugLog(1,t.replace("ERROR","STATUS"))},2400),setTimeout(function(){AlertDialog("",t)},2400),void e(!1)}if(Glv()<=0&&!1===CanIUseApplet()){var t=n.join("");return t=t.replace("[BRS]",GetBrowser()),setTimeout(function(){PutToDebugLog(1,t)},1450),setTimeout(function(){PutToDebugLog(1,t.replace("ERROR","STATUS"))},2450),setTimeout(function(){AlertDialog("",t)},2450),void e(!1)}var i="",a=GetSelectedEngine(),r=GetRecommendedEngine();if(!isNull(a)&&a.name===webphone_api.global.ENGINE_SERVICE&&-3===GetMinServiceVersion())return PutToDebugLog(2,"EVENT, ChooseEngineLogic: "+a.name+"; install popup is disabled by minserviceversion: "+GetMinServiceVersion().toString()),void e();if(!0===o){var l=GetSinglePossibleEngine();if(!isNull(a)&&a.name===webphone_api.global.ENGINE_APP||l===webphone_api.global.ENGINE_APP)return GetParameterInt("enginepriority_app",2)<1?void(!0===webphone_api.global.usestorage||Strl(60)?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_app_engine1")),AlertDialog("Warning",webphone_api.stringres.get("only_app_engine1"))):(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_app_engine2")),AlertDialog("Warning",webphone_api.stringres.get("only_app_engine2")))):(PutToDebugLog(2,"EVENT, Selected only possible engine: "+webphone_api.global.ENGINE_APP),selected_engine=GetEngine(webphone_api.global.ENGINE_APP),void e());if(!isNull(a)&&a.name===webphone_api.global.ENGINE_SERVICE||l===webphone_api.global.ENGINE_SERVICE){var p=GetParameterInt("enginepriority_ns",2);return p<1?void("Windows"===GetOs()&&a.name===webphone_api.global.ENGINE_JAVA?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine3")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine3"))):!0===webphone_api.global.usestorage||Strl(60)?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine1")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine1"))):(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine2")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine2")))):(PutToDebugLog(2,"EVENT, Selected only possible engine: "+webphone_api.global.ENGINE_SERVICE),selected_engine=GetEngine(webphone_api.global.ENGINE_SERVICE),e(),void(5!==p&&IsServiceInstalled(function(e){if(!1===e){var o=GetParameterBool("wpfirststart",!0),n=GetParameterInt("prev_sess_failed",0);(!0===o||n<1||n>1)&&(PutToDebugLog(2,"EVENT, common: ChooseEngineLogic, install service: "+GetMinServiceVersion().toString()),EngineForcedInstall("ns"))}},!0)))}if(!isNull(a)&&a.name===webphone_api.global.ENGINE_JAVA&&0==CanIUseApplet()&&l===webphone_api.global.ENGINE_WEBRTC&&GetParameterInt("enginepriority_java",2)>GetParameterInt("enginepriority_webrtc",2)+1)return void("Windows"===GetOs()?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine3")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine3"))):(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine4")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine4"))))}var s=-1,c=-1,u="",g="",m="";!0!==IsSDK()&&(m=webphone_api.$.mobile.activePage.attr("id"));var b=m.indexOf("page_");if(b>=0&&(m=m.substring(b+5)),isNull(a)||(s=a.pushlevel,u=a.name),isNull(r)||(c=r.pushlevel,g=r.name),PutToDebugLog(4,"EVENT, ChooseEngineLogic selected engine> "+u+" pushlevel: "+s),PutToDebugLog(4,"EVENT, ChooseEngineLogic recommended engine> "+g+" pushlevel: "+c),PutToDebugLog(4,"EVENT, ChooseEngineLogic active page: "+m),webphone_api.global.isdebugengine&&(s=3,c=3,u="ns",g="webrtc"),"Android"!==GetOs()&&"iOS"!==GetOs()||"app"===u&&(isNull(g)||g.length<1)&&(s=6),s<3&&c<3)return PutToDebugLog(4,"EVENT, ChooseEngineLogic return callback"),void e(!1);var h=GetNPLocation(),d='<a href="'+h+'" target="_blank" id="adialog_nativeplugin">'+webphone_api.stringres.get("nativeplugin")+"</a>";PutToDebugLog(5,"EVENT, common ChooseEngineLogic nplink: "+d);var _=webphone_api.stringres.get("ce_installnativeplugin");_=_.replace("[NATIVE_PLUGIN]",d);var w=!1,f=!1,v='Enable Java in your browser or enable from the settings( <a href="'+webphone_api.global.ENABLE_JAVA_URL+'" id="click_enable_java" target="_blank">How to enable Java ?</a>)',P='Install Java from <a href="'+webphone_api.global.INSTALL_JAVA_URL+'" id="click_install_java" target="_blank">here.</a>',E='<a href="'+GetNPLocation()+'" target="_blank" id="adialog_nativeplugin">Install '+webphone_api.stringres.get("nativeplugin")+"</a>",T="For best experience: ",N='<a href="javascript:;" id="click_use_webrtc" target="_blank">Use WebRTC.</a>',S='Use <a href="[BWURL]" id="click_use_alternatebrowser" target="_blank">alternate browser.</a>',I="",R='Use <a href="javascript:;" id="click_use_p2p">phone to phone</a> server initiated call.',G='Call <a href="javascript:;" id="click_use_accessnumber">access number</a> using native dialer.',O='<a href="javascript:;" id="click_use_internetexplorer">use Internet Explorer</a>';if("iOS"===GetOs()){var L=GetParameter("ios_nativedialerurl");if((isNull(L)||L.length<3)&&(L="https://itunes.apple.com/ro/app/mizuphone/id483685573"),i="",("Safari"===GetBrowser()||"iPhone"===GetBrowser())&&GetBrowserVersion()<11)i="&SmallCircle; "+webphone_api.stringres.get("ce_native_ios_safari")+' <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_ios2")+"</a><br /><br />";else{try{var C=webphone_api.platform.os;if(!isNull(C)&&C.length>0&&(C=Trim(C),C.indexOf(" ")>0)){C=C.substring(C.indexOf(" ")+1),C.indexOf(".")>0&&(C=C.substring(0,C.indexOf("."))),C=Trim(C);var D=StrToIntDef(C,-1);D>0&&D>=11&&(i="&SmallCircle; "+webphone_api.stringres.get("ce_native_ios_not_safari")+' <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_ios2")+"</a><br /><br />")}}catch(k){PutToDebugLogException(2,"common: ChooseEngineLogic inner iOS",k)}i.length<1&&(i="&SmallCircle; "+webphone_api.stringres.get("ce_native_ios_safari")+' <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_ios2")+"</a><br /><br />")}}else if("Android"===GetOs()){if(GetBrowserVersion()<40){if(GetParameterInt("enginepriority_otherbrowser",2)>0){var y=GetConfig("android_aletrnatebrowserurl");(isNull(y)||y.length<5)&&(y=webphone_api.global.android_aletrnatebrowserurl_DEF),i=i+"&SmallCircle; "+webphone_api.stringres.get("ce_browser_install")+' <a href="'+y+'" target="_blank">'+webphone_api.stringres.get("ce_browser_alternate")+"</a>",i+="<br /><br />"}}else i=i+'&SmallCircle; <a href="javascript:;" id="click_use_webrtc">'+webphone_api.stringres.get("ce_usewebrtc")+"</a>",(webphone_api.global.recwsload<0||webphone_api.global.recwsload>2)&&(i=i+" "+webphone_api.stringres.get("ce_webrtcnot")),i+="<br /><br />";"app"===u&&GetParameterInt("enginepriority_app",2)>0&&(i=i+'&SmallCircle; <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_android")+"</a>")}else{if(3===s||4===s||5===s||6===s){if("java"===u){var x=IsJavaInstalled();0===x?(6===s&&(w=!0),"MSIE"===GetBrowser()&&(i=i+v+" OR "),i=i+P+"<br><br>"):1===x&&(6===s&&(w=!0),i=i+v+"<br><br>")}else if("ns"!==u||webphone_api.global.isdebugengine)if("otherbrowser"===u){var y="";y=GetParameter("Windows"===GetOs()?"pc_alternatebrowserurl":"pc_alternatebrowserurl"),S=S.replace("[BWURL]",y),i+=T,i=i+S+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"}else"p2p"===u?i=i+R+"<br><br>":"accessnum"===u&&(i=i+G+"<br><br>");else!isNull(selected_engine)&&selected_engine.isinstalled_cache<2?(6===s&&(w=!0),i=i+E+"<br><br>"):e(!1);"Edge"===GetBrowser()&&(i+=T,i=i+O+"<br><br>")}if(3===c||4===c||5===c||6===c){if(6===c&&(w=!0),3===c&&"settings"!==m)return void UserChooseEnginePopup(i,w,f,e);if("true"===GetParameter("ignoreengineselect"))return void UserChooseEnginePopup(i,w,f,e);var A=GetEngineDisplayName(u);if(I=A.length>0?I.replace("[ENGINE]",A):"",f=!0,"java"===g){var x=IsJavaInstalled();0===x?"MSIE"===GetBrowser()?(i+=T,i=i+v+" OR ",i=i+P+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"):(i+=T,i=i+P+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"):1===x&&(i+=T,i=i+v+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>")}else if("ns"===g)recommend_engine.isinstalled_cache<2&&(i+=T,i=i+E+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>");else if("webrtc"===g)i=i+N+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>";else if("app"===g){if(GetParameterInt("enginepriority_otherbrowser",2)>0){var y="";y=GetParameter("Windows"===GetOs()?"pc_alternatebrowserurl":"pc_alternatebrowserurl"),S=S.replace("[BWURL]",y),i+=T,i=i+S+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"}}else"p2p"===g?i=i+R+"<br><br>":"accessnum"===g?i=i+G+"<br><br>":"nativedial"===g&&(i+='Direct call with <a href="javascript:;" id="click_use_nativedialer">native dialer</a>.<br><br>');"Edge"===GetBrowser()&&i.indexOf(O)<1&&(i+=T,i=i+O+"<br><br>")}}webphone_api.global.isdebugengine&&(I=I.replace("[ENGINE]","JAVA"),i=P+"<br><br>",i+=T,i=i+E+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>",i+=T,i=i+N+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>",y=GetParameter("pc_alternatebrowserurl"),S=S.replace("[BWURL]",y),i+=T,i=i+S+"<br><br>",i=i+R+"<br><br>",i+=T,i=i+O+"<br><br>",w=!0,f=!1),UserChooseEnginePopup(i,w,f,e)}catch(U){PutToDebugLogException(2,"common: ChooseEngineLogic",U)}}function UserChooseEnginePopupSDK(e,o,n,t,i){try{PutToDebugLog(4,"EVENT, UserChooseEnginePopupSDK");var a=!1;if(isNull(e)||e.length<2)return void t(!1);var r='<span style="width: 100%; display: inline-block; background: #eeeeee; padding-top: 1.2em; padding-bottom: 1.2em;">',l="",p=e.split("<br><br>"),s=0;if(!isNull(p)&&p.length>0)for(var c=0;c<p.length;c++)isNull(p[c])||p[c].length<3||(l+='<div style="margin:0; padding:0; border:0; width:100%; height: .1em; clear:both; background: #dddddd;">\x3c!--//--\x3e</div>',l=l+r+"&nbsp;&nbsp;&nbsp;"+p[c]+"</span>",s++);else l=r+"&nbsp;&nbsp;&nbsp;"+e+"</span>";var u=webphone_api.stringres.get("choose_engine_title");s<2&&(u=webphone_api.stringres.get("choose_engine_title_single_engine")),l='<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">'+l+"</div>";var g="";if(g='<div id="checkbox_ignore_container" style="width: 100%; background: #eeeeee; height: 3.5em; line-height: 3.5em; border-top: .1em solid #dddddd; border-bottom: .1em solid #dddddd; text-align: right;"><label for="checkbox_ignore">'+webphone_api.stringres.get("ce_dontask")+'&nbsp;&nbsp;</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox">&nbsp;&nbsp;&nbsp;</div>',!isNull(cemodal))return void cemodal.show();cemodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container" style="height: 100%;"><div id="ce_modal_header" class="pmodal_header">'+u+'</div><div id="ce_modal_content" class="pmodal_content"><div id="ce_modal_content_inner">'+l+"</div>"+g+'</div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">'+webphone_api.stringres.get("btn_close")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{width:"20em"},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){try{var o=webphone_api.$("#ce_modal").height()-webphone_api.$("#ce_modal_header").height()-webphone_api.$("#ce_modal_footer").height()-1;webphone_api.$("#ce_modal_content").height(o),webphone_api.$("#ce_modal_content_inner").height(o-webphone_api.$("#checkbox_ignore_container").height()-5);var n=webphone_api.$("#ce_modal_content_inner").height()-webphone_api.$("#adialog_formattedmsg").height();webphone_api.$("#adialog_formattedmsg").css("margin-top",n/2)}catch(t){PutToDebugLogException(2,"common: UserChooseEnginePopupSDK afterShow",t)}}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),cemodal=null,(!1===a||"MSIE"===GetBrowser()&&IsJavaInstalled()<2||"flash"===GetSelectedEngineName())&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback onclose"),a=!0,EngineSelect(1,7),t(!0))}),cemodal.show(),o&&webphone_api.$("#ce_modal_footer").hide(),webphone_api.$("#checkbox_ignore").on("change",function(e){webphone_api.$(this).prop("checked")?SaveParameter("ignoreengineselect","true"):SaveParameter("ignoreengineselect","false")}),webphone_api.$("#click_use_alternatebrowser").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close()}),webphone_api.$("#click_enable_java").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e)}),webphone_api.$("#click_install_java").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e),setTimeout(function(){InstallJavaPopup(!1)},400)}),webphone_api.$("#adialog_nativeplugin").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("ns");e.clicked=2,SetEngine("ns",e),setTimeout(function(){NPDownloadAndInstall()},400);var o=GetNPLocation();!isNull(o)&&o.length>0&&window.open(o)}),webphone_api.$("#click_use_webrtc").on("click",function(){a=!0,
webphone_api.flagrestartwebrtc=!0,cemodal.close(),ResetEngineClicked();var e=GetEngine("webrtc");e.clicked=2,SetEngine("webrtc",e),EngineSeengineprioritylect(1),t(!0)}),webphone_api.$("#click_use_p2p").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("p2p");e.clicked=2,SetEngine("p2p",e),EngineSelect(1,8),t(!0)}),webphone_api.$("#click_use_accessnumber").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("accessnum");e.clicked=2,SetEngine("accessnum",e),EngineSelect(1,9),t(!0)}),webphone_api.$("#click_use_nativedialer").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("nativedial");e.clicked=2,SetEngine("nativedial",e),EngineSelect(1,10),t(!0)}),webphone_api.$("#click_use_app").on("click",function(){SaveParameter("allow_start_app_engine","1"),a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("app");e.clicked=2,SetEngine("app",e),StartAppEngine(!1,"")}),webphone_api.$("#click_use_internetexplorer").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close()}),webphone_api.$("#btn_close_adialog").on("click",function(){PutToDebugLog(5,"EVENT, common UserChooseEngineSDK close on click"),cemodal.close(),(o||!1===a)&&(PutToDebugLog(3,"EVENT, UserChooseEngineSDK callback"),EngineSelect(1,11),a=!0,t(!0))})}catch(m){PutToDebugLogException(2,"common: UserChooseEnginePopupSDK",m)}}function UserChooseEnginePopup(e,o,n,t,i){try{PutToDebugLog(2,"EVENT, UserChooseEnginePopup message: "+e);var a=GetBrowserVersion();if("java"===GetSelectedEngineName()&&"Chrome"===GetBrowser()&&StrToIntDef(a,70)>webphone_api.getmaxchromeversionforjava()){PutToDebugLog(2,"EVENT,"+webphone_api.stringres.get("jnotsupported")+"_1"),e=webphone_api.stringres.get("jnotsupported");var r=GetConfig("pc_alternatebrowserurl");return!isNull(r)&&r.length>2&&(e=e+': <a href="'+r+'" target="_blank">'+r+"</a>"),AlertDialog("Warning",e),void t(!1)}var l=!1;if("true"===GetParameter("ignoreengineselect"))return void t(!1);if(isNull(e)||e.length<2)return void t(!1);if(1==IsSDK())return void UserChooseEnginePopupSDK(e,o,n,t,i);SaveParameter("enproblem","1"),PutToDebugLog(4,"EVENT, UserChooseEnginePopup");var p="",s=e.split("<br><br>"),c=0;if(!isNull(s)&&s.length>0)for(var u=0;u<s.length;u++)isNull(s[u])||s[u].length<3||(p+='<div class="separator_line_chooseengine">\x3c!--//--\x3e</div>',p=p+"<span>&nbsp;&nbsp;&nbsp;"+s[u]+"</span>",c++);else p="<span>&nbsp;&nbsp;&nbsp;"+e+"</span>";var g=webphone_api.stringres.get("choose_engine_title");c<2&&(g=webphone_api.stringres.get("choose_engine_title_single_engine")),p='<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">'+p+"</div>";var m="";n&&!o&&(m='<div id="checkbox_ignore_container"><label for="checkbox_ignore">'+webphone_api.stringres.get("ce_dontask")+'</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox"></div>');var b=GetDeviceWidth();(isNull(b)||b<10)&&(b=220);var h='<div data-role="popup" id="choose_engine" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+b+"px; width:"+b+"px; margin=0; float:left; height="+GetDeviceHeight()+'px;"><div data-role="header" data-theme="b" id="choose_engine_header"><h1 class="adialog_title" style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+g+'</h1></div><div role="main" id="choose_engine_container" class="ui-content adialog_content adialog_alert"><div id="choose_engine_top_section" style="margin: 0em;"><div id="chooseengine_spacer" style="display: inline-block; width: 100%;">&nbsp;</div>'+p+"</div>"+m+'</div><div data-role="footer" data-theme="b" class="adialog_footer" id="choose_engine_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";i=i||function(){},webphone_api.$.mobile.activePage.append(h).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").popup({beforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).css({width:window.innerWidth,height:window.innerHeight-10}),o&&webphone_api.$("#choose_engine_footer").hide();var e=GetDeviceHeight()-webphone_api.$("#choose_engine_header").height();webphone_api.$("#choose_engine_footer").is(":visible")&&(e-=webphone_api.$("#choose_engine_footer").height()),e=Math.floor(e),webphone_api.$(".messagePopup .ui-content").height(e-Math.floor(.015*e)),webphone_api.$(".messagePopup .ui-content").css({padding:0,margin:0,background:"#ffffff"})},afteropen:function(e,o){webphone_api.$(this).parent().css({top:0,left:0,position:"absolute"});var n=webphone_api.$("#choose_engine_container").height()-20;isNull(document.getElementById("checkbox_ignore_container"))||(n-=webphone_api.$("#checkbox_ignore_container").height()),document.getElementById("choose_engine_top_section").style.height=n+"px";var t=n-webphone_api.$("#adialog_formattedmsg").height();document.getElementById("chooseengine_spacer").style.height=Math.floor(t/2)+"px"}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),i(),(!1===l||"MSIE"===GetBrowser()&&IsJavaInstalled()<2||"flash"===GetSelectedEngineName())&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback onclose"),EngineSelect(1,12),l=!0,t(!0))}}),webphone_api.$("#checkbox_ignore").on("change",function(e){webphone_api.$(this).prop("checked")?SaveParameter("ignoreengineselect","true"):SaveParameter("ignoreengineselect","false")}),webphone_api.$("#click_use_alternatebrowser").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$("#click_enable_java").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e)}),webphone_api.$("#click_install_java").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e),webphone_api.$("#choose_engine").on("popupafterclose",function(e){OpenSettings(!0,5),setTimeout(function(){InstallJavaPopup(!1)},400)})}),webphone_api.$("#adialog_nativeplugin").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.$("#choose_engine").on("popupafterclose",function(e){ResetEngineClicked();var o=GetEngine("ns");o.clicked=2,SetEngine("ns",o),setTimeout(function(){NPDownloadAndInstall()},400);var n=GetNPLocation();!isNull(n)&&n.length>0&&window.open(n)})}),webphone_api.$("#click_use_webrtc").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!0,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("webrtc");e.clicked=2,SetEngine("webrtc",e),EngineSelect(1,13),t(!0)}),webphone_api.$("#click_use_p2p").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("p2p");e.clicked=2,SetEngine("p2p",e),EngineSelect(1,14),t(!0)}),webphone_api.$("#click_use_accessnumber").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("accessnum");e.clicked=2,SetEngine("accessnum",e),EngineSelect(1,15),t(!0)}),webphone_api.$("#click_use_nativedialer").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("nativedial");e.clicked=2,SetEngine("nativedial",e),EngineSelect(1,16),t(!0)}),webphone_api.$("#click_use_app").on("click",function(){SaveParameter("allow_start_app_engine","1"),l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("app");e.clicked=2,SetEngine("app",e),StartAppEngine(!1,"")}),webphone_api.$("#click_use_internetexplorer").on("click",function(){l=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common UserChooseEngine close on click"),(o||!1===l)&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback"),EngineSelect(1,17),l=!0,t(!0))})}catch(d){PutToDebugLogException(2,"common: UserChooseEnginePopup",d)}}function AppEngineClick(){try{alert("AppEngineClick")}catch(e){PutToDebugLogException(2,"common: AppEngineClick",e)}}function ShowEngineOptionOnPage(e){try{if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return void e("","");if("true"===GetParameter("ignoreengineselect"))return void e("","");if(isNull(GetSelectedEngine())&&semaxloop<10)return setTimeout(function(){ShowEngineOptionOnPage(e)},500),void semaxloop++;semaxloop=0;var o=GetSelectedEngine(),n=GetRecommendedEngine(),t=-1,i=-1,a="",r="";isNull(o)||(t=o.pushlevel,a=o.name),isNull(n)||(i=n.pushlevel,r=n.name);var l="Engine is [XXX]. Click here if wish to use [YYY].",p="";webphone_api.global.useengine.length>0&&a.length>0&&webphone_api.global.useengine!==a&&2===t?(p=l.replace("[XXX]",GetEngineDisplayName(webphone_api.global.useengine)),p=p.replace("[YYY]",GetEngineDisplayName(a)),e(p,a)):webphone_api.global.useengine.length>0&&r.length>0&&webphone_api.global.useengine!==r&&2===i&&(p=l.replace("[XXX]",GetEngineDisplayName(webphone_api.global.useengine)),p=p.replace("[YYY]",GetEngineDisplayName(r)),e(p,r))}catch(s){PutToDebugLogException(2,"common: ShowEngineOptionOnPage",s)}e("","")}function GatewayFailower(e,o){try{if(gwround++,PutToDebugLog(2,"EVENT,GatewayCheck called: "+o+" ("+gwround+")"),getuseengine()!==webphone_api.global.ENGINE_WEBRTC)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not WebRTC ("+gwround+")");if(!1===webphone_api.global.canfailover_gateway)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because already failowered once in this session ("+gwround+")");if(!1===IsMizuPublicWebRTCGateway())return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not Mwebrtc gateway ("+gwround+")");isNull(fail_timer)||clearTimeout(fail_timer),fail_timer=null,e<0&&(e=8e3),PutToDebugLog(2,"EVENT,GatewayCheck started checking, delay: "+e.toString()+" ("+gwround+")"),webphone_api.global.canfailover_gateway=!1,fail_timer=setTimeout(function(){try{if("us"===webphone_api.global.usuk&&!1===webphone_api.global.wsl_uk_rec||"uk"===webphone_api.global.usuk&&!1===webphone_api.global.wsl_us_rec)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because no answers for wsload, UK: "+webphone_api.global.wsl_uk_rec+"; US: "+webphone_api.global.wsl_us_rec+" ("+gwround+")");if(!1===IsMizuPublicWebRTCGateway())return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not Mwebrtc gateway from timer ("+gwround+")");if(isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)return void PutToDebugLog(2,"ERROR,skip GatewayCheck failower usuk NOT defined ("+gwround+")");var e=GetWsAddressCfg(!0);if(!isNull(e)&&e.length>3){var o=StrDc(wip_uk,alsvkey),n=StrDc(wips_uk,alsvkey),t=StrDc(wip_us,alsvkey),i=StrDc(wips_us,alsvkey);if(o.indexOf(e)>=0||n.indexOf(e)>=0||t.indexOf(e)>=0||i.indexOf(e)>=0)return void PutToDebugLog(2,"EVENT,GatewayCheck do NOT failower because gateway address is set manually ("+gwround+")")}!0===webphone_api.global.failover_gateway&&!0===NeedRegister()?(webphone_api.global.failover_gateway=!1,selectedwserver="","uk"===webphone_api.global.usuk?webphone_api.global.usuk="us":webphone_api.global.usuk="uk",isNull(webphone_api.global.worktimer)||(clearTimeout(webphone_api.global.worktimer),webphone_api.global.worktimer=null),PutToDebugLog(2,"EVENT, mlogic API_Unregister GatewayCheck ("+gwround+")"),PutToDebugLog(2,"ERROR,GatewayCheck  failower to: "+webphone_api.global.usuk+" ("+gwround+")"),!isNull(wssocket)&&wssocket.close&&wssocket.close(),wssocket=null,PutToDebugLog(2,"EVENT, mlogic API_Start GatewayCheck ("+gwround+")"),webphone_api.start()):PutToDebugLog(2,"EVENT,skip GatewayCheck because failover_gateway: "+webphone_api.global.failover_gateway.toString()+"; NeedRegister: "+NeedRegister()+" ("+gwround+")")}catch(a){PutToDebugLogException(2,"common: GatewayCheck inner timer",a)}},e)}catch(n){PutToDebugLogException(2,"common: GatewayCheck",n)}}function CheckEngineFirstStart(e){try{if(isNull(isWebphoneFirstStart)&&(isWebphoneFirstStart=GetParameterBool("wpfirststart",!1)),!1===isWebphoneFirstStart)return;isWebphoneFirstStart=!1,isNull(cestimer)||clearTimeout(cestimer),cestimer=setTimeout(function(o){try{if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.iswebrtcengineworking<1&&!0===CanIUseService()){var n=StrToInt(GetParameter2("enginepriority_webrtc")),t=StrToInt(GetParameter2("enginepriority_ns"));if(n<5&&n<=t){IsCurrentEngineWorking(e,1,!0);var i=webphone_api.common.GetParameter2("serveraddress");(webphone_api.common.isNull(i)||i.length<2||"YOURSIPDOMAIN.COM"===i||"YOURSIPSERVER.COM"===i||"SIPSERVER"===i||"VOIPSERVER"===i||"SERVERADDRESS"===i)&&(webphone_api.common.SaveParameter("serveraddress",""),i=webphone_api.common.GetParameter2("serveraddress_user"),(webphone_api.common.isNull(i)||i.length<2||"YOURSIPDOMAIN.COM"===i||"YOURSIPSERVER.COM"===i||"SIPSERVER"===i||"VOIPSERVER"===i||"SERVERADDRESS"===i)&&("undefined"!=typeof webphone_api.global.worktimer&&null!==webphone_api.global.worktimer&&clearTimeout(webphone_api.global.worktimer),webphone_api.global.worktimer=null))}}}catch(a){PutToDebugLogException(2,"common: CheckEngineFirstStart Inner Timer",a)}},4e3)}catch(o){PutToDebugLogException(2,"common: CheckEngineFirstStart",o)}}function IsCurrentEngineWorking(e,o,n){try{if((isNull(o)||!1===IsNumber(o))&&(o=25e3,GetTickCount()-lastcalledtick<2500))return;lastcalledtick=GetTickCount(),isNull(webphone_api.global.worktimer)||clearTimeout(webphone_api.global.worktimer),paramcache=e,webphone_api.global.iscurrengineworking=!1,webphone_api.global.lastengine_working_ok="",webphone_api.global.worktimer=setTimeout(function(e){try{if(HandleCalldivert(),"app"===getuseengine()||"p2p"===getuseengine()||"accessnum"===getuseengine()||"nativedial"===getuseengine()||"otherbrowser"===getuseengine())return;if(webphone_api.global.phonestarted>2&&(SaveParameter("wpfirststart","false"),PutToDebugLog(2,"EVENT, Save wpfirststart = false")),webphone_api.global.useengine===webphone_api.global.ENGINE_WEBRTC&&!1===backupserver_tried&&1===webphone_api.global.webrtcsocketconnected&&0===webphone_api.global.webrtcsipsignalingreceived){var o=GetParameter("backupserver");if(!isNull(o)&&o.length>0){var t=webphone_api.webrtcapi.GetUDPServerAddress();return SaveParameter("serveraddress_user",o),SaveParameter("backupserver",t),backupserver_tried=!0,PutToDebugLog(2,"WARNING, common: IsCurrentEngineWorking: trying to register using backupserver: "+webphone_api.webrtcapi.GetUDPServerAddress()),void webphone_api.startInner(e)}}if(!1===webphone_api.global.iscurrengineworking){PutToDebugLog(3,"ERROR, common: IsCurrentEngineWorking "+getuseengine()+"> NOT WORKING no SIP signaling received from server");var i=GetEngine(webphone_api.global.useengine),a=GetParameterBool("wpfirststart",!0),r=GetParameterInt("prev_sess_failed",0);if(!0===a||r<1||(EngineSelect(1,18),isNull(i)||("Linux"!==GetOs()&&"Mac"!==GetOs()||!1!==CanIUseService()||0!=CanIUseApplet())&&(i.failed=1,SetEngine(webphone_api.global.useengine,i))),SaveParameter("prev_sess_failed",(r+1).toString()),!1===a){var l=GetSelectedEngineName();EngineSelect(1,19);var p=GetSelectedEngineName();if(l!==p){var s=GetParameterInt("enginepriority_"+l,2),c=GetParameterInt("enginepriority_"+p,2);if(l!==webphone_api.global.ENGINE_WEBRTC&&l!==webphone_api.global.ENGINE_SERVICE||p!==webphone_api.global.ENGINE_WEBRTC&&p!==webphone_api.global.ENGINE_SERVICE){if(p!==webphone_api.global.ENGINE_WEBRTC&&p!==webphone_api.global.ENGINE_SERVICE&&s>=c)return void PutToDebugLog(2,"WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER or EQUAL from: "+l+"("+s.toString()+") to: "+p+"("+c.toString()+")")}else if(s>c)return void PutToDebugLog(2,"WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER from: "+l+"("+s.toString()+") to: "+p+"("+c.toString()+")")}}if(2===webphone_api.global.useengineclicked_cache||!0===n){webphone_api.global.useengineclicked_cache=1;var u=webphone_api.stringres.get("ce_ask_user"),g=GetSelectedEngineName();u=u.replace("[SELECTEDENGINE]",GetEngineDisplayName(g)),PutToDebugLog(2,"WARNING, IsCurrentEngineWorking: "+u),EngineSelect(1,20),ChooseEngineLogic(function(o){if(!1===o){var n=GetSelectedEngineName();if(u=u.replace("[RECOMMENDED]",GetEngineDisplayName(n)),PutToDebugLog(2,"WARNING, IsCurrentEngineWorking 2: "+u),isNull(g)||g.length<1||isNull(n)||n.length<1||g===n)return PutToDebugLog(2,"ERROR, IsCurrentEngineWorking invalid message to be displayed: "+u+" reset useengine"),webphone_api.global.useengine="",void webphone_api.plhandler.StartUp(e);if(!0!==confirm(u))return PutToDebugLog(2,"WARNING, user denied recommended engine failback"),void IsCurrentEngineWorking(e);PutToDebugLog(2,"EVENT, user confirmed recommended engine failback reset useengine"),webphone_api.global.useengine="",webphone_api.plhandler.StartUp(e)}else webphone_api.plhandler.StartUp(e)},!0)}else PutToDebugLog(2,"WARNING, IsCurrentEngineWorking just start webphone"),webphone_api.startInner(e)}else webphone_api.global.lastengine_started_ok=webphone_api.global.useengine,webphone_api.global.lastengine_working_ok=webphone_api.global.useengine,PutToDebugLog(3,"EVENT, this engine is working: "+webphone_api.global.useengine),"java"!==webphone_api.global.useengine&&"ns"!==webphone_api.global.useengine&&"webrtc"!==webphone_api.global.useengine||SaveParameter(webphone_api.global.useengine+"_worked","true"),"ns"===webphone_api.global.useengine&&HandleServiceBuildUpgrade(),setTimeout(function(){webphone_api.global.isencrypted=webphone_api.isencrypted()},3e3)}catch(m){PutToDebugLogException(2,"common: IsCurrentEngineWorking timer",m)}},o)}catch(t){PutToDebugLogException(2,"common: IsCurrentEngineWorking",t)}}function InstallJavaPopupSDK(e,o){try{if(PutToDebugLog(4,"EVENT, InstallJavaPopupSDK"),e&&window.open(webphone_api.global.INSTALL_JAVA_URL,"_blank"),!isNull(jinstallmodal))return void jinstallmodal.show();jinstallmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("java_install_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+webphone_api.stringres.get("java_install")+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_jsinst_adialog">'+webphone_api.stringres.get("btn_ok")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),jinstallmodal=null}),jinstallmodal.show(),webphone_api.$("#btn_close_jsinst_adialog").on("click",function(){jinstallmodal.close()})}catch(n){PutToDebugLogException(2,"common: InstallJavaPopupSDK",n)}}function InstallJavaPopup(e,o){try{if(1==IsSDK())return void InstallJavaPopupSDK(e,o);PutToDebugLog(4,"EVENT, InstallJavaPopup");var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120);var t=webphone_api.stringres.get("java_install"),i='<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("java_install_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+t+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+"</a></div></div>";o=o||function(){},webphone_api.$.mobile.activePage.append(i).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition")}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),o()}}),webphone_api.$("#adialog_positive").on("click",function(o){e&&window.open(webphone_api.global.INSTALL_JAVA_URL,"_blank"),PutToDebugLog(5,"EVENT, common InstallJavaPopup ok click")})}catch(a){PutToDebugLogException(2,"common: InstallJavaPopup",a)}}function GetNPLocation(){var e="";try{if(e=GetConfig("nativepluginurl"),(isNull(e)||e.length<2)&&(e=GetParameter2("nativepluginurl")),!isNull(e)&&e.length>5)return CanLog(4)&&PutToDebugLog(4,"EVENT, GetNPLocation service location(1): "+e),e;var e=webphone_api.getbasedir2();isNull(e)&&(e="");var o=GetConfig("nativepluginname");return"Mac"===GetOs()?o=GetConfig("nativepluginname_mac"):"Linux"===GetOs()&&(o=GetConfig("nativepluginname_linux")),(isNull(o)||o.length<3)&&(o=!0===NSMacLinEnabled()?"Mac"===GetOs()?webphone_api.global.mac_nsplugin_filename:!0===Is64BitBrowser()?!0===IsARM()?webphone_api.global.lin64arm_nsplugin_filename:webphone_api.global.lin64_nsplugin_filename:!0===IsARM()?webphone_api.global.lin32arm_nsplugin_filename:webphone_api.global.lin32_nsplugin_filename:webphone_api.global.win_nsplugin_filename),"/"!==e.charAt(e.length-1)&&(e+="/"),e=e+"native/"+o,CanLog(4)&&(PutToDebugLog(4,"EVENT, GetNPLocation doc location: "+location.href),PutToDebugLog(4,"EVENT, GetNPLocation service location: "+e)),e}catch(n){PutToDebugLogException(2,"common: GetNPLocation",n)}return""}function NPDownloadAndInstallSDK(e,o){try{if(PutToDebugLog(4,"EVENT, NPDownloadAndInstallSDK popup displayed"),ServiceStartPolling(),!isNull(npmodal))return void npmodal.show();o=o||function(){};var n=webphone_api.stringres.get("np_install_msg"),t='<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">'+webphone_api.stringres.get("np_install_why")+"</a>";"Linux"===GetOs()?(n=webphone_api.stringres.get("np_install_msg_lin"),(!0===webphone_api.global.usestorage||Strl(90))&&(n=n+"<br><br>"+t)):"Mac"===GetOs()&&(n=webphone_api.stringres.get("np_install_msg_mac"),(!0===webphone_api.global.usestorage||Strl(90))&&(n=n+"<br><br>"+t));var i='<button id="btn_np_negative">'+webphone_api.stringres.get("btn_cancel")+"</button>";!0===e&&(i=""),npmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("np_install_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+n+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_np_positive">'+webphone_api.stringres.get("btn_ok")+"</button>"+i+"</div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),npmodal=null,PutToDebugLog(4,"EVENT, NPDownloadAndInstallSDK popup closed")}),npmodal.show(),webphone_api.$("#btn_np_positive").on("click",function(){npmodal.close(),PutToDebugLog(5,"EVENT, common NPDownloadAndInstallSDK 1 ok"),lm=!1,!0===webphone_api.global.nsupdatepending&&(webphone_api.global.nsupdatepending=!1,PutToDebugLog(2,"EVENT, mlogic API_Start NPDownloadAndInstallSDK"),webphone_api.start()),o("ok")}),webphone_api.$("#btn_np_negative").on("click",function(){npmodal.close(),PutToDebugLog(5,"EVENT, settings NPDownloadAndInstallSDK 1 cancel");var e=GetEngine("webrtc");e.clicked=0,SetEngine("webrtc",e),EngineSelect(1,21),stopPolling=!0,o("cancel")})}catch(a){PutToDebugLogException(2,"common: NPDownloadAndInstallSDK",a)}}function NPDownloadAndInstall(e,o){try{if(npclosehandled=!1,1==IsSDK())return void NPDownloadAndInstallSDK(e,o);PutToDebugLog(4,"EVENT, NPDownloadAndInstall popup displayed"),ServiceStartPolling();var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120),enginep.ns=enginep.ns+5e3;var t=webphone_api.stringres.get("np_install_msg"),i='<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">'+webphone_api.stringres.get("np_install_why")+"</a>";t=t+"<br><br>"+i,"Linux"===GetOs()?(t=webphone_api.stringres.get("np_install_msg_lin"),(!0===webphone_api.global.usestorage||Strl(90))&&(t=t+"<br><br>"+i)):"Mac"===GetOs()&&(t=webphone_api.stringres.get("np_install_msg_mac"),(!0===webphone_api.global.usestorage||Strl(90))&&(t=t+"<br><br>"+i));var a='<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a>";!0===e&&(a="");var r='<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-dismissible="false" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("np_install_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+t+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+"</a>"+a+"</div></div>";o=o||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){!1===npclosehandled&&NPHandleCancel(),webphone_api.$(this).unbind("popupafterclose").remove(),PutToDebugLog(4,"EVENT, NPDownloadAndInstall popup closed")}}),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common NPDownloadAndInstall 1 ok"),npclosehandled=!0,lm=!1,setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},500),!0===webphone_api.global.nsupdatepending&&(webphone_api.global.nsupdatepending=!1,PutToDebugLog(2,"EVENT, mlogic API_Start NPDownloadAndInstall"),webphone_api.start()),setTimeout(function(){IsServiceInstalled(function(e){!1===e&&(PutToDebugLog(2,"WARNING, on NPDownloadAndInstall OK clikc, NS service is not reachable"),AlertDialog(webphone_api.stringres.get("warning"),webphone_api.stringres.get("np_install_warn")))},!0)},500),o("ok")}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, settings NPDownloadAndInstall 1 cancel"),o("cancel"),NPHandleCancel(),setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},500)})}catch(l){PutToDebugLogException(2,"common: NPDownloadAndInstall",l)}}function NPHandleCancel(){npclosehandled=!0;var e=GetEngine("ns");e.clicked=0,SetEngine("ns",e),EngineSelect(1,22),stopPolling=!0,webphone_api.startInner()}function EngineForcedInstallSDK(e,o,n,t){function i(){if("java"===e)InstallJavaPopup(!0),t("ok");else if("ns"===e){t("ok"),setTimeout(function(){NPDownloadAndInstall(!0)},450);var o=GetNPLocation();!isNull(o)&&o.length>0&&window.open(o)}}try{var a=!1;if(PutToDebugLog(4,"EVENT, EngineForcedInstallSDK popup displayed: "+e+"; message: "+o),t=t||function(){},!isNull(efmodal))return void efmodal.show();if(isNull(o)||o.length<1)if("java"===e&&"Chrome"===GetBrowser()){PutToDebugLog(2,"EVENT,"+webphone_api.stringres.get("jnotsupported")+"_2"),o=webphone_api.stringres.get("jnotsupported");var r=GetConfig("pc_alternatebrowserurl");!isNull(r)&&r.length>2&&(o=o+': <a href="'+r+'" target="_blank">'+r+"</a>"),a=!0}else o=webphone_api.stringres.get("ce_alert_user")+" "+GetEngineDisplayName(e)+".",o=o.replace("[BRAND]",GetBrandName());o.indexOf(webphone_api.stringres.get("service_update"))>=0&&(o+='<br /><a id="efi_download_link" style="cursor:pointer; color:#3f8fcf;">Download NS -Service Plugin</a>');var l=webphone_api.stringres.get("btn_ok");e===webphone_api.global.ENGINE_SERVICE&&(l=webphone_api.stringres.get("btn_download"));var p='<button id="btn_ef_positive">'+l+"</button>";!0===n&&(p='<button id="btn_ef_negative">'+webphone_api.stringres.get("btn_cancel")+"</button>"+p),efmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("ce_alert_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+o+'</div></div><div id="ce_modal_footer" class="pmodal_footer">'+p+"</div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){webphone_api.$("#efi_download_link").off("click"),e.destroy(),PutToDebugLog(4,"EVENT, EngineForcedInstallSDK popup closed"),efmodal=null}),efmodal.show(),webphone_api.$("#efi_download_link").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK link click"),i(),efmodal.close()}),webphone_api.$("#btn_ef_positive").on("click",function(){efmodal.close(),!0!==a&&(PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK 1 ok"),i())}),webphone_api.$("#btn_ef_negative").on("click",function(){efmodal.close(),PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK 1 cancel");var e=GetEngine("webrtc");e.clicked=0,SetEngine("webrtc",e),EngineSelect(1,23),stopPolling=!0,t("cancel")})}catch(s){PutToDebugLogException(2,"common: EngineForcedInstallSDK",s)}}function EngineForcedInstall(e,o,n,t){function i(){if("java"===e)InstallJavaPopup(!0),t("ok");else if("ns"===e){t("ok"),setTimeout(function(){NPDownloadAndInstall(!0)},450);var o=GetNPLocation();!isNull(o)&&o.length>0&&window.open(o)}setTimeout(function(){
webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},200)}try{if("ns"===e&&-3===GetMinServiceVersion())return void PutToDebugLog(2,"ERROR, EngineForcedInstall: "+e+"; install popup is disabled by minserviceversion: "+GetMinServiceVersion().toString());var a=!1;if(1==IsSDK())return void EngineForcedInstallSDK(e,o,n,t);PutToDebugLog(4,"EVENT, EngineForcedInstall popup displayed: "+e+"; message: "+o);var r=GetDeviceWidth();if(r=!isNull(r)&&IsNumber(r)&&r>100?Math.floor(r/1.2):220,r>400?r=400:r<120&&(r=120),isNull(o)||o.length<1)if("java"===e&&"Chrome"===GetBrowser()){PutToDebugLog(2,"EVENT,"+webphone_api.stringres.get("jnotsupported")+"_3"),o=webphone_api.stringres.get("jnotsupported");var l=GetConfig("pc_alternatebrowserurl");!isNull(l)&&l.length>2&&(o=o+': <a href="'+l+'" target="_blank">'+l+"</a>"),a=!0}else o=webphone_api.stringres.get("ce_alert_user")+" "+GetEngineDisplayName(e)+".",o=o.replace("[BRAND]",GetBrandName());var p=webphone_api.stringres.get("btn_ok");e===webphone_api.global.ENGINE_SERVICE&&(p=webphone_api.stringres.get("btn_download")),o.indexOf(webphone_api.stringres.get("service_update"))>=0&&(o+='<br /><a id="efi_download_link" style="cursor:pointer;">Download NS -Service Plugin</a>');var s='<a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+p+"</a>";!0===n&&(s='<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a>"+s);var c='<div data-role="popup" id="np_forcedinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+r+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title" style="margin-left: 2.2em;">'+webphone_api.stringres.get("ce_alert_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+o+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer">'+s+"</div></div>";t=t||function(){},webphone_api.$.mobile.activePage.append(c).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$("#efi_download_link").off("click"),webphone_api.$(this).unbind("popupafterclose").remove(),PutToDebugLog(4,"EVENT, EngineForcedInstall popup closed")}}),webphone_api.$("#efi_download_link").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstall link click"),webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),i()}),webphone_api.$("#adialog_positive").on("click",function(e){!0!==a&&(PutToDebugLog(5,"EVENT, common EngineForcedInstall ok"),i())}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstall 1 cancel"),t("cancel"),NPHandleCancel(),setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},200)})}catch(u){PutToDebugLogException(2,"common: EngineForcedInstall",u)}}function GetAppEnProtocol(e){try{var o=GetConfig("app_protocol");if((isNull(o)||o.length<1)&&(o="webphone:"),o.indexOf(":")<1&&(o+=":"),o.indexOf("//")<1&&(o+="//"),"Mac"!==GetOs()&&"Linux"!==GetOs()||(o="sip://"),(isNull(o)||o.length<1)&&(o="webphone://"),o=o.toLowerCase(),!0===e){var n=GetParameter("callto");isNull(n)&&(n=""),n=Trim(n),o+=n}return o}catch(t){PutToDebugLogException(2,"common: GetAppEnProtocol",t)}return"webphone://"}function HandleProtocol(e){var o=0;try{if(PutToDebugLog(2,"EVENT, HandleProtocol called: "+e),!1===webphone_api.global.isdebugversion&&"iOS"!==GetOs()&&"Android"!==GetOs())return;o=1;var n=window.location;if(o=2,o=5,PutToDebugLog(2,"EVENT, HandleProtocol: "+e),"iOS"===GetOs())if(o=6,!0===IsWebphoneInIframe()){var t=GetNativeDialerUrl(GetOs());PutToDebugLog(2,"EVENT, HandleProtocol open protocol (iOS-iframe): "+t),window.open(t)}else PutToDebugLog(2,"EVENT, HandleProtocol open protocol (iOS): "+e),window.location=e;else if("Chrome"===GetBrowser()){var i=e;i=i.replace(":",""),i=i.replace("//",""),i=i.replace("\\","");var a=GetNativeDialerUrl(GetOs());a=a.toLowerCase();var r=a.indexOf("id=");r>0?(a=a.substring(r+3),r=a.indexOf("&"),r>0&&(a=a.substring(0,r)),r=a.indexOf("#"),r>0&&(a=a.substring(0,r)),a=Trim(a)):a="com.mizuvoip.mizudroid.app";var l=encodeURIComponent(GetNativeDialerUrl(GetOs())),p="intent://#Intent;scheme="+i+";apppackage="+a+";S.browser_fallback_url="+l+";end";PutToDebugLog(2,"EVENT, HandleProtocol for Chrome in Android: "+p),window.location=p}else{o=7;var s=document.getElementById("loader");if(isNull(s))return PutToDebugLog(1,"ERROR, HandleProtocol loader iframe is NULL"),void ShowToast("ERROR, app loader is not defined.");s.src=e}o=11,n=GetNativeDialerUrl(GetOs()),o=14,PutToDebugLog(2,"EVENT, HandleProtocol fallbackLink: "+n),redirect_timer=setTimeout(function(){try{o=15,PutToDebugLog(2,"EVENT, HandleProtocol open fallback link because could not open app"),window.location=n,o=16}catch(e){PutToDebugLogException(2,"common: HandleProtocol inner timer second( "+o+" ), fallbackLink: "+n,e)}},3e3),o=17,clear_timer=setInterval(function(){try{o=18,protocolmaxloop++;var e=window.document.hasFocus();o=17,(!e||document.hidden||protocolmaxloop>100)&&(o=21,protocolmaxloop=0,isNull(clear_timer)||clearInterval(clear_timer),clear_timer=null,o=22,isNull(redirect_timer)||clearTimeout(redirect_timer),redirect_timer=null,o=23,PutToDebugLog(2,"EVENT, HandleProtocol redirect timer cleared, because app was found and opened"))}catch(n){PutToDebugLogException(2,"common: HandleProtocol inner timer( "+o+" )",n)}},200),o=24}catch(c){PutToDebugLogException(2,"common: HandleProtocol( "+o+" )",c)}}function StartAppEngine(e,o,n,t){try{if(GetParameterInt("allow_start_app_engine",1)<1)return void PutToDebugLog(1,"STATUS, Skip app engine start, last start was cancelled");0===GetAppEnProtocol(n).indexOf("webphone:")?(UploadAutoprov(),setTimeout(function(){StartAppEnginePopup(e,o,n,t)},600)):StartAppEnginePopup(e,o,n,t)}catch(i){PutToDebugLogException(2,"common: StartAppEngine",i)}}function StartAppEnginePopup(e,o,n,t){try{var i=GetParameterInt("app_popup_displayed",0);if((!0!==e||i>0)&&("iOS"!==GetOs()||!0!==IsWebphoneInIframe()))return void StartAppEngineExec(e,o,n,t);var a=GetParameterInt("enginepriority_webrtc",2),r=GetParameterInt("enginepriority_app",2),l=GetParameterInt("enginepriority_p2p",2),p=GetParameterInt("enginepriority_accessnum",2);if((r>=5&&a<5&&l<5&&p<5||r>=2&&a<r&&l<r&&p<r)&&("iOS"!==GetOs()||!0!==IsWebphoneInIframe()))return void StartAppEngineExec(e,o,n,t);var s=webphone_api.stringres.get("app_en_message3");a<1&&(s=webphone_api.stringres.get("app_en_message2")),i+=1,SaveParameter("app_popup_displayed",i.toString());var c=webphone_api.common.GetDeviceWidth();c=!webphone_api.common.isNull(c)&&webphone_api.common.IsNumber(c)&&c>100?Math.floor(c/1.2):220,c>400?c=400:c<120&&(c=120);var u='<div id="adialog_appenalert" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+c+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("warning")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+s+'</span><div style="clear: both;">\x3c!--//--\x3e</div></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(u).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}}),webphone_api.$("#adialog_positive").on("click",function(i){StartAppEngineExec(e,o,n,t)}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(1,"STATUS, No engines to start."),ShowToast("ERROR, No engines to start!",8e3),PutToDebugLog(2,"ERROR, StartAppEngine user clicked cancel, so do NOT start APP engine"),SaveParameter("allow_start_app_engine","0")})}catch(g){PutToDebugLogException(2,"common: StartAppEngine",g)}}function StartAppEngineExec(e,o,n,t){try{void 0!==n&&null!==n||(n=!1),void 0!==t&&null!==t&&t.length>0&&Trim(t),function(e,o,n){try{webphone_api.global.isappenginestarted=!0,!isNull(e)&&e.length>0&&PutToDebugLog(2,e),isNull(n)&&(n=""),HandleProtocol(GetAppEnProtocol(o)+n)}catch(t){webphone_api.common.PutToDebugLogException(2,"common: StartAE",t)}}(o,n,t)}catch(i){webphone_api.common.PutToDebugLogException(2,"common: StartAppEngineExec",i)}}function Phone2Phone(e,o){try{var n=GetParameter("p2p");if(0!==Trim(n).indexOf("*"))return void OpenWebURL(n,webphone_api.stringres.get("p2p"));var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120),isNull(e)&&(e=""),isNull(o)&&(o="");var i='<div id="adialog_p2p" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("p2p")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+webphone_api.stringres.get("p2p_nra")+'</span><input type="text" id="phonea_input" name="phonea_input" value="'+e+'" data-theme="a" autocapitalize="off"/><span>'+webphone_api.stringres.get("p2p_nrb")+'</span><input type="text" id="phoneb_input" name="phoneb_input" value="'+o+'" data-theme="a" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(i).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}});var a=document.getElementById("phonea_input"),r=document.getElementById("phoneb_input");isNull(a)||a.focus(),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, _dialpad Phone2Phone 1 ok");var o=a.value,n=r.value;return isNull(o)||Trim(o).length<1?void ShowToast(webphone_api.stringres.get("p2p_err1")):(o=Trim(o),isNull(n)||Trim(n).length<1?void ShowToast(webphone_api.stringres.get("p2p_err2")):(n=Trim(n),void UriParser(GetParameter("p2p"),"",o,n,"","phone2phone")))}),webphone_api.$("#adialog_negative").on("click",function(e){})}catch(l){PutToDebugLogException(2,"common: Phone2Phone",l)}}function AlertDialogSDK(e,o,n,t){try{if(!isNull(admodal))return void admodal.show();isNull(t)&&(t=webphone_api.stringres.get("btn_ok")),admodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+e+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+o+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">'+t+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),admodal=null}),admodal.show(),webphone_api.$("#btn_close_adialog").on("click",function(){admodal.close(),n&&"function"==typeof n&&(n(!0),n=null)})}catch(i){PutToDebugLogException(2,"common: AlertDialogSDK",i)}}function ShowToastSDK(e,o){try{if(!isNull(toastmodal))return void toastmodal.show();toastmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_content" class="modal_content" style="font-size: .8em; padding: .7em;"><div id="ce_modal_content_inner" style="margin-right: 1.6em;">'+e+"</div></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{padding:"0",margin:"0",border:".2em solid #d8d8d8",borderRadius:".5em",width:"auto",background:"#ffffff",fontFamily:"sans-serif"},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),toastmodal=null}),toastmodal.show(),webphone_api.$("#btn_close_adialog").on("click",function(){toastmodal.close()}),isNull(o)&&(o=3e3),o>0&&setTimeout(function(){isNull(toastmodal)||toastmodal.close()},o)}catch(n){PutToDebugLogSpecial(2,"common: ShowToastSDK",!0,n)}}function LcAc(e,o){try{if(IsWindowsSoftphone()||!webphone_api.global.usestorage)return!0;if(e&&isNull(lctmr))return lctmr=setTimeout(function(){lcsexp=!0},36e5),!0;var n=1;!0===SvCont()&&!0===WbCont()?n=5:!0===SvCont()?n=3:!0===WbCont()&&(n=2);if(lccsenr>15*n&&(lcsexp=!0),!0===o){var t=GetParameter("lccnr"),i=0;if(!isNull(t)&&t.length>0){t=Trim(t);try{i=StrToInt(t)}catch(c){PutToDebugLogException(2,"_call: convert to int",c)}var a=n;a>1&&(a/=2),a*=100,i>a?lcsexp=!0:(i++,lccsenr++,SaveParameter("lccnr",i.toString()))}else SaveParameter("lccnr","1")}if(lcsexp){var r=[];r.push("D"),r.push("e"),r.push("m"),r.push("o "),r.push("l"),r.push("i"),r.push("m"),r.push("i"),r.push("t "),r.push("r"),r.push("e"),r.push("a"),r.push("c"),r.push("h"),r.push("e"),r.push("d"),r.push(". "),r.push("P"),r.push("l"),r.push("e"),r.push("a"),r.push("s"),r.push("e "),r.push("r"),r.push("e"),r.push("s"),r.push("t"),r.push("a"),r.push("r"),r.push("t "),r.push("t"),r.push("h"),r.push("e "),r.push("b"),r.push("r"),r.push("o"),r.push("w"),r.push("s"),r.push("e"),r.push("r "),r.push("t"),r.push("o "),r.push("c"),r.push("o"),r.push("n"),r.push("t"),r.push("i"),r.push("n"),r.push("u"),r.push("e "),r.push("t"),r.push("e"),r.push("s"),r.push("t"),r.push("i"),r.push("n"),r.push("g"),r.push(". "),r.push("\n<br>"),r.push("C"),r.push("o"),r.push("n"),r.push("t"),r.push("a"),r.push("c"),r.push("t "),r.push("M"),r.push("i"),r.push("z"),r.push("u"),r.push("t"),r.push("e"),r.push("c"),r.push("h "),r.push("t"),r.push("o "),r.push("b"),r.push("u"),r.push("y "),r.push("a "),r.push("l"),r.push("i"),r.push("c"),r.push("e"),r.push("n"),r.push("s"),r.push("e"),r.push("d "),r.push("c"),r.push("o"),r.push("p"),r.push("y"),r.push(": "),r.push("s"),r.push("u"),r.push("p"),r.push("p"),r.push("o"),r.push("r"),r.push("t"),r.push("@"),r.push("m"),r.push("i"),r.push("z"),r.push("u"),r.push("-"),r.push("v"),r.push("o"),r.push("i"),r.push("p"),r.push("."),r.push("c"),r.push("o"),r.push("m");var l=r.join(""),p=[];p.push("D"),p.push("e"),p.push("m"),p.push("o");var s=p.join("");return setTimeout(function(){AlertDialog(s,l)},950),!1}}catch(c){PutToDebugLogException(2,"common: LcAc",c)}return!0}function GetServerForHttpReq(){var e="";try{e=GetParameter("serveraddress_user");var o=GetParameter("upperserver");return(GetConfigInt("cfgusetunneling",0)>0||e.length>0&&e.indexOf(".")<1)&&!isNull(o)&&o.length>1&&(e=o),(isNull(e)||e.length<1)&&(e=GetParameter2("serveraddress"),(isNull(e)||e.length<1)&&(e=GetParameter("serveraddress_user")),(isNull(e)||e.length<1)&&(e=GetParameter("serveraddress_orig")),(isNull(e)||e.length<1)&&(e=GetConfig("serveraddress")),(isNull(e)||e.length<1)&&(e=GetProxyaddress("")),(isNull(e)||e.length<1)&&(e=GetWebrtcUpperServer("")),GetConfigInt("cfgusetunneling",0)>0&&!isNull(GetConfig("upperserver"))&&GetConfig("upperserver").length>1&&(e=GetConfig("upperserver"))),isNull(e)&&(e=""),e.indexOf(":")>0&&(e=e.substring(0,e.indexOf(":"))),e}catch(n){PutToDebugLogException(2,"common: GetServerForHttpReq",n)}return""}function GetProxyaddress(e){try{var o="";if(!isNull(e)&&e.length>0)o=e;else{if((isNull(o)||o.length<3)&&(o=GetConfig("proxyaddress")),!isNull(o)&&o.length>2&&o.indexOf(":")<1){var n=GetConfig("serverport");!isNull(n)&&n.length>0&&"5060"!==n&&(o=o+":"+n)}(isNull(o)||o.length<3)&&(o=GetParameter("proxyaddress"))}return isNull(o)&&(o=""),o=o.toLowerCase(),o=o.replace("udp://",""),o=o.replace("tcp://",""),o=o.replace("http://",""),o=o.replace("https://",""),o=o.replace("udp:",""),o=o.replace("tcp:",""),o=o.replace("http:",""),o=o.replace("https:",""),o=Trim(o),0===o.indexOf("udp")&&(o=o.replace("udp","")),0===o.indexOf("tcp")&&(o=o.replace("tcp","")),0===o.indexOf("http")&&(o=o.replace("http","")),0===o.indexOf("https")&&(o=o.replace("https","")),o}catch(t){PutToDebugLogException(2,"common: GetProxyaddress",t)}return""}function GetWebrtcUpperServer(e){try{var o="",n=GetParameter("upperserverip");if(!isNull(n)&&Trim(n).length>0)return n;if(!0!==e){var t=GetParameter("upperserverdomain");if(!isNull(t)&&Trim(t).length>0)return t}var i=GetConfig("wsuser");if(!isNull(i)&&i.length>10){if(n=GetUrlParamVal("upperserverip"),t=GetUrlParamVal("upperserverdomain"),!isNull(n)&&Trim(n).length>0)return n;if(!0!==e&&!isNull(t)&&Trim(t).length>0)return t}var a=GetWsAddressCfg();if(isNull(a)||a.length<2){o=GetParameter("serveraddress_user");var r=GetParameter("upperserver");return(GetConfigInt("cfgusetunneling",0)>0||o.length>0&&o.indexOf(".")<1)&&!isNull(r)&&r.length>1&&(o=r),Trim(o)}return o=GetParameter2("serveraddress"),(isNull(o)||o.length<1)&&(o=GetParameter("serveraddress_user")),(isNull(o)||o.length<1)&&(o=GetParameter("serveraddress_orig")),(isNull(o)||o.length<1)&&(o=GetConfig("serveraddress")),GetConfigInt("cfgusetunneling",0)>0&&!isNull(GetConfig("upperserver"))&&GetConfig("upperserver").length>1&&(o=GetConfig("upperserver")),o}catch(l){PutToDebugLogException(2,"common: GetWebrtcUpperServer",l)}return""}function GetWebrtcSyUpperHeader(e){try{var o=GetParameter("jsupperserver");if((isNull(o)||o.length<1)&&(o=GetWebrtcUpperServer(!0)),!isNull(o)&&o.length>0){var n=GetConfig("transport");return!isNull(n)&&n.length>0&&(n.indexOf(":")<0&&(n=":"+n),o=n+o),o}PutToDebugLog(2,"WARNING, GetWebrtcUpperServer is NULL ("+e+")")}catch(t){PutToDebugLogException(2,"common: GetWebrtcSyUpperHeader",t)}return""}function GetWebrtcSyUpperDomainHeader(e){try{var o=GetParameter("upperserverd");isNull(o)&&(o="");var n=GetConfig("wsuser");if(!isNull(n)&&n.length>10){var t=GetParameter("upperserverdomain");if(!isNull(t)&&Trim(t).length>0)return t}if(o.length>0){var i=GetConfig("transport");return!isNull(i)&&i.length>0&&(i.indexOf(":")<0&&(i=":"+i),o=i+o),o}}catch(a){PutToDebugLogException(2,"common: GetWebrtcSyUpperHeader",a)}return""}function GetUpperProxyHeaderForSignaling(){var e="";try{if(e=GetParameter("upperproxy"),!isNull(e)&&Trim(e).length>0)return e;if(e=GetParameter("proxyaddress"),!isNull(e)&&Trim(e).length>0)return e;var o=GetConfig("wsuser");if(!isNull(o)&&o.length>10&&(e=GetUrlParamVal(o,"proxyaddress"),!isNull(e)&&Trim(e).length>0))return e}catch(n){PutToDebugLogException(2,"common:  GetUpperProxyHeaderForSignaling",n)}return""}function GetWebrtcSrvAddr(){return GetBestWsAddress()}function GetUsableWebrtcSrvAddr(){var e=GetWsAddressCfg();if(!isNull(e)&&e.length>3)return e;var o=getuseengine();if(isNull(o)||o.length<1);else if(o===webphone_api.global.ENGINE_WEBRTC)return e=GetWebrtcSrvAddr(),!isNull(e)&&e.length,e;return""}function HandleAddress(e){try{if(isNull(e)||e.length<1)return"";e=e.toLowerCase(),e=Trim(e);var o=!1;location.host.toLowerCase();!0!==PreferWss()&&!0!==IsHttps()||(o=!0),!0===o&&0===e.indexOf("ws:")&&(e=e.replace("ws:","wss:")),e.indexOf("ws:")<0&&e.indexOf("wss:")<0&&(e=!0===o?"wss://"+e:"ws://"+e),e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?")))}catch(n){PutToDebugLogException(2,"common: HandleAddress",n)}return e}function AddWsAddress(e,o){try{if(isNull(e)||!e.address||isNull(e.address)||e.address.length<4)return void PutToDebugLog(2,"ERROR, AddWsAddress invalid object");if(isNull(wsrvL)&&(wsrvL=[]),wsrvL.length>0)for(var n=0;n<wsrvL.length;n++)if(wsrvL[n].address===e.address)return void(wsrvL[n].answertime<2&&(wsrvL[n].answertime=e.answertime,wsrvL[n].load=e.load));var t=GetParameter("lastwebrtcserver");!isNull(t)&&t.length>3&&t===e.address&&(e.answertime=e.answertime-20),wsrvL.push(e),GetBestWsAddress(o)}catch(i){PutToDebugLogException(2,"common: AddWsAddress",i)}}function GetWsAddressCfg(e){var o;if(void 0!==(o=selectedwserver)&&null!==o&&o.length>3)return o;if(void 0!==(o=GetParameter("webrtcserveraddress"))&&null!==o&&o.length>3&&0==o.indexOf("ws")&&o.indexOf(",")<0)return o;if(void 0!==(o=webphone_api.parameters.webrtcserveraddress)&&null!==o&&o.length>3&&0==o.indexOf("ws")&&o.indexOf(",")<0)return o;if(webphone_api.global.decideusuk_finished&&webphone_api.global.usuk.length>0&&!waitingforusukdecide&&(isNull(e)||!1===e)){if("uk"===webphone_api.global.usuk)return StrDc(wips_uk,alsvkey);if("us"===webphone_api.global.usuk)return StrDc(wips_us,alsvkey)}return void 0!==(o=GetParameter("webrtcserveraddress"))&&null!==o&&o.length>3?o:void 0!==(o=webphone_api.parameters.webrtcserveraddress)&&null!==o&&o.length>3?o:void 0!==(o=GetParameter("origwebrtcserveraddress"))&&null!==o&&o.length>3?o:void 0!==(o=GetParameter("webrtcserver"))&&null!==o&&o.length>3?o:void 0!==(o=GetParameter("webrtcaddress"))&&null!==o&&o.length>3?o:void 0!==(o=GetParameter("rtcserver"))&&null!==o&&o.length>3?o:void 0!==(o=GetParameter("rtcaddress"))&&null!==o&&o.length>3?o:void 0!==(o=webphone_api.parameters.webrtcserver)&&null!==o&&o.length>3?o:void 0!==(o=webphone_api.parameters.webrtcaddress)&&null!==o&&o.length>3?o:void 0!==(o=webphone_api.parameters.rtcserver)&&null!==o&&o.length>3?o:(o=webphone_api.parameters.rtcaddress,void 0!==o&&null!==o&&o.length>3?o:"")}function GetBestWsAddress(e){try{if(!isNull(selectedwserver)&&selectedwserver.length>3)return selectedwserver;var o=GetWsAddressCfg();if(void 0!==o&&null!==o&&o.length>3&&o.indexOf(",")<0)return selectedwserver=o;if(!1===decide_already_run)return DecideWebrtcServer(),"";if(!0===e)return selectedwserver=wsrvL[0].address,webphone_api.global.recwsload=wsrvL[0].load,webphone_api.global.selected_apikey=wsrvL[0].apikey,SaveParameter("lastwebrtcserver",selectedwserver),selectedwserver;isNull(addrtimer)&&(ADDR_TIMERSTART=GetTickCount(),addrtimer=setInterval(function(){if(addr_maxloop>60||!isNull(selectedwserver)&&selectedwserver.length>3)return isNull(addrtimer)||clearInterval(addrtimer),void(addrtimer=null);var e=null;if(!isNull(wsrvL)&&wsrvL.length>0)for(var o=0;o<wsrvL.length;o++)!0!==wsrvL[o].worked||wsrvL[o].load<0||(isNull(e)&&wsrvL[o].answertime<9e4&&wsrvL[o].load<2||e.answertime>wsrvL[o].answertime&&wsrvL[o].load<2)&&(e=wsrvL[o]);if(isNull(e)){var n=GetTickCount(),t=!0,i=!1;wsrvL.length<1&&(t=!1);for(var o=0;o<wsrvL.length;o++)wsrvL[o].load<0?t=!1:i=!0;if(!0===t||n-ADDR_TIMERSTART>=3e3&&!0===i||n-ADDR_TIMERSTART>=6e3){for(var a=wsrvL.length,r=0,o=0;o<a&&(wsrvL[o].load<0&&(wsrvL.push(wsrvL.splice(o,1)[0]),o<a-1&&o--),!(++r>3*a));o++);for(var o=0;o<a;o++)for(var l=o+1;l<a;l++)if(wsrvL[o].load>-1&&wsrvL[l].load>-1&&wsrvL[o].load>wsrvL[l].load){var p=wsrvL[o];wsrvL[o]=wsrvL[l],wsrvL[l]=p}for(var s=-1,o=0;o<a;o++)wsrvL[o].load<0||(s<0&&(s=wsrvL[o].load),isNull(e)&&(e=wsrvL[o]),wsrvL[o].load>s||e.answertime>wsrvL[o].answertime&&(e=wsrvL[o]))}if(!isNull(e)&&(selectedwserver=e.address,webphone_api.global.recwsload=e.load,webphone_api.global.selected_apikey=e.apikey,isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,!0===IsUKGateway(selectedwserver)?webphone_api.global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished)){webphone_api.global.decideusuk_finished=!0;var c=GetWsAddressCfg();c.length>0&&SaveParameter("lastwebrtcserver",c),PutToDebugLog(5,"EVENT, DecideUsUk select finished on fastest2 "+c)}}else if(selectedwserver=e.address,webphone_api.global.recwsload=e.load,webphone_api.global.selected_apikey=e.apikey,isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,!0===IsUKGateway(selectedwserver)?webphone_api.global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var c=GetWsAddressCfg();c.length>0&&SaveParameter("lastwebrtcserver",c),PutToDebugLog(5,"EVENT, DecideUsUk select finished on fastest1 "+c)}},100))}catch(n){PutToDebugLogException(2,"common: GetBestWsAddress",n)}return""}function GetSpecialWsloadUrl(e){try{var o=GetWsloadUrl(GetSipusername()),n=o.indexOf("://");if(n>0){var t=o.substring(0,n+3),i=o.substring(n+3);i=i.substring(i.indexOf("/"));o=t+NormalizeInput(e,0)+i}return o}catch(a){PutToDebugLogException(2,"common: GetSpecialWsloadUrl",a)}return""}function IsUKGateway(e){try{if(isNull(e)||e.length<3)return!1;isNull(uk_ip)&&(uk_ip=StrDc(wip_uk,alsvkey),uk_domain=StrDc(wips_uk,alsvkey));var o=-1;if(uk_ip=uk_ip.replace("ws://",""),o=uk_ip.lastIndexOf("/"),o>0&&(uk_ip=uk_ip.substring(0,o)),o=uk_ip.lastIndexOf(":"),o>0&&(uk_ip=uk_ip.substring(0,o)),uk_domain=uk_domain.replace("wss://",""),o=uk_domain.lastIndexOf("/"),o>0&&(uk_domain=uk_domain.substring(0,o)),o=uk_domain.lastIndexOf(":"),o>0&&(uk_domain=uk_domain.substring(0,o)),e.indexOf(uk_ip)>=0||e.indexOf(uk_domain)>=0)return!0}catch(n){PutToDebugLogException(2,"common: IsUKGateway",n)}return!1}function IsUSGateway(e){try{if(isNull(e)||e.length<3)return!1;isNull(us_ip)&&(us_ip=StrDc(wip_us,alsvkey),us_domain=StrDc(wips_us,alsvkey));var o=-1;if(us_ip=us_ip.replace("ws://",""),o=us_ip.lastIndexOf("/"),o>0&&(us_ip=us_ip.substring(0,o)),o=us_ip.lastIndexOf(":"),o>0&&(us_ip=us_ip.substring(0,o)),us_domain=us_domain.replace("wss://",""),o=us_domain.lastIndexOf("/"),o>0&&(us_domain=us_domain.substring(0,o)),o=us_domain.lastIndexOf(":"),o>0&&(us_domain=us_domain.substring(0,o)),e.indexOf(us_ip)>=0||e.indexOf(us_domain)>=0)return!0}catch(n){PutToDebugLogException(2,"common: IsUSGateway",n)}return!1}function ClassWServers(){this.address="",this.worked=!1,this.answertime=99999,this.load=-1,this.apikey=""}function DecideWebrtcServer(){try{if(!isNull(selectedwserver)&&selectedwserver.length>3)return;if(!0===decide_already_run)return void PutToDebugLog(5,"EVENT, DecideWebrtcServer already run");var e=GetWsAddressCfg(),o=GetParameter("lastwebrtcserver"),n=GetParameter("topprioritywebrtcserver");if(isNull(e)||e.length<4){if(!isNull(o)&&o.length>0||!isNull(n)&&n.length>0)return;if(!IsMizuPublicWebRTCGateway())return;e=StrDc(wip_uk,alsvkey)+","+StrDc(wip_us,alsvkey)}if(PutToDebugLog(5,"EVENT, DecideWebrtcServer "+e),e.indexOf(",")<0){e.indexOf("://")<0&&(e=UseSecureSrvConnection()||!1===IsIPAddrress(e)?"wss://"+e:"ws://"+e),selectedwserver=e;var t="",i=selectedwserver.indexOf("authkey=");if(i>0&&(t=selectedwserver.substring(i+8),selectedwserver=selectedwserver.substring(0,i),isNull(t)&&(t=""),i=t.indexOf("&"),i>0&&(t=t.substring(0,i)),t=Trim(t),webphone_api.global.selected_apikey=api_key,!0===IsUKGateway(selectedwserver)?webphone_api.global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished)){webphone_api.global.decideusuk_finished=!0;var a=GetWsAddressCfg();a.length>0&&SaveParameter("lastwebrtcserver",a),PutToDebugLog(5,"EVENT, DecideUsUk select finished on single "+a)}return}for(var r=e.split(","),l=0;l<r.length;)isNull(r[l])||r[l].length<4?r.splice(l,1):l++;if(isNull(r)||r.length<1)return;for(var p=!0,s=r.length,c=0;c<s;c++)if(r[c].toLowerCase().indexOf("mfstwebsock")<1&&r[c].toLowerCase().indexOf("mvstwebsock")<1){p=!1;break}if(r=ShuffleArray(r),!isNull(n)&&n.length>0)for(var c=0;c<s;c++)if(r[c]===n){var u=splice(c,1);r.unshift(u);break}if(!isNull(o)&&o.length>0)for(var c=0;c<s;c++)if(r[c]===o){var u=splice(c,1);r.unshift(u);break}var g=GetTickCount();if(wsrvL=[],isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,addr_maxloop=0,decide_already_run=!0,!0===p)for(var c=0;c<s;c++)!function(){function e(){!isNull(s)&&s.close&&s.close(),s=null}var o=c,n=new ClassWServers;try{var t=r[o],i="",a=t.indexOf("authkey=");a>0&&(i=t.substring(a+8),isNull(i)&&(i=""),a=i.indexOf("&"),a>0&&(i=i.substring(0,a)),i=Trim(i));var l=!1;t.indexOf("mfstwebsock")>0&&(l=!0);var p=HandleAddress(t);n.address=p,n.apikey=i,PutToDebugLog(2,"EVENT, DecideWebrtcServer ("+o+") url: "+p);var s=new WebSocket(p,"sip");s.binaryType="arraybuffer",s.onopen=function(){g=!0};var u=0,g=!1,m=setInterval(function(){u++,1===s.readyState&&!0===g&&!0===l&&(h=GetTickCount(),s.send("mrtcping\r\n")),(u>25||1===s.readyState)&&(isNull(m)||clearInterval(m),m=null)},100),b=-1,h=0;s.onerror=function(){n.worked=!1,AddWsAddress(n)},s.onclose=function(){n.worked=!1,AddWsAddress(n)},s.onmessage=function(t){var i=null;if(isNull(t)||(i=t.data),!isNull(i)){var r=ArrayBufferToString(i);if(r=r.toLowerCase(),r.indexOf("mrtcpong")>=0){b=GetTickCount()-h,n.answertime=b;var l=GetSpecialWsloadUrl(p);PutToDebugLog(2,"EVENT, DecideWebrtcServer send wsload ("+o+") url: "+p+"; answertime: "+b.toString()+"; url: "+l),s.send(l+"\r\n")}else{var c=r;if((a=c.indexOf("ws load:"))>=0){c=c.substring(a+8),c=Trim(c),a=c.indexOf(" "),a>0&&(c=c.substring(0,a));var u=-1;!isNull(c)&&IsNumber(c)&&(u=StrToInt(c)),n.load=u,PutToDebugLog(2,"EVENT, DecideWebrtcServer rec wsload ("+o+") url: "+p+"; answertime: "+b.toString()+"; load: "+c),AddWsAddress(n),e()}}}},setTimeout(function(){e()},6500)}catch(d){n.worked=!1,PutToDebugLogException(2,"DecideWebrtcServer ("+o+") failure",d)}}();else{var m=0;if(m<s){var b=m,h=new ClassWServers;try{var d=HandleAddress(r[b]);h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=HandleAddress(r[b]);h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip")
;_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}if(++m<s){var b=m,h=new ClassWServers;try{var d=r[b];h.address=d,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+b+") url: "+d);var _=new WebSocket(d,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-g;h.answertime=e,h.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+b+") url: "+d+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(h,!0)}}catch(w){h.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+b+") failed to connect",w)}}m++}}catch(f){PutToDebugLogException(2,"common: DecideWebrtcServer",f)}}function ShuffleArray(e){try{var o,n,t,i=e;for(t=i.length-1;t>0;t--)o=Math.floor(Math.random()*(t+1)),n=i[t],i[t]=i[o],i[o]=n;return i}catch(a){PutToDebugLogException(2,"common: ShuffleArray",a)}return e}function Engine(){this.name,this.cfg_priority,this.defpriority,this.available,this.serversupport,this.finalscore,this.finalscorex,this.pushlevel,this.failed,this.clicked,this.issupported_cache,this.isinstalled_cache,this.serversupport_cache,this.available_old,this.asyncreqbegintime}function GetEngineList(){return engines}function GetSelectedEngine(){return selected_engine}function GetRecommendedEngine(){return recommend_engine}function GetSelectedEngineName(){try{if(!isNull(selected_engine)&&!isNull(selected_engine.name))return selected_engine.name}catch(e){PutToDebugLogException(2,"common: GetSelectedEngineName",e)}return null}function GetRecommendedEngineName(){try{if(!isNull(recommend_engine)&&!isNull(recommend_engine.name))return recommend_engine.name}catch(e){PutToDebugLogException(2,"common: GetRecommendedEngineName",e)}return null}function GetEngine(e){try{if(isNull(engines))return null;for(var o,n=0;n<engines.length;n++)if(o=engines[n],o.name===e)return o}catch(t){PutToDebugLogException(2,"common: GetEngine",t)}return null}function SetEngine(e,o){try{if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common SetEngine invalid engine name: "+e),!1;if(isNull(o))return PutToDebugLog(2,"ERROR, common SetEngine invalid engine object"),!1;if(isNull(engines))return PutToDebugLog(2,"ERROR, common SetEngine engines is NULL"),!1;for(var n=0;n<engines.length;n++)engines[n].name===e&&(engines[n]=o)}catch(t){PutToDebugLogException(2,"common: GetEngine",t)}return!1}function ResetEngineClicked(){try{if(isNull(engines))return PutToDebugLog(2,"ERROR, common ResetEngineClicked engines is NULL"),!1;for(var e,o=0;o<engines.length;o++)e=engines[o],e.clicked=0,engines[o]=e}catch(n){PutToDebugLogException(2,"common: ResetEngineClicked",n)}}function HasUsableEngine(e){try{if(isNull(engines))return!1;for(var o,n=0;n<engines.length;n++)if(o=engines[n],o.available>1&&o.failed<1&&e.name!==o.name&&o.name.indexOf("_avail")<0&&o.defpriority>0)return!0}catch(t){PutToDebugLogException(2,"common: HasUsableEngine",t)}return!1}function HasUsableEngineFromEngines(e,o){try{if(isNull(engines))return!1;for(var n,t=0;t<engines.length;t++)if(n=engines[t],!(o.indexOf(n.name)<0)&&n.available>1&&n.failed<1&&e.name!==n.name&&n.name.indexOf("_avail")<0&&n.defpriority>0)return!0}catch(i){PutToDebugLogException(2,"common: HasUsableEngineFromEngines",i)}return!1}function IsMizuPublicWebRTCGateway(){return IsMizuPublicWebRTCGatewayIntern(!0)}function IsMizuPublicWebRTCGatewayUsed(){return IsMizuPublicWebRTCGatewayIntern(!1)}function IsMizuPublicWebRTCGatewayIntern(e){try{if(0===GetConfigInt("usemizuwebrtcgateway",1))return!1;var o=GetWsAddressCfg();if(isNull(o)||o.length<3)return!(!webphone_api.global.decideusuk_finished||!(webphone_api.global.usuk.length>0||getuseengine()===webphone_api.global.ENGINE_WEBRTC))||(!(!(webphone_api.global.usuk.length>0)||!webphone_api.global.decideusuk_finished&&getuseengine()!==webphone_api.global.ENGINE_WEBRTC)||(2===GetConfigInt("usemizuwebrtcgateway",1)||!!e));o=o.toLowerCase(),o=NormalizeInput(o,0),o=o.replace("*","");var n=o.indexOf("/");n>0&&(o=o.substring(0,n));var n=0,t=StrDc(wip_uk,alsvkey);t=t.toLowerCase(),t=NormalizeInput(t,0),t=t.replace("*",""),n=t.indexOf(":"),n>0&&(t=t.substring(0,n)),n=t.indexOf("/"),n>0&&(t=t.substring(0,n));var i=StrDc(wips_uk,alsvkey);i=i.toLowerCase(),i=NormalizeInput(i,0),i=i.replace("*",""),n=i.indexOf(":"),n>0&&(i=i.substring(0,n)),n=i.indexOf("/"),n>0&&(i=i.substring(0,n));var a=StrDc(wip_us,alsvkey);a=a.toLowerCase(),a=NormalizeInput(a,0),a=a.replace("*",""),n=a.indexOf(":"),n>0&&(a=a.substring(0,n)),n=a.indexOf("/"),n>0&&(a=a.substring(0,n));var r=StrDc(wips_us,alsvkey);if(r=r.toLowerCase(),r=NormalizeInput(r,0),r=r.replace("*",""),n=r.indexOf(":"),n>0&&(r=r.substring(0,n)),n=r.indexOf("/"),n>0&&(r=r.substring(0,n)),t===o||i===o||a===o||r===o)return!0}catch(l){PutToDebugLogException(2,"common: IsMizuPublicWebRTCGateway",l)}return!1}function IsMizuWebRTCGatewayAndNotMizuServer(){try{if(ismizuserverdetected>=2)return!1;if(!0===GetConfigBool("usingmizuserver",!1))return!1;if(!0===GetConfigBool("usingmizuserveronly",!1))return!1;if(0===GetConfigInt("usemizuwebrtcgateway",1))return!1;if(GetConfigInt("ismrtcgateway",0)>0)return!0;if(webphone_api.global.wsload_type>0)return!0;var e=GetWsAddressCfg();return!(!(isNull(e)||e.length<3)||1!=ismizuserverdetected)||IsMizuPublicWebRTCGateway()}catch(o){PutToDebugLogException(2,"common: IsMizuWebRTCGateway2",o)}return!1}function IsMizuServer(){return!(!IsMizuServerOrGateway()||IsMizuWebRTCGatewayAndNotMizuServer())}function IsMizuServerOrGateway(){try{if(ismizuserverdetected>0)return!0;if(!0===GetConfigBool("usingmizuserver",!1))return!0;if(!0===GetConfigBool("usingmizuserveronly",!1))return!0;if(GetConfigInt("ismrtcgateway",0)>0)return!0;if(webphone_api.global.wsload_type>0)return!0;if(GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1))return!0;var e=GetServerForHttpReq();if(!isNull(e)&&(e.indexOf("mizu-voip.com")>=0||e.indexOf("webvoipphone.com")>=0))return!0;var o=GetWsAddressCfg();if(o=o.toLowerCase(),o.indexOf("mfstwebsock")>0)return!0}catch(n){PutToDebugLogException(2,"common: IsMizuServerOrGateway",n)}return!1}function CanIUseApplet(){try{var e=GetBrowserVersion(),o=GetBrowser(),n=GetOs(),t=webphone_api.getmaxchromeversionforjava();if(CanLog(4)&&PutToDebugLog(4,"EVENT, CanIUseApplet, OS: "+n+"; browser: "+o),"Windows"===n){if("Chrome"===o)return!(isNull(e)||IsNumber(e)&&(e<1||e>t));if("Firefox"===o){var i=GetParameterInt("nojavaforff",52);return!(!0===Is64BitBrowser()||GetBrowserVersion()>=i)||(CanLog(4)&&PutToDebugLog(4,"EVENT, CanIUseApplet, nojavaforff: "+i),!1)}return"Safari"===o?GetBrowserVersion()<6:"Edge"!==o}if("Mac"===n)return"Chrome"===o?!(isNull(e)||IsNumber(e)&&(e<1||e>t)):"Safari"!==o||!!(!isNull(e)&&IsNumber(e)&&e>0&&e<7);if("Linux"===n)return"Chrome"!==o||!(isNull(e)||IsNumber(e)&&(e<1||e>t))}catch(a){PutToDebugLogException(2,"common: CanIUseApplet",a)}return!1}function CanIUseWebRTC(e){try{if(lversion<=0){var o=[];if("Android"===GetOs()||"iOS"===GetOs()){o.push("D"),o.push("e"),o.push("s"),o.push("k"),o.push("t"),o.push("o"),o.push("p"),o.push(" "),o.push("o"),o.push("n"),o.push("l"),o.push("y"),o.push("_");var n=o.join("");setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},500)}return!1}if(1===lversion&&!1===Glsp()){var o=[];o.push("D"),o.push("e"),o.push("s"),o.push("k"),o.push("t"),o.push("o"),o.push("p"),o.push(" "),o.push("o"),o.push("n"),o.push("l"),o.push("y"),o.push("_");var n=o.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},510),!1}if(IsMizuPublicWebRTCGateway()&&IsLanIP(GetWebrtcUpperServer()))return PutToDebugLog(2,"EVENT, CanIUseWebRTC server is on local network"),!1;var t=-1;if(webphone_api.webrtcapi){var i=webphone_api.webrtcapi.WebRtcIsSupported();if(!0===i)t=1;else if(!1===i)return t=0,PutToDebugLog(5,"EVENT, CanIUseWebRTC no capabilities"),!1}if("iOS"===GetOs()){if("Safari"!==GetBrowser()&&"iPhone"!==GetBrowser())return 1===t?PutToDebugLog(5,"EVENT, (warn) CanIUseWebRTC ios other browser but webrtc supported"):PutToDebugLog(5,"EVENT, CanIUseWebRTC ios other browser"),!1;if(GetBrowserVersion()<11)return 1===t?PutToDebugLog(5,"EVENT, (warn) CanIUseWebRTC old safari but webrtc supported"):PutToDebugLog(5,"EVENT, CanIUseWebRTC old safari "),!1}var a="";if(75!==GetParameterInt("brandid",-1)){var r=GetWsAddressCfg();if(isNull(r)||Trim(r).length<1){var l=webphone_api.webrtcapi.GetUDPServerAddress();if(isNull(l)&&(l=""),l=NormalizeInput(GetDomainPart(l)),l.length>0&&!1===IsIPAddrress(l)){var p=GetParameterInt("enginepriority_java",2),s=GetParameterInt("enginepriority_webrtc",2),c=GetParameterInt("enginepriority_ns",2),u=GetParameterInt("enginepriority_flash",2);s>2||s>p&&s>c&&s>u||DomainToIpServer(l,function(e){isNull(e)||e.length<1||(a=e,canresolvedomain=!(e.indexOf("cannotresolve")>=0)&&(!IsIPAddrress(e)||!IsLanIP(e)))})}else l.length>0&&IsIPAddrress(l)&&IsLanIP(l)&&(canresolvedomain=!1);if(!1===canresolvedomain)return PutToDebugLog(3,"EVENT, CanIUseWebRTC WebRTC NOT available: Cannot resolve SIP server domain ("+l+") to public ip: "+a),!1}}if(webphone_api.global.webrtcavailable<1)return PutToDebugLog(2,"EVENT, CanIUseWebRTC WebRTC NOT available in this environment: "+webphone_api.global.webrtcavailable.toString()),!1;if(0===GetConfigInt("usemizuwebrtcgateway",1)&&GetWebrtcSrvAddr().length<2)return PutToDebugLog(2,"WARNING, CanIUseWebRTC WebRTC available but there is no webrtc server"),!1;if("Windows"===GetOs()){if("MSIE"===GetBrowser())return!1;if("Edge"===GetBrowser()&&GetBrowserVersion()<14)return!1}return!0}catch(g){PutToDebugLogException(2,"common: CanIUseWebRTC",g)}return!1}function CanIUseService(){try{if("Windows"!==GetOs()&&!IsMacLin()||IsMacLin()&&!1===NSMacLinEnabled())return PutToDebugLog(2,"EVENT, CanIUseService not windows/mac/linux: false"),!1;var e=StrToInt(GetParameter2("enginepriority_java")),o=StrToInt(GetParameter2("enginepriority_webrtc")),n=StrToInt(GetParameter2("enginepriority_ns")),t=StrToInt(GetParameter2("enginepriority_flash")),i=StrToInt(GetParameter2("enginepriority_app")),a=StrToInt(GetParameter2("enginepriority_p2p")),r=StrToInt(GetParameter2("enginepriority_accessnum")),l=StrToInt(GetParameter2("enginepriority_nativedial")),p=!1;if(!isNull(e)&&IsNumber(e)||(p=!0,e=2),!isNull(o)&&IsNumber(o)||(p=!0,o=2),!isNull(n)&&IsNumber(n)||(p=!0,n=2),!isNull(t)&&IsNumber(t)||(p=!0,t=2),!isNull(i)&&IsNumber(i)||(p=!0,i=2),!isNull(a)&&IsNumber(a)||(p=!0,a=2),!isNull(r)&&IsNumber(r)||(p=!0,r=2),!isNull(l)&&IsNumber(l)||(p=!0,l=2),!0===p&&PutToDebugLog(2,"EVENT, CanIUseService priorities are NULL, probably couldnt read settings"),n<1||e>4||o>4||t>4||i>4||a>4||r>4||l>4)return PutToDebugLog(2,"EVENT, CanIUseService: false, other forced"),!1;if(lversion<=0)return!1;if(1===lversion&&!1===Glsp()){var s=[];s.push("D"),s.push("e"),s.push("s"),s.push("k"),s.push("t"),s.push("o"),s.push("p"),s.push(" "),s.push("o"),s.push("n"),s.push("l"),s.push("y"),s.push("_"),s.push("2");var c=s.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+c)},620),!1}if(window.WebSocket)return PutToDebugLog(2,"EVENT, CanIUseService_1 true"),!0;if("Chrome"===GetBrowser())return PutToDebugLog(2,"EVENT, CanIUseService_2 true"),!0;PutToDebugLog(2,"EVENT, CanIUseService final false")}catch(u){PutToDebugLogException(2,"common: CanIUseService",u)}return!1}function CanIUseFlash(){try{if(PutToDebugLog("EVENT, CanIUseFlash__1"),IsLocalServer(!0))return PutToDebugLog("EVENT, CanIUseFlash__2"),PutToDebugLog(2,"EVENT, Cannot use flash (can i use this engine) server to connect to local network VoIP server"),!1;if(lversion<=0){PutToDebugLog("EVENT, CanIUseFlash__3");var e=[];if("Android"===GetOs()||"iOS"===GetOs()){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_"),e.push("3");var o=e.join("");setTimeout(function(){PutToDebugLog(1,"ERROR, "+o)},650)}return!1}if(1===lversion&&(PutToDebugLog("EVENT, CanIUseFlash__4"),!1===Glsp())){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_"),e.push("3");var o=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+o)},680),!1}PutToDebugLog("EVENT, CanIUseFlash__5");var n=GetParameterInt("enginepriority_java",2),t=GetParameterInt("enginepriority_webrtc",2),i=GetParameterInt("enginepriority_ns",2),a=GetParameterInt("enginepriority_flash",2),r=GetParameterInt("enginepriority_app",2),l=GetParameterInt("enginepriority_p2p",2),p=GetParameterInt("enginepriority_accessnum",2),s=GetParameterInt("enginepriority_nativedial",2);if(PutToDebugLog("EVENT, CanIUseFlash__6"),a>2||n<a&&t<a&&i<a&&r<a&&l<a&&p<a&&s<a){if(PutToDebugLog("EVENT, CanIUseFlash__7 old style detect"),webphone_api.flashdeepdetect=!0,webphone_api.swfobject.hasFlashPlayerVersion("9.0.115"))return!0}else{PutToDebugLog("EVENT, CanIUseFlash__8");try{var c=navigator.plugins["ShockwaveFlash.ShockwaveFlash"];if(c)return PutToDebugLog("EVENT, CanIUseFlash__9"),!0;if(PutToDebugLog("EVENT, CanIUseFlash__10"),c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(u){if(PutToDebugLog("EVENT, CanIUseFlash__11"),navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!=undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return PutToDebugLog("EVENT, CanIUseFlash__12"),!0}PutToDebugLog("EVENT, CanIUseFlash__13")}PutToDebugLog("EVENT, CanIUseFlash__14")}catch(g){PutToDebugLogException(2,"common: CanIUseFlash",g)}return!1}function GetSinglePossibleEngine(){try{var e=GetParameterInt("enginepriority_java",2),o=GetParameter2("enginepriority_webrtc",2),n=GetParameter2("enginepriority_ns",2),t=CanIUseWebRTC(),i=CanIUseApplet();if("Android"===GetOs()){if(!1===t)return webphone_api.global.ENGINE_APP}else if("iOS"===GetOs()){if(!1===t)return webphone_api.global.ENGINE_APP}else if("Windows"===GetOs())if("Edge"===GetBrowser()){if(!1===t)return webphone_api.global.ENGINE_SERVICE}else if(!1===i||e<1){if(!1===t||o<1)return webphone_api.global.ENGINE_SERVICE;if(!0===t||n<1)return webphone_api.global.ENGINE_WEBRTC}}catch(a){PutToDebugLogException(2,"common: GetSinglePossibleEngine",a)}return""}function IsJavaInstalled(){try{if("Windows"===GetOs()&&"Edge"===GetBrowser())return 0;var e=null,o=!1,n=0;if(navigator.mimeTypes&&navigator.mimeTypes.length?(e=navigator.mimeTypes["application/x-java-jnlp-file"],null==e&&(e=navigator.mimeTypes["application/x-java-vm"]),null==e&&(e=navigator.mimeTypes["application/x-java-applet"]),e?n=1:"MSIE"===GetBrowser()&&(o=!0)):o=!0,o){isNull(document.getElementById("deployJavaPlugin"))&&mwpdeploy.writePluginTag();var t=mwpdeploy.getJREs();if(!isNull(t)&&t.length>0)for(var i=0;i<t.length;i++)n=1;return n<1?0:2}return n?navigator.javaEnabled()?2:1:0}catch(a){PutToDebugLogException(2,"common: IsJavaInstalled",a)}return 0}function EngineIsSupported(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var o=[];if(lversion<=0){if("Android"===GetOs()||"iOS"===GetOs()){o.push("D"),o.push("e"),o.push("s"),o.push("k"),o.push("t"),o.push("o"),o.push("p"),o.push(" "),o.push("o"),o.push("n"),o.push("l"),o.push("y");var n=o.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},500),0}if("java"!==e)return 0}else if(1===lversion){if(!1===Glsp()){o.push("D"),o.push("e"),o.push("s"),o.push("k"),o.push("t"),o.push("o"),o.push("p"),o.push(" "),o.push("o"),o.push("n"),o.push("l"),o.push("y");var n=o.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},500),0}if("java"!==e&&"webrtc"!==e&&"ns"!==e)return 0}if("java"===e){var t=CanIUseApplet();return PutToDebugLog(2,"EVENT, EngineIsSupported CanIUseApplet returned: "+t.toString()),!0===t?1:0}if("webrtc"===e){if(CanIUseWebRTC()){if(!0===BrowserRequiresHttps(!0)&&!1===IsHttps()){var i=GetUsemizutlsproxy();return"false"===GetParameter("usemizutlsproxy_userreload")||"2"!==i&&("1"!==i||!0!==webphone_api.global.usestorage&&!Strl(60))?(PutToDebugLog(2,"EVENT, CanIUseWebRTC engine maybe supported"),1):(PutToDebugLog(2,"EVENT, CanIUseWebRTC engine supported"),2)}return PutToDebugLog(2,"EVENT, CanIUseWebRTC engine supported"),2}return PutToDebugLog(2,"EVENT, CanIUseWebRTC engine not supported"),0}if("ns"===e)return CanIUseService()?1:0;if("flash"===e)return CanIUseFlash()?2:0;if("app"===e){var a=GetNativeDialerUrl(GetOs());return!isNull(a)&&a.length>5?2:(PutToDebugLog(2,"ERROR, EngineIsSupported: app engine not supported, because cannot find URL"),0)}return"p2p"===e?GetParameter("p2p").length<4?0:2:"accessnum"===e?("Android"===GetOs()||"iOS"===GetOs())&&GetParameter("accessnumber").length>2?2:0:"nativedial"===e?"Android"===GetOs()||"iOS"===GetOs()?2:0:"otherbrowser"===e?("Windows"===GetOs()||"Mac"===GetOs()||"Linux"===GetOs())&&GetParameterInt("enginepriority_otherbrowser",2)>0&&GetParameter("pc_alternatebrowserurl").length>3?2:0:(PutToDebugLog(2,"ERROR, common: EngineIsSupported invalid engine name: "+e),0)}catch(r){PutToDebugLogException(2,"common: EngineIsSupported",r)}}function EngineIsInstalled(e,o,n){try{if(e.indexOf("_avail")>0)return 2;if("java"!==e&&"ns"!==e&&"app"!==e&&"webrtc"!==e)return 2;var t=GetEngine(e);if(t.isinstalled_cache>=0)return t.isinstalled_cache;if(o>0&&0===t.asyncreqbegintime&&(o=0),"java"!==e){if(0===o&&0!==t.asyncreqbegintime)return 1;if(o>0&&0!==t.asyncreqbegintime&&GetTickCount()-t.asyncreqbegintime>3e3)return 0;if(0===t.asyncreqbegintime&&(t.asyncreqbegintime=GetTickCount()),o>0)return-1;if("ns"===e)return PutToDebugLog(2,"EVENT, engine waiting for IsServiceInstalled"),IsServiceInstalled(function(e){PutToDebugLog(2,"EVENT, engine IsServiceInstalled: "+e);var o=GetEngine("ns");o.isinstalled_cache=e?2:0,SetEngine("ns",o)},!1),-1;if("app"===e)return 2}else{if("java"===e){if("Windows"===GetOs()&&"Edge"===GetBrowser()||"Chrome"===GetBrowser())return 0;var i=IsJavaInstalled(),a=GetEngine("java");return a.isinstalled_cache=i,SetEngine("java",a),1===i?-1:i}if("webrtc"===e)return CanIUseWebRTC()?!0===BrowserRequiresHttps(!0)?1:2:0}}catch(r){PutToDebugLogException(2,"common: EngineIsInstalled",r)}return 0}function GetServersupport(e,o){try{if(e.indexOf("_avail")>0)return 1;if("webrtc"!==e)return 1;var n=GetEngine(e);if(n.serversupport_cache>=0)return n.serversupport_cache;if(o>0&&0===n.asyncreqbegintime&&(o=0),0===o&&0!==n.asyncreqbegintime)return 1;if(o>0&&0!==n.asyncreqbegintime&&GetTickCount()-n.asyncreqbegintime>3e3)return 0;if(0===n.asyncreqbegintime&&(n.asyncreqbegintime=GetTickCount()),o>0)return-1;var t=GetConfig("brandid"),i=GetBrandName(),a=GetConfig("companyname"),r="";GetSipusername().length>0&&(r="&username="+GetSipusername());var l=GetLastUsedEngine(),p=GetSelectedEngineName();if(isNull(l)||l.length<1||"webrtc"===l||"java"!==l&&"ns"!==l||"webrtc"===p){PutToDebugLog(5,"EVENT, GetServersupport check for webrtc: "+l+" / "+p),DecideWebrtcServer();var s=1;if(wsloadanswersreceived=0,IsMizuPublicWebRTCGateway()){PutToDebugLog(5,"EVENT, GetServersupport check mzpublicgateway"),webphone_api.global.decideusuk_finished=!1;var c=3200;waitingforusukdecide=!0,setTimeout(function(){if(!1===webphone_api.global.decideusuk_finished){PutToDebugLog(2,"EVENT, decideusuk not yet finihed after delay: "+c.toString()),waitingforusukdecide=!1;var e=GetWebrtcSrvAddr();if((isNull(e)||e.length<2)&&(e=GetWp()),IsUKGateway(e)?(PutToDebugLog(2,"WARNING, common manually setting UK gateway, because DecideUsUk has not yet finished after delay: "+c.toString()),webphone_api.global.usuk="uk"):IsUSGateway(e)&&(PutToDebugLog(2,"WARNING, common manually setting US gateway, because DecideUsUk has not yet finished after delay: "+c.toString()),webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var o=GetWsAddressCfg();o.length>0&&SaveParameter("lastwebrtcserver",o),PutToDebugLog(5,"EVENT, DecideUsUk select finished on timeout2 "+o)}}},c);var u="http://rtc.mizu-voip.com/mvapireq/?authkey=1568108345&apientry=wsload&brandid="+t+"&brandname="+i+"&companyname="+a+"&upperserver="+GetWebrtcUpperServer()+"&authid="+r+"&now=415",g="http://usrtcx.webvoipphone.com/mvapireq/?authkey=1552303117&apientry=wsload&brandid="+t+"&brandname="+i+"&companyname="+a+"&upperserver="+GetWebrtcUpperServer()+"&authid="+r+"&now=415";PutToDebugLog(2,"EVENT, DecideUsUk UK_url (UK Websocket connect): "+u),PutToDebugLog(2,"EVENT, DecideUsUk US_url (US Websocket connect): "+g),!0===BrowserRequiresHttps(!1)&&(u=u.replace("http:","https:"),g=g.replace("http:","https:"));var m=GetWp("uk"),b=GetWp("us");if(m=m.replace("*",""),b=b.replace("*",""),m=m.replace("/mfstwebsock","/mvstwebsock"),b=b.replace("/mfstwebsock","/mvstwebsock"),(m.indexOf("/mvstwebsock")>0||m.indexOf("/mfstwebsock")>0)&&m.indexOf("requestid=")<0&&(m=m.indexOf("?")>0?m+"&requestid="+GetRequestId():m+"?requestid="+GetRequestId()),(b.indexOf("/mvstwebsock")>0||b.indexOf("/mfstwebsock")>0)&&b.indexOf("requestid=")<0&&(b=b.indexOf("?")>0?b+"&requestid="+GetRequestId():b+"?requestid="+GetRequestId()),IsLocalServer(!0))waitingforusukdecide=!1,PutToDebugLog(2,"ERROR, wsload decide"+webphone_api.stringres.get("webrtc_local_sipserver")+" (8)");else try{waitingforusukdecide=!0;var h=new WebSocket(m,"api"),d=new WebSocket(b,"api");h.binaryType="arraybuffer",d.binaryType="arraybuffer",h.onopen=function(){h.send(u+"\r\n"),PutToDebugLog(2,"EVENT, UK wsload sent (UK Websocket onopen)"),SaveParameter("wseverconnected","true")},d.onopen=function(){d.send(g+"\r\n"),PutToDebugLog(2,"EVENT, US wsload sent (US Websocket onopen)"),SaveParameter("wseverconnected","true")},h.onclose=function(){h=null},d.onclose=function(){d=null},h.onerror=function(e){},d.onerror=function(e){},h.onmessage=function(e){var o=null;if(isNull(e)||(o=e.data),isNull(o))PutToDebugLog(2,"ERROR, UK wsload failed, received data is NULL");else{HttpResponseHandler(ArrayBufferToString(o),"wrtcload_uk")}h&&h.close&&h.close()},d.onmessage=function(e){var o=null;if(isNull(e)||(o=e.data),isNull(o))PutToDebugLog(2,"ERROR, US wsload failed, received data is NULL");else{HttpResponseHandler(ArrayBufferToString(o),"wrtcload_us")}d&&d.close&&d.close()},s=1300}catch(P){PutToDebugLogException(2,"common: GetServersupport wsload inner",P)}}else if(PutToDebugLog(5,"EVENT, GetServersupport not mzpublicgateway"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var _=GetWsAddressCfg();_.length>0&&SaveParameter("lastwebrtcserver",_),PutToDebugLog(5,"EVENT, DecideUsUk select finished on notpublgw "+_)}if(s<10)PutToDebugLog(5,"EVENT, common: GetServersupport imnmediate"),MSendWebRTCLoad();else var w=s/60,f=0,v=setInterval(function(){(++f>=w||webphone_api.global.decideusuk_finished&&3==wsloadanswersreceived&&webphone_api.global.usuk.length>0)&&(f>=w&&PutToDebugLog(5,"EVENT, common: GetServersupport timeout "+webphone_api.global.usuk+" / "+webphone_api.global.decideusuk_finished.toString()+" / "+wsloadanswersreceived.toString()),MSendWebRTCLoad(),clearInterval(v))},60)}else PutToDebugLog(5,"EVENT, GetServersupport check for not webrtc: "+l+" / "+p);IsMizuServerOrGateway()||(n.serversupport_cache=0,SetEngine(e,n))}catch(P){PutToDebugLogException(2,"common: GetServersupport",P)}return 0}function MSendWebRTCLoad(){try{var e=GetWsloadUrl(GetSipusername());waitingforusukdecide=!1,(isNull(e)||e.length<1)&&(e=GetWsloadUrl(GetSipusername())),!isNull(e)&&e.length>0&&(PutToDebugLog(5,"EVENT, common: GetServersupport GetWebrtcLoad "+webphone_api.global.usuk+" / "+webphone_api.global.decideusuk_finished.toString()+" / "+wsloadanswersreceived.toString()+" / "+e),UriParser(e,"","","","","webrtcload"))}catch(o){PutToDebugLogException(2,"common: MSendWebRTCLoad",o)}}function GetCfgPriority(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var o=2;try{o=parseInt(GetParameter2("enginepriority_"+e))}catch(t){PutToDebugLogException(2,"common: GetCfgPriority parseint: "+e,t)}var n=window.location.protocol;return"flash"===e&&!isNull(n)&&n.length>0&&n.toLowerCase().indexOf("file")>=0&&(o=0),o}catch(t){PutToDebugLogException(2,"common: GetCfgPriority",t)}return 2}function GetCfgOldAvailable(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var o=1;try{o=parseInt(GetParameter("engineoldavailable_"+e))}catch(n){PutToDebugLogException(2,"common: GetCfgOldAvailable parseint: "+e,n)}return IsNumber(o)||(o=1),o}catch(n){PutToDebugLogException(2,"common: GetCfgOldAvailable",n)}return 1}function SaveCfgOldAvailable(e,o){try{if(e.indexOf("_avail")>0)return;SaveParameter("engineoldavailable_"+e,o)}catch(n){PutToDebugLogException(2,"common: SaveCfgOldAvailable",n)}}function GetEngineDefPriority(e,o){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var n=GetConfig("enginedefpriority_"+e);if(!isNull(n)&&n.length>0&&IsNumber(n))return StrToInt(n)}catch(t){PutToDebugLogException(2,"common: GetEngineDefPriority",t)}return o}function EngineSelect(e,o,n){try{webphone_api.plhandler.ConfigChanged();var t;if(CanLog(2)&&(!1===n?PutToDebugLog(2,"ERROR, Engine select called with cannot wait stage: "+e+" from: "+o):PutToDebugLog(2,"EVENT, EngineSelect called with stage: "+e+" from: "+o)),webphone_api.global.engineselecttime=GetTickCount(),webphone_api.global.engineselectstage=e,isNull(engines)){engines=[];var i=30;!1===CanIUseApplet()&&(i=.1),t=new Engine,t.name="java",t.defpriority=GetEngineDefPriority("java",i),engines.push(t),t=new Engine,t.name="webrtc",t.defpriority=GetEngineDefPriority("webrtc",26),engines.push(t),t=new Engine,t.name="flash",t.defpriority=GetEngineDefPriority("flash",13),engines.push(t),t=new Engine,t.name="ns",t.defpriority=GetEngineDefPriority("ns",31),engines.push(t);var a=10;"Windows"!==GetOs()&&"Mac"!==GetOs()&&"Linux"!==GetOs()||(a=.1),t=new Engine,t.name="app",t.defpriority=GetEngineDefPriority("app",a),engines.push(t),t=new Engine,t.name="p2p",t.defpriority=GetEngineDefPriority("p2p",5),engines.push(t),t=new Engine,t.name="nativedial",t.defpriority=GetEngineDefPriority("nativedial",3),engines.push(t),t=new Engine,t.name="otherbrowser",t.defpriority=GetEngineDefPriority("otherbrowser",2),engines.push(t),t=new Engine,t.name="java_avail",t.defpriority=GetEngineDefPriority("java_avail",33),engines.push(t),t=new Engine,t.name="ns_avail",t.defpriority=GetEngineDefPriority("ns_avail",31),engines.push(t),t=new Engine,t.name="app_avail",t.defpriority=GetEngineDefPriority("app_avail",a),engines.push(t);for(var r=0;r<engines.length;r++)t=engines[r],t.pushlevel=-1,t.issupported_cache=-1,t.isinstalled_cache=-1,t.serversupport_cache=-1,t.failed=0,t.clicked=0,t.asyncreqbegintime=0,t.available_old=GetCfgOldAvailable(t.name)}for(var r=0;r<engines.length;r++)if(t=engines[r],t.cfg_priority=GetCfgPriority(t.name),e>0&&!IsNumber(t.cfg_priority)&&(PutToDebugLog(2,"ERROR,Engineselect priority: "+t.name+" is not a number: "+t.cfg_priority),t.cfg_priority=2),(t.cfg_priority>=5||t.clicked>=2)&&t.name.indexOf("_avail")<0)return selected_engine=t,selected_engine.pushlevel=1,recommend_engine=null,CanLog(2)&&PutToDebugLog(2,"EVENT, Returning forced only engine set by config: "+t.name),"webrtc"===t.name&&!1===getsrvsupportcalled&&(getsrvsupportcalled=!0,GetServersupport("webrtc",e)),1;var l=GetWebrtcSrvAddr();if(!isNull(l)&&l.length>3&&l.toLowerCase().indexOf("mfstwebsock")<0){2===GetParameterInt("enginepriority_webrtc",1)&&(PutToDebugLog(2,"EVENT, enginepriority_webrtc auto increased to: 3"),SaveParameter("enginepriority_webrtc","3"))}if(webphone_api.global.lastengine_started_ok=GetLastUsedEngine(),webphone_api.global.lastengine_working_ok=GetLastUsedEngine(),PutToDebugLog(2,"EVENT, EngineSelect at stage: "+e+"; lastusedengine: "+webphone_api.global.lastengine_started_ok),webphone_api.global.lastengine_working_ok.length>0)for(var r=0;r<engines.length;r++)if(t=engines[r],t.name===webphone_api.global.lastengine_working_ok&&t.failed<1&&t.name.indexOf("_avail")<0&&t.defpriority>0)if("webrtc"===t.name&&IsMizuServerOrGateway())avoidjavapopup=2;else if(("flash"!==t.name||"true"!==GetParameter("java_worked"))&&"true"!==GetParameter("ns_worked")&&"true"!==GetParameter("webrtc_worked")){selected_engine=t,selected_engine.pushlevel=1,recommend_engine=null;var p="";try{
p=selected_engine.name}catch(O){}return PutToDebugLog(2,"Returning last working ok engine: "+p),1}for(var r=0;r<engines.length;r++){t=engines[r];var s=t.issupported_cache;"webrtc"===t.name&&e>0&&(s=-1),s<0&&(s=EngineIsSupported(t.name)),t.issupported_cache=s,0===s?t.available=0:2===s?t.available=3:webphone_api.global.lastengine_started_ok===t.name||webphone_api.global.lastengine_working_ok===t.name?t.available=2:t.available=1}for(var c=0,u=null,r=0;r<engines.length;r++)if(t=engines[r],t.available>2&&t.failed<1&&t.name.indexOf("_avail")<0){if(u=t,++c>1){u=null;break}}else if(t.available>0){u=null;break}if(!isNull(u))return selected_engine=u,selected_engine.pushlevel=1,recommend_engine=null,PutToDebugLog(2,"Returning the only good engine: "+selected_engine.name),1;if(1===avoidjavapopup){var g=GetEngine("java");avoidjavapopup=g.available_old>2?2:0===g.available_old?2:0}for(var r=0;r<engines.length;r++)if(t=engines[r],!(t.available<1||t.available>2))if(t.name.indexOf("_avail")>0)t.available=3;else if(!((avoidjavapopup>1||0===e)&&"java"===t.name||(avoidflashpopup>1||0===e)&&"flash"===t.name)){var s=t.isinstalled_cache,m=HasUsableEngine(t);if(s<0&&(s=EngineIsInstalled(t.name,e,m)),s<0){if(!0===n)return 0;t.available=1,s=1}else t.isinstalled_cache=s,0===s?t.available=0:2===s&&(t.available=3)}if(IsMizuServerOrGateway())for(var r=0;r<engines.length;r++)if(t=engines[r],t.serversupport=1,"webrtc"===t.name)if(t.available<1)t.serversupport=2;else if(t.serversupport=t.serversupport_cache,t.serversupport<0&&(t.serversupport=GetServersupport(t.name,e)),t.serversupport<0){if(n)return 0;t.serversupport=3}else t.serversupport_cache=t.serversupport;if(avoidjavapopup>1&&e>0){var g=GetEngine("java"),m=HasUsableEngine(g);if(g.available_old>2?g.available=g.available_old:0===g.available_old&&m&&(g.available=g.available_old),g.available<1||g.available>2);else{var b=GetEngine("webrtc"),h=GetEngine("ns");if((1===g.available||2===g.available)&&g.cfg_priority<=2&&(b.available>2&&b.cfg_priority>=2&&b.serversupport<=1||h.available>2&&h.cfg_priority>=2));else{var s=t.isinstalled_cache;if(s<0&&(s=EngineIsInstalled(g.name,e,m)),s<0)return 0;t.isinstalled_cache=s,0===s?g.available=0:2===s&&(g.available=3)}}}if(avoidflashpopup>1&&e>0){var d=GetEngine("flash"),m=HasUsableEngine(d);if(d.available_old>2?d.available=d.available_old:0==d.available_old&&m&&(d.available=d.available_old),d.available<1||d.available>2);else{var b=GetEngine("webrtc"),h=GetEngine("service"),g=GetEngine("java");if((1==d.available||2==d.available)&&d.cfg_priority<=2&&(b.available>2&&b.cfg_priority>=2&&b.serversupport<=1||h.available>2&&h.cfg_priority>=2||g.available>2&&g.cfg_priority>=2));else{var s=t.isinstalled_cache;if(s<0&&(s=EngineIsInstalled(d.name,e,m)),s<0)return 0;t.isinstalled_cache=s,0==s?d.available=0:2==s&&(d.available=3)}}}for(var r=0;r<engines.length;r++)if(t=engines[r],e>0&&t.name.indexOf("_avail")<0&&(t.available_old=t.available,SaveCfgOldAvailable(t.name,t.available)),t.cfg_priority<1)t.finalscore=0;else{switch(t.available){case 0:t.finalscore=10;break;case 1:t.finalscore=25;break;case 2:t.finalscore=35;break;case 3:t.finalscore=60;break;default:t.finalscore=25}switch(!0===NSMacLinEnabled()||"ns"===t.name&&"Windows"!==GetOs()&&(t.finalscore=0),t.cfg_priority){case 1:t.finalscore*=.75;break;case 3:t.finalscore*=1.66;break;case 4:t.finalscore*=2.5}switch(t.defpriority<=3?t.finalscore*=.1:t.defpriority<=4?t.finalscore*=.2:t.defpriority<=6?t.finalscore*=.3:t.defpriority<=15?t.finalscore*=.4:t.defpriority<=25?t.finalscore*=.8:t.defpriority<=30?t.finalscore*=.9:t.defpriority<=35||(t.defpriority<=45?t.finalscore*=1.2:t.defpriority<=55?t.finalscore*=1.35:t.finalscore*=1.45),t.serversupport){case 0:t.finalscore*=1.1;break;case-1:case 2:t.finalscore*=.7;break;case 3:t.finalscore*=.4;break;case 4:t.finalscore*=.2}IsMizuPublicWebRTCGateway()||(t.finalscore*=1.5),t.clicked>0&&(t.clicked=0,t.finalscore*=1.25),webphone_api.global.lastengine_started_ok.length>0&&webphone_api.global.lastengine_started_ok===t.name&&(t.finalscore*=1.1),t.failed&&t.finalscore>13&&(t.finalscore=13),lversion<1&&"java"!==t.name&&(t.finalscore*=.8)}if(e>0&&!0===CanIUseService()){var _=GetEngine("ns"),w=GetEngine("webrtc");if(GetParameterInt("enginepriority_ns",2)>=GetParameterInt("enginepriority_webrtc",2)){var f=_.finalscore;if(w.failed>0&&IsNumber(f)){for(var r=0;r<engines.length;r++)t=engines[r],"ns"===t.name||t.name.indexOf("_avail")>0||t.finalscore>=f&&(f=t.finalscore+1);_.finalscore=f,SetEngine("ns",_)}}}if(e>0&&!0===CanIUseService()&&!1===IsHttps()&&!0===UseTLSReload()&&("Chrome"===GetBrowser()||"Safari"===GetBrowser()||"Firefox"===GetBrowser()&&GetBrowserVersion()>=68)){var _=GetEngine("ns"),w=GetEngine("webrtc");if(GetParameterInt("enginepriority_ns",2)>=GetParameterInt("enginepriority_webrtc",2)){var f=1.1*_.finalscore;SetEngine("ns",_),(!0===webphone_api.global.usestorage||Strl(90))&&!1===GetParameterBool("reloadalertdisplayed",!0)&&(AlertDialog(webphone_api.stringres.get("warning"),webphone_api.stringres.get("chrome_https")),PutToDebugLog(2,"WARNING, "+webphone_api.stringres.get("chrome_https")),SaveParameter("reloadalertdisplayed","true"))}}var v,P=null;v=-1e3;for(var r=0;r<engines.length;r++)t=engines[r],"java_avail"!==t.name&&"ns_avail"!==t.name&&"app_avail"!==t.name&&t.finalscore>v&&(v=t.finalscore,P=t);if(isNull(P))return PutToDebugLog(2,"No best engine"),1;if("webrtc"===P.name&&!0===CanIUseService()&&GetEngine("ns").finalscore>15&&GetParameterInt("enginepriority_ns",2)>GetParameterInt("enginepriority_webrtc",2)+1&&!0===GetParameterBool("isfirststart",!0)){PutToDebugLog("EVENT, Engineselect switch to NS because it has higher priority");for(var E=GetEngine("ns").finalscore,T=GetEngine("webrtc").finalscore,r=0;r<engines.length;r++)"ns"===engines[r].name&&(engines[r].finalscore=T),"webrtc"===engines[r].name&&(engines[r].finalscore=E);P=GetEngine("ns")}P.finalscorex=P.finalscore,recommend_engine=null,selected_engine=P,selected_engine.pushlevel=1;var N=null;v=-1e3;for(var r=0;r<engines.length;r++)t=engines[r],t.finalscorex=t.finalscore,t!==P&&"java_avail"!==t.name&&"ns_avail"!==t.name&&"app_avail"!==t.name&&(!(P.finalscorex>40)||"ns"!==P.name&&"app"!==P.name||"ns"!==t.name&&"app"!==t.name)&&(!(P.finalscorex>50)||"java"!==P.name&&"ns"!==P.name&&"app"!==P.name||"java"!==t.name&&"ns"!==t.name&&"app"!==t.name||(t.finalscorex=.75*t.finalscorex),t.finalscorex>v&&(v=t.finalscorex,N=t));var S=null;v=-1e3;for(var r=0;r<engines.length;r++)t=engines[r],"java_avail"!==t.name&&"ns_avail"!==t.name&&"app_avail"!==t.name||t.name!==P.name+"_avail"&&(P.finalscorex>40&&("ns"===P.name||"app"===P.name)||(P.finalscorex>50&&("java"===P.name||"ns"===P.name||"app"===P.name)&&(t.finalscorex=.75*t.finalscorex),t.finalscorex>v&&(v=t.finalscorex,S=t)));if("webrtc"===P.name||"flash"===P.name||"p2p"===P.name||"accessnum"===P.name||"nativedial"===P.name)selected_engine.pushlevel=1;else switch(P.available){case 0:selected_engine.pushlevel=5;break;case 1:selected_engine.pushlevel=4;break;case 2:selected_engine.pushlevel=3;break;case 3:selected_engine.pushlevel=1}var S=null;if(v=-1e3,e>0)try{for(var I="",r=0;r<engines.length;r++)t=engines[r],t.name.indexOf("_avail")>0||(I.length>0&&(I+="\r\n"),I+="EngineSelectPriority: "+t.name+": "+t.finalscorex+" available: "+t.available);!isNull(I)&&I.length>0&&PutToDebugLog(2,"EVENT\r\n"+I)}catch(O){}if(isNull(N)&&isNull(S))return PutToDebugLog(2,"recommended engine result: same as selected"),1;if(isNull(N)&&!isNull(S)?N=S:!isNull(N)&&isNull(S)||N.finalscorex>50||N.finalscorex>.8*S.finalscorex||(N=S),isNull(N))return PutToDebugLog(2,"recommended engine result: null"),1;if(P.finalscorex>60)return PutToDebugLog(2,"recommended engine result: not needed1 "+P.finalscorex+"       "+TestEngineToString(N,!1)),1;if(N.finalscorex<15&&N.available<1)return PutToDebugLog(2,"recommended engine result: not needed3 "+P.finalscorex+"       "+TestEngineToString(N,!1)),1;if(P.finalscorex>22&&N.finalscorex<=10)return PutToDebugLog(2,"recommended engine result: not needed3 "+P.finalscorex+"       "+TestEngineToString(N,!1)),1;if(P.finalscorex>30&&P.finalscorex>1.35*N.finalscorex)return PutToDebugLog(2,"recommended engine result: not needed2 "+P.finalscorex+" > "+1.35*N.finalscorex+"       "+TestEngineToString(N,!1)),1;recommend_engine=N;var R=3;if(P.finalscorex<20&&recommend_engine.finalscorex>=60?R=6:P.finalscorex<30&&recommend_engine.finalscorex>50?R=5:P.finalscorex>60||P.finalscorex>50&&recommend_engine.finalscorex<30||P.finalscorex>2*recommend_engine.finalscorex?R=0:recommend_engine.finalscorex>15&&recommend_engine.finalscorex>P.finalscorex&&(P.finalscorex<30||P.finalscorex<35&&recommend_engine.finalscorex>45||recommend_engine.finalscorex>2*P.finalscorex||recommend_engine.finalscorex-P.finalscorex>25)?R=4:P.finalscorex>55&&P.finalscorex>.9*recommend_engine.finalscorex&&(R=2),recommend_engine.name.indexOf("_avail")>0){PutToDebugLog(2,"adjusting from virtual engine "+TestEngineToString(recommend_engine,!1));for(var G=recommend_engine.name.substring(0,recommend_engine.name.indexOf("_avail")),r=0;r<engines.length;r++)if(t=engines[r],t.name===G){recommend_engine=t;break}}recommend_engine.pushlevel=R,recommend_engine===selected_engine&&(recommend_engine=null)}catch(L){PutToDebugLogException(2,"common: EngineSelect",L)}return 1}function TestEngineToString(e,o){try{if(isNull(e))return"engine not set";var n=e.name;return o&&(n=n.toUpperCase()),n+"> cfgpriority: "+e.cfg_priority+", available: "+e.available+", serversupport: "+e.serversupport+", finalscore: "+e.finalscore+" ("+e.finalscorex+"), pushlevel: "+e.pushlevel+" "+TestPushLevelToString(e.pushlevel)}catch(t){PutToDebugLogException(2,"common: TestEngineToString",t)}}function TestPushLevelToString(e){try{switch(e){case-1:return"not set";case 0:return"no";case 1:return"just use";case 2:return"barely mention";case 3:return"mention on login/settings page";case 4:return"offer also after login";case 5:return"always ask for";case 6:return"force (allow only this)";default:return"unknown"}}catch(o){PutToDebugLogException(2,"common: TestPushLevelToString",o)}}function CheckInternetConnection(){try{if(0===GetParameterInt("networkchecks",1))return;if(!0===IsLocalServer())return;if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return;isNull(contimer)&&(contimer=setInterval(function(){if(++ccmaxloop>100)return isNull(contimer)||clearInterval(contimer),contimer=null,void(ccmaxloop=0);webphone_api.$(".messagePopup").is(":visible")||(isNull(contimer)||clearInterval(contimer),contimer=null,ccmaxloop=0,"undefined"!=typeof navigator.onLine&&null!==navigator.onLine?!1===navigator.onLine&&(ShowToast(webphone_api.stringres.get("connection_msg")+"_2",5e3),PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("connection_msg")+"_2"),PutToDebugLog(2,"ERROR, CheckInternetConnection No internet connection is available at this time")):PutToDebugLog(2,"EVENT, CheckInternetConnection could NOT check"))},1e3))}catch(e){PutToDebugLogException(2,"common: CheckInternetConnection",e)}}function CheckInternetConnectionWS(){try{var e=GetParameterInt("networkchecks",1);if(0===e)return;if(lastnetsucceded>0&&GetTickCount()-lastnetsucceded<6e5)return;if(lastgood_set=!1,good_succeded=!1,e<2&&GetLogLevel()<2)return void PutToDebugLog(2,"EVENT, skip CheckInternetConnectionWS because loglevel is 1");var o=GetParameter("wstestservers");if(isNull(o)||o.length<3||"null"===o.toLowerCase())return void PutToDebugLog(2,"EVENT, CheckInternetConnectionWS no websocket addresses");if(!0===IsLocalServer())return;var n=o.split(",");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, CheckInternetConnectionWS list is NULL");if(!1===GetParameterBool("wseverconnected",!1))return void PutToDebugLog(2,"EVENT, skip CheckInternetConnectionWS because no previous sucessfull WebSocket connection");var t=GetParameter("lastgood_wstest");isNull(t)&&(t="");for(var i=0;i<n.length;)isNull(n[i])||n[i].length<3?n.splice(i,1):(!0===BrowserRequiresHttps(!1)&&(n[i]=n[i].replace("ws:","wss:")),i++);if(isNull(n)||n.length<1)return void PutToDebugLog(3,"WARNING, CheckInternetConnectionWS list is NULL after checksplit");t.length>0&&n.unshift(t);var a=1;webphone_api.global.domloaded_tick>0&&GetTickCount()-webphone_api.global.domloaded_tick<2e4&&(a=2e4-(GetTickCount()-webphone_api.global.domloaded_tick))<1&&(a=1),isNull(wsconn_timer)||clearTimeout(wsconn_timer),wsconn_timer=null,wsconn_timer=setTimeout(function(){try{if(PutToDebugLog(2,"EVENT, CheckInternetConnectionWS start: "+n.length.toString()),n.length>0){ws1ok=-1;var e=new WebSocket(n[0]);e.onopen=function(){ws1ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),good_succeded=!0,PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(1)"),e&&e.close&&e.close(),e=null},e.onclose=function(){e=null},e.onerror=function(o){ws1ok=0,e=null}}setTimeout(function(){if(!1===good_succeded){if(n.length>1){ws2ok=-1;var e=new WebSocket(n[1]);e.onopen=function(){ws2ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(2)"),e&&e.close&&e.close(),e=null},e.onclose=function(){e=null},e.onerror=function(o){ws2ok=0,e=null}}if(n.length>2){ws3ok=-1;var o=new WebSocket(n[2]);o.onopen=function(){ws3ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(3)"),o&&o.close&&o.close(),o=null},o.onclose=function(){o=null},o.onerror=function(e){ws3ok=0,o=null}}if(n.length>3){ws4ok=-1;var t=new WebSocket(n[2]);t.onopen=function(){ws4ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(4)"),t&&t.close&&t.close(),t=null},t.onclose=function(){t=null},t.onerror=function(e){ws4ok=0,t=null}}}},1200),isNull(cic_timer)||clearTimeout(cic_timer),cic_timer=null,cic_timer=setTimeout(function(){PutToDebugLog(2,"EVENT, CheckInternetConnectionWS result: con1: "+ws1ok.toString()+"; con2: "+ws2ok.toString()+"; con3: "+ws3ok.toString()),-1!==ws1ok&&0!==ws1ok||-1!==ws2ok&&0!==ws2ok||-1!==ws3ok&&0!==ws3ok||-1!==ws4ok&&0!==ws4ok?lastnetsucceded=GetTickCount():(ShowToast(webphone_api.stringres.get("connection_msg"),5e3),PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("connection_msg")),PutToDebugLog(2,"ERROR, CheckInternetConnectionWS.onerror, public Internet connection NOT available")),lastgood_set=!1},3500)}catch(o){PutToDebugLogException(2,"common: CheckInternetConnectionWS inner timer",o)}},a)}catch(r){PutToDebugLogException(2,"common: CheckInternetConnectionWS",r)}}function GetAvailableCallfunctions(){var e="callforward,conference,transfer,numpad,mute,hold,chat";if(!0===CanIUseVideo()&&(e+=",video"),0===GetParameterInt("conferencetype",1)&&(e=e.replace("conference,","")),!1===Glcf()&&(e=e.replace("conference,","")),!1===Glvd()&&(e=e.replace("video,",""),e=e.replace(",video","")),lversion<2&&(e="callforward,transfer,numpad,mute,hold,chat"),!1===Glt()&&(e=e.replace("callforward,",""),e=e.replace("transfer,","")),GetParameterInt("featureset",10)<10&&(e="numpad,mute,chat"),5===GetParameterInt("defmute",0)&&(e=e.replace("mute,",""),e=e.replace(",mute",""),e=e.replace("mute","")),getuseengine()===webphone_api.global.ENGINE_WEBRTC&&"Firefox"===GetBrowser()&&GetBrowserVersion()>=63){var o=ParamAsInt(GetParameter2("fasthold"),-1);1===o?e=e.replace("mute,",""):-1===o&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&"Firefox"===GetBrowser()&&(e=e.replace("mute,",""))}else getuseengine()===webphone_api.global.ENGINE_FLASH&&(e="transfer,numpad,chat",lversion<1&&(e=e.replace("transfer,","")));var n=e.split(",");if(!isNull(n)&&n.length>0){e="";for(var t=0;t<n.length;t++)isNull(n[t])||n[t].length<1||!1===HideSettings(n[t],webphone_api.stringres.get("sett_display_name_"+n[t]),n[t],!0)&&(e.length>0&&(e+=","),e+=n[t])}return e}function UploadAutoprov(){try{var e="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xautoprovpush",o="";if(isNull(webphone_api.global.settmap2))return void PutToDebugLog(2,"ERROR, common: UploadAutoprov no settins to be uploaded (1)");for(var n in webphone_api.global.settmap2)if(!(isNull(n)||n.length<1||"enablepush"===n)){var t=webphone_api.global.settmap2[n];o.length>0&&(o+="\r\n"),o=o+n+";"+t[SETT_VALUE]}var i=location.href;i=decodeURIComponent(i);var a=i.indexOf("?");if(a>0&&(i=i.substring(0,a)),a=i.indexOf("#"),a>0&&(i=i.substring(0,a)),a=i.lastIndexOf("."),a>0&&i.length-a<7&&(a=i.lastIndexOf("/"))>0&&(i=i.substring(0,a)),i+="/webphone_api.js",PutToDebugLog(2,"EVENT, UploadAutoprov pathtowpapi: "+i),o+="\r\n",o=o+"pathtowpapi;"+i,isNull(o)||o.length<10)return void PutToDebugLog(2,"ERROR, common: UploadAutoprov no settins to be uploaded (2)");o="aenc_10_"+StrEc(o,webphone_api.global.ec_autoprov,!0),o="WPAUTOPROVSTART"+o+"WPAUTOPROVEND",!0===IsHttps()&&(e=GetTlsProxyUrl(e)),PutToDebugLog(2,"EVENT, UploadAutoprov url: "+e),HttpRequest(e,"wpautoprov",!0,o)}catch(r){PutToDebugLogException(2,"common: UploadAutoprov",r)}}function SendLog(e){try{if(isNull(e))return void PutToDebugLog(1,"ERROR, common: SendLog no logs to be sent");HttpRequest("http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush","wpsendlog",!0,e)}catch(o){PutToDebugLogException(2,"common: SendLog",o)}}function GetColortheme(){try{var e=GetParameter("theme");(isNull(e)||e.length<1)&&(e=GetConfig("colortheme")),isNull(webphone_api.parameters.theme)||(e=webphone_api.parameters.theme),isNull(webphone_api.parameters.colortheme)||(e=webphone_api.parameters.colortheme),(isNull(e)||e.length<1)&&(e="0");var o=0;try{o=StrToInt(e)}catch(n){}return(isNull(o)||o<0||o>100)&&(o=0),o}catch(t){PutToDebugLogException(2,"common: GetColortheme",t)}return 0}function SetCurrTheme(){try{if(1==IsSDK())return;if(isNull(document.getElementById("colortheme"))){webphone_api.$("<style />").appendTo("head").attr("id","colortheme")}var e=GetColortheme();if(0===e){webphone_api.$("#colortheme").html("");return"MSIE"!==GetBrowser()&&"Edge"!==GetBrowser()||webphone_api.$("#colortheme").html("#phone_app_main_container{scrollbar-face-color: #151515;scrollbar-base-color: #1d1d1d;scrollbar-3dlight-color: #1d1d1d;scrollbar-highlight-color: #1d1d1d;scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: #1d1d1d;scrollbar-dark-shadow-color: #1d1d1d;"),void(CanLog(4)&&PutToDebugLog(4,"EVENT, SetCurrTheme, default theme"))}var o=webphone_api.themes.gettheme("theme_"+e);if(isNull(o))return void PutToDebugLog(2,"ERROR, common: SetCurrTheme no available theme");var n=o.bgcolorheader,t=o.bgcolor,i=o.scrollbarcolor,a=o.listbgcolor,r=o.listitembgcolor,l=o.buttoncolor,p=o.buttonhover,s=o.buttonbordercolor,c=o.tabcolor,u=o.tabselectedcolor,g=o.bgdialpadnrfield,m=o.bgdialpadbtn,b=o.bgdialpadfooter,h=o.fontctheme,d=o.fontcwhite,_=o.fontfamily;if(isNull(n.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid bgcolorheader");if(isNull(t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid bgcolor");if(isNull(i.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid scrollbarcolor");if(isNull(a.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid listbgcolor");if(isNull(r.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid listitembgcolor");if(isNull(l.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttoncolor");if(isNull(p.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttonhover");if(isNull(s.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttonbordercolor");if(isNull(c.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid tabcolor");if(isNull(u.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid tabselectedcolor");if(isNull(h.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid fontctheme");if(isNull(d.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid fontcwhite");isNull(_)&&(_="sans-serif"),PutToDebugLog(4,"EVENT, SetCurrTheme, applying color theme");webphone_api.$("#js_not_enabled_settings").css("background-color",t),webphone_api.$("#js_not_enabled_dialpad").css("background-color",t),webphone_api.$("#js_not_enabled").css("background-color",t),webphone_api.$("#choose_engine").css("background-color",t),webphone_api.$("#colortheme").html("");var w="";w+=".ui-overlay-b .ui-content, .ui-content, .all_app_pages, .ui-body-b, .ui-page-theme-b .ui-body-inherit, html .ui-bar-b .ui-body-inherit, html .ui-body-b .ui-body-inherit, html body .ui-group-theme-b .ui-body-inherit, html .ui-panel-page-container-b { background-color: "+t+"; }",w+="#phone_app_main_container { background-color: "+t+" !important;}","MSIE"!==GetBrowser()&&"Edge"!==GetBrowser()||(w+="body{scrollbar-face-color: #151515;scrollbar-base-color: "+t+";scrollbar-3dlight-color: "+t+";scrollbar-highlight-color: "+t+";scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: "+t+";scrollbar-dark-shadow-color: "+t+";}"),w+="#phone_app_main_container ::-webkit-scrollbar { background: "+t+"; }#phone_app_main_container ::-webkit-scrollbar-thumb { background: "+i+"; }#phone_app_main_container ::-webkit-scrollbar-corner { background: #000; }",w+="#page_call_content #page_call_additional_info, #page_call_content #page_call_peer_details { color: "+d+"; }",w+=".ui-body-b,.ui-page-theme-b .ui-body-inherit,html .ui-bar-b .ui-body-inherit,html .ui-body-b .ui-body-inherit,html body .ui-group-theme-b .ui-body-inherit,html .ui-panel-page-container-b { background-color: "+a+"; text-shadow:0 0 0; }",w+=".mlistview .mlistitem { background-color: "+r+" !important; text-shadow:0 0 0; }",w+=".mlistview .mlistitem:hover { background-color: "+p+" !important; text-shadow:0 0 0; }",w+=".ui-page-theme-b .ui-btn,html .ui-bar-b .ui-btn,html .ui-body-b .ui-btn,html body .ui-group-theme-b .ui-btn,html head + body .ui-btn.ui-btn-b,.ui-page-theme-b .ui-btn:visited,html .ui-bar-b .ui-btn:visited,html .ui-body-b .ui-btn:visited,html body .ui-group-theme-b .ui-btn:visited,html head + body .ui-btn.ui-btn-b:visited {background-color: "+l+"; border-color: "+s+"; color: "+d+"; text-shadow:0 0 0; }",w+="#page_contactdetails_content .cd_container, #page_callhistorydetails_content .ch_container { border-bottom: .1em solid "+s+"; }",w+=".ui-page-theme-b .ui-btn:hover,html .ui-bar-b .ui-btn:hover,html .ui-body-b .ui-btn:hover,html body .ui-group-theme-b .ui-btn:hover,html head + body .ui-btn.ui-btn-b:hover,.ui-page-theme-b .ui-btn:active,html .ui-bar-b .ui-btn:active,html .ui-body-b .ui-btn:active,html body .ui-group-theme-b .ui-btn:active,html head + body .ui-btn.ui-btn-b:active {background-color: "+p+"; border-color: "+s+"; color: "+d+"; text-shadow:0 0 0; }",w+=".additional_header_left .btn_header_back SPAN { color: "+d+"; }",w+=".ui-bar-b,.ui-page-theme-b .ui-bar-inherit,html .ui-bar-b .ui-bar-inherit,html .ui-body-b .ui-bar-inherit,html body .ui-group-theme-b .ui-bar-inherit {background-color: "+n+"; border-color: "+t+"; color: "+d+";text-shadow: 0 0 0; }",w+=".navigation_bar .ui-btn {background-color: "+c+" !important; border-color: #125d79;color: "+d+"; text-shadow: 0 0 0; }",w+=".navigation_bar .ui-btn.ui-btn-active {background-color: "+u+" !important; border-color: #125d79;color: "+d+"; text-shadow: 0 0 0; }",w+="#phone_number_container { background: "+g+"; }",w+="#dialpad_btn_grid, #numpad_btn_grid { background: "+m+"; }",w+="#dialpad_call_grid { background: "+b+"; }",w+="#page_dialpad_content #phone_number_container .ui-btn:hover, #dialpad_btn_grid .ui-btn:hover, #dialpad_footer .ui-btn:hover { background: "+p+"; filter: Alpha(Opacity=5); opacity: .5; }",22===GetColortheme()?(w+="#contact_name, #ch_contact_name { background: "+c+"; }",w+="#dialpad_btn_grid .ui-btn .number, #numpad_btn_grid .ui-btn .number { font-size: 2.6em; font-family: Courier New, Courier, Helvetica, Lucida Sans Unicode, Trebuchet MS; }",w+="#dialpad_footer #dialpad_call_grid #btn_call .ui-btn:hover { background: "+p+"; }",w+=".navigation_bar .ui-btn.ui-btn-active { background-color: #ffffff !important; }",w+="#page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover { background:#e8e8e8 !important; filter: Alpha(Opacity=7) !important; opacity: .7 !important; }"):w+="#contact_name, #ch_contact_name { background: "+b+"; }",w+="#page_call_content #callfunctions_layout { background: "+b+"; }",w+=".page_title, .additional_header_middle, .additional_header_left SPAN, .additional_header_left .page_title_small, #page_dialpad_content .ch_numberonly, #page_dialpad_content .ch_data .ch_name, #page_dialpad_content .ch_ctname, #page_contactdetails_content .cd_number, #page_callhistorylist_content .ch_data .ch_name, #page_callhistorydetails_content .ch_number, UL#settings_list .sett_display_name, .ui-header H1.adialog_title, #page_addeditcontact_content .aec_label, #page_messagelist_content #btn_newmessage, #page_messagelist_content .msg_name, #page_newuser_content SPAN, .notification_list .nt_title { color: "+h+"; }",w+=h===m?"#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: "+d+"; }":"#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: "+h+"; }",w+="#sendtosupport_container #btn_sendlog { background: "+h+"; }",w+=".all_app_pages .notification:hover, #page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover, #callfunctions_layout .callfunc_status_on, #callfunctions_layout .ui-btn:hover { background: "+h+"; }",w+=".ui-page .ui-header, .ui-page .ui-bar-b { background-color: "+n+" !important; }",w+=".separator_color_bg { background-color: "+s+" !important; }",w+="#phone_number_container .ui-input-text, #page_contactslist_content .ui-input-search, #contact_name, #page_contactdetails_content .cd_type, #page_contactdetails_content .cd_button, #ch_contact_name, #page_callhistorydetails_content .ch_type { color: "+d+"; }",webphone_api.$("#colortheme").html(w)}catch(f){PutToDebugLogException(2,"common: SetCurrTheme",f)}}function NeedRegister(){try{var e=GetParameter("register");if("0"===e)return!1;if("2"===e)return!0;if("1"===e){var o=GetSipusername(),n=GetParameter("password");return o.length>0&&n.length>0}}catch(t){PutToDebugLogException(2,"common: NeedRegister",t)}return!0}function IsDomainName(e){try{if(isNull(e)||e.length<1)return!1;var o=e.indexOf("://");if(o>=0&&(e=e.substring(o+3)),o=e.indexOf("/"),o>=0&&(e=e.substring(0,o)),e=Trim(e),isNull(e)||e.length<1)return!1;if("localhost"===(e=e.toLowerCase()))return!0;var n=e.lastIndexOf(".");return!(n<2)&&(e=e.substr(n+1),!(e.length<2||e.length>3)&&("com"===e||"net"===e||"org"===e||"gov"===e||"ro"===e||"hu"===e||"ru"===e||"biz"===e||"edu"===e||"mil"===e||"de"===e||"in"===e||"it"===e||"uk"===e))}catch(t){PutToDebugLogException(2,"common: IsDomainName",t)}return!1}function IsIPAddrress(e){try{if(isNull(e)||e.length<1)return!1;var o=e.indexOf("://");if(o>=0&&(e=e.substring(o+3)),o=e.indexOf("/"),o>=0&&(e=e.substring(0,o)),e=Trim(e),isNull(e)||e.length<1)return!1;for(var n=0,t=0;t<e.length;t++)"."==e.charAt(t)&&++n;return 3==n&&(e=ReplaceAll(e,".",""),e=ReplaceAll(e," ",""),e=ReplaceAll(e,":",""),IsNumber(e))}catch(i){PutToDebugLogException(2,"common: IsIPAddrress",i)}return!1}function IsLanIP(e){try{if(isNull(e))return!1;if(e=e.toString(),e.length<5)return!1;if("mnt.mizu-voip.com"===e||"rtc.mizu-voip.com"===e||"usrtc3.webvoipphone.com"===e||"usrtcx.webvoipphone.com"===e||"usrtc.webvoipphone.com"===e||"www.webvoipphone.com"===e||"www.mizu-voip.com"===e||"fcm.webvoipphone.com"===e||"voip.mizu-voip.com"===e||"sip.mizu-voip.com"===e)return!1;if(IsIPAddrress(e)||(isNull(dtisrvcache)||isNull(dtisrvcache[e])||!IsIPAddrress(dtisrvcache[e])?e===GetConfig("knowndomain")&&!isNull(GetConfig("knownip"))&&IsIPAddrress(GetConfig("knownip"))&&(e=GetConfig("knownip")):e=dtisrvcache[e]),e=e.toLowerCase(),0===e.indexOf("ERROR")||0===e.indexOf("192.168.")||0===e.indexOf("10.")||0===e.indexOf("172.")&&(0===e.indexOf("172.16.")||0===e.indexOf("172.17.")||0===e.indexOf("172.18.")||0===e.indexOf("172.19.")||0===e.indexOf("172.20.")||0===e.indexOf("172.21.")||0===e.indexOf("172.22.")||0===e.indexOf("172.23.")||0===e.indexOf("172.24.")||0===e.indexOf("172.25.")||0===e.indexOf("172.26.")||0===e.indexOf("172.27.")||0===e.indexOf("172.28.")||0===e.indexOf("172.29.")||0===e.indexOf("172.30.")||0===e.indexOf("172.31."))||0===e.indexOf("169.254.")||0===e.indexOf("127.")||0===e.indexOf("0.")||"4.3.2.1"===e||"9.8.7.6"===e||0===e.indexOf("192.0.0.")||0===e.indexOf("192.0.2.")||e.indexOf("intranet")>=0||e.indexOf("private")>=0||e.indexOf("inner")>=0||e.indexOf("intern")>=0||e.indexOf(".lan")>=0||e.indexOf("local")>=0||e.indexOf("cannotresolve")>=0||e.indexOf(".")<0)return PutToDebugLog(3,"EVENT, IsLanIP is local IP address: "+e),!0}catch(o){PutToDebugLogException(2,"common: IsLanIP",o)}return!1}function IsLocalUpperServer(){try{var e=GetWsuserUrl(GetSipusername(),GetParameter("password"));if(!isNull(e)&&e.indexOf("upperserver=")>0&&(e=e.substring(e.indexOf("upperserver=")+12),e.indexOf("&")>=0&&(e=e.substring(0,e.indexOf("&"))),!isNull(e)&&e.length>0&&!0===IsIPAddrress(e)&&!0===IsLanIP(e)))return!0}catch(o){PutToDebugLogException(2,"common: IsLocalUpperServer",o)}return!1}function IsLocalServer(e){try{(isNull(ils_srv1)||ils_srv1.length<1)&&(ils_srv1=GetParameter("serveraddress_user")),(isNull(ils_srv2)||ils_srv2.length<1)&&(ils_srv2=GetParameter("serveraddress_orig")),(isNull(ils_srv3)||ils_srv3.length<1)&&(ils_srv3=GetParameter("serveraddress"));var o=GetConfig("serverip");isNull(o)&&(o=""),o=Trim(o);var n=GetConfig("server");isNull(n)&&(n=""),n=Trim(n);var t=GetConfig("knownip");if(isNull(t)&&(t=""),t=Trim(t),o.length>0||n.length>0||t.length>0)return!!(o.length>0&&IsIPAddrress(o)&&IsLanIP(o))||(!!(n.length>0&&IsIPAddrress(n)&&IsLanIP(n))||!!(t.length>0&&IsIPAddrress(t)&&IsLanIP(t)));if(!isNull(alsv)&&alsv.length>0){var i=StrDc(alsv,alsvkey),a=i.split(",");if(!isNull(a)&&a.length>0){var r=!0,l=!1,p=[];p.push("l"),p.push("a"),p.push("n"),p.push("i"),p.push("p");var s=p.join("");p=[],p.push("l"),p.push("o"),p.push("c"),p.push("a"),p.push("l"),p.push("f"),p.push("i"),p.push("l"),p.push("e");var c=p.join("");p=[],p.push("l"),p.push("o"),p.push("c"),p.push("a"),p.push("l");var u=p.join("");p=[],p.push("l"),p.push("o"),p.push("c"),p.push("a"),p.push("l"),p.push("h"),p.push("o"),p.push("s"),p.push("t");for(var g=p.join(""),m=0;m<a.length;m++)isNull(a[m])||Trim(a[m]).length<1||(a[m]=Trim(a[m]),a[m]!==c&&a[m]!==u&&a[m]!==s&&a[m]!==g&&"127.0.0.1"!==a[m]&&IsIPAddrress(a[m])&&(l=!0,IsLanIP(a[m])?!1:r=!1));if(!0===l&&!0===r)return!0}}if(ils_srv1.length>0&&!IsIPAddrress(ils_srv1)&&DomainToIp(ils_srv1,function(e){ils_srv1=e}),ils_srv2.length>0&&!IsIPAddrress(ils_srv1)&&DomainToIp(ils_srv2,function(e){ils_srv2=e}),ils_srv3.length>0&&!IsIPAddrress(ils_srv3)&&DomainToIp(ils_srv3,function(e){ils_srv3=e}),!0===e){var b="",h="",d="",_=GetParameter("serveraddress_user");!isNull(_)&&_.length>0&&(b=DomainToIp(_,function(){}),isNull(b)&&(b=""));var w=GetParameter("serveraddress_orig");!isNull(w)&&w.length>0&&(h=DomainToIp(w,function(){}),isNull(h)&&(h=""));var f=GetParameter("serveraddress");return!isNull(f)&&f.length>0&&(d=DomainToIp(f,function(){}),isNull(d)&&(d="")),
!!(_.length>0&&IsLanIP(_))||(!!(w.length>0&&IsLanIP(w))||(!!(f.length>0&&IsLanIP(f))||(!(!(b.length>0)||!IsLanIP(b)&&!1!==IsIPAddrress(b))||(!(!(h.length>0)||!IsLanIP(h)&&!1!==IsIPAddrress(h))||!(!(d.length>0)||!IsLanIP(d)&&!1!==IsIPAddrress(d))))))}var v=GetWebrtcSrvAddr();if(v.length<2){if(ils_srv1.length>0&&(IsLanIP(ils_srv1)||!1===IsIPAddrress(ils_srv1)))return!0;if(ils_srv2.length>0&&(IsLanIP(ils_srv2)||!1===IsIPAddrress(ils_srv1)))return!0;if(ils_srv3.length>0&&(IsLanIP(ils_srv3)||!1===IsIPAddrress(ils_srv1)))return!0}else{var P=v.indexOf("://");if(P>0&&(v=v.substring(P+3)),P=v.indexOf(":"),P>0&&(v=v.substring(0,P)),P=v.indexOf("/"),P>0&&(v=v.substring(0,P)),P=v.indexOf("?"),P>0&&(v=v.substring(0,P)),!isNull(v)&&v.length>0&&!0===IsLanIP(v))return!0}}catch(E){PutToDebugLogException(2,"common: IsLanIP",E)}return!1}function GetWebdomain(){try{var e=window.location.host,o=window.location.protocol;return isNull(e)&&(e=""),isNull(o)||o.length<1?o="":o+="//",o+e}catch(n){PutToDebugLogException(2,"common: GetWebdomain",n)}return""}function GetBrandName(){try{var e="";return webphone_api.global.usestorage?(e=GetParameter("brandname"),(isNull(e)||e.length<1)&&(e=GetConfig("brandname")),(isNull(e)||e.length<1)&&(e=IsWindowsSoftphone()?"Softphone":"WebPhone")):(e=GetParameter("brandname"),(isNull(e)||e.length<1)&&(e=GetConfig("brandname")),isNull(e)&&(e="")),e}catch(o){PutToDebugLogException(2,"common: GetWebdomain",o)}return"WebPhone"}function CanShowLicKeyInput(){try{if(!IsWindowsSoftphone())return!1;if(!isNull(canshowlickeyinput)&&(!0===canshowlickeyinput||!1===canshowlickeyinput))return canshowlickeyinput;WinAPI("API_CanShowLicKeyUserInput",function(e){canshowlickeyinput=!(isNull(e)||!0!==e&&"true"!=e),SaveParameter("canshowlickeyinput",canshowlickeyinput.toString()),PutToDebugLog(4,"EVENT, common API_CanShow: "+e)})}catch(e){PutToDebugLogException(2,"common: CanShowLicKeyInput",e)}return!1}function BrowserRequiresHttps(e){try{if(UseSecureSrvConnection())return!0;var o=GetBrowser();if(!0===e){var n=window.location.href;if(isNull(n)&&(n=""),n=Trim(n.toLowerCase()),n.length<1&&(n=window.location.protocol,isNull(n)&&(n=""),n=Trim(n.toLowerCase()),n.length<1&&(n=location.href,isNull(n)&&(n=""),n=Trim(n.toLowerCase()))),n.toLowerCase().indexOf("file://")>=0)return!1;if(n.indexOf("localhost")<0&&n.indexOf("127.0.0.1")<0&&("Chrome"===o||"Safari"===o||"Firefox"===o&&GetBrowserVersion()>=68))return!0}else if("Chrome"===o||"Safari"===o||"Firefox"===o&&GetBrowserVersion()>=68)return!0}catch(t){PutToDebugLogException(2,"common: BrowserRequiresHttps",t)}return!1}function IsHttps(){try{if(!isNull(is_https))return is_https;if(!0===PreferWss())return is_https=null,!0;is_https=!1;var e=window.location.protocol;return isNull(e)&&(e=""),(e=Trim(e.toLowerCase()),(e.length<4||e.indexOf("http")<0||e.indexOf("extension")<0)&&(e=location.href,isNull(e)&&(e=""),e=Trim(e.toLowerCase())),e.length<4)?is_https=!1:((e.indexOf("https")>=0&&e.indexOf("https")<10||e.indexOf("extension")>=0&&e.indexOf("extension")<12)&&(is_https=!0),is_https)}catch(o){PutToDebugLogException(2,"common: IsHttps",o)}return!1}function UseSecureSrvConnection(){try{if(!0===PreferWss())return!0;var e=window.location.protocol;if(isNull(e)&&(e=""),e=Trim(e.toLowerCase()),(e.length<1||0!=e.indexOf("http"))&&(e=location.href,isNull(e)&&(e=""),e=Trim(e.toLowerCase()),(e.length<1||0!=e.indexOf("http"))&&(e=window.location.href,isNull(e)&&(e=""),e=Trim(e.toLowerCase()))),0==e.indexOf("https:"))return!0;var o=GetWsAddressCfg();if(isNull(o)&&(o=""),0==o.indexOf("*")&&(o=o.substring(1)),0==o.indexOf("wss:"))return!0;if(0==o.indexOf("ws:"))return!1;if(o=GetConfig("wsuser"),isNull(o)&&(o=""),0==o.indexOf("*")&&(o=o.substring(1)),0==o.indexOf("https:"))return!0;if(0==o.indexOf("http:"))return!1}catch(n){PutToDebugLogException(2,"common: UseSecureSrvConnection",n)}return IsHttps()}function PreferWss(){var e=!1;try{return!0===GetConfig("preferwss")&&(e=!0),isNull(webphone_api.parameters.preferwss)||!0!==webphone_api.parameters.preferwss&&!1!==webphone_api.parameters.preferwss||(e=webphone_api.parameters.preferwss,wsprinted||(wsprinted=!0,PutToDebugLog(3,"EVENT, PreferWss() set manually in webphone_api."))),e}catch(o){PutToDebugLogException(2,"common: PreferWss",o)}return!1}function MediaStreamPermissionDenied(){var e=GetBrandName();try{e+=" "+webphone_api.stringres.get("allowmedia_general"),1==IsSDK()?AlertDialogSDK(webphone_api.stringres.get("allowmedia_title"),e):AlertDialog(webphone_api.stringres.get("allowmedia_title"),e)}catch(o){PutToDebugLogException(2,"common: MediaStreamPermissionDenied",o)}}function GetTransferDirectoryName(e){try{var o=GetSipusername(),n=GetParameter("password"),t=GetParameter("serveraddress_user");isNull(o)&&(o=""),isNull(n)&&(n=""),isNull(t)&&(t=""),isNull(e)&&(e="");return Md5Hash(o+n+t+e+"539249178376")}catch(i){PutToDebugLogException(2,"common: GetTransferDirectoryName",i)}return""}function FileTransfer(e){try{isNull(e)&&(e=""),e=Trim(e),webphone_api.global.intentfiletransfer[0]="destination="+e,!1===IsSDK()&&webphone_api.$.mobile.changePage("#page_filetransfer",{transition:"slide",role:"page"})}catch(o){PutToDebugLogException(2,"common: FileTransfer",o)}}function GetLastUsedEngine(){var e="";try{var o=GetParameter("enginechecksum"),n=GetNewConfig(),t=Md5Hash(n);if(o!==t){if(o.length>0)return PutToDebugLog(2,"Reset lastusedengine because config changed: "+n),PutToDebugLog(2,"old checksum: "+o+"; new checksum: "+t),SaveParameter("enginechecksum",t),SaveParameter("lastusedengine",""),SaveParameter("engineoldavailable_werbrtc",""),SaveParameter("engineoldavailable_ns",""),SaveParameter("engineoldavailable_java",""),SaveParameter("engineoldavailable_p2p",""),SaveParameter("engineoldavailable_app",""),SaveParameter("engineoldavailable_flash",""),SaveParameter("engineoldavailable_nativedial",""),"";SaveParameter("enginechecksum",t)}return e=GetParameter("lastusedengine"),(isNull(e)||e.length<1)&&(e=webphone_api.global.last_used_engine_cache),isNull(e)&&(e=""),e}catch(i){PutToDebugLogException(2,"common: GetLastUsedEngine",i)}return""}function IsConfigChanged(){try{if(GetParameter("enginechecksum")!==Md5Hash(GetNewConfig()))return!0}catch(e){PutToDebugLogException(2,"common: IsConfigChanged",e)}return!1}function GetNewConfig(){try{var e=location.href;isNull(e)&&(e=""),e=decodeURIComponent(e),e=e.toLowerCase();var o;o=e.indexOf("?"),o>=0&&(e=e.substring(0,o)),o=e.indexOf("#"),o>=0&&(e=e.substring(0,o)),e=Trim(e);var n=GetParameter("serveraddress_user");(isNull(n)||n.length<2)&&(n=GetParameter("serveraddress")),isNull(n)&&(n=""),n=n.toLowerCase();var t=GetWebrtcSrvAddr();isNull(t)&&(t=""),t=t.toLowerCase();var i=GetProxyaddress(),a=GetParameter("transport"),r=GetParameterInt("enginepriority_java",2),l=GetParameterInt("enginepriority_webrtc",2),p=GetParameterInt("enginepriority_ns",2),s=GetParameterInt("enginepriority_flash",2),c=GetParameterInt("enginepriority_app",2),u=GetParameterInt("enginepriority_p2p",2),g=GetParameterInt("enginepriority_accessnum",2),m=GetParameterInt("enginepriority_nativedial",2),b=GetParameter("realm");isNull(b)&&(b="");var h=GetParameter("webphonebasedir");isNull(h)&&(h="");return e+":"+n+":"+t+":"+r+":"+l+":"+p+":"+s+":"+c+":"+u+":"+g+":"+m+":"+b+":"+h+":"+i+":"+a}catch(d){PutToDebugLogException(2,"common: GetNewConfig",d)}return""}function SaveLastUsedEngine(){try{var e="";getuseengine()===webphone_api.global.ENGINE_JAVA?e="java":getuseengine()===webphone_api.global.ENGINE_WEBRTC?e="webrtc":getuseengine()===webphone_api.global.ENGINE_SERVICE?e="ns":getuseengine()===webphone_api.global.ENGINE_FLASH&&(e="flash"),"Windows"===GetOs()&&"flash"===e||(SaveParameter("lastusedengine",e),!isNull(e)&&e.length>0&&(webphone_api.global.last_used_engine_cache=e),PutToDebugLog(2,"EVENT, lastusedengine saved: "+e))}catch(o){PutToDebugLogException(2,"common: SaveLastUsedEngine",o)}}function IsLocalFileSystem(){try{var e=location.protocol;if(isNull(e)&&(e=location.href,e=decodeURIComponent(e),isNull(e)||e.length<2))return!1;if(e=e.toLowerCase(),e=Trim(e),e.indexOf("file:")>=0)return!0}catch(o){PutToDebugLogException(2,"common: IsLocalFileSystem",o)}return!1}function IsLocalFileSys(){try{var e=location.protocol;if(isNull(e)&&(e=location.href,e=decodeURIComponent(e),isNull(e)||e.length<2))return!1;var o=[];o.push("f"),o.push("i"),o.push("l"),o.push("e"),o.push(":");var n=o.join("");if(e=e.toLowerCase(),e=Trim(e),e.indexOf(n)>=0)return!0}catch(t){PutToDebugLogException(2,"common: ilfs",t)}return!1}function CallScriptingUrl(e,o,n,t,i,a,r,l,p,s){try{if(isNull(e)||Trim(e).length<4)return;isNull(o)&&(o=""),isNull(n)&&(n=""),isNull(t)&&(t=""),isNull(a)&&(a=""),isNull(l)&&(l=""),isNull(p)&&(p=""),isNull(i)&&(i="");var c=GetSipusername(),u=GetParameter("password"),g=GetParameter("serveraddress"),m=RandomInt(1e4,9999999).toString(),b=Md5Hash(c+":"+u),h=Md5Hash(c+":"+u+":"+m);(isNull(r)||r.length<1)&&(r="scripting_cb"),e.indexOf("USERNAME")>0?e=e.replace("USERNAME",c):(e.indexOf("?")<0?e+="?":e+="&",e=e+"username="+c),e=e.replace("PASSWORD",u),e=e.replace("CALLEDNUMBER",t),e.indexOf("PEERNUM")>0?e=e.replace("PEERNUM",t):(e.indexOf("?")<0?e+="?":e+="&",e=e+"peernumber="+t),e.indexOf("PEERDETAILS")>0?e=e.replace("PEERDETAILS",i):(e.indexOf("?")<0?e+="?":e+="&",e=e+"peerdetails="+i),e.indexOf("SERVERADDRESS")>0?e=e.replace("SERVERADDRESS",g):(e.indexOf("?")<0?e+="?":e+="&",e=e+"server="+g),e=e.replace("DIRECTION",n),e=e.replace("STATUS",o),e=e.replace("TEXT",a),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("CONNECTTIME",l),e=e.replace("DURATION",p),e=e.replace("MD5SIMPLE",b),e=e.replace("MD5NORMAL",h),e=e.replace("MD5SALT",m),!isNull(s)&&s.length>0&&(e=e+"&cdr="+encodeURIComponent(s)),PutToDebugLogSpecial(3,"EVENT,CallScriptingUrl: "+e,!1,""),UriParser(e,"","","","",r)}catch(d){PutToDebugLogException(2,"common: CallScriptingUrl",d)}}function ShowOfferSaveContact(){try{if(webphone_api.global.lastcallduration<1)return;if(IsCExt()>0)return;if(webphone_api.global.lastcallduration=0,webphone_api.$(".ui-page-active .ui-popup-active").length>0)return;!1===webphone_api.global.contactExists&&!isNull(webphone_api.global.contactExistsNr)&&webphone_api.global.contactExistsNr.length>0&&"1"===GetParameter("savetocontacts")&&(OfferSaveContact(webphone_api.global.contactExistsNr,webphone_api.global.callName),webphone_api.global.contactExists=!0,webphone_api.global.contactExistsNr="")}catch(e){PutToDebugLogException(2,"common: ShowOfferSaveContact",e)}}function OfferSaveContact(e,o,n){try{if(!0===IsSDK())return;var t=GetDeviceWidth();if(t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120),!isNull(webphone_api.global.lastconfroom)&&webphone_api.global.lastconfroom.length>2){var i=" "+e;if(webphone_api.global.lastconfroom.indexOf(i)>0)return}o=isNull(o)||o===e?"":"<br />"+o;var a="";a='<li id="#offer_item_save"><a data-rel="back" style="text-align: center;">'+webphone_api.stringres.get("btn_save_to_contacts_1")+"</a></li>"+('<li id="#offer_item_cancel"><a data-rel="back" style="text-align: center;">'+webphone_api.stringres.get("btn_cancel")+"</a></li>")+('<li id="#offer_item_dontask"><a data-rel="back">'+webphone_api.stringres.get("btn_save_to_contacts_dontask")+"</a></li>");var r='<div id="savetocontacts" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("save_to_contacts_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><div style="text-align: center; margin-top: .5em; margin-bottom: .5em;">'+webphone_api.stringres.get("save_to_contacts_msg")+"<br />"+e+o+'</div><ul id="savetocontacts_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+a+"</ul></div></div>";savectpopup_wasclosed=!1,n=n||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),savectpopup_wasclosed=!0}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){savectpopup_wasclosed=!0,webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#savetocontacts_ul").off("click","li"),n()}}),webphone_api.$("#savetocontacts_ul").on("click","li",function(n){var t=webphone_api.$(this).attr("id");webphone_api.$("#savetocontacts").on("popupafterclose",function(n){savectpopup_wasclosed=!0,"#offer_item_save"===t&&(webphone_api.global.intentaddeditct[0]="action=add",webphone_api.global.intentaddeditct[1]="numbertoadd="+e,webphone_api.global.intentaddeditct[2]="nametoadd="+o,webphone_api.$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})),"#offer_item_cancel"===t||"#offer_item_dontask"===t&&SaveParameter("savetocontacts","0")})}),setTimeout(function(){!1===savectpopup_wasclosed&&webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),savectpopup_wasclosed=!0,webphone_api.global.contactExists=!0,webphone_api.global.contactExistsNr=""},15e3)}catch(l){PutToDebugLogException(2,"common: OfferSaveContact",l)}}function ContactIsFavorite(e){try{if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1||isNull(e)||e.length<1||!IsNumber(e))return!1;var o=webphone_api.global.ctlist[e];if(isNull(o))return!1;var n=o[CT_FAV];if(!isNull(n)&&"1"===n)return!0}catch(t){PutToDebugLogException(2,"common: ContactIsFavorite",t)}return!1}function ContactSetFavorite(e,o){try{if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1||isNull(e)||e.length<1)return;var n="0";isNull(o)||!0!==o||(n="1");var t=webphone_api.global.ctlist[e];if(isNull(t))return;t[CT_FAV]=n,webphone_api.global.ctlist[e]=t,webphone_api.global.wasCtModified=!0}catch(i){PutToDebugLogException(2,"common: ContactSetFavorite",i)}}function AudioDevicePopupSDK(e,o,n,t){try{if(!isNull(audiomodal))return void audiomodal.show();var i=GetParameter("volumein"),a=GetParameter("volumeout");!isNull(i)&&IsNumber(i)||(i="50"),!isNull(a)&&IsNumber(a)||(a="50");var r="";getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(r='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_ring_label" style="display: inline-block; margin-top: 1.3em;">'+webphone_api.stringres.get("audio_ring")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0; width: 100%;">'+n+"</select></div>");var l="";!isNull(t)&&t.length>0&&(l='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="video_rec_label" style="display: inline-block; margin-top: 1.3em;">'+webphone_api.stringres.get("video_rec")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0; width: 100%;">'+t+"</select></div>");var p="";!isNull(o)&&o.length>0&&(p='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_rec_label" style="display: inline-block; margin-top: 2.3em;">'+webphone_api.stringres.get("audio_rec")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_play" id="audioselect_play" style="margin: 0; width: 100%;">'+o+'</select><span id="audio_volumeout_value" style="background: #ccc; padding: .5em;">'+a+'</span><input name="audio_volumeout" id="audio_volumeout" min="0" max="100" value="'+a+'" type="range" style="margin-top: 1em; width: 80%;"></div>');var s='<span id="audio_volumein_value" style="background: #ccc; padding: .5em;">'+i+'</span><input name="audio_volumein" id="audio_volumein" min="0" max="100" value="'+i+'" type="range" style="margin-top: 1em; width: 80%;">';getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(s=""),audiomodal=webphone_api.picoModal({content:'<div id="audiodevice_modal" class="pmodal_container"><div id="audiodevice_modal_header" class="pmodal_header">'+webphone_api.stringres.get("audio_title")+'</div><div id="audiodevice_modal_content" class="pmodal_content" style="padding: 1em;"><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_mic_label" style="display: inline-block; margin-top: 2.3em;">'+webphone_api.stringres.get("audio_mic")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0; width: 100%;">'+e+"</select>"+s+"</div>"+p+r+l+'</div><div id="audiodevice_modal_footer" class="pmodal_footer" style="float: left; width: 100%; margin-top: 1em;"><button id="btn_audiodevice_positive">'+webphone_api.stringres.get("btn_ok")+'</button><button id="btn_audiodevice_negative">'+webphone_api.stringres.get("btn_cancel")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{width:"20em"},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),audiomodal=null,webphone_api.webrtcapi.HideVideoPriview()}),audiomodal.show(),webphone_api.$("#audio_volumein").on("change",function(){webphone_api.$("#audio_volumein_value").html(webphone_api.$(this).val())}),webphone_api.$("#audio_volumeout").on("change",function(){webphone_api.$("#audio_volumeout_value").html(webphone_api.$(this).val())}),webphone_api.$("#videoselect_rec").on("change",function(){var e=webphone_api.$("#videoselect_rec").val();webphone_api.webrtcapi.MyCameraPreview(e)}),webphone_api.$("#btn_audiodevice_positive").on("click",function(){try{PutToDebugLog(5,"EVENT, common AudioDevicePopupSDK OK click");var e=webphone_api.$("#audioselect_rec").val(),o=webphone_api.$("#audioselect_play").val(),n=webphone_api.$("#audioselect_ring").val(),t="";isNull(document.getElementById("videoselect_rec"))||(t=webphone_api.$("#videoselect_rec").val()),!isNull(arecL)&&arecL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 0"),webphone_api.setdevice(0,e,2)),!isNull(aplayL)&&aplayL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 1"),webphone_api.setdevice(1,o,2)),!isNull(n)&&!isNull(aringL)&&aringL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 2"),webphone_api.setdevice(2,n,2)),!isNull(t)&&t.length>0&&!isNull(vrecL)&&vrecL.length>0&&vrecL[0]!==t&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 3"),webphone_api.setdevice(3,t,2)),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 0"),webphone_api.getdevice(0,function(e){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 1"),webphone_api.getdevice(1,function(e){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 3"),webphone_api.getdevice(3,function(e){})},300);var i=webphone_api.$("#audio_volumein").val(),a=webphone_api.$("#audio_volumeout").val();!isNull(i)&&i.length>0&&IsNumber(i)&&(SaveParameter("volumein",i),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopupSDK 0"),webphone_api.setvolume(0,i)),!isNull(a)&&a.length>0&&IsNumber(a)&&(SaveParameter("volumeout",a),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopupSDK 1"),webphone_api.setvolume(1,a)),audiomodal.close()}catch(r){PutToDebugLogException(2,"common: AudioDevicePopupSDK OK click",r)}}),webphone_api.$("#btn_audiodevice_negative").on("click",function(){audiomodal.close()})}catch(c){PutToDebugLogException(2,"common: AudioDevicePopupSDK",c)}}function AudioDevicePopup(e){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120),arecL=GetAudioRecList().split("\r\n"),aplayL=GetAudioPlayList().split("\r\n"),aringL=GetAudioRingList().split("\r\n"),getuseengine()===webphone_api.global.ENGINE_WEBRTC&&!isNull(GetVideoRecList())&&GetVideoRecList().length>0&&(vrecL=GetVideoRecList().split("\r\n"));var n='<option value="[VALUE]">[TEXT]</option>',t="",i="",a="",r="";if(!isNull(arecL))for(var l=0;l<arecL.length;l++)if(!(isNull(arecL[l])||arecL[l].length<1)){var p=!1,s=GetAudioRecDev();!isNull(s)&&s.length>0&&(s.indexOf(arecL[l])>=0||arecL[l].indexOf(s)>=0)&&(p=!0,t=n+t),!1===p&&(t+=n),t=t.replace("[VALUE]",arecL[l]),t=t.replace("[TEXT]",arecL[l])}if(!isNull(aplayL))for(var l=0;l<aplayL.length;l++)if(!(isNull(aplayL[l])||aplayL[l].length<1)){var p=!1,c=GetAudioPlayDev();!isNull(c)&&c.length>0&&(c.indexOf(aplayL[l])>=0||aplayL[l].indexOf(c)>=0)&&(p=!0,i=n+i),!1===p&&(i+=n),i=i.replace("[VALUE]",aplayL[l]),i=i.replace("[TEXT]",aplayL[l])}if(!isNull(aringL))for(var l=0;l<aringL.length;l++)if(!(isNull(aringL[l])||aringL[l].length<1)){var p=!1,u=GetAudioRingDev();!isNull(u)&&u.length>0&&(u.indexOf(aringL[l])>=0||aringL[l].indexOf(u)>=0)&&(p=!0,a=n+a),!1===p&&(a+=n),a=a.replace("[VALUE]",aringL[l]),a=a.replace("[TEXT]",aringL[l])}if(!isNull(vrecL))for(var l=0;l<vrecL.length;l++)if(!(isNull(vrecL[l])||vrecL[l].length<1)){var p=!1;!isNull(webphone_api.global.video_rec_curr_device)&&webphone_api.global.video_rec_curr_device.length>0&&(webphone_api.global.video_rec_curr_device.indexOf(vrecL[l])>=0||vrecL[l].indexOf(webphone_api.global.video_rec_curr_device)>=0)&&(p=!0,r=n+r),!1===p&&(r+=n),r=r.replace("[VALUE]",vrecL[l]),r=r.replace("[TEXT]",vrecL[l])}if(!0===IsSDK())return void AudioDevicePopupSDK(t,i,a,r);var g=GetParameter("volumein"),m=GetParameter("volumeout");!isNull(g)&&IsNumber(g)||(g="50"),!isNull(m)&&IsNumber(m)||(m="50");var b="";getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(b='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_ring_label">'+webphone_api.stringres.get("audio_ring")+':</label></div><div class="audio_right_container"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0;">'+a+"</select></div>");var h="";!isNull(r)&&r.length>0&&(h='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="video_rec_label">'+webphone_api.stringres.get("video_rec")+':</label></div><div class="audio_right_container"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0;">'+r+"</select></div>");var d="";!isNull(i)&&i.length>0&&(d='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_rec_label">'+webphone_api.stringres.get("audio_rec")+':</label></div><div class="audio_right_container"><select name="audioselect_play" id="audioselect_play" style="margin: 0;">'+i+'</select><input name="audio_volumeout" id="audio_volumeout" data-highlight="true" data-mini="true" min="0" max="100" value="'+m+'" type="range"></div>');var _='<input name="audio_volumein" id="audio_volumein" data-highlight="true" data-mini="true" min="0" max="100" value="'+g+'" type="range">';getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(_="");var w='<div id="audiodevice_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="width:'+o+"px; max-width:"+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("audio_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0; width: 100%;"><div class="audio_left_container"><label id="audio_mic_label">'+webphone_api.stringres.get("audio_mic")+':</label></div><div class="audio_right_container"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0;">'+t+"</select>"+_+"</div>"+d+b+h+'</div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";savectpopup_wasclosed=!1,e=e||function(){},webphone_api.$.mobile.activePage.append(w).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#videoselect_rec").off("change"),webphone_api.webrtcapi.HideVideoPriview(),e()}}),webphone_api.$("#videoselect_rec").on("change",function(){var e=webphone_api.$("#videoselect_rec").val();webphone_api.webrtcapi.MyCameraPreview(e)}),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common AudioDevicePopup close on click");var o=(webphone_api.$(this).attr("id"),webphone_api.$("#audioselect_rec").val()),n=webphone_api.$("#audioselect_play").val(),t=webphone_api.$("#audioselect_ring").val(),i="";isNull(document.getElementById("videoselect_rec"))||(i=webphone_api.$("#videoselect_rec").val()),!isNull(arecL)&&arecL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 0"),webphone_api.setdevice(0,o,2)),!isNull(aplayL)&&aplayL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 1"),webphone_api.setdevice(1,n,2)),!isNull(t)&&!isNull(aringL)&&aringL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 2"),webphone_api.setdevice(2,t,2)),!isNull(i)&&i.length>0&&!isNull(vrecL)&&vrecL.length>0&&vrecL[0]!==i&&webphone_api.setdevice(3,i,2),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 0"),webphone_api.getdevice(0,function(e){})},200),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 1"),webphone_api.getdevice(1,function(e){})},300),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 2"),webphone_api.getdevice(2,function(e){})},400),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 3"),webphone_api.getdevice(3,function(e){})},500);var a=webphone_api.$("#audio_volumein").val(),r=webphone_api.$("#audio_volumeout").val();!isNull(a)&&a.length>0&&IsNumber(a)&&(SaveParameter("volumein",a),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopup 0"),webphone_api.setvolume(0,a)),!isNull(r)&&r.length>0&&IsNumber(r)&&(SaveParameter("volumeout",r),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopup 1"),webphone_api.setvolume(1,r))})}catch(f){PutToDebugLogException(2,"common: AudioDevicePopup",f)}}function IsContactBlocked(e,o){try{if((isNull(e)||e.length<1)&&(isNull(o)||o.length<1))return!1;var n=GetParameter2("blocked_contacts");if(isNull(n)||n.length<1)return!1;n=Trim(n);var t=n.split(",");if(isNull(t)||t.length<1)return!1;if(!isNull(e)&&Trim(e).length>0)for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<1)&&t[i]===e)return!0;if(!isNull(o)&&o.length>0)for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<1))for(var a=0;a<o.length;a++)if(!(isNull(o[a])||[a].length<1)&&t[i]===o[a])return!0}catch(r){PutToDebugLogException(2,"common: IsContactBlocked",r)}return!1}function IsNumberBlacklisted(e,o){try{if((isNull(e)||e.length<1)&&(isNull(o)||o.length<1))return!1;var n=GetParameter2("blacklist");if(isNull(n)||n.length<1)return!1;n=Trim(n);var t=n.split(",");if(isNull(t)||t.length<1)return!1;if(!isNull(e)&&Trim(e).length>0)for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<1)&&t[i]===e)return!0;if(!isNull(o)&&o.length>0)for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<1))for(var a=0;a<o.length;a++)if(!(isNull(o[a])||[a].length<1)&&t[i]===o[a])return!0}catch(r){PutToDebugLogException(2,"common: IsNumberBlacklisted",r)}return!1}function BlockContact(e,o){try{if((isNull(e)||e.length<1)&&(isNull(o)||o.length<1))return;var n=GetParameter2("blocked_contacts");if(isNull(n)&&(n=""),n=Trim(n),isNull(e)&&Trim(e).length>0||(n.length>0&&(n+=","),n+=Trim(e)),!(isNull(o)&&o.length>0))for(var t=0;t<o.length;t++)isNull(o[t])||Trim(o[t]).length<1||(n.length>0&&(n+=","),n+=Trim(o[t]));SaveParameter("blocked_contacts",n)}catch(i){PutToDebugLogException(2,"common: BlockContact",i)}}function UnBlockContact(e,o){try{if((isNull(e)||e.length<1)&&(isNull(o)||o.length<1))return;var n=GetParameter2("blocked_contacts");if(isNull(n)||n.length<1)return;n=Trim(n);var t=n.split(",");if(isNull(t)||t.length<1)return;if(!isNull(e)&&Trim(e).length>0){e=Trim(e);for(var i=0;i<t.length;i++)isNull(t[i])||t[i].length<1||t[i]===e&&(t[i]="")}if(!isNull(o)&&o.length>0)for(var i=0;i<t.length;i++)if(!(isNull(t[i])||t[i].length<1))for(var a=0;a<o.length;a++)isNull(o[a])||[a].length<1||t[i]===o[a]&&(t[i]="");n="";for(var i=0;i<t.length;i++)isNull(t[i])||t[i].length<1||(n.length>0&&(n+=","),n+=t[i]);SaveParameter("blocked_contacts",n)}catch(r){PutToDebugLogException(2,"common: UnBlockContact",r)}}function GetTlsProxyUrl(e){try{if(isNull(e)||e.length<1)return"";var o=RandomInt(1e5,999999999);return"https://rtc.mizu-voip.com:4443/?hsforward="+StrEc(e,"s7n1k8fnz7ejian4k",!1)+"&nocache="+o.toString()}catch(n){PutToDebugLogException(2,"common: GetTlsProxyUrl",n)}return""}function SetLogFormAction(){try{if(!0===IsSDK())return;var e=document.getElementById("xlogpush");if(isNull(e))return void PutToDebugLog(2,"ERROR, log form not found in HTML");var o=GetParameter("logform_action");(isNull(o)||o.length<3)&&(o="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush"),o=o.toLowerCase(),o=Trim(o),0!==o.indexOf("http")&&(o="http://"+o);var n="";n=!0===IsHttps()?GetTlsProxyUrl(o):o,e.action=n,PutToDebugLog(2,"EVENT, SetLogFormAction: "+n.replace("mnt.mizu-voip","xxx"))}catch(t){PutToDebugLogException(2,"common: SetLogFormAction",t)}}function SentWebrtcSignaling(e){if(!(isNull(e)||e.length<1)&&0!==e.indexOf("INVITE sip")&&(e.indexOf("REGISTER sip:")>=0||e.indexOf("REGISTER sips:")>=0)){webphone_api.global.webrtclastregsent=GetTickCount(),isNull(wrereg_timer)||clearTimeout(wrereg_timer),wrereg_timer=null;var o=GetParameterInt("regtimeout",6e3);0!=o&&o<100&&(o=6e3),0!=o&&GetTickCount()-webphone_api.global.webrtcregtimer_exec>o+2e3&&(wrereg_timer=setTimeout(function(){webphone_api.global.webrtcregtimer_exec=GetTickCount(),PutToDebugLog(2,"WARNING, Webrtc resend REGISTER because no answer received for previous register"),webphone_api.webrtcapi.ResendRegister()},o))}}function GetRecentInviteIn(){return lastinvite_in}function GetWebrtcDisplayName(){
return!isNull(webphone_api.global.sipunicoderewritefrom)&&webphone_api.global.sipunicoderewritefrom.length>0&&!isNull(webphone_api.global.sipunicoderewriteto)&&webphone_api.global.sipunicoderewriteto.length>0&&webphone_api.global.sipunicoderewriteto===displayname?webphone_api.global.sipunicoderewritefrom:displayname}function CatchWebrtcSignaling(e,o){try{if(isNull(e)||e.length<1||isNull(o))return;getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),webphone_api.iswebrtcengineworking=1,webphone_api.global.webrtcsipsignalingreceived=1,e=e.toString(),webphone_api.global.failover_gateway=!1;try{var n="",t=Trim(e),i=t.indexOf("\r\n");i>0&&(n=t.substring(0,i)),isNull(n)&&(n=""),n=n.toLowerCase()}catch(P){PutToDebugLogException(2,"common: CatchWebrtcSignaling inner 1",P)}if(GetParameterInt("forcereregister",1)>0){var a=GetSipHeaderFromMsg(e,"CSeq");if(!isNull(a)&&a.indexOf("REGISTER")>0){var r=e.indexOf("\r\n");if(r>0){var l=e.substring(0,i);if(!isNull(l)&&(l=Trim(l),(r=l.indexOf(" "))>0&&(l=Trim(l.substring(r)),!isNull(l)&&(r=l.indexOf(" "),r>0&&(l=l.substring(0,r)),!isNull(l)&&IsNumber(l))))){var p=StrToInt(l);p>=200?(isNull(wrereg_timer)||clearTimeout(wrereg_timer),wrereg_timer=null):200===p&&1===GetParameterInt("forcereregister",1)&&webphone_api.webrtcapi.StartReRegister(!0)}}}}if(!isNull(n)&&n.indexOf("message")>=0)try{var s=GetSipHeaderFromMsg(e,"X-Sms");if((isNull(s)||s.length<1)&&(s=GetSipHeaderFromMsg(e,"P-Sms")),!isNull(s)&&s.length>0&&s.toLowerCase().indexOf("yes")>=0&&e.indexOf("\r\n\r\n")>0){var c=e.substring(e.indexOf("\r\n\r\n")+4);if(isNull(c)&&(c=""),c=Trim(c),c.length>0){var u=GetSipHeaderFromMsg(e,"From");if(!isNull(u)&&u.length>0&&u.indexOf("<")>=0&&(u=u.substring(u.indexOf("<")+1),u.indexOf("@")>0)){u=u.substring(0,u.indexOf("@")),u=u.replace("sips:",""),u=u.replace("sip:","");try{webphone_api.onSmsCb(u,c)}catch(P){webphone_api.common.PutToDebugLogException(2,"There is an error in onSms() callback",P)}}}}}catch(P){PutToDebugLogException(2,"common: CatchWebrtcSignaling handle SMS",P)}if(!isNull(n)&&n.indexOf("invite")>=0){var g="";if(e.indexOf("recv=")>=0){var m=e.toLowerCase();(m.indexOf("p-auto-answer:normal")>0||m.indexOf("p-auto-answer: normal")>0||m.indexOf("answer-mode: auto")>0||m.indexOf("answer-mode:auto")>0||webphone_api.global.autoacceptsipheader.length>0&&m.indexOf(webphone_api.global.autoacceptsipheader)>0)&&setTimeout(function(){webphone_api.common.PutToDebugLog(3,"EVENT, autoaccept INVITE sip header: WebRTC accept"),webphone_api.webrtcapi.SipAccept(webphone_api.global.aline,!1)},800);var u=GetSipHeaderFromMsg(e,"From");!isNull(u)&&u.length>0&&u.indexOf("<")>=0&&(u=u.substring(u.indexOf("<")+1),u.indexOf("@")>0&&(u=u.substring(0,u.indexOf("@")),u=u.replace("sips:",""),u=u.replace("sip:",""),g=Trim(u)))}else{var u=GetSipHeaderFromMsg(e,"To");!isNull(u)&&u.length>0&&u.indexOf("<")>=0&&(u=u.substring(u.indexOf("<")+1),u.indexOf("@")>0&&(u=u.substring(0,u.indexOf("@")),u=u.replace("sips:",""),u=u.replace("sip:",""),g=Trim(u)))}if(!isNull(g)&&g.length>0)for(var b=0;b<webphone_api.global.ep.length;b++){var h=webphone_api.global.ep[b][EP_DESTNR];if(!isNull(h)&&h.length>0&&h.toLowerCase()===g.toLowerCase()){webphone_api.global.ep[b][EP_SIPINVITE]=e,webphone_api.global.ep[b][EP_CALLID]=GetSipHeaderFromMsg(e,"Call-ID");break}}}if(!0===webphone_api.global.redialof&&!isNull(e)&&e.length>0)try{var d=GetSipHeaderFromMsg(e,"CSeq");isNull(d)&&(d=""),d=d.toLowerCase(),d.indexOf("invite")>=0&&(n.indexOf("100 trying")>0||n.indexOf("603 decline")>0||n.indexOf("486 busy here")>0)&&(webphone_api.global.redialof=!1)}catch(P){PutToDebugLogException(2,"common: CatchWebrtcSignaling inner 2",P)}n.indexOf("503 ")>0&&(PutToDebugLog(2,"WARNING,Restating webrtc sipstack because 503 received: "+n),webphone_api.flagrestartwebrtc=!0,webphone_api.webrtcapi.ReStart(5e3,!1));var _=!1;switch(o){case SIP_REGISTER:e.length>10&&(lastreg=e,lastmsg=e);break;case SIP_INVITE_IN:e.length>10&&(lastinvite_in=e,lastmsg=e);break;case SIP_INVITE_OUT:e.length>10&&(lastinvite_out=e,lastmsg=e);break;case SIP_UNKNOWN:_=!0;break;default:_=!0}if(lastmsg=e,e.indexOf("X-UT: g")>=0?ismizuserverdetected=2==ismizuserverdetected?3:1:e.indexOf("X-UT: s")>=0?ismizuserverdetected=1==ismizuserverdetected?3:2:ismizuserverdetected<0&&(ismizuserverdetected=0),!0===_){var w=e.toLowerCase();if(w.indexOf("invite sip")>=0&&w.indexOf("invite sip")<10&&(lastinvite_in=e,e.indexOf("recv=")>=0)){var u=GetSipHeaderFromMsg(e,"From");!isNull(u)&&u.length>0&&u.indexOf("<")>0&&(u=u.substring(0,u.indexOf("<")),isNull(u)&&(u=""),u=ReplaceAll(u,'"',""),displayname=Trim(u))}}var f=GetSipHeaderFromMsg(e,"X-IMStatus");if(!isNull(f)&&f.length>0){var u=GetSipHeaderFromMsg(e,"From");isNull(u)&&(u="");var v=u.indexOf("<sip:");v>=0&&(u=u.substring(v+5),v=u.indexOf("@"),v>=0&&(u=u.substring(0,v)),u=Trim(u)),u!==GetSipusername()&&u!==GetCallerid()&&SaveReceivedPresence2(u,f)}GetWebrtcCreditRating(e),GetWebrtcOptions(e),UpdateShCache(lastmsg)}catch(P){PutToDebugLogException(2,"common: CatchWebrtcSignaling",P)}}function GetSipHeaderFromMsg(e,o){try{if(isNull(e)||e.length<10||isNull(o)||o.length<1)return"";var n="";o=Trim(o),o=o.toLowerCase(),0===o.indexOf("x-r-")&&(o=o.replace("x-r-",""));var t="\r\n";e.indexOf("\r\n")<0&&e.indexOf("\n")>=0&&(t="\n");var i=e.split(t);if(isNull(i))return"";for(var a=0,r=0;r<i.length;r++)if(!(isNull(i[r])||i[r].indexOf(":")<1)){a=i[r].indexOf(":");var l=Trim(i[r].substring(0,a));if(l=l.toLowerCase(),0===l.indexOf("x-r-")&&(l=l.replace("x-r-","")),l===o){n=Trim(i[r].substring(a+1,i[r].length));break}}return isNull(n)&&(n=""),n}catch(p){PutToDebugLogException(2,"common: GetSipHeaderFromMsg",p)}return""}function RewriteSipHeaderInMsg(e,o,n){try{if(isNull(e)||e.length<10||isNull(o)||o.length<1||isNull(n))return e;var t=e;o.indexOf(":")<0&&(o+=":");var i=t.indexOf(o);if(i<0)return e;var a=t.substring(0,i);t=t.substring(i);var r="\r\n";t.indexOf("\r\n")<0&&t.indexOf("\n")>=0&&(r="\n"),t=t.substring(t.indexOf(r)+r.length);return a+o+" "+n+r+t}catch(l){PutToDebugLogException(2,"common: RewriteSipHeaderInMsg",l)}return e}function ClassSipHeader(){this.line,this.header,this.value}function UpdateShCache(e){try{if(isNull(e)||e.length<10)return;isNull(shcache)&&(shcache=[]);var o=StrToInt(webphone_api.global.aline),n=GetSipHeaderFromMsg(e,"CSeq");if(isNull(n))return;if(n=n.toLowerCase(),n.indexOf("register")>=0)o=0;else{if(!(n.indexOf("invite")>=0))return;var t=GetSipHeaderFromMsg(e,"From");isNull(t)&&(t="");var i=GetSipHeaderFromMsg(e,"To");isNull(i)&&(i="");var a=GetSipHeaderFromMsg(e,"Call-ID");isNull(a)&&(a=""),a=Trim(a),t.indexOf("<")>=0&&(t=t.substring(t.indexOf("<")+1)),t.indexOf(">")>0&&(t=t.substring(0,t.indexOf(">"))),t.indexOf("sip:")>=0&&(t=t.substring(t.indexOf("sip:")+4)),t.indexOf("sips:")>=0&&(t=t.substring(t.indexOf("sips:")+5)),t.indexOf("@")>=0&&(t=t.substring(0,t.indexOf("@"))),t.indexOf(";")>=0&&(t=t.substring(0,t.indexOf(";"))),i.indexOf("<")>=0&&(i=i.substring(i.indexOf("<")+1)),i.indexOf(">")>0&&(i=i.substring(0,i.indexOf(">"))),i.indexOf("sip:")>=0&&(i=i.substring(i.indexOf("sip:")+4)),i.indexOf("sips:")>=0&&(i=i.substring(i.indexOf("sips:")+5)),i.indexOf("@")>=0&&(i=i.substring(0,i.indexOf("@"))),i.indexOf(";")>=0&&(i=i.substring(0,i.indexOf(";")));var r="";r=t===GetSipusername()?i:t;var l=GetEndpoint(-1,r,a,!1,!0);!isNull(l)&&l.length>4&&(o=StrToIntDef(l[EP_LINE],o)),o<1&&(o=1)}for(var p=0;p<shcache.length;p++)if(isNull(shcache[p])&&(shcache.splice(p,1),p--),shcache[p].line===o){var s=shcache[p].header,c=GetSipHeaderFromMsg(e,s);!isNull(c)&&c.length>0&&(shcache[p].value=c)}}catch(u){PutToDebugLogException(2,"common: UpdateShCache",u)}}function RemoveSipHeadreFromCache(e){try{if(isNull(e)||e.length<1)return!1;e=Trim(e),e=e.toLowerCase(),0===e.indexOf("x-r-")&&(e=e.replace("x-r-","")),isNull(shcache)&&(shcache=[]);for(var o=0;o<shcache.length;o++)isNull(shcache[o])&&(shcache.splice(o,1),o--),shcache[o].header===e&&(shcache.splice(o,1),o--)}catch(n){PutToDebugLogException(2,"common: RemoveSipHeadreFromCache",n)}}function RemoveSessionHeadersFromCache(e){try{if(isNull(shcache))return void(shcache=[]);var o=StrToIntDef(e,webphone_api.global.aline);if(o<1)return;for(var n=0;n<shcache.length;n++)isNull(shcache[n])&&(shcache.splice(n,1),n--),shcache[n].line===o&&(shcache.splice(n,1),n--)}catch(t){PutToDebugLogException(2,"common: RemoveSipHeadreFromCache",t)}}function GetSipHeaderInternal(e){return GetSipHeader(e,!0)}function GetSipHeader(e,o){try{if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, GetSipHeader header is NULL"),"ERROR, GetSipHeader header is NULL";e=e.toLowerCase(),e=Trim(e),0===e.indexOf("x-r-")&&(e=e.replace("x-r-","")),isNull(shcache)&&(shcache=[]);for(var n="",t=StrToInt(webphone_api.global.aline),i=0;i<shcache.length&&(isNull(shcache[i])&&(shcache.splice(i,1),i--),shcache[i].header!==e||(n=shcache[i].value,shcache[i].line!==t));i++);if(!isNull(n)&&n.length>0)return n;n=GetSipHeaderFromMsg(lastmsg,e),isNull(n)&&(n="");var a=GetSipHeaderFromMsg(lastmsg,"CSeq");isNull(a)&&(a=""),a=a.toLowerCase();var r=StrToInt(webphone_api.global.aline);if(a.indexOf("invite")<0&&a.indexOf("message")<0&&(r=0),r<0&&(r=1),n.length>0){var l=new ClassSipHeader;l.line=r,l.header=e,l.value=n,shcache.push(l)}return n.length<1?!0===o||"warning"==e||"x-reason"==e||"reason"==e?"":(PutToDebugLog(3,"EVENT, GetSipHeader no header available at this moment: "+e),"WARNING: header not found"):n}catch(p){PutToDebugLogException(2,"common: GetSipHeader",p)}return"ERROR, common: GetSipHeader failed"}function GetSipMessage(e,o,n){try{return lastmsg}catch(t){PutToDebugLogException(2,"common: GetSipMessage",t)}return"ERROR, common: GetSipMessage failed"}function GetWebrtcCreditRating(e){try{if(!1===Glbr())return;if(isNull(e))return;e=e.toString();var o=e.indexOf("Credit:");if(o>0){var n=e.substring(o+7);o=n.indexOf("\r\n"),o>0&&(n=n.substring(0,o)),o=n.indexOf("\n"),o>0&&(n=n.substring(0,o)),!isNull(n)&&n.length>0&&PutToDebugLog(1,"CREDIT,Credit: "+Trim(n))}var o=e.indexOf("Rating:");if(o>0){var t=e.substring(o+7);o=e.indexOf("\r\n"),o>0&&(t=t.substring(0,o)),o=e.indexOf("\n"),o>0&&(t=t.substring(0,o)),!isNull(t)&&t.length>0&&(webphone_api.global.rating=" ("+Trim(t)+")",PutToDebugLog(4,"GetWebrtcCreditRating received rating: "+Trim(t)))}}catch(i){PutToDebugLogException(2,"common: GetWebrtcCreditRating",i)}}function GetWebrtcOptions(e){try{if(isNull(e))return;e=e.toString();var o=e.indexOf("X-RTCOptions:");if(o>0){var n=e.substring(o+13);o=n.indexOf("\r\n"),o>0&&(n=n.substring(0,o)),o=n.indexOf("\n"),o>0&&(n=n.substring(0,o)),!isNull(n)&&n.length>0&&(PutToDebugLog(3,"EVENT,GetWebrtcOptions received: "+n),n.indexOf("nostun")>=0&&(webphone_api.global.nostun=!0),n.indexOf("noturn")>=0&&(webphone_api.global.noturn=!0))}}catch(t){PutToDebugLogException(2,"common: GetWebrtcOptions",t)}}function GetUsemizutlsproxy(){try{var e=GetParameter("usemizutlsproxy"),o=GetConfig("usemizutlsproxy"),n=webphone_api.parameters.usemizutlsproxy;return!isNull(o)&&o.length>0&&IsNumber(o)&&(e=o),!isNull(n)&&n.length>0&&IsNumber(n)&&(e=n),(isNull(e)||1!==e.length)&&(e="1"),e}catch(t){PutToDebugLogException(2,"common: GetUsemizutlsproxy",t)}return"1"}function UseTLSReload(){try{if(!0===IsHttps())return!1;var e=window.location.href;if(!0===IsLanIP(GetDomainFromURL(e))||"localhost"===GetDomainFromURL(e)||e.toLowerCase().indexOf("file:")>=0)return CanLog(4)&&PutToDebugLog(4,"EVENT, TLSReload, page will NOT be reloaded because local webserver"),!1;var o=!1,n=GetParameter2("webrtcserveraddress");if((isNull(n)||n.length<3)&&(n=GetConfig("webrtcserveraddress")),(isNull(n)||n.length<3)&&(n=GetWsAddressCfg()),!isNull(n)&&n.length>3&&n.indexOf("ws:")>=0)return CanLog(4)&&PutToDebugLog(4,"EVENT, TLSReload, page will NOT be reloaded because webrtcserveraddress is not secure"),!1;var t=GetUsemizutlsproxy();"2"===t||"1"===t&&(!0===webphone_api.global.usestorage||Strl(60))?o=!0:PutToDebugLog(2,"EVENT, TLSReload skipped because usemizutlsproxy: "+t);try{decodeURIComponent(window.location.href).toLowerCase()}catch(s){""}if(!0===o&&!0===BrowserRequiresHttps(!0)){SaveParameter("aldm",decodeURIComponent(window.location.href)),PutToDebugLog(2,"EVENT, TLSReload, page will reload over https");var i=GetParameter("serveraddress_user"),a=GetParameter("serveraddress_orig"),r=GetParameter("serveraddress"),l=window.location.hostname;if(l=Trim(l),l=l.toLowerCase(),!1===webphone_api.global.isdebugversion&&(IsLanIP(i)||IsLanIP(a)||IsLanIP(r)||IsLanIP(l)||i.indexOf("localhost")>=0||a.indexOf("localhost")>=0||r.indexOf("localhost")>=0||l.indexOf("localhost")>=0))return PutToDebugLog(4,"EVENT, TLSReload, will NOT reload page, because server is on local network or webphone hosted on localhost"),!1;var p=StrToInt(GetParameter2("enginepriority_webrtc"));if(isNull(p)&&(p=2),p>=2)return PutToDebugLog(3,"EVENT, TLSReload, enginepriority_webrtc: "+p.toString()+"; higher priority, will not ask user, just automatically reload page"),!0;if(p<2)return PutToDebugLog(4,"EVENT, TLSReload, enginepriority_webrtc: "+p.toString()+"; lower priority, will NOT reload page"),!1;GetParameter("usemizutlsproxy_userreload")}}catch(c){PutToDebugLogException(2,"common: UseTLSReload",c)}return!1}function TLSReload(){try{if(!0===tlsrcalled)return;PutToDebugLog(2,"EVENT, TLSReload, reloading page over https"),tlsrcalled=!0;SaveSettingsFile(2,GetActiveAccSettingsFilename(),function(e){e?PutToDebugLog(2,"EVENT, SaveSettingsFile from TLSReload Successfull"):PutToDebugLog(2,"ERROR, SaveSettingsFile from TLSReload Failed");var o=window.location.href;if(!(isNull(o)||o.length<4)){o=decodeURIComponent(o),o.indexOf("#")>0&&(o=o.substring(0,o.indexOf("#"))),PutToDebugLog(2,"EVENT, TLSReload, current location: "+o);var n=GetTlsProxyUrl(o);PutToDebugLog(2,"EVENT, TLSReload, new location: "+n),window.location.href=n}})}catch(e){PutToDebugLogException(2,"common: TLSReload",e)}}function GetDomainFromURL(e){try{if(isNull(e))return"";if(e=decodeURIComponent(e),e.toLowerCase().indexOf("file:")>=0)return e;e=e.toLowerCase();var o=e.indexOf("//");o>=0&&(e=e.substring(o+2)),o=e.indexOf(":"),o>=0&&(e=e.substring(0,o)),o=e.indexOf("/"),o>=0&&(e=e.substring(0,o)),o=e.indexOf("#"),o>=0&&(e=e.substring(0,o)),e=Trim(e)}catch(n){PutToDebugLogException(2,"common: GetDomainFromURL",n)}return e}function CallWsuserKeepAlive(e){try{if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC)return;if(!IsMizuServerOrGateway())return;if(IsLocalServer())return;var o=GetTickCount();if(!0!==e&&o-wsuserka_lasttick<36e3)return;wsuserka_lasttick=o;var n=GetSipusername(),t=GetParameter("password");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, common CallWsuserKeepAlive will NOT send, because invalid username ("+n+")");if(!0!==e&&(isNull(t)||t.length<1))return void PutToDebugLog(2,"EVENT, common CallWsuserKeepAlive will not send wsuser, because we have no password ("+t+")");var i=GetWsuserUrl(n,t);if(i.length<3)return void PutToDebugLog(2,"ERROR, common CallWsuserKeepAlive wsuser not needed");IsMizuServerOrGateway()&&UriParser(i,"","","","","webrtccreateuser")}catch(a){PutToDebugLogException(2,"common: CallWsuserKeepAlive",a)}}function GetVersionStr(){try{if(!isNull(e))return e;var e=webphone_api.versionstr;return(isNull(e)||Trim(e).length<1)&&(e=webphone_api.global.versionstr),e}catch(o){PutToDebugLogException(2,"common: GetVersionStr",o)}return""}function IsSDK(){try{if(isnotsdkcache)return!1;if(1190===GetConfigInt("brandid",-1)&&!isNull(document.getElementById("page_dialpad")))return!1;var e=null;if("undefined"==typeof window.pageissdk||null===window.pageissdk||"false"!=window.pageissdk&&0!=window.pageissdk&&1!=window.pageissdk&&"true"!=window.pageissdk||(e=("undefined"==typeof window.pageissdk||null===window.pageissdk||"false"!==window.pageissdk)&&("undefined"!=typeof window.pageissdk&&null!==window.pageissdk&&"true"===window.pageissdk||window.pageissdk))||(isnotsdkcache=!0),isNull(e)&&webphone_api.parameters&&(e=webphone_api.parameters.issdk),isNull(e)||1==e||"true"==e||e.length<1)return!0}catch(o){PutToDebugLogException(2,"common: IsSDK",o)}return!1}function GetStunServersStr(){var e=0;if(0===GetParameterInt("use_fast_stun",1))return null;if(!0===webphone_api.global.nostun||!0===IsLocalServer(!0))return null;ParseStunTurnNew();var o="",n=!0;try{var t=GetConfig("stunserveraddress");t.length<1&&(n=!1),e=1;var i=t,a="stun:rtc.mizu-voip.com:8090",r=GetSipusername(),l=GetParameter("password"),p=GetWsuserUrl(r,l),s=p;e=2;var c=GetParameter("stunserveraddress");if(null===c||"null"===c||"Null"===c||"NULL"===c)return PutToDebugLog(2,"EVENT, GetStunServersStr2: NULL"),null;if(void 0===c||c.length<1?n=!1:(e=3,i=c,n=!0),i.length>0&&(n=!0),e=4,!1===n)if(e=10,!0===IsMizuServerOrGateway()&&!isNull(p)&&p.length>3){e=11;var u=p,g=u.indexOf("://");if(e=12,g>0&&(u=u.substring(g+3)),g=u.indexOf("/"),g>0&&(u=u.substring(0,g)),e=13,p.indexOf("wss:")>=0||p.indexOf("https:")>=0)if(e=14,(g=u.indexOf(":"))<1)e=15,o="stun:"+u+":8090";else{e=16;var m=u.substring(g+1);u=u.substring(0,g),e=20,o="8090"===m||"443"===m?"stun:"+u+":8090":a}else e=20,g=u.indexOf(":"),o=g<1?"stun:"+u+":80":"stun:"+u,e=21}else o=a;else if("null"==i.toLowerCase())e=22,o=null;else{e=23;var b=i.split(",");if(!isNull(b)&&b.length>0){e=24;for(var h=0;h<b.length;h++)isNull(b[h])||b[h].length<1||(o.length>0&&(o+=","),b[h].indexOf(":")<0&&(b[h]=b[h]+":80"),o=o+"stun:"+Trim(b[h]));e=25}}if(e=30,!isNull(s)&&s.length>0){e=31;var g=s.indexOf("://");g>=0&&(s=s.substring(g+3)),e=32,g=s.indexOf("/"),g>0&&(s=s.substring(0,g)),e=33,(s.indexOf("148.251.28.181")>=0||s.indexOf("rtc.mizu-voip.com")>=0)&&(s.indexOf("18080")>0||s.indexOf("2443")>0)&&(e=34,o=a)}if(e=35,o.indexOf("148.251.28.181")>=0||o.indexOf("rtc.mizu-voip.com")>=0||o.indexOf("107.175.156.227")>=0||o.indexOf("usrtcx.webvoipphone.com")>=0||o.indexOf("usrtc3.webvoipphone.com")>=0){e=36;var g=o.lastIndexOf(":");g>0&&(e=40,o=o.substring(0,g+1)+"8090"),e=41}PutToDebugLog(2,"EVENT, GetStunServersStr: "+o)}catch(d){PutToDebugLogException(2,"common: GetStunServersStr: ("+e.toString()+")",d)}return o}function GetOneStunSrv(){var e="";try{var o=GetStunServersStr();if(!isNull(o)&&o.length>3){var n=o.indexOf(",");e=n>0?Trim(o.substring(0,n)):o}isNull(e)&&(e=""),PutToDebugLog(2,"EVENT, GetOneStunSrv: "+e)}catch(t){PutToDebugLogException(2,"common: GetOneStunSrv",t)}return e}function GetTurnSrv(){if(!0===webphone_api.global.noturn||!0===IsLocalServer(!0))return null;ParseStunTurnNew();var e={},o=!0;try{var n=GetConfig("turnserveraddress"),t=GetConfig("turnparameters"),i=GetConfig("turnusername"),a=GetConfig("turnpassword");(n.length<1||i.length<1||a.length<1)&&(o=!1);var r=n,l=t,p=i,s=a;if(null===webphone_api.parameters.turnserveraddress||"null"==webphone_api.parameters.turnserveraddress||"NULL"==webphone_api.parameters.turnserveraddress)return PutToDebugLog(2,"EVENT, GetTurnSrv3: NULL"),null;var c=GetParameter2("turnserveraddress"),u=GetParameter2("turnparameters"),g=GetParameter2("turnusername"),m=GetParameter2("turnpassword");if(null===c||"null"===c||"Null"===c||"NULL"===c)return PutToDebugLog(2,"EVENT, GetTurnSrv4: NULL"),null;if(void 0===c||c.length<1||void 0===g||g.length<1||void 0===m||m.length<1?o=!(r.length<1):(r=c,l=u,p=g,s=m,o=!0),isNull(r)||"null"===r||"NULL"===r||isNull(p)||"null"===p||"NULL"===p||isNull(s)||"null"===s||"NULL"===s)return PutToDebugLog(2,"EVENT, GetTurnSrv2: NULL"),null;var b=!1;if(GetBrowserVersion()>40&&(b=!0),!1===o){var h=webphone_api.parameters.webrtcserveraddress;(isNull(h)||h.length<2)&&(h=GetWsAddressCfg(),(isNull(h)||h.length<2)&&(h=GetWp())),isNull(h)&&(h=""),h=h.toLowerCase();var d=GetConfig("mainaport");if(!0===IsMizuServerOrGateway()&&h.length>0){var _=h,w=h.indexOf("://");if(w>0&&(h=h.substring(w+3)),w=h.indexOf("/"),w>0&&(h=h.substring(0,w)),!isNull(d)&&d.length>0&&IsNumber(d)&&(w=h.indexOf(":"),w>0&&(h=h.substring(0,w)),h=h+":"+d),_.indexOf("wss:")>=0)if((w=h.indexOf(":"))>0){var f=h.substring(w+1);if(h=h.substring(0,w),"80"===f||"443"===f||"2443"===f){var v="turn:"+h+":"+f+"?transport=tcp";e=!0===b?{urls:v,username:"mzturnusr",credential:"rnd87719318572"}:{url:v,username:"mzturnusr",credential:"rnd87719318572"}}else e=null;o=!0}else{var v="turn:"+h+":80?transport=tcp";e=!0===b?{urls:v,username:"mzturnusr",credential:"rnd87719318572"}:{url:v,username:"mzturnusr",credential:"rnd87719318572"},o=!0}else{h.indexOf(":")<0&&(h+=":80");var v="turn:"+h+"?transport=tcp";e=!0===b?{urls:v,username:"mzturnusr",credential:"rnd87719318572"}:{url:v,username:"mzturnusr",credential:"rnd87719318572"},o=!0}}}else null==r?e=null:(r=Trim(r),0!==r.indexOf("turn:")&&(r="turn:"+r),r.indexOf(":")===r.lastIndexOf(":")&&(r+=":80"),isNull(l)&&(l=""),l.length>0&&0!==l.indexOf("?")&&(l="?"+l),e=!0===b?{urls:r+l,username:p,credential:s}:{url:r+l,username:p,credential:s},o=!0);if(!1===o&&(e=null),isNull(e))PutToDebugLog(2,"EVENT, GetTurnSrv: NULL");else{var P=JSON.stringify(e);P=P.substring(0,P.indexOf("credential")+10),P+='":"*****"}',PutToDebugLog(2,"EVENT, GetTurnSrv: "+P)}return e}catch(E){PutToDebugLogException(2,"common: GetTurnSrv",E)}return{}}function ParseStunTurnNew(){try{var e=GetParameter("stunserveraddress"),o=GetParameter("turnserveraddress");isNull(e)&&(e=""),e=ReplaceAll(e," ",""),e=ReplaceAll(e,'"',""),e=ReplaceAll(e,"'",""),isNull(o)&&(o=""),o=ReplaceAll(o," ",""),o=ReplaceAll(o,'"',""),o=ReplaceAll(o,"'",""),e=ReplaceAll(e,"{",""),e=ReplaceAll(e,"}",""),e=ReplaceAll(e,"[",""),e=ReplaceAll(e,"]",""),o=ReplaceAll(o,"{",""),o=ReplaceAll(o,"}",""),o=ReplaceAll(o,"[",""),o=ReplaceAll(o,"]","");var n=-1,t="";if(o.toLowerCase().indexOf("turn")>=0||o.toLowerCase().indexOf("transport")>=0?t=o:(e.toLowerCase().indexOf("turn")>=0||e.toLowerCase().indexOf("transport")>=0)&&(t=e),t.length>3){n=t.toLowerCase().indexOf("turn:"),n>=0&&(t=t.substring(n+5)),n=t.toLowerCase().indexOf("stun:"),n>=0&&(t=t.substring(0,n));var i="",a="",r="",l="";n=t.toLowerCase().indexOf("username:"),n>=0&&(a=t.substring(n+9),(n=a.indexOf(","))>0&&(a=a.substring(0,n))),n=t.toLowerCase().indexOf("credential:"),n>=0&&(r=t.substring(n+11),(n=r.indexOf(","))>0&&(r=r.substring(0,n))),n=t.toLowerCase().indexOf("?"),n>=0&&(l=t.substring(n+1),(n=l.indexOf(","))>0&&(l=l.substring(0,n))),isNull(a)&&(a=""),isNull(r)&&(r=""),isNull(l)&&(l=""),i=t.toLowerCase(),i=i.replace("username:"+a,""),i=i.replace("credential:"+r,""),i=i.replace("?"+l,""),i=ReplaceAll(i,",",""),n=i.indexOf("url:"),n>=0&&(i=i.substring(n+4)),n=i.indexOf("urls:"),n>=0&&(i=i.substring(n+5)),isNull(i)&&(i=""),i.length>0&&SaveParameter("turnserveraddress",i),l.length>0&&SaveParameter("turnparameters",l),a.length>0&&SaveParameter("turnusername",a),r.length>0&&SaveParameter("turnpassword",r)}var p="";if(p=o.toLowerCase().indexOf("stun:")>=0?o.toLowerCase():e.toLowerCase(),p.length>3){p=ReplaceAll(p,"url:",""),p=ReplaceAll(p,"urls:","");var s=p.indexOf("turn:");n=p.indexOf("stun:"),n>=0&&s>=0&&(p=n>s?p.substring(n):p.substring(n,s)),n=p.toLowerCase().indexOf("url:"),n>=0&&(p=p.substring(n+4)),n=p.toLowerCase().indexOf("urls:"),n>=0&&(p=p.substring(n+5)),n=p.toLowerCase().indexOf("stun:"),n>=0&&(p=p.substring(n+5)),n=p.toLowerCase().indexOf(","),n>=0&&(p=p.substring(0,n)),isNull(p)&&(p=""),p.length>0&&SaveParameter("stunserveraddress",p)}}catch(c){PutToDebugLogException(2,"common: ParseStunTurnNew",c)}return""}function GetDeviceId(){try{if(!isNull(cachedevid)&&cachedevid.length>1)return cachedevid;var e="",o=GetBrandName();isNull(o)&&(o=""),o=o.toLowerCase(),o=Trim(o);var n=location.host;isNull(n)?n="":n.indexOf(":")>0&&(n=n.substring(0,n.indexOf(":"))),n=n.toLowerCase(),n=Trim(n),o=o+"_"+n;for(var t=o+"=",i=document.cookie.split(";"),a=0;a<i.length;a++){for(var r=i[a];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t)){e=r.substring(t.length,r.length);break}}if(isNull(e)||Trim(e).length<1){e=Md5Hash(RandomInt(1e3,9999999)+"_"+GetTickCount()+"_"+o)}if(!isNull(e)&&Trim(e).length>1){var l=new Date;l.setTime(l.getTime()+31536e6);var p="; expires="+l.toGMTString();return document.cookie=o+"="+e+p+"; path=/;SameSite=Lax",cachedevid=e,e}}catch(s){PutToDebugLogException(2,"common: GetDeviceId",s)}return""}function LogAllParameters(e,o){if(CanLog(4)){try{if(isNull(e)&&(e="All parameters:"),isNull(o))return void PutToDebugLog(2,"ERROR, LogAllParameters params is NULL");var n=[];n.push("d"),n.push("e"),n.push("m"),n.push("o");var t=n.join("");n=[],n.push("s"),n.push("u"),n.push("p"),n.push("p"),n.push("o"),n.push("r"),n.push("t"),n.push("e"),n.push("n"),n.push("d");var i=n.join("");n=[],n.push("h"),n.push("a"),n.push("s");var a=n.join("");n=[],n.push("u"),n.push("s"),n.push("e");var r=n.join("");n=[],n.push("e"),n.push("n"),n.push("a"),n.push("b"),n.push("l"),n.push("e");var l=n.join("");delete o.domaintoip_cache;for(var p in o)if("get"!==p&&"getAll"!==p)if("password"===p&&GetLogLevel()<5){var s=StrEc(o[p],webphone_api.global.ec_apikey,!0);e=e+"\r\nep="+s}else"needactivation"===p||"passphrase"===p||0===p.indexOf(t)||0===p.indexOf(i)||GetLogLevel()<6&&(0===p.indexOf(r)||0===p.indexOf(a)||0===p.indexOf(l))||(e=e+"\r\n"+p+"="+o[p]);PutToDebugLog(4,"EVENT, All parameters: "+e)}catch(c){PutToDebugLogException(2,"common: GetDeviceId",c)}return""}}function AutodetectDirectWebrtc(){try{if("true"===GetParameter("autodetectwebrtc_completed")||!1===CanIUseWebRTC())return;if("java"===getuseengine()||"ns"===getuseengine()||"java"===getuseengine()||IsMizuServerOrGateway()||GetWsAddressCfg().length>3)return void PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc not needed "+getuseengine()+" "+GetWsAddressCfg());var e=GetUA();if(GetParameter("useragent").length>0&&!1===IsMizuPublicWebRTCGateway()&&(e=GetParameter("useragent")),GetConfigInt("autodetectwebrtc",1)<1)return;var o=GetViaRandomAddress(),n="OPTIONS sip:domain.com SIP/2.0\r\nVia: SIP/2.0/WSS "+o+';branch=z9hG4bKZm6ekwKTdh4HVt5KZKbFAiPsa7HfefiL;rport\r\nFrom: "1234"<sip:1234@domain.com>;tag=ExB7vRKwE52lvEsR1WrC\r\nTo: "1234"<sip:1234@domain.com>\r\nContact: "1234"<sips:1234@'+o+";transport=wss>;expires=180\r\nCall-ID: 5ff2d63f-4939-2816-eeb8-6feca8245b92\r\nCSeq: 1522 REGISTER\r\nContent-Length: 0\r\nMax-Forwards: 70\r\nUser-Agent: "+e+"\r\nOrganization: DTC\r\nSupported: path\r\n",t=GetParameter("serveraddress");if((isNull(t)||t.length<2)&&(t=GetParameter("serveraddress_user")),isNull(t)||t.length<2)return void PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc cannot find serveraddress");t=NormalizeInput(t,0),t.indexOf(":")>0&&(t=t.substring(0,t.indexOf(":"))),t.indexOf("/")>0&&(t=t.substring(0,t.indexOf("/"))),PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc base serveraddress: "+t),!0===BrowserRequiresHttps(!1)?(wsuri_1="wss://"+t+":80/ws",wsuri_2="wss://"+t+":8080/ws",wsuri_3="wss://"+t+":443/ws",wsuri_4="wss://"+t+":8088/ws",wsuri_5="wss://"+t+":8089/ws"):(wsuri_1="wss://"+t+":80/ws",wsuri_2="wss://"+t+":8080/ws",wsuri_3="wss://"+t+":443/ws",wsuri_4="wss://"+t+":8088/ws",wsuri_5="wss://"+t+":8089/ws",wsuri_6="ws://"+t+":80/ws",wsuri_7="ws://"+t+":8080/ws",wsuri_8="ws://"+t+":443/ws",wsuri_9="ws://"+t+":8088/ws"),wsuri_1.length>0&&(ws_1=new WebSocket(wsuri_1),ws_1.binaryType="arraybuffer",ws_1.onopen=function(e){ws_1.send(n)},ws_1.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_1)}),wsuri_2.length>0&&(ws_2=new WebSocket(wsuri_2),ws_2.binaryType="arraybuffer",ws_2.onopen=function(e){ws_2.send(n)},ws_2.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_2)}),wsuri_3.length>0&&(ws_3=new WebSocket(wsuri_3),ws_3.binaryType="arraybuffer",ws_3.onopen=function(e){ws_3.send(n)},ws_3.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_3)}),wsuri_4.length>0&&(ws_4=new WebSocket(wsuri_4),ws_4.binaryType="arraybuffer",ws_4.onopen=function(e){ws_4.send(n)},ws_4.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_4)}),wsuri_5.length>0&&(ws_5=new WebSocket(wsuri_5),ws_5.binaryType="arraybuffer",ws_5.onopen=function(e){ws_5.send(n)},ws_5.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_5)}),wsuri_6.length>0&&(ws_6=new WebSocket(wsuri_6),ws_6.binaryType="arraybuffer",ws_6.onopen=function(e){ws_6.send(n)},ws_6.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_6)}),wsuri_7.length>0&&(ws_7=new WebSocket(wsuri_7),ws_7.binaryType="arraybuffer",ws_7.onopen=function(e){ws_7.send(n)},ws_7.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_7)}),wsuri_8.length>0&&(ws_8=new WebSocket(wsuri_8),ws_8.binaryType="arraybuffer",ws_8.onopen=function(e){ws_8.send(n)},ws_8.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_8)}),wsuri_9.length>0&&(ws_9=new WebSocket(wsuri_9),ws_9.binaryType="arraybuffer",ws_9.onopen=function(e){ws_9.send(n)},ws_9.onmessage=function(e){var o=null;isNull(e)||(o=e.data),!isNull(o)&&o.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_9)}),setTimeout(function(){if(SaveParameter("autodetectwebrtc_completed","true"),isNull(ws_1)||ws_1.close(),isNull(ws_2)||ws_2.close(),isNull(ws_3)||ws_3.close(),isNull(ws_4)||ws_4.close(),isNull(ws_5)||ws_5.close(),isNull(ws_6)||ws_6.close(),isNull(ws_7)||ws_7.close(),isNull(ws_8)||ws_8.close(),isNull(ws_9)||ws_9.close(),!isNull(at_addr)&&at_addr.length>0){for(var e="",o=0;o<at_addr.length;o++)isNull(at_addr[o])||at_addr[o].length<1||(PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc list["+o+"] = "+at_addr[o]),e.length<1&&(e=at_addr[o]),at_addr[o].indexOf("wss:")>=0&&(e=at_addr[o]));!isNull(e)&&e.length>0&&(SaveParameter("webrtcserveraddress",e),PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc best webrtcserveraddress: "+e))}else PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc not found any valid server")},2500)}catch(i){PutToDebugLogException(2,"common: AutodetectDirectWebrtc",i)}}function GetMediaConstraints(e,o){try{if(!0===webphone_api.isscreensharecall){return{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}}}var n=webphone_api.common.GetParameter("sel_rtc_audio_in"),t="";if(!0===e&&!isNull(n)&&n.length>1&&!0!==webphone_api.global.isholdresume){var i=webphone_api.webrtcapi.GetAudioVideoInputId(n,!1);if(gmc={audio:{deviceId:{exact:i}}},!0===o&&(t=webphone_api.common.GetParameter("sel_rtc_video_in"),!isNull(t)&&t.length>0)){var a=webphone_api.webrtcapi.GetAudioVideoInputId(t,!0);!isNull(a)&&a.length>0&&(gmc.video={deviceId:{exact:a}})}}else gmc={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};if(!0===e)try{var r=JSON.stringify(gmc);isNull(r)?PutToDebugLog(2,"ERROR,GetMediaConstraints is NULL"):(PutToDebugLog(2,"EVENT,GetMediaConstraints: "+r),PutToDebugLog(2,"EVENT,GetMediaConstraints audioSource: "+n+"; videoSource: "+t))}catch(l){PutToDebugLogException(2,"common: GetMediaConstraints inner",l)}return gmc}catch(l){PutToDebugLogException(2,"common: GetMediaConstraints",l)}return null}function GetScreenshareConstraints(){try{return{video:{cursor:"always"},audio:!1}}catch(e){PutToDebugLogException(2,"common: GetScreenshareConstraints",e)}return null}function StripServeraddress(e){try{if(isNull(e))return"";e=e.toLowerCase(),e=e.replace("sip:","");var o=e.indexOf("@");if(o>0){e.substring(0,o);e=e.substring(o+1)}return e=Trim(e)}catch(n){PutToDebugLogException(2,"common: StripServeraddress",n)}return""}function StripUsername(e){try{if(isNull(e))return"";e=e.replace("sip:",""),e=e.replace("SIP:",""),e=e.replace("Sip:","");var o=e.indexOf("@");return o>0&&(e=e.substring(0,o)),e=Trim(e)}catch(n){PutToDebugLogException(2,"common: StripServeraddress",n)}return""}function AddJscommport(e){try{if(isNull(e))return""
;if(isNull(jscport)||jscport.length<1){var o="",n=window.location.href;if(isNull(n)||n.length<1)return e;n=decodeURIComponent(n),n=Trim(n);var t=n.indexOf("jscommport=");t>0&&(o=n.substring(t+11),t=o.indexOf("&"),t>0&&(o=o.substring(0,t)),t=o.indexOf("#page_"),t>0&&(o=o.substring(0,t)),t=o.indexOf("/"),t>0&&(o=o.substring(0,t)),o=Trim(o),!isNull(o)&&o.length>0&&IsNumber(o)&&(PutToDebugLog(2,"EVENT, AddJscommport jscommport found: "+o),jscport=o))}if(!isNull(jscport)&&jscport.length>0&&IsNumber(jscport)){PutToDebugLog(2,"EVENT, AddJscommport adding port: "+jscport);var t=e.lastIndexOf(":");return t>0&&(e=e.substring(0,t)),e+":"+jscport}}catch(i){PutToDebugLogException(2,"common: AddJscommport",i)}return e}function DecideUsUk(){try{if(!0===webphone_api.global.decideusuk_finished&&("uk"===webphone_api.global.usuk||"us"===webphone_api.global.usuk))return;webphone_api.global.usuk.length<1?wsl_uk_time>0?(webphone_api.global.usuk="uk",ddu_lastload=wsl_uk):wsl_us_time>0&&(webphone_api.global.usuk="us",ddu_lastload=wsl_us):ddu_lastload>2&&-1!==ddu_lastcalled&&GetTickCount()-ddu_lastcalled<800&&(ddu_lastload>wsl_uk&&(webphone_api.global.usuk="uk"),ddu_lastload>wsl_us&&(webphone_api.global.usuk="us"));var e=GetWsAddressCfg();if(!isNull(e)&&e.length>3){var o=StrDc(wip_uk,alsvkey),n=StrDc(wips_uk,alsvkey),t=StrDc(wip_us,alsvkey),i=StrDc(wips_us,alsvkey);o.indexOf(e)>=0||n.indexOf(e)>=0?webphone_api.global.usuk="uk":(t.indexOf(e)>=0||i.indexOf(e)>=0)&&(webphone_api.global.usuk="us")}var a=!0,r=GetParameter("lastwebrtcserver"),l=GetParameter("topprioritywebrtcserver");if((!isNull(r)&&r.length>0||!isNull(l)&&l.length>0)&&(a=!1),PutToDebugLog(2,"EVENT, DecideUsUk selected: "+webphone_api.global.usuk),PutToDebugLog(2,"EVENT, DecideUsUk uk load: "+wsl_uk+"; uk timestamp: "+wsl_uk_time),PutToDebugLog(2,"EVENT, DecideUsUk us load: "+wsl_us+"; us timestamp: "+wsl_us_time),a)setTimeout(function(){if(!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var e=GetWsAddressCfg();e.length>0&&SaveParameter("lastwebrtcserver",e),PutToDebugLog(5,"EVENT, DecideUsUk select finished on timeout "+webphone_api.global.usuk+" "+e)}},250);else{webphone_api.global.decideusuk_finished=!0;var p=GetWsAddressCfg();p.length>0&&SaveParameter("lastwebrtcserver",p),PutToDebugLog(5,"EVENT, DecideUsUk select finished on firstanswer "+webphone_api.global.usuk+" "+p+" ("+r+" / "+l+")")}ddu_lastcalled=GetTickCount()}catch(s){PutToDebugLogException(2,"common: DecideUsUk",s)}}function getuseengine(){try{isNull(webphone_api.global.useengine)||webphone_api.global.useengine.length<1?isNull(webphone_api.global.maintimerid)||GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||CanLog(2)&&PutToDebugLog(2,"EVENT, useengine is not set"):webphone_api.global.last_useengine=webphone_api.global.useengine}catch(e){PutToDebugLogException(2,"common: GetUseengine",e)}return webphone_api.global.useengine}function DisplayPeerDetails(e){try{var o=GetParameter2("displaypeerdetails");(isNull(o)||o.length<1)&&(o="0"),IsNumber(o)?"0"===o&&!0===IsSDK()?isNull(document.getElementById("page_call_additional_info"))||(PutToDebugLog(4,"EVENT, DisplayPeerDetails Display additional call info: "+e),document.getElementById("page_call_additional_info").innerHTML=e):"1"===o&&AlertDialog("Peer details",e):isNull(document.getElementById(o))||(document.getElementById(o).innerHTML=e,document.getElementById(o).value=e)}catch(n){PutToDebugLogException(2,"common: DisplayPeerDetails",n)}}function Beep(e){try{(isNull(e)||e.length<1)&&(e="1");var o=document.getElementById("justbeep_"+e);isNull(o)||o.play()}catch(n){PutToDebugLogException(2,"common: Beep",n)}}function GetCodecsFromApiParam(){try{if(isNull(webphone_api.parameters.codec))return;var e=webphone_api.parameters.codec;if(e.length<1)return;e=e.toLowerCase();var o=e.split(",");if(isNull(o)||o.length<1)return;for(var n="",t=0;t<o.length;t++)if(!isNull(o[t])){if(o[t]=o[t].replace(".",""),o[t]=Trim(o[t]),"auto"===o[t]){n="-1";break}"g711"===o[t]||"g.711"===o[t]?(n.length>0&&(n+=","),n+="1,2"):"pcmu"===o[t]?(n.length>0&&(n+=","),n+="1"):"pcma"===o[t]?(n.length>0&&(n+=","),n+="2"):"gsm"===o[t]?(n.length>0&&(n+=","),n+="3"):"ilbc"===o[t]?(n.length>0&&(n+=","),n+="4"):"speex"===o[t]?(n.length>0&&(n+=","),n+="5"):"speex-wb"===o[t]||"speexwb"===o[t]?(n.length>0&&(n+=","),n+="6"):"g729"===o[t]||"g.729"===o[t]?(n.length>0&&(n+=","),n+="8"):"opus"===o[t]?(n.length>0&&(n+=","),n+="10"):"opuswb"===o[t]||"opus-wb"===o[t]?(n.length>0&&(n+=","),n+="11"):"opusswb"===o[t]?(n.length>0&&(n+=","),n+="12"):"opusuwb"===o[t]?(n.length>0&&(n+=","),n+="13"):"g.722"===o[t]||"g722"===o[t]?(n.length>0&&(n+=","),n+="14"):"isac"===o[t]?(n.length>0&&(n+=","),n+="15"):"h.264"===o[t]||"h264"===o[t]?(n.length>0&&(n+=","),n+="50"):"h.265"===o[t]||"h265"===o[t]?(n.length>0&&(n+=","),n+="51"):"vp8"===o[t]?(n.length>0&&(n+=","),n+="52"):"vp9"===o[t]?(n.length>0&&(n+=","),n+="53"):"vp10"===o[t]?(n.length>0&&(n+=","),n+="54"):"av1"===o[t]&&(n.length>0&&(n+=","),n+="55")}n.length<1&&(n="-1"),SaveParameter("codec",n)}catch(i){PutToDebugLogException(2,"common: GetCodecsFromApiParam",i)}}function GetHttpAPIKey(){try{if(!isNull(apikey_cache))return apikey_cache;var e=GetConfig("serverapikey");if(!(isNull(e)||e.length<2))return apikey_cache=e,e;var o=GetConfigAll(!0);if(isNull(o))return"";for(var n in o)if(!isNull(o[n])&&(e=o[n],e=e.toString(),!(e.indexOf("mvapireq")<1||e.indexOf("authkey=")<1)&&(e=e.substring(e.indexOf("authkey=")+8),e.indexOf("&")>=0&&(e=e.substring(0,e.indexOf("&"))),isNull(e)&&(e=""),"key"!==e&&"KEY"!==e||(e=""),e=Trim(e),e.length>0)))return apikey_cache=e,e}catch(t){PutToDebugLogException(2,"common: GetHttpAPIKey",t)}return apikey_cache="",""}function Wsunreg(){try{var e=GetTickCount();if(unregcalledtime>0&&e-unregcalledtime<1500)return void PutToDebugLog("WARNING, Wsunreg NOT called twice");if(unregcalledtime=e,isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)return;if(!IsMizuServerOrGateway())return;if(IsLocalServer())return;PutToDebugLog(2,"common: Wsunreg called: "+webphone_api.global.usuk);var o=GetConfig("wsunreg");if(isNull(o)||o.length<3){var n=GetWebrtcSrvAddr(),t=GetSipusername(),i=GetParameter("password");(isNull(n)||n.length<2)&&(n=GetWp()),n=n.toLowerCase(),n=NormalizeInput(n,0),n=n.replace("*","");var a=n.indexOf("/");a>0&&(n=n.substring(0,a));var r="1568108345";if("us"===webphone_api.global.usuk&&(r="1552303117"),IsMizuPublicWebRTCGateway()||(r=GetConfig("serverapikey")),n.indexOf("rtc.mizu-voip.com:2443")>=0&&(r="1568108399"),isNull(t)||t.length<1||isNull(i)||i.length<1)return void PutToDebugLog(2,"EVENT, common Wsunreg invalid username ("+t+") or invalid password ("+i+")");var l="http://";UseSecureSrvConnection()&&(l="https://"),o=l+n+"/mvapireq/?apientry=wsunreg&authkey="+r+"&authid="+t+"&authpwd="+i+"&sessionid="+GetSessionId()}else 0!==o.indexOf("http")&&(o="http://"+o),UseSecureSrvConnection()&&(o=o.replace("http:","https:"));IsMizuServerOrGateway()&&UriParser(o,"","","","","webrtcunregisteruser")}catch(p){PutToDebugLogException(2,"common: Wsunreg",p)}}function GetWsuserUrl(e,o){try{if(isNull(e)||e.length<1)return"";if(e.indexOf("@")>0&&(e=e.substring(0,e.indexOf("@")),e.length<1))return"";if(!1===UsernameStringIsValidForServer(e)){var n="ERROR, "+webphone_api.stringres.get("username_err")+": "+e;return ShowToast(n,5e3),PutToDebugLog(1,n),""}if(!isNull(o)&&o.length>0&&!1===PasswordStringIsValidForServer(o)){var n="ERROR, "+webphone_api.stringres.get("password_err")+": "+o;return ShowToast(n,5e3),PutToDebugLog(1,n),""}var t=GetWebrtcSrvAddr();if((isNull(t)||t.length<2)&&(t=GetWp()),t=t.toLowerCase(),t.indexOf("mfstwebsock")<0)return"";var i=GetConfig("brandid"),a=GetBrandName(),r=GetConfig("companyname"),l=GetParameter2("voicerecupload");isNull(l)&&(l=""),l.length<1&&(l=GetParameter2("voicerecftp_addr")),isNull(l)&&(l=""),l=Trim(l);var p=GetParameter("username"),s=GetParameter("displayname"),c=GetParameter("upperproxy");if(isNull(c)||Trim(c).length<1)c=GetProxyaddress();else if(!isNull(c)&&c.length>2&&c.indexOf(":")<1){var u=GetConfigInt("serverport",-1);u>0&&5060!==u&&(c=c+":"+u.toString())}isNull(c)&&(c=""),c=Trim(c);var g=GetParameter2("inbounddtmf");isNull(g)&&(g=""),g=Trim(g);var m=GetParameter2("outbounddtmf");isNull(m)&&(m=""),m=Trim(m);var b=GetParameter("dtmfmode");isNull(b)&&(b="");var h=GetParameter("transport");isNull(h)&&(h=""),!0===voice_wasset&&l.length<1&&(l="null"),!0===proxy_wasset&&c.length<1&&(c="null"),l.length>0&&(voice_wasset=!0),c.length>0&&(proxy_wasset=!0);var d=ParamAsBool(GetParameter2("use_h264"));isNull(d)&&(d=!0);var _=ParamAsBool(GetParameter2("use_vp8"));isNull(_)&&(_=!0);var w=ParamAsBool(GetParameter2("use_vp9"));isNull(w)&&(w=!0),t=NormalizeInput(t,0),t=t.replace("*","");var f=t.indexOf("/");f>0&&(t=t.substring(0,f));var v="1568108345";"us"===webphone_api.global.usuk&&(v="1552303117"),IsMizuPublicWebRTCGateway()||(v=GetConfig("serverapikey")),t.indexOf("rtc.mizu-voip.com:2443")>=0&&(v="1568108399");var P=NeedRegister(),E=GetParameter("wsuser"),T=!1,N="1";getuseengine()===webphone_api.global.ENGINE_FLASH&&(N="2");var S="https://";!isNull(E)&&E.length>10&&(t=E,f=t.indexOf("://"),f>0&&(t=t.substring(f+3)),f=t.indexOf("?"),f>0&&(t=t.substring(0,f+1)),0==E.indexOf("http:")&&(S="http://"));var I=t;if(f=I.indexOf("/"),f>0&&(I=I.substring(0,f)),f=I.indexOf("?"),f>0&&(I=I.substring(0,f)),f=I.indexOf(":"),f>0&&(I=I.substring(0,f)),I.length>3&&IsIPAddrress(I)&&!1===UseSecureSrvConnection()&&(S="http://"),!isNull(E)&&E.length>10&&E.indexOf("?")>0&&E.indexOf("&")>0){t=E,f=t.indexOf("://"),f>0&&(t=t.substring(f+3)),f=t.indexOf("?"),t=t.substring(0,f+1),f=E.indexOf("?");var R=E.substring(f+1);R=R.toLowerCase();var G=R.split("&");if(!isNull(G)&&G.length>0){for(var O=0;O<G.length;O++)if(!(isNull(G[O])||G[O].indexOf("=")<2||0===G[O].indexOf("apientry=")||0===G[O].indexOf("authkey="))){var L=G[O].substring(0,G[O].indexOf("="));if("upperserver"!==L&&"upperserverdomain"!==L)if("transport"!==L)switch(L){case"authid":G[O]="authid="+e;break;case"username":G[O]="username="+e;break;case"authpwd":G[O]="authpwd="+o;break;case"brandid":G[O]="brandid="+i;break;case"brandname":G[O]="brandname="+a;break;case"companyname":G[O]="companyname="+r;break;case"needregister":G[O]="needregister="+P.toString();break;case"callerid":G[O]="callerid="+p;break;case"displayname":G[O]="displayname="+s;break;case"voicerecupload":G[O]="voicerecupload="+l;break;case"engine":G[O]="engine="+N;break;case"proxyaddress":G[O]="proxyaddress="+c}else{var C=G[O].substring(G[O].indexOf("=")+1),D=ParameterIsDefault("transport"),y=GetParameterInt("transport",-1),x="udp";1===y?x="tcp":2===y&&(x="tls"),y<0||(isNull(C)||C.length<1?D||(G[O]=L+"="+x):G[O]=L+"="+x)}else{var C=G[O].substring(G[O].indexOf("=")+1);isNull(C)||C.length<1?G[O]=L+"="+GetWebrtcUpperServer():"true"===GetParameter("iswebrtcuppersrvfromuser")&&(G[O]=L+"="+GetWebrtcUpperServer())}}R="";for(var O=0;O<G.length;O++)isNull(G[O])||G[O].indexOf("=")<2||(R.length>0&&(R+="&"),R+=G[O]);E=S+t+R,g.length>0&&(E=E+"&inbounddtmf="+g),m.length>0&&(E=E+"&outbounddtmf="+m)}E.indexOf("authid=")<0&&(E=E+"&authid="+e),E.indexOf("authpwd=")<0&&(E=E+"&authpwd="+o),E.indexOf("upperserver=")<0&&(E=E+"&upperserver="+GetWebrtcUpperServer()),E.indexOf("upperserverdomain=")<0&&(E=E+"&upperserverdomain="+GetWebrtcUpperServer()),E.indexOf("voicerecupload=")<0&&(E=E+"&voicerecupload="+l),E.indexOf("needregister=")<0&&(E=E+"&needregister="+P.toString()),E.indexOf("callerid=")<0&&(E=E+"&callerid="+p),E.indexOf("displayname=")<0&&(E=E+"&displayname="+s),E.indexOf("proxyaddress=")<0&&(E=E+"&proxyaddress="+c),E.indexOf("dtmfmode=")<0&&(E=E+"&dtmfmode="+b),E.indexOf("engine=")<0&&(E=E+"&engine="+N),h.length>0&&"-1"!=h&&E.indexOf("transport=")<0&&(E=E+"&transport="+h),T=!0}if(!1===T){var A="&authpwd="+o;!1===IsMizuWebRTCGatewayAndNotMizuServer()&&t.indexOf("rtc.mizu-voip.com:2443")<0&&(A="&authmd5=MD5VALUE&authsalt=MD5SALT"),E=S+t+"/mvapireq/?apientry=wsuser&authkey="+v+"&authid="+e+A+"&brandid="+i+"&brandname="+a+"&companyname="+r+"&upperserver="+GetWebrtcUpperServer()+"&needregister="+P.toString()+"&callerid="+p+"&displayname="+s+"&voicerecupload="+l+"&engine="+N+"&dtmfmode="+b+"&proxyaddress="+c+"&sessionid="+GetSessionId()+"&now=415",g.length>0&&(E=E+"&inbounddtmf="+g),m.length>0&&(E=E+"&outbounddtmf="+m)}if(E.indexOf("appversion=")<0&&(E=E+"&appversion="+webphone_api.global.versionstr),E.indexOf("transport=")<0&&!1===ParameterIsDefault("transport")){var y=GetParameterInt("transport",0),x="udp";1===y?x="tcp":2===y&&(x="tls"),E=E+"&transport="+x}if(!1===Glcr()&&(f=E.indexOf("voicerecupload"))>0){var k=E.substring(0,f),U="";U=E.substring(f),f=U.indexOf("&"),U=f>0?U.substring(f+1):"",E=k+U}return E}catch(V){PutToDebugLogException(2,"common: GetWsuserUrl",V)}return""}function GetWsloadUrl(e){try{var o=GetWebrtcSrvAddr(),n=GetConfig("brandid"),t=GetBrandName(),i=GetConfig("companyname"),a="http://";if(UseSecureSrvConnection()&&(a="https://"),(isNull(o)||o.length<2)&&(o=GetWp()),o=o.toLowerCase(),o.indexOf("mfstwebsock")<0)return"";o=NormalizeInput(o,0),o=o.replace("*","");var r=o.indexOf("/");r>0&&(o=o.substring(0,r));var l="1568108345";"us"===webphone_api.global.usuk&&(l="1552303117"),IsMizuPublicWebRTCGateway()||(l=GetConfig("serverapikey")),o.indexOf("rtc.mizu-voip.com:2443")>=0&&(l="1568108399");var p=GetConfig("wsload"),s=!1;if(!isNull(p)&&p.length>10&&p.indexOf("?")>0&&p.indexOf("&")>0){o=p,r=o.indexOf("://"),r>0&&(o=o.substring(r+3)),r=o.indexOf("?"),o=o.substring(0,r+1);var c=p.substring(r+1);c=c.toLowerCase();var u=c.split("&");if(!isNull(u)&&u.length>0){for(var g=0;g<u.length;g++)if(!(isNull(u[g])||u[g].indexOf("=")<2||0===u[g].indexOf("apientry=")||0===u[g].indexOf("authkey="))){var m=u[g].substring(0,u[g].indexOf("="));switch(m){case"authid":u[g]="authid="+e;break;case"username":u[g]="username="+e;break;case"brandid":u[g]="brandid="+n;break;case"brandname":u[g]="brandname="+t;break;case"companyname":u[g]="companyname="+i;break;case"upperserver":u[g]="upperserver="+GetWebrtcUpperServer()}}c="";for(var g=0;g<u.length;g++)isNull(u[g])||u[g].indexOf("=")<2||(c.length>0&&(c+="&"),c+=u[g]);p=a+o+c}s=!0}else{var b=GetConfig("wsuser");if(!isNull(b)&&b.length>10){var h=b;if(r=h.indexOf("://"),r>0&&(h=h.substring(r+3)),r=h.indexOf("/"),r>0&&(h=h.substring(0,r)),r=h.indexOf("?"),r>0&&(h=h.substring(0,r)),h.length>0&&(PutToDebugLog(4,"EVENT, GetWsloadUrl guessed domain: "+h),o=h),(r=b.indexOf("authkey="))>0){var d=b.substring(r+8);r=d.indexOf("&"),r>0&&(d=d.substring(0,r)),!isNull(d)&&d.length>2&&(PutToDebugLog(4,"EVENT, GetWsloadUrl guessed apikey: "+d),l=d)}}}return!1===s&&(p=a+o+"/mvapireq/?authkey="+l+"&apientry=wsload&brandid="+n+"&brandname="+t+"&companyname="+i+"&upperserver="+GetWebrtcUpperServer()+"&authid="+e+"&now=415"),p}catch(_){PutToDebugLogException(2,"common: GetWsloadUrl",_)}return""}function HandleCalldivert(){try{if(!IsMizuServerOrGateway())return;var e=GetParameter("calldivertchecksum");isNull(e)&&(e="");if("1"===GetParameter("calldivertsuccess"))return;var o=GetParameter2("callforwardonbusy"),n=GetParameter2("callforwardonnoanswer"),t=GetParameter2("callforwardalways"),i=GetParameter2("callforwardonnoanswertimeout"),a=Md5Hash(o+n+t+i);if(e===a)return;PutToDebugLog(2,"EVENT, HandleCalldivert old checksum: "+e+" ; new checksum: "+a),(isNull(o)||o.length<1)&&(o="null"),(isNull(n)||n.length<1)&&(n="null"),(isNull(t)||t.length<1)&&(t="null"),SaveParameter("calldivertsuccess","0");var r=GetWebrtcSrvAddr(),l="http://";UseSecureSrvConnection()&&(l="https://"),(isNull(r)||r.length<2)&&(r=GetWp()),r=r.toLowerCase(),r=NormalizeInput(r,0),r=r.replace("*","");var p=r.indexOf("/");p>0&&(r=r.substring(0,p));var s="1568108345";"us"===webphone_api.global.usuk&&(s="1552303117"),IsMizuPublicWebRTCGateway()||(s=GetConfig("serverapikey"));var c=GetConfig("wsload"),u=GetConfig("wsuser");if(!isNull(u)&&u.length>10){var g=u;if(p=g.indexOf("://"),p>0&&(g=g.substring(p+3)),p=g.indexOf("/"),p>0&&(g=g.substring(0,p)),p=g.indexOf("?"),p>0&&(g=g.substring(0,p)),g.length>0&&(PutToDebugLog(4,"EVENT, GetCalldivertUrl guessed domain: "+g),r=g),(p=u.indexOf("authkey="))>0){var m=u.substring(p+8);p=m.indexOf("&"),p>0&&(m=m.substring(0,p)),!isNull(m)&&m.length>0&&(PutToDebugLog(4,"EVENT, GetCalldivertUrl guessed apikey: "+m),s=m)}}c=l+r+"/mvapireq/?authkey="+s+"&authid="+GetSipusername()+"&authpwd="+GetParameter("password")+"&apientry=calldivert&callforwardonbusy="+o+"&callforwardonnoanswer="+n+"&callforwardalways="+t+"&callforwardonnoanswertimeout="+i+"&now=415",UriParser(c,"","","","","calldivertapi")}catch(b){PutToDebugLogException(2,"common: HandleCalldivert",b)}}function SetVoiceMailNumber(e){try{var o="";webphone_api.getsipheader("Server",function(e){!webphone_api.common.isNull(e)&&e.length>0&&(o=e),webphone_api.getsipheader("User-Agent",function(e){!webphone_api.common.isNull(e)&&e.length>0&&(hua=e),hua.indexOf("Asterisk")>=0||hua.indexOf("FPBX")>=0||hua.indexOf("FreePBX")>=0||hua.indexOf("FreeSWITCH")>=0||hua.indexOf("Asterisk")>=0||o.indexOf("FPBX")>=0||o.indexOf("FreePBX")>=0||o.indexOf("FreeSWITCH"),SetVoiceMailNumberDelayed(null,"*97")})})}catch(n){PutToDebugLogException(2,"common: HandleCalldivert",n)}}function SetVoiceMailNumberDelayed(e,o){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120),void 0!==o&&null!==o||(o=""),o=webphone_api.common.Trim(o);var t='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("voicemail_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+webphone_api.stringres.get("voicemail_msg")+'</span><input type="text" id="voicemail_input" name="setting_item" data-theme="a" autocapitalize="off" value="'+o+'"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(t).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}});var i=document.getElementById("voicemail_input");isNull(i)||i.focus(),webphone_api.$("#adialog_positive").on("click",function(o){PutToDebugLog(5,"EVENT, common SetVoiceMailNumber OK click");var n="";isNull(i)||(n=i.value),!isNull(n)&&n.length>0&&(n=Trim(n),SaveParameter("voicemailnum",n)),e&&"function"==typeof e&&e(n)}),webphone_api.$("#adialog_negative").on("click",function(e){})}catch(a){PutToDebugLogException(2,"common: SetVoiceMailNumber",a)}}function CreateConferenceRoom(e,o){var n="";try{webphone_api.global.lastcontarget=o;var t=GetConfigAll(!0);if(!isNull(t)&&n.length<1)for(var i in t){var a=t[i];if(!isNull(a)&&a.toString().indexOf("/mvapireq/?apientry=")>0){var r=a.toString();r.indexOf("authkey=")>0&&(r=r.substring(r.indexOf("authkey=")),r.indexOf("&")>0&&(r=r.substring(0,r.indexOf("&")))),n=a.toString(),n=n.substring(0,n.indexOf("?")+1),n=n+r+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&target="+o+"&apientry=getconfroom";break}}if(n.length<1){var l=GetConfig("mainaport");l=!isNull(l)&&l.length>0?":"+l:"";var p=GetParameter("serveraddress");if((isNull(p)||p.length<1)&&(p=GetParameter("serveraddress_user")),!isNull(p)&&p.length>0){var s="";GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(s="1568108399"),(isNull(s)||s.length<1)&&(s="1568108345","us"===webphone_api.global.usuk&&(s="1552303117"),p=GetDomainFromURL(GetWsuserUrl(GetSipusername(),GetParameter("password"))));var c="http://";!0===UseSecureSrvConnection()&&(c="https://"),n=c+p+l+"/mvapireq/?authkey="+s+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&target="+o+"&apientry=getconfroom"}}if(n.length>0){if(!0!==e)return n;!isNull(webphone_api.global.lastconfroom)&&webphone_api.global.lastconfroom.length>2?(PutToDebugLog(3,"EVENT, CreateConferenceRoom returning cached conference room: "+webphone_api.global.lastconfroom),ConferenceRoomReceived(webphone_api.global.lastconfroom)):UriParser(n,"","","","","getconferenceroom")}else PutToDebugLog(1,"ERROR, Cannot create conference room"),PutToDebugLog(2,"ERROR, CreateConferenceRoom invalid uri: "+n)}catch(u){PutToDebugLogException(2,"common: CreateConferenceRoom",u)}return""}function ConferenceRoomReceived(e){try{if(isNull(e))return PutToDebugLog(1,"ERROR, Ivalid conference room"),void PutToDebugLog(2,"ERROR, Ivalid conference room: "+e);var o=e.toLowerCase().indexOf("error:");if(o>=0){return void PutToDebugLog(1,"ERROR, "+e.substring(o+6))}if(e=e.toLowerCase(),o=e.indexOf("ok:"),e.indexOf("error:")>0)e.indexOf("higlhoad")>0&&(ebphone_api.global.lastconftargetstate=5);else if(o>=0){webphone_api.global.lastconfroom=e;var n=e.substring(o+3);o=n.indexOf(":"),o>=0&&(n=n.substring(o+1)),n.indexOf(" usr: notexists")>0?webphone_api.global.lastconftargetstate=1:n.indexOf(" usr: registered")>0?webphone_api.global.lastconftargetstate=4:n.indexOf(" usr: push")>0?webphone_api.global.lastconftargetstate=3:n.indexOf(" usr: exists")>0?webphone_api.global.lastconftargetstate=2:webphone_api.global.lastconftargetstate=0,o=n.indexOf(" usr: "),o>0&&(n=n.substring(0,o)),n=Trim(n),PutToDebugLog(2,"EVENT, Received conference room: "+n),webphone_api.global.confanswer_received=!0;var t=GetParameter("received_confrooms");isNull(t)&&(t="");for(var i=t.split(","),a=!1,r=0;r<i.length;r++)if(i[r]===n){a=!0;break}if(i.length>10)for(;i.length>10;)i.shift();!1===a&&i.push(n),t="";for(var r=0;r<i.length;r++)isNull(i[r])||(t.length>0&&(t+=","),t+=i[r]);SaveParameter("received_confrooms",t),currconfroom=n;var l=!1;if(!1===IsSDK()&&!0===webphone_api.global.isDialpadStarted&&(InitiateConference(""),l=!0),!l&&webphone_api.global.confcanfailover&&(3==webphone_api.global.lastconftargetstate||4==webphone_api.global.lastconftargetstate)&&webphone_api.global.lastcontarget.length>0&&(webphone_api.common.PutToDebugLog(2,"EVENT, Conference failover to DTMF: "+webphone_api.global.lastcontarget),webphone_api.dtmf("*1*"+webphone_api.global.lastcontarget+"#"),l=!0),!l){var p=GetParameterInt("conferencerooms",-1),s=GetParameterInt("conferencetype",-1);s<0&&(s=1==p?5:2==p?6:3==p?7:1);var c="",u=!1;if(GetNrOfActiveCalls()>0){if(c=GetPeerUsername(),(1==s||5==s)&&c.length>0){PutToDebugLog(2,"EVENT, ConferenceRoom transfer call ("+c+") to conf room number: "+n);var g=webphone_api.common.GetCallSession(!1,webphone_api.global.aline,c);g&&0!=g.transfer(n)&&(u=!0)}PutToDebugLog(2,"EVENT, ConferenceRoom hangup active call ("+c+") and call conf room number: "+n),webphone_api.hangup()}if(PutToDebugLog(2,"EVENT, mlogic API_Call ConferenceRoomReceived"),webphone_api.call(n),!isNull(webphone_api.global.waiting_conf_numbers)&&webphone_api.global.waiting_conf_numbers.length>0){var m=webphone_api.global.waiting_conf_numbers.split(",");if(!isNull(m)&&m.length>0)for(var r=0;r<m.length;r++)isNull(m[r])||Trim(m[r]).length<1||(c.length>0&&c==m[r]&&(c=""),SendConferenceInvites(m[r],n));c.length>0&&!u&&SendConferenceInvites(c,n)}}}else PutToDebugLog(1,"ERROR, No conference room received: "+e)}catch(b){PutToDebugLogException(2,"common: ConferenceRoomReceived",b)}}function InitiateConference(e){try{!isNull(e)&&e.length>0&&(conf_ct.length>0&&(conf_ct+=","),conf_ct+=e);var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120);var n=webphone_api.stringres.get("confroom_msg1")+": "+currconfroom+"<br /><br />"+webphone_api.stringres.get("confroom_msg2")+":",t='<div id="conferenceroom_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("menu_confrooms")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+n+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="conferenceroom_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+GetElementSource()+'images/btn_add_contact_txt.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(t).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click"),webphone_api.$("#btn_pickct").off("click")}});var i=document.getElementById("conferenceroom_input");!isNull(conf_ct)&&conf_ct.length>1&&(i.value=Trim(conf_ct)),isNull(i)||i.focus(),setTimeout(function(){webphone_api.common.isNull(i)||i.focus()},150),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, call Conferenceroom ok onclick");var o=Trim(i.value);webphone_api.$("#conferenceroom_popup").on("popupafterclose",function(e){!isNull(o)&&o.length>0?(conf_ct="",SendConferenceInvites(o,currconfroom),7!==GetParameterInt("conferencetype",1)&&(PutToDebugLog(2,"EVENT, mlogic API_Call InitiateConference"),webphone_api.call(currconfroom))):(ShowToast(webphone_api.stringres.get("err_msg_4")),webphone_api.$.mobile.back())})}),webphone_api.$("#adialog_negative").on("click",function(e){}),webphone_api.$("#btn_pickct").on("click",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.$("#conferenceroom_popup").on("popupafterclose",function(e){webphone_api.$("#conferenceroom_popup").off("popupafterclose"),PickContact(InitiateConference)})})}catch(a){PutToDebugLogException(2,"common: InitiateConference",a)}}function SendConferenceInvites(e,o){function n(){try{var e=GetParameter2("webrtcgwsipaddress");if(!isNull(e)&&e.length>2)return e;if((!0===webphone_api.global.decideusuk_finished||isNull(apikey)||apikey.length<1)&&webphone_api.global.usuk.length>0){if("uk"===webphone_api.global.usuk)return"rtc.mizu-voip.com";if("us"===webphone_api.global.usuk)return"usrtcx.webvoipphone.com"}var o=GetParameter2("serveraddress_user");if((isNull(o)||o.length<2)&&(o=GetParameter2("serveraddress")),isNull(o)||o.length<2)return"";var n=GetWebrtcSrvAddr();if(isNull(n)||n.length<2)return"";var t=n.indexOf("//");t>0&&(n=n.substr(t+2));var t=n.indexOf("/");if(t>0&&(n=n.substr(0,t)),isNull(n)||n.length<2)return"";if(o.indexOf(n)>=0)return o}catch(i){PutToDebugLogException(2,"common: GetWebRTCServerSIPAddress",i)}return""}try{var t=GetParameterInt("conferencerooms",-1),i=GetParameterInt("conferencetype",-1);i<0&&(i=1==t?5:2==t?6:3==t?7:1);var a=webphone_api.common.GetSipHeaderInternal("X-UT");webphone_api.common.isNull(a)&&(a=""),a=webphone_api.common.Trim(a),o.indexOf("@")<0&&"g"===a&&n().length>0&&(o=o+"@"+n());var r="[DONT_START_CHAT_WINDOW][CONFERENCE] You are invited to conference by: "+GetSipusername()+". Call this number to join the conference: "+o,l=e.split(",");if(isNull(l)||l.length<1)return;for(var p=0;p<l.length;)isNull(l[p])||l[p].length<1?l.splice(p,1):p++;var s=Trim(l[0]);i<6?(PutToDebugLog(2,"EVENT, mlogic API_SendCaht SendConferenceInvites"),webphone_api.sendchat(s,r)):6===i?(PutToDebugLog(2,"EVENT, mlogic API_SendChat SendConferenceInvites 2"),webphone_api.sendchat(s,r)):7===i&&function(){function e(){isNull(cftimer)||clearInterval(cftimer),cftimer=null}try{if(null===cftimer){var n=0,t=0;cftimer=setInterval(function(){if(++cfmaxloop>90)return void e();n<1?(n=1,!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, ConfRoom: hangup active call"),PutToDebugLog(2,"EVENT, mlogic API_Hangup HanleConfTransfer"),webphone_api.hangup())):cfmaxloop>2&&1===n?(PutToDebugLog(2,"EVENT, ConfRoom: call destination: "+s),PutToDebugLog(2,"EVENT, mlogic API_Call HanleConfTransfer: "+s),webphone_api.call(s),n=2):2===n?!0===webphone_api.global.checkIfCallActive&&(PutToDebugLog(2,"EVENT, ConfRoom: destination accepted the call"),n=3,cfmaxloop>40&&(cfmaxloop=10)):3===n?(PutToDebugLog(2,"EVENT, ConfRoom: transfer call: "+o),PutToDebugLog(2,"EVENT, mlogic API_Transfer HanleConfTransfer: "+o),webphone_api.transfer(o),n=5,t=cfmaxloop+5):5===n&&t<cfmaxloop&&(PutToDebugLog(2,"EVENT, ConfRoom: call conf room: "+o),PutToDebugLog(2,"EVENT, mlogic API_Call HanleConfTransfer 2: "+o),webphone_api.call(o),e())},330)}}catch(i){PutToDebugLogException(2,"common: HanleConfTransfer",i)}}()}catch(c){PutToDebugLogException(2,"common: SendConferenceInvites",c)}}function ReceivedConferenceInvite(e,o){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220;var t=o.lastIndexOf(":");t>0&&(o=o.substring(t+1));var i=Trim(o);o=webphone_api.stringres.get("confroom_inv_msg")+": "+e;var a='<div id="conferenceinvite_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("confroom_inv_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+o+'</span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_accept")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_reject")+"</a></div></div>";Beep("1"),webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition")}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}}),PutToDebugLog(2,"EVENT, mlogic API_SendChat ReceivedConferenceInvite"),webphone_api.sendchat(e,"[DONT_START_CHAT_WINDOW][CONFERENCE_ANSWER]"),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, ReceivedConferenceInvite ok onclick"),webphone_api.$("#conferenceinvite_popup").on("popupafterclose",function(e){webphone_api.global.isconfcall=!0,
PutToDebugLog(2,"EVENT, mlogic API_Call ReceivedConferenceInvite: "+i),webphone_api.call(i)})}),webphone_api.$("#adialog_negative").on("click",function(e){})}catch(r){PutToDebugLogException(2,"common: ReceivedConferenceInvite",r)}}function IsServiceUpToDate(){try{if(webphone_api.global.nsupdatepending)return;var e=GetParameterInt("autosrvupgrade",1),o=GetParameterInt("nsupgrademode",1);if((e<1||!0===serviceupdatechecked||0===o)&&o<2)return;WinAPI("extcmd_version",function(n){if(isNull(n)||n.indexOf("ERROR:")>=0)return void PutToDebugLog(2,"ERROR, IsServiceUpToDate: "+n);var t=GetMinServiceVersion(),i=0,a=n,r=a.indexOf("version:");if(r>0&&(a=a.substring(r+8)),r=a.indexOf("eov"),r>0&&(a=a.substring(0,r)),a=Trim(a),!isNull(a)&&IsNumber(a))(i=StrToInt(a))>0&&SaveParameter("srvupgrade_currversion",i);else if(PutToDebugLog(2,"ERROR, IsServiceUpToDate, received data is ivalid: "+a),o<2)return;var l=GetConfig("confighash");isNull(l)&&(l="");var p="";WinAPI("API_GetConfigHash",function(n){if(isNull(n)&&(n=""),p=Trim(n),serviceupdatechecked=!0,t>i||32===l.length&&32===p.length&&l!==p){var a=!0;if(1===e){var r=GetParameterInt("srvupgrade_count",0);r<3?(a=!1,PutToDebugLog(2,"EVENT, native service upgrade skipped because count: "+r.toString()),r++):r=0,SaveParameter("srvupgrade_count",r)}var s=GetParameter("srvupgrade_version"),c=i.toString()+"_"+t.toString();s===c&&(a=!1),2===o&&(a=!0),PutToDebugLog(2,"EVENT, native service upgrade sv: "+s+" : "+c),!0===a&&(SaveParameter("srvupgrade_version",c),EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0)}})})}catch(n){PutToDebugLogException(2,"common: IsServiceUpToDate",n)}}function GetMinServiceVersion(){try{var e=webphone_api.global.minimumserviceversion,o=webphone_api.parameters.minserviceversion;return!isNull(o)&&IsNumber(o)&&(e=StrToInt(o)),o=GetConfig("minserviceversion"),!isNull(o)&&IsNumber(o)&&StrToInt(o)>e&&(e=StrToInt(o)),e}catch(n){PutToDebugLogException(2,"common: GetMinServiceVersion",n)}return 0}function GetAudioBandwidth(){try{var e=64,o=GetParameter2("audio_bandwidth");if(!isNull(o)&&IsNumber(o)){var n=StrToInt(o);n>=0&&n<2049&&(e=n)}return e}catch(t){PutToDebugLogException(2,"common: GetAudioBandwidth",t)}return 0}function GetVideoBandwidth(){try{var e=256,o=GetParameter2("video_bandwidth");if(!isNull(o)&&IsNumber(o)){var n=StrToInt(o);n>=0&&n<4e3&&(e=n)}return e}catch(t){PutToDebugLogException(2,"common: GetVideoBandwidth",t)}return 0}function GetVideoWidth(){try{var e=320,o=GetParameter2("video_width");if(!isNull(o)&&IsNumber(o)){var n=StrToInt(o);n>0&&n<4e3&&(e=n)}return e}catch(t){PutToDebugLogException(2,"common: GetVideoWidth",t)}return 0}function GetVideoHeight(){try{var e=240,o=GetParameter2("video_height");if(!isNull(o)&&IsNumber(o)){var n=StrToInt(o);n>0&&n<4e3&&(e=n)}return e}catch(t){PutToDebugLogException(2,"common: GetVideoHeight",t)}return 0}function EngineSwitchConference(e,o,n,t){try{SaveParameter("conf_engineswitcheoffered","true"),PutToDebugLog(2,"EVENT, EngineSwitchConference called");var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var a="Conferencing is not available for WebRTC. If this functionality is important for you, we recommend to use "+GetEngineDisplayName(e)+" engine.<br /><br />Would you like to switch to "+GetEngineDisplayName(e)+" engine ?",r='<div data-role="popup" id="conf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("switch_engine")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+a+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";t=t||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e+100&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),t()}}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, EngineSwitchConference cancel click"),n(o)}),webphone_api.$("#adialog_positive").on("click",function(o){PutToDebugLog(5,"EVENT, EngineSwitchConference ok click, engine: "+e),webphone_api.$("#conf_switch_popup").on("popupafterclose",function(o){if(PutToDebugLog(2,"EVENT, EngineSwitchConference hangup active call"),!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, mlogic API_Hangup EngineSwitchConference"),webphone_api.hangup()),"java"===e){webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("java");n.clicked=2,SetEngine("java",n),OpenSettings(!0,6),setTimeout(function(){InstallJavaPopup(!1)},400)}else{SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("ns");n.clicked=2,SetEngine("ns",n),EngineSelect(1,24),webphone_api.common.EngineForcedInstall("ns","",function(){webphone_api.startInner()})}})})}catch(l){PutToDebugLogException(2,"common: EngineSwitchConference",l)}}function EngineSwitchTransfer(e,o,n,t){try{SaveParameter("transf_engineswitcheoffered","true"),PutToDebugLog(2,"EVENT, EngineSwitchTransfer called");var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var a="Transfer with WebRTC works only between WebRTC endpoints. If this functionality is important for you, we recommend to use "+GetEngineDisplayName(e)+" engine.<br /><br />Would you like to switch to "+GetEngineDisplayName(e)+" engine ?",r='<div data-role="popup" id="transf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("switch_engine")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+a+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";t=t||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e+100&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),t()}}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, EngineSwitchTransfer cancel click"),n(o)}),webphone_api.$("#adialog_positive").on("click",function(o){PutToDebugLog(5,"EVENT, EngineSwitchTransfer ok click, engie: "+e),webphone_api.$("#transf_switch_popup").on("popupafterclose",function(o){if(PutToDebugLog(2,"EVENT, EngineSwitchTransfer hangup active call"),!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, mlogic API_Hangup EngineSwitchTransfer"),webphone_api.hangup()),"java"===e){webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("java");n.clicked=2,SetEngine("java",n),OpenSettings(!0,7),setTimeout(function(){InstallJavaPopup(!1)},400)}else{webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("ns");n.clicked=2,SetEngine("ns",n),setTimeout(function(){NPDownloadAndInstall()},400);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}})})}catch(l){PutToDebugLogException(2,"common: EngineSwitchTransfer",l)}}function HideSettings(e,o,n,t){try{if(isNull(enableoptions)){enableoptions=[];var i="";!isNull(webphone_api.parameters.enableoptions)&&webphone_api.parameters.enableoptions.length>0&&(i=webphone_api.parameters.enableoptions),(isNull(i)||i.length<2)&&(i=GetConfig("enableoptions")),!isNull(i)&&i.length>0&&(i=Trim(i),enableoptions=i.split(",")),isNull(enableoptions)&&(enableoptions=[])}if(isNull(disableoptions)){disableoptions=[];var i="";!isNull(webphone_api.parameters.disableoptions)&&webphone_api.parameters.disableoptions.length>0&&(i=webphone_api.parameters.disableoptions),(isNull(i)||i.length<2)&&(i=GetConfig("disableoptions")),!isNull(i)&&i.length>0&&(i=Trim(i),disableoptions=i.split(",")),isNull(disableoptions)&&(disableoptions=[])}if(isNull(e)&&(e=""),isNull(o)&&(o=""),isNull(n)&&(n=""),isNull(t)&&(t=!1),enableoptions.length>0&&(e.length>0||o.length>0||n.length>0)){e=e.toLowerCase(),o=o.toLowerCase(),n=n.toLowerCase();for(var a=0;a<enableoptions.length;a++){var r=enableoptions[a];if(!(isNull(r)||r.length<1)&&(r=r.toLowerCase(),e.indexOf(r)>=0||r===o||r===n))return!1}return!0}if(disableoptions.length>0&&(e.length>0||o.length>0||n.length>0)){e=e.toLowerCase(),o=o.toLowerCase(),n=n.toLowerCase();for(var a=0;a<disableoptions.length;a++){var r=disableoptions[a];if(!(isNull(r)||r.length<1)&&(r=r.toLowerCase(),e.indexOf(r)>=0||r===o||r===n))return!0!==t||!!StrIsUpperCase(disableoptions[a])}}}catch(l){PutToDebugLogException(2,"common: HideSettings",l)}return!1}function ShowRatingWhyleType(e){try{if(webphone_api.global.showratewhiletype_cache<1||isNull(e)||e.length<1)return;webphone_api.$("#disprate_container").html(e)}catch(o){PutToDebugLogException(2,"common: ShowRatingWhyleType",o)}}function SetLanguage(){try{var e=webphone_api.parameters.language;if((isNull(e)||2!==e.length)&&(e=GetConfig("language")),(isNull(e)||2!==e.length)&&(e=GetParameter("language")),isNull(e))return void PutToDebugLog(2,"EVENT, common: SetLanguage invalid language: "+e);2===e.length&&(webphone_api.stringres.setlang(e),CanLog(3)&&PutToDebugLog(3,"EVENT, language set to: "+e))}catch(o){PutToDebugLogException(2,"common: SetLanguage",o)}}function SetNotCounter(e,o){try{if(isNull(e)||e.length<1)return;var n=document.getElementById(e);if(isNull(n))return;!isNull(o)&&o.length>0&&IsNumber(o)&&"0"!=o?(n.innerHTML=o,n.style.display="block"):(n.innerHTML="",n.style.display="none")}catch(t){PutToDebugLogException(2,"common: SetNotCounter",t)}}function WebContactGet(e,o){try{if(isNull(webct_url)&&(webct_url=GetParameter2("webcontact_url"),(isNull(webct_url)||webct_url.length<3)&&(webct_url=GetConfig("webcontact_url")),isNull(webct_url)&&(webct_url="")),webct_url.length<3)return;if(isNull(e)||e.length<1)return void PutToDebugLog(3,"WARNING, common WebContactGet invalid number: "+e);if(!o||"function"!=typeof o)return void PutToDebugLog(3,"ERROR, common WebContactGet callback is NULL");var n=webct_url.replace("CALLEDNUMBER",e);webct_cb.push(o),UriParser(n,"","","","","webcontactsearch")}catch(t){PutToDebugLogException(2,"common: WebContactGet",t)}}function WebContactReceived(e){try{if(isNull(webct_cb)||webct_cb.length<1)return void PutToDebugLog(3,"ERROR, common WebContactReceived no callback specified");var o=webct_cb.shift();if(isNull(o)||!o||"function"!=typeof o)return void PutToDebugLog(3,"ERROR, common WebContactReceived invalid callback");if(isNull(e)||e.length<2)return void PutToDebugLog(3,"WARNING, common WebContactReceived invalid data: "+e);var n=[];if(webct_url.toLowerCase().indexOf("tel.search.ch")>=0){var t=e.split("</entry>");if(!isNull(t)&&t.length>0)for(var i=0,a=0;a<t.length;a++)if(!((i=t[a].indexOf("<entry>"))<0)){var r=t[a].substring(i),l="",p="",i=r.indexOf("<tel:name>");i>0&&(l=r.substring(i+10),i=l.indexOf("</tel:name>"),i>0&&(l=l.substring(0,i)),isNull(l)&&(l=""),l=Trim(l)),i=r.indexOf("<tel:phone>"),i>0&&(p=r.substring(i+11),i=p.indexOf("</tel:phone>"),i>0&&(p=p.substring(0,i)),isNull(p)&&(p=""),p=Trim(p)),n.push(l+","+p)}}n.length<1&&n.push(e),o(n)}catch(s){PutToDebugLogException(2,"common: WebContactReceived",s)}}function IsXML(e){try{webphone_api.$.parseXML(e);return!0}catch(o){}return!1}function GetLastRecInvite(){return isNull(saved_lastrecinvite)&&(saved_lastrecinvite=""),saved_lastrecinvite}function GetLastSentInvite(){return isNull(saved_lastsentinvite)&&(saved_lastsentinvite=""),saved_lastsentinvite}function SaveCallSession(e,o,n,t,i,a,r,l,p,s,c,u,g,m,b){var h=-5;try{var d=-1;null===e||((void 0===e||e.length<1)&&(e=webphone_api.global.aline.toString(),e=Trim(e)),StrToInt(e)<1&&(e=GetBestLine().toString())),isNull(n)&&(n=""),n=Trim(n),(isNull(t)||"1"!=t&&"2"!=t)&&(t=""),t=Trim(t),(isNull(i)||!1===IsNumber(i))&&(i=-1),(isNull(a)||!1===IsNumber(a))&&(a=-1),(isNull(r)||!1===IsNumber(r))&&(r=-1),(isNull(l)||l.length<1)&&(l=""),l=Trim(l),(isNull(p)||p.length<1)&&(p=""),p=Trim(p),p=p.toLowerCase(),(isNull(s)||s.length<1)&&(s=""),(isNull(c)||c.length<1)&&(c=""),(isNull(g)||"true"!==g&&"false"!==g)&&(g=""),(isNull(m)||"true"!==m&&"false"!==m)&&(m=""),(isNull(b)||b.length<10)&&(b=""),!isNull(u)&&u.length<1&&(u=null),b.length>10&&("1"===t?saved_lastsentinvite=b:"2"===t&&(saved_lastrecinvite=b));for(var _=0;_<webphone_api.global.ep.length;_++)if(isNull(webphone_api.global.ep[_])||webphone_api.global.ep[_].length<5){var w="NULL";isNull(webphone_api.global.ep[_])||(w=webphone_api.global.ep[_].toString()),PutToDebugLog(2,"ERROR, common: SaveCallSession remove invalid endpoint_1: "+w),webphone_api.global.ep.splice(_,1),_--}else{var f=webphone_api.global.ep[_][EP_LINE],v=webphone_api.global.ep[_][EP_CALLID];if((null!==e&&f==e||!isNull(v)&&v.length>0&&v==p)&&!isNull(webphone_api.global.ep[_][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){d=_;break}}if(null===e&&d<0&&n.length>0)for(var _=0;_<webphone_api.global.ep.length;_++)if(isNull(webphone_api.global.ep[_])||webphone_api.global.ep[_].length<5){var w="NULL";isNull(webphone_api.global.ep[_])||(w=webphone_api.global.ep[_].toString()),PutToDebugLog(2,"ERROR, common: SaveCallSession remove invalid endpoint_2: "+w),webphone_api.global.ep.splice(_,1),_--}else{var P=webphone_api.global.ep[_][EP_DESTNR];if(P==n&&!isNull(webphone_api.global.ep[_][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){if("1"!=t&&"2"!=t){d=_;break}if(t===webphone_api.global.ep[_][EP_INCOMING]){d=_;break}}}if(d>-1){var E=webphone_api.global.ep[d][EP_LINE];if(isNull(E)&&(E=""),E=E.toString(),null!==e&&(E.length<1||null===StrToInt(E))){StrToInt(e)>0&&(webphone_api.global.ep[d][EP_LINE]=e)}isNull(o)||(webphone_api.global.ep[d][EP_SESSION]=o),n.length>0&&(webphone_api.global.ep[d][EP_DESTNR]=n),1===t.length&&(webphone_api.global.ep[d][EP_INCOMING]=t),i>0&&(webphone_api.global.ep[d][EP_SETUPTIME]=i),(a>0||a<-2)&&(webphone_api.global.ep[d][EP_CONNECTTIME]=a),(r>0||r<-2)&&(webphone_api.global.ep[d][EP_DISCONNECTTIME]=r),(l.length>0||r<-2)&&(webphone_api.global.ep[d][EP_REASON]=l),p.length>0&&webphone_api.global.ep[d][EP_CALLID].length<5&&(webphone_api.global.ep[d][EP_CALLID]=p),s.length>0&&(webphone_api.global.ep[d][EP_SETUPSENT]=s),c.length>0&&(webphone_api.global.ep[d][EP_FINISHEDSENT]=c),isNull(u)||(webphone_api.global.ep[d][EP_SIPHEADERS]=u),"true"!==g&&"false"!==g||(webphone_api.global.ep[d][EP_MUTESTATE]=g),"true"!==m&&"false"!==m||(webphone_api.global.ep[d][EP_HOLDSTATE]=m),b.length>10&&(webphone_api.global.ep[d][EP_SIPINVITE]=b);try{("undefined"==typeof webphone_api.global.ep[d][EP_SESSID]||null===webphone_api.global.ep[d][EP_SESSID]||webphone_api.global.ep[d][EP_SESSID].length<1)&&void 0!==o&&null!==o&&"undefined"!=typeof o.o_session&&null!==o.o_session&&"undefined"!=typeof o.o_session.__i_session_id&&null!==o.o_session.__i_session_id&&(webphone_api.global.ep[d][EP_SESSID]=o.o_session.__i_session_id)}catch(I){PutToDebugLogException(2,"common: SaveCallSession inner sessionID 1",I)}webphone_api.global.ep[d][EP_FLAGDEL]="false",h=StrToInt(webphone_api.global.ep[d][EP_LINE]),!isNull(h)&&IsNumber(h)||(h=-5);var T=b;T.length>50&&(T=T.substring(0,50)),PutToDebugLog(4,"EVENT, common: SaveCallSession endpoint updated, line: "+webphone_api.global.ep[d][EP_LINE]+"; destnr: "+n+"; isincoming: "+t+"; callid: "+p+"; setuptime: "+i+"; connecttime: "+a+"; disctime: "+r+"; setupsent: "+s+"; finishedsent: "+c+"; mutestate: "+g+"; holdstate: "+m+"; sipinvite: "+T)}else{"true"!==g&&"false"!==g&&(g="false"),"true"!==m&&"false"!==m&&(m="false"),(isNull(e)||e.length<1)&&(e=webphone_api.global.aline.toString()),StrToInt(e)<1&&(e=GetBestLine().toString()),h=StrToInt(e);var N="";try{void 0!==o&&null!==o&&"undefined"!=typeof o.o_session&&null!==o.o_session&&"undefined"!=typeof o.o_session.__i_session_id&&null!==o.o_session.__i_session_id&&(N=o.o_session.__i_session_id)}catch(I){PutToDebugLogException(2,"common: SaveCallSession inner sessionID 2",I)}var S=[e,o,n,t,i,a,r,l,p,"false",s,c,u,g,m,b,N];isNull(webphone_api.global.ep)&&(webphone_api.global.ep=[]),webphone_api.global.ep.push(S);var T=b;T.length>50&&(T=T.substring(0,50)),PutToDebugLog(4,"EVENT, common: SaveCallSession new endpoint added, line: "+e+"; destnr: "+n+"; isincoming: "+t+"; callid: "+p+"; setuptime: "+i+"; connecttime: "+a+"; disctime: "+r+"; setupsent: "+s+"; finishedsent: "+c+"; mutestate: "+g+"; holdstate: "+m+"; sipinvite: "+T+"; sessionID: "+N)}!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons()}catch(R){PutToDebugLogException(2,"common: SaveCallSession",R)}return h}function GetLineForJavaAPI(e,o){if(!isNull(e)&&IsNumber(e)){var n=StrToInt(e);if(!isNull(n)&&(-3===n&&(n=-1),n>=-2))return n}if(webphone_api.global.lastalinesetreal>=-2&&webphone_api.global.lastalinesetreal===webphone_api.global.aline)return webphone_api.global.lastalinesetreal;if(webphone_api.global.lastalinesetreal>=-2&&0!=webphone_api.global.lastalinesetrealtick&&GetTickCount()-webphone_api.global.lastalinesetrealtick<300&&GetTickCount()-webphone_api.global.lastalinesetrealtick>=0)return webphone_api.global.lastalinesetreal;if(webphone_api.global.lastalineset>=-2&&0!=webphone_api.global.lastalinesettick&&GetTickCount()-webphone_api.global.lastalinesettick<5e3&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset;if(webphone_api.global.lastalinesetreal>=-2&&0!=webphone_api.global.lastalinesetrealtick&&GetTickCount()-webphone_api.global.lastalinesetrealtick<600&&GetTickCount()-webphone_api.global.lastalinesetrealtick>=0)return webphone_api.global.lastalinesetreal;if(webphone_api.global.lastalineset>=-2&&webphone_api.global.lastalineset===webphone_api.global.aline&&0!=webphone_api.global.lastalinesettick&&GetTickCount()-webphone_api.global.lastalinesettick<4e4&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset;if(isNull(o)||-3===o){if((-1===webphone_api.global.lastalineset||-2===webphone_api.global.lastalineset)&&GetTickCount()-webphone_api.global.lastalinesettick<1e4&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset;if(-1===webphone_api.global.lastalinesetreal||-2===webphone_api.global.lastalinesetreal)return webphone_api.global.lastalinesetreal;if(-1===webphone_api.global.lastalineset||-2===webphone_api.global.lastalineset)return webphone_api.global.lastalineset;if(webphone_api.global.lastalineset>=-2&&0!=webphone_api.global.lastalinesettick&&GetTickCount()-webphone_api.global.lastalinesettick<1e4&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset}return-2===o||-1===o?o:webphone_api.global.aline}function GetCallSession(e,o,n,t,i,a,r){var l=GetCallEpIdx(e,o,n,t,i,a,r);if(l>=0){var p=webphone_api.global.ep[l][EP_SESSION];return isNull(p)||p===r?i:p}return i}function GetCallEpIdx(e,o,n,t,i,a,r){try{if(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return webphone_api.global.ep=[],!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),-1;if(isNull(n)&&(n=""),n=Trim(n),(isNull(a)||"1"!=a&&"2"!=a)&&(a=1===a?"1":2===a?"2":"1"),a=Trim(a),(isNull(t)||t.length<1)&&(t=""),t=Trim(t),t=t.toLowerCase(),t.length>0)for(var l=0;l<webphone_api.global.ep.length;l++)if(isNull(webphone_api.global.ep[l])||webphone_api.global.ep[l].length<5){var p="NULL";isNull(webphone_api.global.ep[l])||(p=webphone_api.global.ep[l].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_0: "+p),webphone_api.global.ep.splice(l,1),l--}else{var s=webphone_api.global.ep[l][EP_CALLID];if(!isNull(s)&&s.length>0&&s==t&&!isNull(webphone_api.global.ep[l][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){var c=webphone_api.global.ep[l][EP_SESSION];if(isNull(c)||c===r)continue;return e&&(webphone_api.global.ep[l][EP_FLAGDEL]="true"),"2"==a&&(webphone_api.global.ep[l][EP_INCOMING]="2"),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),l}}if(isNull(o)||(o=Trim(o)),!isNull(o)&&o.length>0){if("2"==a)for(var l=0;l<webphone_api.global.ep.length;l++)if(isNull(webphone_api.global.ep[l])||webphone_api.global.ep[l].length<5){var p="NULL";isNull(webphone_api.global.ep[l])||(p=webphone_api.global.ep[l].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_11: "+p),webphone_api.global.ep.splice(l,1),l--}else{var u=webphone_api.global.ep[l][EP_LINE];if(u==o&&"2"===webphone_api.global.ep[l][EP_INCOMING]&&!isNull(webphone_api.global.ep[l][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){var c=webphone_api.global.ep[l][EP_SESSION];if(isNull(c)||c===r)continue;return e&&(webphone_api.global.ep[l][EP_FLAGDEL]="true"),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),l}}for(var l=0;l<webphone_api.global.ep.length;l++)if(isNull(webphone_api.global.ep[l])||webphone_api.global.ep[l].length<5){var p="NULL";isNull(webphone_api.global.ep[l])||(p=webphone_api.global.ep[l].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_1: "+p),webphone_api.global.ep.splice(l,1),l--}else{var u=webphone_api.global.ep[l][EP_LINE];if(u==o&&!isNull(webphone_api.global.ep[l][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){var c=webphone_api.global.ep[l][EP_SESSION];if(isNull(c)||c===r)continue;return e&&(webphone_api.global.ep[l][EP_FLAGDEL]="true"),"2"==a&&(webphone_api.global.ep[l][EP_INCOMING]="2"),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),l}}}if(n.length>0)for(var l=0;l<webphone_api.global.ep.length;l++)if(isNull(webphone_api.global.ep[l])||webphone_api.global.ep[l].length<5){var p="NULL";isNull(webphone_api.global.ep[l])||(p=webphone_api.global.ep[l].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_2: "+p),webphone_api.global.ep.splice(l,1),l--}else{var g=webphone_api.global.ep[l][EP_DESTNR];if(g==n&&"true"!==webphone_api.global.ep[l][EP_FLAGDEL]&&!isNull(webphone_api.global.ep[l][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){var c=webphone_api.global.ep[l][EP_SESSION];if(isNull(c)||c===r)continue;return e&&(webphone_api.global.ep[l][EP_FLAGDEL]="true"),"2"==a&&(webphone_api.global.ep[l][EP_INCOMING]="2"),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),l}}if(isNull(o)||o.length<1){if(o=webphone_api.global.aline.toString(),o=Trim(o),"2"==a)for(var l=0;l<webphone_api.global.ep.length;l++)if(isNull(webphone_api.global.ep[l])||webphone_api.global.ep[l].length<5){var p="NULL";isNull(webphone_api.global.ep[l])||(p=webphone_api.global.ep[l].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_11: "+p),webphone_api.global.ep.splice(l,1),l--}else{var u=webphone_api.global.ep[l][EP_LINE];if(u==o&&"2"===webphone_api.global.ep[l][EP_INCOMING]&&!isNull(webphone_api.global.ep[l][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){var c=webphone_api.global.ep[l][EP_SESSION];if(isNull(c)||c===r)continue;return e&&(webphone_api.global.ep[l][EP_FLAGDEL]="true"),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),l}}for(var l=0;l<webphone_api.global.ep.length;l++)if(isNull(webphone_api.global.ep[l])||webphone_api.global.ep[l].length<5){var p="NULL";isNull(webphone_api.global.ep[l])||(p=webphone_api.global.ep[l].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_1: "+p),webphone_api.global.ep.splice(l,1),l--}else{var u=webphone_api.global.ep[l][EP_LINE];if(u==o&&!isNull(webphone_api.global.ep[l][EP_SESSION]||getuseengine()!==webphone_api.global.ENGINE_WEBRTC)){var c=webphone_api.global.ep[l][EP_SESSION];if(isNull(c)||c===r)continue;return e&&(webphone_api.global.ep[l][EP_FLAGDEL]="true"),"2"==a&&(webphone_api.global.ep[l][EP_INCOMING]="2"),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),l}}}if(webphone_api.global.ep.length<1)return PutToDebugLog(2,"EVENT, common: GetCallSession no global session found a"),-1;if(webphone_api.global.loglevel>0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC){var c=webphone_api.global.ep[0][EP_SESSION];if(isNull(c))return PutToDebugLog(2,"WARNING, common: GetCallSession no global session found for webrtc"),0}return PutToDebugLog(2,"EVENT, common: GetCallSession returning guessed session"),0}catch(m){PutToDebugLogException(2,"common: GetCallSession",m)}try{if(webphone_api.global.ep.length>0)return 0}catch(m){}return-1}function FixSessionId(e,o){return e}function GetEndpoint(e,o,n,t,i){try{if((isNull(e)||e.length<1)&&(e=webphone_api.global.aline),e=Trim(e),e=e.toString(),isNull(o)&&(o=""),o=Trim(o),(isNull(n)||n.length<1)&&(n=""),n=Trim(n),n=n.toLowerCase(),isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),webphone_api.global.aline=1,null;if(!0!==i)for(var a=0;a<webphone_api.global.ep.length;a++)if(!(isNull(webphone_api.global.ep[a])||webphone_api.global.ep[a].length<5)){var r=webphone_api.global.ep[a][EP_LINE],l=webphone_api.global.ep[a][EP_CALLID];if(r==e||!isNull(l)&&l.length>0&&l==n){var p=webphone_api.global.ep[a];if(!0===t){if(webphone_api.global.ep.length<2&&webphone_api.global.ep[a][EP_DISCONNECTTIME].toString().length<4)return p;var s="NULL";isNull(webphone_api.global.ep[a])||(s=webphone_api.global.ep[a].toString()),!isNull(s)&&s.length>550&&(s=s.substring(0,550)),PutToDebugLog(2,"EVENT, common: GetEndpoint remove OLD endpoint_1: "+s),webphone_api.global.ep.splice(a,1)}return!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)&&(webphone_api.global.aline=1),p}}if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&n.toString().length>0&&n.toString().length<5)for(var a=0;a<webphone_api.global.ep.length;a++)if(!(isNull(webphone_api.global.ep[a])||webphone_api.global.ep[a].length<5)){var c=webphone_api.global.ep[a][EP_SESSID];if(c==n){var p=webphone_api.global.ep[a];if(!0===t){if(webphone_api.global.ep.length<2&&webphone_api.global.ep[a][EP_DISCONNECTTIME].toString().length<4)return p;var s="NULL";isNull(webphone_api.global.ep[a])||(s=webphone_api.global.ep[a].toString()),!isNull(s)&&s.length>550&&(s=s.substring(0,550)),PutToDebugLog(2,"EVENT, common: GetEndpoint remove OLD endpoint_2: "+s),webphone_api.global.ep.splice(a,1)}return!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)&&(webphone_api.global.aline=1),p}}if(o.length>0)for(var a=0;a<webphone_api.global.ep.length;a++)if(!(isNull(webphone_api.global.ep[a])||webphone_api.global.ep[a].length<5)){var u=webphone_api.global.ep[a][EP_DESTNR];if(u==o){var p=webphone_api.global.ep[a];if(!0===t){if(webphone_api.global.ep.length<2&&webphone_api.global.ep[a][EP_DISCONNECTTIME].toString().length<4)return p;var r=webphone_api.global.ep[a][EP_LINE];if(r==e){var s="NULL";isNull(webphone_api.global.ep[a])||(s=webphone_api.global.ep[a].toString()),!isNull(s)&&s.length>550&&(s=s.substring(0,550)),PutToDebugLog(2,"EVENT, common: GetEndpoint remove OLD endpoint_2: "+s),webphone_api.global.ep.splice(a,1)}}return!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)&&(webphone_api.global.aline=1),p}}(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)&&(webphone_api.global.aline=1)}catch(g){PutToDebugLogException(2,"common: GetEndpoint",g)}return null}function GetFreeLine(){try{for(var e=[],o=[],n=0;n<webphone_api.global.ep.length;n++){var t=webphone_api.global.ep[n][EP_LINE];if(!isNull(t)&&!1!==IsNumber(t)){var i=StrToInt(t);i>0&&(e.push(i),o.push(StrToInt(webphone_api.global.ep[n][EP_SETUPTIME])))}}for(var n=0;n<e.length;n++)for(var a=n+1;a<e.length;a++)if(e[n]>e[a]){var r=e[n];e[n]=e[a],e[a]=r,r=o[n],o[n]=o[a],o[a]=r}for(var l=GetTickCount(),p=1,n=0;n<e.length;n++)e[n]===p&&o[n]>0&&l-o[n]>1500&&p++;return PutToDebugLog(2,"EVENT, GetFreeLine returned: "+p.toString()),p}catch(s){PutToDebugLogException(2,"common: GetFreeLine",s)}return webphone_api.global.aline+1}function IsLineFree(e){try{if(e<1)return!1;for(var o=0;o<webphone_api.global.ep.length;o++){var n=webphone_api.global.ep[o][EP_LINE];if(!isNull(n)&&!1!==IsNumber(n)){var t=StrToInt(n);if(n=n.toString(),e=e.toString(),t>0&&n===e)return!1}}}catch(i){PutToDebugLogException(2,"common: GetFreeLine",i)}return!0}function GetBestLine(){var e=1;try{e=webphone_api.global.aline;for(var o=-10,n=0,t=-10,i=GetLineForJavaAPI(),a=webphone_api.global.ep.length-1;a>=0;a--){var r=webphone_api.global.ep[a];if(!(isNull(r)||r.length<5)&&("false"===r[EP_FLAGDEL]&&"true"!==r[EP_FINISHEDSENT]&&r[EP_DISCONNECTTIME].toString().length<4)){var l=StrToInt(r[EP_LINE]);if(IsNumber(r[EP_SETUPTIME])&&(n=StrToInt(r[EP_SETUPTIME])),l>0){if(l===i){t=l;break}if(i<1&&l===webphone_api.global.aline){t=l;break}o>0?0>=n&&(o=l,n=0):(o=l,n=0)}}}return t>0?t:o>0?o:webphone_api.global.aline<2?webphone_api.global.aline:1}catch(p){PutToDebugLogException(2,"common: GetBestLine",p)}return e}function GetLastCallEPIdx(){try{for(var e=-10,o=0,n=webphone_api.global.ep.length-1;n>=0;n--){var t=webphone_api.global.ep[n];if(!(isNull(t)||t.length<5)&&("false"===t[EP_FLAGDEL]&&"true"!==t[EP_FINISHEDSENT]&&t[EP_DISCONNECTTIME].toString().length<4)){IsNumber(t[EP_SETUPTIME])&&(o=StrToInt(t[EP_SETUPTIME])),e>0?0>=o&&(e=n,o=0):(e=n,o=0)}}return e}catch(i){PutToDebugLogException(2,"common: GetLastCallEPIdx",i)}return-1}
function GetNrOfActiveCalls(){try{for(var e=0,o=0;o<webphone_api.global.ep.length;o++){var n=webphone_api.global.ep[o][EP_DISCONNECTTIME];isNull(n)||(n=n.toString(),n.length<3&&e++)}return e}catch(t){PutToDebugLogException(2,"common: GetNrOfActiveCalls",t)}return webphone_api.global.acallcount}function GetPeerUsername(){try{for(var e=0;e<webphone_api.global.ep.length;e++){var o=webphone_api.global.ep[e][EP_DISCONNECTTIME];if(!isNull(o)){o=o.toString();var n=webphone_api.global.ep[e][EP_DESTNR];if(!isNull(n)&&(n=n.toString(),o.length<3&&n.length>0))return n}}}catch(t){PutToDebugLogException(2,"common: GetPeerUsername",t)}return""}function RefreshInfo(){try{if(!0===IsSDK()||!1===webphone_api.global.isCallStarted)return;var e=GetEndpoint(webphone_api.global.aline,"","",!1);if(isNull(e)||e.length<5)return;var o=e[EP_DESTNR],n="";!isNull(o)&&o.length>0&&(n=GetContactNameFromNumber(o),isNull(n)&&(n="")),n===o&&(n=""),n.length>0?webphone_api.$("#calledcaller").html(n+"&nbsp;("+o+")&nbsp;"):webphone_api.$("#calledcaller").html(o);var t=e[EP_SETUPTIME],i=e[EP_CONNECTTIME];"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?isNull(i)||i.length<3?!isNull(t)&&t.toString().length>2&&IsNumber(t)&&webphone_api.notifications.SetCallStartTime(StrToInt(t)):i.toString().length>2&&IsNumber(i)&&webphone_api.notifications.SetCallStartTime(StrToInt(i)):console&&console.log&&console.log("ERROR, common RefreshInfo webphone_api.notifications is not defined");var a=document.getElementById("mute_status"),r=document.getElementById("hold_status");if(isNull(a)||(!0===GetMuteState(StrToInt(e[EP_LINE]))?webphone_api.$(a).hasClass("callfunc_status_on")||webphone_api.$(a).addClass("callfunc_status_on"):webphone_api.$(a).hasClass("callfunc_status_on")&&webphone_api.$(a).removeClass("callfunc_status_on")),isNull(r)||(!0===GetHoldState(StrToInt(e[EP_LINE]))?webphone_api.$(r).hasClass("callfunc_status_on")||webphone_api.$(r).addClass("callfunc_status_on"):webphone_api.$(r).hasClass("callfunc_status_on")&&webphone_api.$(r).removeClass("callfunc_status_on")),!isNull(e)&&e.length>4){var l=!0;i.toString().length>2&&IsNumber(i)&&(l=!1);var p=!1;"2"!=e[EP_INCOMING]&&2!=e[EP_INCOMING]||(p=!0);var s=!1;"true"!=e[EP_FINISHEDSENT]&&1!=e[EP_FINISHEDSENT]||(s=!0),!0===p&&!0===l&&!1===s?(webphone_api.$("#hangup_layout").hide(),webphone_api.$("#callfunctions_layout").hide(),webphone_api.global.ep.length>1?(webphone_api.$("#acceptreject_layout").hide(),webphone_api.$("#mline_layout").show()):(webphone_api.$("#mline_layout").hide(),webphone_api.$("#acceptreject_layout").show())):(webphone_api.$("#acceptreject_layout").hide(),webphone_api.$("#mline_layout").hide(),webphone_api.$("#hangup_layout").show(),webphone_api.$("#callfunctions_layout").show())}}catch(c){PutToDebugLogException(2,"common: RefreshInfo",c)}}function GetRequestId(){try{return reqid_cached>0?(reqid_cached+=1,reqid_cached.toString()):(reqid_cached=RandomInt(5e3,9999999),reqid_cached.toString())}catch(e){PutToDebugLogException(2,"common: GetRequestId",e)}return GetTickCount().toString()}function IsMultiline(){try{var e=GetParameter2("multilinegui");if(isNull(e)||e.length<1)return-1;if(IsNumber(e)&&StrToInt(e),"true"===e.toLowerCase()||"1"==e)return 1;if("false"===e.toLowerCase())return 0}catch(o){PutToDebugLogException(2,"common: GetRequestId",o)}return-1}function GetTelsearchName(e,o){try{var n=GetParameter2("telsearchurl");if((isNull(n)||n.length<3)&&(n=webphone_api.parameters.telsearchurl),isNull(n)||n.length<3)return PutToDebugLog(2,"ERROR, GetTelsearchName invalid search url: "+n),void o("invalid search url: "+n);var t=NormalizeNumber(e);t=encodeURIComponent(t),n=n.replace("DESTINATION",t),telshearchcb.push(o),UriParser(n,"","","","","telsearchname")}catch(i){PutToDebugLogException(2,"common: GetTelsearchName",i)}}function TelSearchNameReceived(e){try{if(isNull(e)||e.length<10)return void PutToDebugLog(2,"ERROR, TelSearchNameReceived invalid data: "+e);PutToDebugLog(5,"EVENT,TelSearchNameReceived: "+e);var o=e.indexOf("<tel:name>");if(o>0){e=e.substring(o+10),o=e.indexOf("</tel:name>"),o>0&&(e=e.substring(0,o)),isNull(e)&&(e=""),e=Trim(e);var n=telshearchcb.shift();isNull(n)||"function"!=typeof n||(PutToDebugLog(2,"EVENT, TelSearchNameReceived name found: "+e),n(e))}}catch(t){PutToDebugLogException(2,"common: TelSearchNameReceived",t)}}function GetIceTimeout(){try{var e=GetParameter("icetimeout");if(isNull(webphone_api.parameters.icetimeout)||(e=webphone_api.parameters.icetimeout),!isNull(e)&&IsNumber(e)){var o=StrToInt(e);if(!isNull(o)&&o>0)return o<30&&(o*=1e3),o}}catch(n){PutToDebugLogException(2,"common: GetIceTimeout",n)}return 2e3}function ResetIce(){try{webphone_api.global.ice_callaccepted=!1,webphone_api.global.icecompleted=!1,isNull(webphone_api.global.ice_timer)||clearInterval(webphone_api.global.ice_timer),webphone_api.global.ice_timer=null}catch(e){PutToDebugLogException(2,"common: ResetIce",e)}}function GetNativeDialerUrl(e){var o="";try{return isNull(e)||e.length<1?(PutToDebugLog(2,"ERROR, GetNativeDialerUrl invalid OS"),""):("iOS"===e?(o=GetParameter2("ios_nativedialerurl"),(isNull(o)||o.length<3)&&(o="https://itunes.apple.com/us/app/mizuphone/id483685573")):(o=GetParameter2("android_nativedialerurl"),(isNull(o)||o.length<3)&&(o="https://play.google.com/store/apps/details?id=com.mizuvoip.mizudroid.app")),o)}catch(n){PutToDebugLogException(2,"common: ResetIce",n)}return""}function GetSessionId(){try{return isNull(sessionid_cache)?(sessionid_cache=RandomInt(1e3,9999999).toString(),sessionid_cache+=GetTickCount().toString()):sessionid_cache}catch(e){PutToDebugLogException(2,"common: GetSessionId",e)}return"1122334455"}function SetElementsSrc(){try{if(!0===IsSDK())return;var e=document.getElementById("phone_app_main_container");if(isNull(e))return void PutToDebugLog(2,"ERROR, common: SetElementsSrc app container is NULL");var o=webphone_api.getbasedir2();if(isNull(o))return void PutToDebugLog(2,"ERROR, common: SetElementsSrc base dir is NULL");var n=e.getElementsByTagName("img");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, common: SetElementsSrc image list is NULL");for(var t=0,i=n.length,a=0;a<i;a++)if(!isNull(n[a])){var r=n[a].src;isNull(r)||r.indexOf("images/")<0||(r=r.substring(r.indexOf("images/")),n[a].src=o+r,t++)}CanLog(2)&&PutToDebugLog(2,"EVENT, common: SetElementsSrc for: "+t.toString()+" images");var l=document.getElementById("android_frame");isNull(l)||isNull(l.style.background)||(l.style.background="url("+o+"images/android_frame.png) no-repeat #ffffff")}catch(p){PutToDebugLogException(2,"common: SetElementsSrc",p)}}function GetElementSource(){try{return isNull(elem_basedir)?(elem_basedir=webphone_api.getbasedir2(),isNull(elem_basedir)&&(elem_basedir=""),elem_basedir):elem_basedir}catch(e){PutToDebugLogException(2,"common: GetElementSource",e)}return""}function PlayDtmfSound(e){var o=0;try{if(isNull(e))return;if(playdtmfsound<0&&(playdtmfsound=GetParameterInt("playdtmfsound",1)),playdtmfsound<1)return;e=Trim(e);var n=IsWebphoneInIframe();if(!0===n&&"Edge"===GetBrowser())return;if(e.length>1&&playdtmfsound<2)return;if(!window.HTMLAudioElement)return void PutToDebugLog(2,"WARNING, PlayDtmfSound audio html element not supported in this browser: "+GetBrowser());if("*"===e?e="x":"#"===e&&(e="y"),!0===n){if(isNull(document.getElementById("dtmfsound"+e))){var t=webphone_api.getbasedir2(),i=e;"y"===i&&(i="diez");var a='<audio id="dtmfsound'+e+'"><source src="'+t+"sound/DTMF"+i+'.ogg" type="audio/ogg"><source src="'+t+"sound/DTMF"+i+'.mp3" type="audio/mpeg"></audio>';webphone_api.$("body").append(a)}}else if(isNull(document.getElementById("dtmfsound0"))){var t=webphone_api.getbasedir2(),r='<audio id="dtmfsound0"><source src="'+t+'sound/DTMF0.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF0.mp3" type="audio/mpeg"></audio><audio id="dtmfsound1"><source src="'+t+'sound/DTMF1.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF1.mp3" type="audio/mpeg"></audio><audio id="dtmfsound2"><source src="'+t+'sound/DTMF2.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF2.mp3" type="audio/mpeg"></audio><audio id="dtmfsound3"><source src="'+t+'sound/DTMF3.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF3.mp3" type="audio/mpeg"></audio><audio id="dtmfsound4"><source src="'+t+'sound/DTMF4.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF4.mp3" type="audio/mpeg"></audio><audio id="dtmfsound5"><source src="'+t+'sound/DTMF5.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF5.mp3" type="audio/mpeg"></audio><audio id="dtmfsound6"><source src="'+t+'sound/DTMF6.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF6.mp3" type="audio/mpeg"></audio><audio id="dtmfsound7"><source src="'+t+'sound/DTMF7.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF7.mp3" type="audio/mpeg"></audio><audio id="dtmfsound8"><source src="'+t+'sound/DTMF8.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF8.mp3" type="audio/mpeg"></audio><audio id="dtmfsound9"><source src="'+t+'sound/DTMF9.ogg" type="audio/ogg"><source src="'+t+'sound/DTMF9.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundy"><source src="'+t+'sound/DTMFdiez.ogg" type="audio/ogg"><source src="'+t+'sound/DTMFdiez.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundx"><source src="'+t+'sound/DTMFx.ogg" type="audio/ogg"><source src="'+t+'sound/DTMFx.mp3" type="audio/mpeg"></audio>';webphone_api.$("body").append(r)}o=5,e=ReplaceAll(e," ","");var l=e.split("");o=6,isNull(playtimer)||clearInterval(playtimer),playtimer=null;var p=0;o=7,playtimer=setInterval(function(){try{if(o=8,p>=l.length)return o=9,isNull(playtimer)||clearInterval(playtimer),void(playtimer=null);if(e=l[p],p++,o=10,isNull(audioElem)){if(o=11,audioElem=document.getElementById("dtmfsound"+e),o=12,isNull(audioElem))return o=13,void PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element a");o=14,audioElem.load(),o=15,audioElem.play(),o=16}else{if(o=20,audioElem.pause(),o=21,"undefined"!=typeof audioElem.currentTime&&null!==audioElem.currentTime&&(audioElem.currentTime=0),o=22,audioElem=document.getElementById("dtmfsound"+e),o=23,isNull(audioElem))return o=24,void PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element b");o=25,audioElem.load(),o=26;try{"undefined"!=typeof audioElem.currentTime&&null!==audioElem.currentTime&&(audioElem.currentTime=0)}catch(n){}o=27,audioElem.play(),o=28}}catch(t){PutToDebugLogException(2,"common: PlayDtmfSound inner Timer ("+o.toString()+")",t)}},300)}catch(s){PutToDebugLogException(2,"common: PlayDtmfSound",s)}}function GetLogLevel(){var e=1;try{var o=GetParameter("loglevel"),n=webphone_api.parameters.loglevel;return!isNull(o)&&1===o.length&&IsNumber(o)||(o="1"),!isNull(n)&&1===n.toString().length&&IsNumber(n)||(n="1"),StrToInt(o)>e&&(e=StrToInt(o)),(StrToInt(n)>e||0===StrToInt(n))&&(e=StrToInt(n)),e}catch(t){PutToDebugLogException(2,"common: GetLogLevel",t)}return 1}function GetHoldState(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var o=0;o<webphone_api.global.ep.length;o++){if(StrToInt(webphone_api.global.ep[o][EP_LINE])===e){var n=webphone_api.global.ep[o][EP_HOLDSTATE];return"true"!=n&&"false"!=n&&PutToDebugLog(2,"ERROR, GetHoldState invalid state: "+n.toString()),"true"==n}}}catch(t){PutToDebugLogException(2,"common: GetHoldState",t)}return!1}function GetMuteState(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var o=0;o<webphone_api.global.ep.length;o++){if(StrToInt(webphone_api.global.ep[o][EP_LINE])===e){var n=webphone_api.global.ep[o][EP_MUTESTATE];return"true"!=n&&"false"!=n&&PutToDebugLog(2,"ERROR, GetMuteState invalid state: "+n.toString()),"true"==n}}}catch(t){PutToDebugLogException(2,"common: GetMuteState",t)}return!1}function SetHoldState(e,o){try{if(e<1&&(e=GetBestLine()),e=StrToInt(e),isNull(o)&&(o=""),"true"!==(o=o.toString())&&"false"!==o)return PutToDebugLog(2,"ERROR, SetHoldState invalid state value: "+o),!1;for(var n=!1,t=0;t<webphone_api.global.ep.length;t++){StrToInt(webphone_api.global.ep[t][EP_LINE])===e&&(n=!0,webphone_api.global.ep[t][EP_HOLDSTATE]=o)}if(!1===n)return PutToDebugLog(2,"ERROR, SetHoldState cannot find endpoint for line: "+e.toString()),!1}catch(i){PutToDebugLogException(2,"common: SetHoldState",i)}return!0}function SetMuteState(e,o){try{if(e<1&&(e=GetBestLine()),e=StrToInt(e),isNull(o)&&(o=""),"true"!==(o=o.toString())&&"false"!==o)return PutToDebugLog(2,"ERROR, SetMuteState invalid state value: "+o),!1;for(var n=!1,t=0;t<webphone_api.global.ep.length;t++){StrToInt(webphone_api.global.ep[t][EP_LINE])===e&&(n=!0,webphone_api.global.ep[t][EP_MUTESTATE]=o)}if(!1===n)return PutToDebugLog(2,"ERROR, SetMuteState cannot find endpoint for line: "+e.toString()),!1}catch(i){PutToDebugLogException(2,"common: SetMuteState",i)}return!0}function IsIncomingCall(e){try{if(e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e),1===webphone_api.global.ep.length&&!isNull(webphone_api.global.ep[0])){var o=webphone_api.global.ep[0][EP_INCOMING];if("1"==o)return!1;if("2"==o)return!0}for(var n=0;n<webphone_api.global.ep.length;n++){var t=webphone_api.global.ep[n];if(!(isNull(t)||t.length<5)){if(StrToInt(t[EP_LINE])===e){var o=t[EP_INCOMING];if("1"==o)return!1;if("2"==o)return!0}}}for(var n=0;n<webphone_api.global.ep.length;n++){var t=webphone_api.global.ep[n];if(!(isNull(t)||t.length<5)&&("false"===t[EP_FLAGDEL]&&"true"!==t[EP_FINISHEDSENT]&&t[EP_DISCONNECTTIME].toString().length<4)){var o=t[EP_INCOMING];if("1"==o)return!1;if("2"==o)return!0}}}catch(i){PutToDebugLogException(2,"common: IsIncomingCall",i)}return webphone_api.global.incommingCall}function GetDiscReasonFromSignaling(e){function o(e){try{if(isNull(e))return"";var o=e.indexOf("text=");if(o>=0)return e=Trim(e.substring(o+5,e.length)),o=e.indexOf('"'),o<3&&(e=e.substring(o+1,e.length)),o=e.indexOf('"'),o>0&&(e=e.substring(0,o)),e=Trim(e);if((o=e.indexOf('"'))>=0&&(e=e.substring(o+1,e.length),(o=e.indexOf('"'))!==e.lastIndexOf('"')))return e=e.substring(o+1,e.length),o=e.indexOf('"'),o>0&&(e=e.substring(0,o)),isNull(e)&&(e=""),Trim(e)}catch(n){PutToDebugLogException(2,"notifications: GetText",n)}return""}try{CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 1"),webphone_api.getsipheader("X-reason",function(n){var t=o(n);if(t.length>0)return void e(t);CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 2"),webphone_api.getsipheader("Reason",function(n){var t=o(n);if(t.length>0)return void e(t);CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 3"),webphone_api.getsipheader("Warning",function(n){var t=o(n);e(t)})})})}catch(n){PutToDebugLogException(2,"common: GetDiscReasonFromSignaling",n),e("")}}function onc(){try{if(!LcAc(!1,!0))return!1;if(Te()){var e=[];e.push("T"),e.push("r"),e.push("i"),e.push("a"),e.push("l"),e.push(" "),e.push("e"),e.push("x"),e.push("p"),e.push("i"),e.push("r"),e.push("e"),e.push("d");var o=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+o)},1050),setTimeout(function(){PutToDebugLog(1,"ERROR, "+o),ShowToast("ERROR, "+o,15e3)},2050),!1}if(GtUct()<1&&GtUc().length>0){var e=[];e.push("T"),e.push("r"),e.push("i"),e.push("a"),e.push("l"),e.push(" "),e.push("e"),e.push("x"),e.push("p"),e.push("i"),e.push("r"),e.push("e"),e.push("d"),e.push("_"),e.push("8");var o=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+o)},1010),!1}return!0}catch(n){PutToDebugLogException(2,"common: onc",n)}return!1}function HandleScurlSetparameters(){try{if(!0===scurlsp_called)return;if(scurlsp_called=!0,!isNull(webphone_api)&&!isNull(webphone_api.parameters))var e=webphone_api.parameters.scurl_setparameters;!isNull(e)&&e.length>3&&(CallScriptingUrl(webphone_api.parameters.scurl_setparameters,"setParameters","","","","","waitforparameters"),setTimeout(function(){!1===webphone_api.global.startendelayed_wascalled&&(PutToDebugLog(2,"WARNING, StartEngine: waiting for parameters timeout, start engine anyway"),PutToDebugLog(2,"EVENT, mlogic API_Start HandleScurlSetparameters"),webphone_api.start())},10500))}catch(o){PutToDebugLogException(2,"common: HandleScurlSetparameters",o)}}function ParseSipAccounts(){try{webphone_api.global.sipaccounts=[];var e=GetParameter("extraregisteraccounts"),o=e,n=GetExtraRegAccFromAPIparam();if(isNull(n)&&(n=""),isNull(o)||o.length<3)return;var t=null;if(o.indexOf("#")>=0?(n.length>0&&(n="#"+n),o+=n,t=o.split("#")):(n.length>0&&(n=";"+n),o+=n,t=o.split(";")),!isNull(t)&&t.length>0){for(var i=0;i<t.length;i++)t[i].length<1&&(t.splice(i,1),i--);if(isNull(t)||t.length<1)return;if(1===t.length){var a=t[0].split(",");if(!isNull(a)&&a.length>3){var r=GetParameter("serveraddress_user");(isNull(r)||r.length<1)&&(r=GetParameter("serveraddress"));var l=GetSipusername(),p=GetParameter("password"),s=!1;if(!isNull(r)&&r.length>0&&!isNull(a[ACC_SERVER])&&a[ACC_SERVER].length>0&&r!==a[ACC_SERVER]&&"[MAIN]"+r!==a[ACC_SERVER]&&(a[ACC_SERVER]=r,s=!0),!isNull(l)&&l.length>0&&!isNull(a[ACC_USER])&&a[ACC_USER].length>0&&l!==a[ACC_USER]&&(a[ACC_USER]=l,s=!0),!isNull(p)&&p.length>0&&!isNull(a[ACC_PASSWORD])&&a[ACC_PASSWORD].length>0&&p!==a[ACC_PASSWORD]&&(a[ACC_PASSWORD]=p,s=!0),!0===s)return PutToDebugLog(2,"EVENT, ParseSipAccounts handling special case"),o=a.join(","),void SaveParameter("extraregisteraccounts",o)}}CanLog(2)&&PutToDebugLog(2,"EVENT, ParseSipAccounts extraregisteraccounts: "+o);for(var c=!0,u=0;u<t.length;u++)if(!(isNull(t[u])||t[u].length<4)){var g=t[u].split(",");if(!(isNull(g)||g.length<4)){var m=g[ACC_SERVER],b="",h="",d="",_="";if(g.length>ACC_CALLERID-2&&(b=g[ACC_CALLERID-2]),g.length>ACC_DISPLAYNAME-2&&(h=g[ACC_DISPLAYNAME-2]),g.length>ACC_PROXY-2&&(d=g[ACC_PROXY-2]),g.length>ACC_REALM-2&&(_=g[ACC_REALM-2]),isNull(b)&&(b=""),isNull(h)&&(h=""),isNull(d)&&(d=""),isNull(_)&&(_=""),!isNull(m)&&m.indexOf("[MAIN]")>=0){m=m.replace("[MAIN]",""),c=!0,SaveParameter("serveraddress_user",m);var b=GetParameter("username");GetParameter("sipusername");GetParameter("username").length>0&&GetParameter("sipusername").length<1?SaveParameter("username",g[ACC_USER]):SaveParameter("sipusername",g[ACC_USER]),SaveParameter("password",g[ACC_PASSWORD]);for(var i=0;i<webphone_api.global.sipaccounts.length;i++)webphone_api.global.sipaccounts[i].ismain=!1}var w=new ClassSipAccounts,f=!0;!isNull(m)&&m.indexOf("[DISABLED]")>=0?(m=m.replace("[DISABLED]",""),f=!1):g.length>=ACC_ENABLED&&"false"===g[ACC_ENABLED]&&(f=!1),w.enabled=f,w.serveraddress=m,w.username=g[ACC_USER],w.password=g[ACC_PASSWORD];var v=3600;g.length>=ACC_IVAL&&!isNull(g[ACC_IVAL])&&IsNumber(g[ACC_IVAL])&&(v=g[ACC_IVAL]),w.ival=StrToInt(v),w.ismain=!0===c,c=!1,w.callerid=b,w.displayname=h,w.proxyaddress=d,w.realm=_,webphone_api.global.sipaccounts.push(w)}}}return}catch(P){PutToDebugLogException(2,"common: ParseSipAccounts",P)}webphone_api.global.sipaccounts=[]}function SaveSipAccounts(){try{if(isNull(webphone_api.global.sipaccounts)||webphone_api.global.sipaccounts.length<1)return void SaveParameter("extraregisteraccounts","");var e=GetExtraRegAccFromAPIparam();isNull(e)&&(e="");var o=[];o=e.indexOf("#")>=0?e.split("#"):e.split(";"),isNull(o)&&(o=[]);for(var n=0;n<o.length;n++)(isNull(o[n])||o[n].length<5)&&(o.splice(n,1),n--);for(var t="",n=0;n<webphone_api.global.sipaccounts.length;n++){var i=webphone_api.global.sipaccounts[n];if(!(isNull(i)||i.length<4)){t.length>0&&(t+="#");var a=!1;if(o.length>0)for(var r=0;r<o.length;r++){var l=o[r];if(i.username===l.username&&i.password===l.password&&i.ival===l.ival&&i.serveraddress===l.serveraddress){a=!0;break}}if(!0!==a){if(!0===i.ismain&&(t+="[MAIN]"),!1===i.enabled&&(t+="[DISABLED]"),!0===i.ismain){var p=i.serveraddress,s=i.username,c=i.password,u=i.ival,g=i.callerid,m=i.displayname,b=i.proxyaddress,h=i.realm;if(isNull(p)&&(p=""),isNull(s)&&(s=""),isNull(c)&&(c=""),isNull(u)&&(u=""),isNull(g)&&(g=""),isNull(m)&&(m=""),isNull(b)&&(b=""),isNull(h)&&(h=""),p.length>0&&SaveParameter("serveraddress_user",p),c.length>0&&SaveParameter("password",c),u.length>0&&IsNumber(u)&&SaveParameter("registerinterval",u),m.length>0&&SaveParameter("displayname",m),b.length>0&&SaveParameter("proxyaddress",b),h.length>0&&SaveParameter("realm",h),s.length>0){var d=!1;GetParameter("sipusername").length>0&&(SaveParameter("sipusername",s),d=!0),GetParameter("username").length>0&&!isNull(g)&&g.length>0&&(SaveParameter("username",g),d=!0),d||SaveParameter("username",s),g.length>0&&GetParameter("sipusername").length>0&&GetParameter("username").length>0&&SaveParameter("username",g)}}t=t+i.serveraddress+","+i.username+","+i.password+","+i.ival+","+i.callerid+","+i.displayname+","+i.proxyaddress+i.realm}}}SaveParameter("extraregisteraccounts",t)}catch(_){PutToDebugLogException(2,"common: SaveSipAccounts",_)}}function GetExtraRegAccFromAPIparam(){try{if("undefined"!=typeof webphone_api.parameters.extraregisteraccounts&&null!==webphone_api.parameters.extraregisteraccounts&&webphone_api.parameters.extraregisteraccounts.length>5){var e=webphone_api.parameters.extraregisteraccounts;if(e=ReplaceAll(e," ",""),!isNull(e)||e.length>5)return e}}catch(o){PutToDebugLogException(2,"common: GetExtraRegAccFromAPIparam",o)}return""}function AddOneAcc(e,o,n,t,i,a,r,l,p,s,c){try{if(webphone_api.common.isNull(webphone_api.global.sipaccounts)&&(webphone_api.global.sipaccounts=[]),isNull(o)||o.length<1||isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, AddOneAcc invalid username: "+o+"; or password: "+n);if((isNull(t)||!1===IsNumber(t))&&(t="3600"),isNull(l)&&(l=""),isNull(p)&&(p=""),isNull(s)&&(s=""),isNull(c)&&(c=""),l=Trim(l),l.length<1&&(l=o),!0===r&&1===webphone_api.global.sipaccounts.length){webphone_api.global.sipaccounts=[];var u=new webphone_api.common.ClassSipAccounts;return u.serveraddress=e,u.username=o,u.password=n,u.ival=webphone_api.common.StrToInt(t),u.enabled=i,u.ismain=!0,u.callerid=l,u.displayname=p,u.proxyaddress=s,u.realm=c,webphone_api.global.sipaccounts.push(u),void SaveSipAccounts()}for(var g=!1,m=0;m<webphone_api.global.sipaccounts.length;m++)if(!webphone_api.common.isNull(webphone_api.global.sipaccounts[m])&&webphone_api.global.sipaccounts[m].username===o&&webphone_api.global.sipaccounts[m].password===n){var b=webphone_api.global.sipaccounts[m].serveraddress;if(webphone_api.common.isNull(b)&&(b=""),webphone_api.common.isNull(e)&&(e=""),b===e){webphone_api.global.sipaccounts[m].serveraddress=e,webphone_api.global.sipaccounts[m].ival=t,webphone_api.global.sipaccounts[m].enabled=i,webphone_api.global.sipaccounts[m].ismain=a,webphone_api.global.sipaccounts[m].callerid=l,webphone_api.global.sipaccounts[m].displayname=p,webphone_api.global.sipaccounts[m].proxyaddress=s,webphone_api.global.sipaccounts[m].realm=c,g=!0;break}}if(!0===g){if(!0===a)for(var m=0;m<webphone_api.global.sipaccounts.length;m++)webphone_api.common.isNull(webphone_api.global.sipaccounts[m])||webphone_api.global.sipaccounts[m].username===o&&webphone_api.global.sipaccounts[m].password===n||(webphone_api.global.sipaccounts[m].ismain=!1)}else{var u=new webphone_api.common.ClassSipAccounts;u.serveraddress=e,u.username=o,u.password=n,u.ival=webphone_api.common.StrToInt(t),u.enabled="true"===i||!0===i,u.ismain="true"===a||!0===a,u.callerid=l,u.displayname=p,u.proxyaddress=s,u.realm=c,webphone_api.global.sipaccounts.push(u),PutToDebugLog(2,"EVENT, AddOneAcc: serveraddress:"+e+" username: "+o+" password: "+n+" regival: "+t+" enabled: "+i+" ismain: "+a)}SaveSipAccounts()}catch(h){PutToDebugLogException(2,"common: AddOneAcc",h)}}function GetOtherPartyName(e,o){e>1||(CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetOtherPartyName"),webphone_api.getsipheader("Contact",function(e){try{if(isNull(e)||e.length<1)return;var n=e.indexOf("<");n>0&&(e=e.substring(0,n),e=ReplaceAll(e,'"',""),e=Trim(e),e.length>0&&e!==o&&e!==GetParameter("displayname")&&(webphone_api.global.callName=e))}catch(t){PutToDebugLogException(2,"common: GetOtherPartyName",t)}}))}function GetMaxLogLevel(){try{if(!isNull(webphone_api.parameters.maxloglevel)&&IsNumber(webphone_api.parameters.maxloglevel)){var e=StrToInt(webphone_api.parameters.maxloglevel);return e>1e3&&(e=1e3),e<1&&(e=1),e}}catch(o){PutToDebugLogException(2,"common: GetMaxLogLevel",o)}return 1e3}function HandleOfflineMessages(e){try{if(isNull(e)||e.indexOf("XOFFMESSAGE:")<0)return;var o=e.indexOf("XOFFMESSAGE:");e=e.substring(o+12);var n=e.split("XOFFMESSAGE:");if(!isNull(n)&&n.length>0)for(var t=0;t<n.length;t++)if(!(isNull(n[t])||(o=n[t].indexOf(":"))<0)){var i=Trim(n[t].substring(0,o)),a=Trim(n[t].substring(o+1));"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?webphone_api.notifications.OnMessageReceived(i,a,-1):console&&console.log&&console.log("ERROR, common HandleOfflineMessages webphone_api.notifications is not defined")}}catch(r){PutToDebugLogException(2,"common: HandleOfflineMessages",r)}}function RequestBrowserNotificationPermission(e,o,n,t){try{if(!window.Notification||!Notification.permission)return void PutToDebugLog(2,"WARNING,RequestBrowserNotificationPermission: Notification not supported in this environment, browser: "+GetBrowser()+"; os: "+GetOs());"granted"!==Notification.permission?Notification.requestPermission(function(i){"granted"===i||"default"===i?(PutToDebugLog(2,"EVENT,RequestBrowserNotificationPermission: granted"),e(o,n,t)):"denied"===i?PutToDebugLog(2,"EVENT,RequestBrowserNotificationPermission: denied"):(PutToDebugLog(2,"WARNING,RequestBrowserNotificationPermission: "+Notification.permission),e(o,n,t))}):e(o,n,t)}catch(i){PutToDebugLogException(2,"common: RequestBrowserNotificationPermission",i)}}function CanUseIncomingCallNot(){try{if(!0===IsWindowsSoftphone())return!1;var e=GetParameterInt("incomingcallpopup",0);if(e<1)return!1;if(1===e){if(!0===GetParameterBool("autoaccept",!1))return!1;if(getuseengine()!==webphone_api.global.ENGINE_JAVA&&!1===BrowserWindowIsActive())return!0}else{if(2!==e)return 3===e||(PutToDebugLog(2,"ERROR, incomingcallpopup invalid value: "+e),!1);if(getuseengine()!==webphone_api.global.ENGINE_JAVA)return!0}}catch(o){PutToDebugLogException(2,"common: CanUseIncomingCallNot",o)}return!1}function ShowIncomingCallNotification(e,o,n,t,i){try{if(!0===t)return isNull(callnotification)||callnotification.close(),void(callnotification=null);if(!CanUseIncomingCallNot())return;RequestBrowserNotificationPermission(function(e,o,n){window.Notification&&Notification.permission&&"granted"===Notification.permission&&(isNull(e)&&(e=""),isNull(o)&&(o=""),isNull(n)&&(n=""),isNull(i)&&(i=""),isNull(callnotification)||callnotification.close(),callnotification=null,callnotification=new Notification(e,{icon:n,body:o,image:i}),callnotification.onclick=function(){window.focus(),isNull(callnotification)||callnotification.close(),callnotification=null})},e,o,n)}catch(a){PutToDebugLogException(2,"common: ShowIncomingCallNotification",a)}}function WebphoneIsLoaded(){try{HandleBrowserWindowActive(),GetContacts(function(e){PutToDebugLog(4,"EVENT, common: WebphoneIsLoaded GetContacts: "+e)}),webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.wnotstartedsession=!1}catch(e){PutToDebugLogException(2,"common: WebphoneIsLoaded",e)}}function BrowserWindowIsActive(){return!1!==browserWindowActive}function HandleBrowserWindowActive(){try{webphone_api.$(window).focus(function(){browserWindowActive=!0}).blur(function(){browserWindowActive=!1})}catch(e){PutToDebugLogException(2,"common: HandleBrowserWindowActive",e)}}function DownloadContacts(){try{ShowToast(webphone_api.stringres.get("sync_message"),5e3);var e=GetParameter("contactimport_url");if(isNull(e)||e.length<3){var o=GetSipusername(),n=GetParameter("serveraddress_user");!isNull(n)&&n.length>0&&(o=o+"_"+n),o+=".dat",e="https://www.mizu-voip.com/G/srvct/"+encodeURIComponent(o)}else e.lastIndexOf("/")<e.length-1&&(e+="/"),e+=encodeURIComponent(o);PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("sync_contacts_started")),UriParser(e,"","","","","downloadcontacts"),setTimeout(function(){cleartimer=!0},6e4),reloadtimer=setInterval(function(){!0===cleartimer&&(clearInterval(reloadtimer),reloadtimer=null),!0===webphone_api.global.reloadcontactsaftersync&&(clearInterval(reloadtimer),reloadtimer=null,webphone_api.global.reloadcontactsaftersync=!1,!0===webphone_api.global.isContactslistStarted&&webphone_api._contactslist.PopulateList(!1))})}catch(t){PutToDebugLogException(2,"common: DownloadContacts",t)}}function ArrayBufferToString(e){try{if(isNull(e))return"null";if("string"===typeof e)return e.toString();var o="",n=new Uint8Array(e);if(isNull(n))return"null";for(var t=n.byteLength,i=0;i<t;i++)o+=String.fromCharCode(n[i]);return isNull(o)?"null":o}catch(a){PutToDebugLogException(2,"common: ArrayBufferToString",a)}return"null"}function Translate(e){try{if(isNull(e)||e.lenght<1)return"";if(isNull(o)){var o=webphone_api.parameters.language;(isNull(o)||2!==o.length)&&(o=GetConfig("language")),(isNull(o)||2!==o.length)&&(o=GetParameter("language")),(isNull(o)||2!==o.length)&&(o=""),o=o.toLowerCase()}if(o.length<1)return e;switch(o){case"ru":return webphone_api.translations.TranslateInnerRus(e);case"hu":return webphone_api.translations.TranslateInnerHun(e);case"ro":return webphone_api.translations.TranslateInnerRo(e);case"de":return webphone_api.translations.TranslateInnerDe(e);case"it":return webphone_api.translations.TranslateInnerItalian(e);case"es":return webphone_api.translations.TranslateInnerSpanish(e);case"tr":return webphone_api.translations.TranslateInnerTr(e);case"pr":case"pt":return webphone_api.translations.TranslateInnerPr(e);case"jp":return webphone_api.translations.TranslateInnerJp(e);case"fr":return webphone_api.translations.TranslateInnerFr(e)}}catch(n){PutToDebugLogException(2,"common: Translate",n)}return e}function GetAutostart(){try{var e=GetParameterInt("autostart",1);return!isNull(webphone_api.parameters.autostart)&&webphone_api.parameters.autostart.toString().length>0&&(e=webphone_api.parameters.autostart.toString(),e=Trim(e),"true"===e||"yes"===e?e=1:"false"!==e&&"no"!==e||(e=0)),e=StrToIntDef(e,1)}catch(o){PutToDebugLogException(2,"common: GetAutostart",o)}return 1}function CanIUseVideo(){try{if(!0===HideSettings("video",webphone_api.stringres.get("sett_display_name_video"),"video",!0))return!1;if(!1===Glvd())return!1;if("1"===GetParameter2("video")||"2"===GetParameter2("video")||"-1"===GetParameter2("video")&&(getuseengine()===webphone_api.global.ENGINE_WEBRTC||!0===CanIUseWebRTC()||!0===IsWindowsSoftphone()))return!0}catch(e){PutToDebugLogException(2,"common: CanIUseVideo",e)}return!1}function CanIUseScreensharing(){try{if(!0===HideSettings("screensharing","","screensharing",!0))return!1;if(!1===Glss())return!1;if("Android"===GetOs()||"iOS"===GetOs())return!1;if(!(navigator.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia))return!1;var e=GetParameter2("screensharing");if("2"===e||"1"===e&&(getuseengine()===webphone_api.global.ENGINE_WEBRTC||!0===CanIUseWebRTC()||!0===IsWindowsSoftphone()))return!0}catch(o){PutToDebugLogException(2,"common: CanIUseScreensharing",o)}return!1}function SwitchToEngine(e){try{PutToDebugLog(2,"EVENT, common: SwitchToEngine: "+e+"; reset useengine"),webphone_api.global.useengine="";var o=GetEngine(e);isNull(o)||(o.clicked=2,SetEngine(e,o),ChooseEngineLogic2(e),EngineSelect(1,25)),PutToDebugLog(2,"EVENT, mlogic API_Start SwitchToEngine"),webphone_api.start()}catch(n){PutToDebugLogException(2,"common: SwitchToEngine",n)}}function ExitVideoMode(e){try{if(!1===IsWindowsSoftphone())return;PutToDebugLog(2,"EVENT, ExitVideoMode: "+e),SwitchToEngine(webphone_api.global.ENGINE_SERVICE);1===GetParameterInt("videomode",0)&&SaveParameter("videomode","2");WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_exitvideo","GET","","",function(e){PutToDebugLog(2,"EVENT, common: Exit response: "+e)})}catch(o){PutToDebugLogException(2,"common: ExitVideoMode",o)}}function ClassCustomMenus(){this.label,
this.action,this.data}function GetCustomMenus(){try{var e=GetParameter("menu_url");if(isNull(e)||e.length<3)return;var o=GetSipusername(),n=GetParameter("password");e=e.replace("[USERNAME]",o),e=e.replace("USERNAME",o),e=e.replace("[PASSWORD]",n),e=e.replace("PASSWORD",n),e=e.replace("PWD",n),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("BRANDNAME",encodeURIComponent(GetBrandName()));var t="http://";IsHttps()&&(t="https://");var i="rtc.mizu-voip.com";"us"===webphone_api.global.usuk&&(i="usrtcx.webvoipphone.com");var a=GetConfig("mainaport");!isNull(a)&&a.length>0&&(i.indexOf(":")>0&&(i=i.substring(0,i.indexOf(":"))),i+=a),PutToDebugLog(4,"EVENT, GetCustomMenus url: "+e);var r=decodeURIComponent(e);r=encodeURIComponent(r);var l=t+i+"/mvapireq/jppget?url="+r+"&callback=cbf";PutToDebugLog(4,"EVENT, GetCustomMenus url JSONP: "+l),webphone_api.$.getJSON(l,function(e){var o="";isNull(e)?PutToDebugLog(2,"ERROR, HttpRequest GetCustomMenus response is NULL"):o=e.contents,HttpResponseHandler(o,"get_custom_menu")})}catch(p){PutToDebugLogException(2,"common: GetCustomMenus",p)}}function ProcessCustomMenu(e){try{if(webphone_api.global.custmenusL=null,webphone_api.global.custmenusL=[],isNull(e)||e.length<5)return;var o=-1,n=e;if(o=n.indexOf("<ERROR>"),o<0&&(o=n.indexOf("<Error>")),n.toLowerCase().indexOf("disabled")>0&&o>0&&(n=n.substring(o+7),o=n.indexOf("</ERROR>"),o>0&&(n=n.substring(0,o)),isNull(n)&&(n=""),n=Trim(n),n.length>0))return PutToDebugLog(2,"ERROR, ProcessCustomMenu returned error: "+n),PutToDebugLog(1,"ERROR, "+n),void AlertDialog("ERROR",n);if((o=e.indexOf("<PROTOCOL>"))>0){var t=e.substring(o+12);o=t.indexOf("</PROTOCOL>"),o>0&&(t=t.substring(0,o),isNull(t)&&(t=""),t=Trim(t),t.length>0&&(PutToDebugLog(2,"EVENT, ProcessCustomMenu set custom received transport protocol: "+t),"udp"===t.toLowerCase()?SaveParameter("transport","0"):"tcp"===t.toLowerCase()?SaveParameter("transport","1"):"tls"===t.toLowerCase()&&SaveParameter("transport","2")))}if((o=e.indexOf("<SIP_SERVER>"))>0){var i=e.substring(o+12);o=i.indexOf("</SIP_SERVER>"),o>0&&(i=i.substring(0,o),isNull(i)&&(i=""),i=Trim(i),i.length>0&&(PutToDebugLog(2,"EVENT, ProcessCustomMenu set custom received serveraddress: "+i),SaveParameter("serveraddress_user",i)))}if((o=n.indexOf("<BUTTONS>"))<0)return;if(n=n.substring(o+9),(o=n.indexOf("</BUTTONS>"))<1)return;n=n.substring(0,o),n=Trim(n);var a=n.split("<BUTTON");if(isNull(a)||a.length<1)return;for(var r=0;r<a.length;r++)if(null!=a[r]){var l=a[r].toString();if(!(l.length<5)){l=ReplaceAll(l,'="',"=");var p="",s="",c="";o=l.indexOf("label="),o>=0&&(p=l.substring(o+6),p=Trim(p),o=p.indexOf('"'),o<0&&(o=p.indexOf(" ")),p=o>0?Trim(p.substring(0,o)):"");var u=!1;if(o=l.indexOf("action="),o>=0&&(s=l.substring(o+7),s=Trim(s),o=s.indexOf('"'),o<0&&(o=s.indexOf(" ")),o>0?(s=Trim(s.substring(0,o)),u=!0):s=""),o=l.indexOf("data="),o>=0&&(c=l.substring(o+5),c=Trim(c),o=c.indexOf('"'),o<0&&(o=c.indexOf(" ")),o>0?(c=Trim(c.substring(0,o)),u||(0===c.toLowerCase().indexOf("http:")||0===c.toLowerCase().indexOf("https:")?s="link":0==c.indexOf("chat:")?(c=Trim(c.substring(c.indexOf("chat:"))),s="chat"):0==c.indexOf("call:")?(c=Trim(c.substring(c.indexOf("call:"))),s="call"):c.length>0&&(s="call"))):c=""),!isNull(p)&&p.length>0&&!isNull(s)&&s.length>0&&!isNull(c)&&c.length>0){var g=new ClassCustomMenus;g.label=p,g.action=s,g.data=c,webphone_api.global.custmenusL.push(g)}}}}catch(m){PutToDebugLogException(2,"common: ProcessCustomMenu",m)}}function GetTextLengthThatFits(e,o,n,t,i,a){if(isNull(o)||o.length<1)return 0;var r=o.length;try{a===undefined&&(a="normal");var l=webphone_api.$("<div>").addClass("auxdiv").css({position:"absolute",height:"auto",marginLeft:"-1000px",marginTop:"-1000px",fontWeight:a,width:"auto"}).appendTo(webphone_api.$("#"+e)).html(o),p=l.width()+1,s=o;if(p>n){for(var c=1,u=1,g=o.length,m=0;u<=g;)c=u+g>>1,s=o.slice(0,c),l.html(s),p=l.width()+1,p<=n?(m=c,u=c+1):g=c-1;s=o.slice(0,m)}return webphone_api.$(".auxdiv").remove(),l.remove(),s.length}catch(b){PutToDebugLogException(2,"common: GetTextLengthThatFits",b)}return r}function HostToIPQuick(e){var o="";return e=NormalizeInput(GetDomainPart(e)),isNull(dtisrvcache)||isNull(dtisrvcache[e])||(o=dtisrvcache[e],!IsIPAddrress(o))?e===GetConfig("knowndomain")&&!isNull(GetConfig("knownip"))&&(o=GetConfig("knownip"),IsIPAddrress(o))?o:e!==GetConfig("serveraddress_user")&&e!==GetConfig("serverdomain")&&e!==GetConfig("serveraddress")||isNull(GetConfig("serverip"))||(o=NormalizeInput(GetDomainPart(GetConfig("serverip"))),!IsIPAddrress(o))?"":o:o}function DomainToIpServer(e,o){function n(e,n){if(!isNull(dreqsrvcache[e])){try{for(var t=dreqsrvcache[e];t.length>0;)isNull(t[0])||"function"!=typeof t[0]||t[0](n),t.splice(0,1)}catch(i){PutToDebugLogException(2,"common: domaintoipServer HanleCallback",i);try{o("")}catch(a){}}delete dreqsrvcache[e]}}try{if(isNull(e)||e.length<3)return o(""),"";if(e=NormalizeInput(GetDomainPart(e)),!0===IsIPAddrress(e))return o(e),e;var t=e.lastIndexOf(":");t>0&&(e=e.substring(0,t)),t=e.indexOf("?"),t>0&&(e=e.substring(0,t)),t=e.indexOf("://"),t>0&&(e=e.substring(t+3,e.length)),t=e.indexOf("//"),t>0&&(e=e.substring(t+2,e.length)),t=e.indexOf("/"),t>0&&(e=e.substring(0,t));var i="";if(i=HostToIPQuick(e),i.length>0)return o(i),i;if(!0===IsLocalUpperServer())return o(e),e;if(isNull(dtisrvcache)){dtisrvcache={};var a=null;if((isNull(dtistrSrv)||dtistrSrv.indexOf("mnt.mizu-voip.com")<0)&&(!isNull(dtistrSrv)&&dtistrSrv.length>0&&(dtistrSrv+="##"),dtistrSrv+="www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,159.69.64.139##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,107.175.156.227"),!isNull(dtistrSrv)&&dtistrSrv.length>0&&(a=dtistrSrv.split("##")),!isNull(a)&&a.length>0)for(var r=0;r<a.length;r++)if(!(isNull(a[r])||a[r].indexOf(",")<0)){var l=a[r].substring(0,a[r].indexOf(",")),p=a[r].substring(a[r].indexOf(",")+1);!isNull(l)&&l.length>0&&!isNull(p)&&p.length>0&&isNull(dtisrvcache[l])&&(dtisrvcache[l]=p)}}if(i="",!isNull(dtisrvcache[e]))return i=dtisrvcache[e],o(i),i;if(e===GetConfig("knowndomain")&&!isNull(GetConfig("knownip"))&&IsIPAddrress(GetConfig("knownip")))return i=GetConfig("knownip"),o(i),i;if(!isNull(dreqsrvcache[e])){var s=dreqsrvcache[e];return s.push(o),dreqsrvcache[e]=s,""}var s=[];if(s.push(o),dreqsrvcache[e]=s,0===GetParameterInt("altexternpublicip",1))return"";var c="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";!0===IsHttps()&&(c=c.replace("http:","https:")),c=c.replace("DOMAIN",encodeURIComponent(e)),CanLog(4)&&PutToDebugLog(4,"EVENT, domaintoipServer url: "+c);var u=new XMLHttpRequest;if("withCredentials"in u)u.open("GET",c,!0);else{if("undefined"==typeof XDomainRequest)return u=null,PutToDebugLog(2,"ERROR, common: domaintoipServer, CORS not supported"),void o("");u=new XDomainRequest,u.open("GET",c)}u.onload=function(){try{if(!1===webphone_api.global.httpheaderslogged&&u.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;var t=u.getAllResponseHeaders();CanLog(5)&&PutToDebugLog(5,"EVENT, domaintoipServer HTTP request answer headers 4: "+t)}if(isNull(u)||isNull(u.responseText)||u.responseText.length<1)return PutToDebugLog(2,"ERROR, domaintoipServer response is NULL"),void o("");var i=u.responseText;if(i.indexOf("OK:")>=0){i=i.replace("OK:","");var a=i.indexOf(":");a>0&&(i=i.substring(a+1)),isNull(i)&&(i=""),i=Trim(i),CanLog(4)&&PutToDebugLog(4,"EVENT, domaintoipServer response is: "+i),dtisrvcache[e]=i,n(e,i);var r="";for(var l in dtisrvcache)!isNull(l)&&l.length>0&&!isNull(dtisrvcache[l])&&dtisrvcache[l].length>0&&(r.length>0&&(r+="##"),r=r+l+","+dtisrvcache[l])}else PutToDebugLog(2,"ERROR, domaintoipServer response is: "+i),dtisrvcache[e]=i,n(e,"ERROR: "+i)}catch(p){PutToDebugLogException(2,"common: domaintoipServer.onload inner",p),o("")}},u.onerror=function(o){var t="";isNull(o)||(t=o.toString(),isNull(o.target)||(t=isNull(o.target.status)?t+" "+o.target.toString():t+" "+o.target.status.toString())),PutToDebugLog(2,"ERROR, domaintoipServer request failed: "+t),n(e,"ERROR, domaintoipServer request failed: "+t)},u.timeout=2e3,u.ontimeout=function(o){PutToDebugLog(2,"ERROR, domaintoipServer: Timeout"),n(e,"ERROR, domaintoipServer: Timeout")},u.send()}catch(g){PutToDebugLogException(2,"common: domaintoipServer",g),o("ERROR, domaintoipServer failed")}}function DomainToIp(e,o){function n(e,o){if(!isNull(dreqcache[e])){var n=dreqcache[e],t=o;for(o.indexOf("ERROR")<0&&(t="");n.length>0;)isNull(n[0])||"function"!=typeof n[0]||n[0](t),n.splice(0,1);delete dreqcache[e]}}try{if(isNull(e))return o(""),"";if(e.length<3)return o(e),"";if(0==e.toLowerCase().indexOf("error"))return o(""),"";if(e.indexOf(".")<0)return o(e),"";if(e=NormalizeInput(GetDomainPart(e)),!0===IsIPAddrress(e))return o(e),e;var t=e.lastIndexOf(":");t>0&&(e=e.substring(0,t)),t=e.indexOf("?"),t>0&&(e=e.substring(0,t)),t=e.indexOf("://"),t>0&&(e=e.substring(t+3,e.length)),t=e.indexOf("//"),t>0&&(e=e.substring(t+2,e.length)),t=e.indexOf("/"),t>0&&(e=e.substring(0,t));var i="";if(i=HostToIPQuick(e),i.length>0)return o(i),i;if(!0===IsLocalUpperServer())return o(e),e;if(isNull(dticache)){dticache={};var a=GetParameter("domaintoip_cache"),r=null;if((isNull(a)||a.indexOf("mnt.mizu-voip.com")<0)&&(!isNull(a)&&a.length>0&&(a+="##"),a+="www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,178.63.153.107##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,204.12.197.98##voip.mizu-voip.com,159.69.64.138##fcm.webvoipphone.com,148.251.28.182"),!isNull(a)&&a.length>0&&(r=a.split("##")),!isNull(r)&&r.length>0)for(var l=0;l<r.length;l++)if(!(isNull(r[l])||r[l].indexOf(",")<0)){var p=r[l].substring(0,r[l].indexOf(",")),s=r[l].substring(r[l].indexOf(",")+1);!isNull(p)&&p.length>0&&!isNull(s)&&s.length>0&&isNull(dticache[p])&&(dticache[p]=s)}}if(i=dticache[e],!isNull(i))return o(i),n(e,i),i;if(!isNull(dreqcache[e])){var c=dreqcache[e];return c.push(o),dreqcache[e]=c,""}var c=[];if(c.push(o),dreqcache[e]=c,0===GetParameterInt("altexternpublicip",1))return"";var u="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";!0===IsHttps()&&(u=u.replace("http:","https:")),u=u.replace("DOMAIN",encodeURIComponent(e)),PutToDebugLog(4,"EVENT, domaintoip url: "+u);var g=new XMLHttpRequest;if("withCredentials"in g)g.open("GET",u,!0);else{if("undefined"==typeof XDomainRequest)return g=null,PutToDebugLog(2,"ERROR, common: domaintoip, CORS not supported"),void o("");g=new XDomainRequest,g.open("GET",u)}g.onload=function(){try{if(!1===webphone_api.global.httpheaderslogged&&g.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 4: "+g.getAllResponseHeaders())}if(isNull(g)||isNull(g.responseText)||g.responseText.length<1)return PutToDebugLog(2,"ERROR, domaintoip response is NULL for "+e),void o("");var t=g.responseText;if(t.indexOf("OK:")>=0){t=t.replace("OK:","");var i=t.indexOf(":");i>0&&(t=t.substring(i+1)),isNull(t)&&(t=""),t=Trim(t),PutToDebugLog(4,"EVENT, domaintoip response is: "+NormalizeInput2(t,3)+" for "+e),dticache[e]=t,o(t),n(e,t);var a="";for(var r in dticache)!isNull(r)&&r.length>0&&!isNull(dticache[r])&&dticache[r].length>0&&(a.length>0&&(a+="##"),a=a+r+","+dticache[r]);SaveParameter("domaintoip_cache",a)}else if((isNull(dticache[e])||dticache[e].length<1)&&(dticache[e]=e),PutToDebugLog(2,"ERROR, domaintoip response is: "+NormalizeInput2(t,3)+" for "+e),o(""),n(e,"ERROR: "+t),t.indexOf("cannotresolve")){var a="";for(var r in dticache)!isNull(r)&&r.length>0&&!isNull(dticache[r])&&dticache[r].length>0&&(a.length>0&&(a+="##"),a=a+r+","+dticache[r]);SaveParameter("domaintoip_cache",a)}}catch(l){PutToDebugLogException(2,"common: domaintoip.onload inner",l),o("")}},g.onerror=function(t){var i="";isNull(t)||(i=t.toString(),isNull(t.target)||(i=isNull(t.target.status)?i+" "+t.target.toString():i+" "+t.target.status.toString())),PutToDebugLog(2,"ERROR, domaintoip request failed: "+i+" for "+e),o(""),n(e,"ERROR, domaintoip request failed: "+i)},g.timeout=4e3,g.ontimeout=function(t){PutToDebugLog(2,"ERROR, domaintoip: Timeout"),o(""),n(e,"ERROR, domaintoip: Timeout")},g.send()}catch(m){PutToDebugLogException(2,"common: domaintoip",m),o("domaintoip failed")}}function HandleSipProtocol(e){try{if(isNull(e)||e.length<1)return e;if(0!==e.indexOf("REGISTER sip:")&&0!==e.indexOf("INVITE sip"))return e;var o=GetParameterInt("sipprotocol",0);if(0===o)return e;var n=e;if(1===o)return n=ReplaceAll(n,"sips:","sip:"),n=ReplaceAll(n,"WSS","WS"),n=ReplaceAll(n,"wss","ws");if(2===o)return n=ReplaceAll(n,"sip:","sips:"),n=ReplaceAll(n,"WS","WSS"),n=ReplaceAll(n,"ws","wss")}catch(t){PutToDebugLogException(2,"common: HandleSipProtocol",t)}return e}function HandleOptions(e){try{if(isNull(e)||e.length<1||e.indexOf("OPTIONS sip")<0)return!1;var o=e,n=GetSipHeaderFromMsg(o,"accept");isNull(n)&&(n=""),n=n.toLowerCase();var t="\r\n";o.indexOf("\r\n")<0&&o.indexOf("\n")>=0&&(t="\n"),o=o.substring(o.indexOf(t)+t.length);var i="SIP/2.0 200 OK"+t+o,a="<sip:"+GetSipusername()+"@"+webphone_api.webrtcapi.GetUDPServerAddress()+">";if(i=i.indexOf("Contact:")>0?RewriteSipHeaderInMsg(i,"Contact",a):i+"Contact: "+a+t,i=i.indexOf("User-Agent:")>0?RewriteSipHeaderInMsg(i,"User-Agent","MWWRTC "+webphone_api.global.versionstr):i+"User-Agent: MWWRTC "+webphone_api.global.versionstr+t,n.indexOf("application")>=0&&n.indexOf("sdp")>=0){i.indexOf("Content-Length:")<0&&(i=i+"Content-Length: 0"+t),i+=t;var r="",l=GetParameter("codec");if(isNull(l)||l.length<1||"-1"==l)r="v=0"+t+"m=audio 80 UDP/TLS/RTP/SAVPF 111 103 104 9 0 8 106 105 13 126"+t+"a=mid:0"+t+"a=sendrecv"+t+"a=rtcp-mux"+t+"a=rtpmap:111 opus/48000/2"+t+"a=rtcp-fb:111 transport-cc"+t+"a=fmtp:111 minptime=10;useinband"+t+"a=rtpmap:103 ISAC/16000"+t+"a=rtpmap:104 ISAC/32000"+t+"a=rtpmap:9 G722/8000"+t+"a=rtpmap:0 PCMU/8000"+t+"a=rtpmap:8 PCMA/8000"+t+"a=rtpmap:106 CN/32000"+t+"a=rtpmap:105 CN/16000"+t+"a=rtpmap:13 CN/8000"+t+"a=rtpmap:126 telephone-event/8000"+t;else{var p="m=audio 80 UDP/TLS/RTP/SAVPF";r="a=mid:0"+t+"a=sendrecv"+t+"a=rtcp-mux"+t;var s=l.split(",");(s.indexOf("10")>=0||s.indexOf("11")>=0||s.indexOf("13")>=0)&&(p+=" 111",r=r+"a=rtpmap:111 opus/48000/2"+t+"a=rtcp-fb:111 transport-cc"+t+"a=fmtp:111 minptime=10;useinband"+t),p+=" 103 104 9",r=r+"a=rtpmap:103 ISAC/16000"+t+"a=rtpmap:104 ISAC/32000"+t+"a=rtpmap:9 G722/8000"+t,s.indexOf("1")>=0&&(p+=" 0",r=r+"a=rtpmap:0 PCMU/8000"+t),s.indexOf("2")>=0&&(p+=" 8",r=r+"a=rtpmap:8 PCMA/8000"+t),p+=" 106 105 13 126",r=r+"a=rtpmap:106 CN/32000"+t+"a=rtpmap:105 CN/16000"+t+"a=rtpmap:13 CN/8000"+t+"a=rtpmap:126 telephone-event/8000"+t,r="v=0"+t+p+t+r}i=i+t+r,i=RewriteSipHeaderInMsg(i,"Content-Length",r.length)}else i=i.indexOf("Accept:")>0?RewriteSipHeaderInMsg(i,"Accept","application/sdp,application/dtmf-relay,text/plain"):i+"Accept: application/sdp,application/dtmf-relay,text/plain"+t,i=i.indexOf("Content-Length:")>0?RewriteSipHeaderInMsg(i,"Content-Length","0"):i+"Content-Length: 0"+t;return webphone_api.common.PutToDebugLog(3,"EVENT, HandleOptions OPTIONS sip handled manually: EVENT, SEND: \r\n"+i),webphone_api.webrtc_socket.send(i),!0}catch(c){PutToDebugLogException(2,"common: HandleOptions",c)}return!1}function HandleEdgeSdpIP(e){try{if(isNull(e)||e.length<1)return e;if("Edge"!==GetBrowser())return e;if(0!==e.indexOf("INVITE sip"))return e;var o=e,n=o.indexOf("a=candidate:");if(n<0)return e;var t=o.substring(n+12);if(t=t.substring(0,t.indexOf("\r\n")),isNull(t)||t.length<1)return e;var i="";if(n=t.lastIndexOf("."),n>0&&(i=t.substring(n),t=t.substring(0,n+4),n=t.lastIndexOf(" "),n>t.length-6&&(t=t.substring(0,n)),t=Trim(t),n=t.lastIndexOf(" "),n>0&&(t=t.substring(n+1)),isNull(i)&&(i=""),i=Trim(i),n=i.indexOf(" "),n>0&&(i=i.substring(n+1)),n=i.indexOf(" "),n>0&&(i=i.substring(0,n),!isNull(i)&&IsNumber(i)||(i="")),t=Trim(t),i=Trim(i)),isNull(t)||t.length<1||!IsIPAddrress(t))return e;if((n=o.indexOf("c="))<1)return e;var a=o.substring(0,n);o=o.substring(n),n=o.indexOf("\r\n");var r=o.substring(0,n+2);o=o.substring(n+2);var l=r.replace("127.0.0.1",t);if(l=l.replace("127.0.0.0",t),o=a+l+o,r=r.replace("\r\n",""),l=l.replace("\r\n",""),PutToDebugLog(2,"EVENT, HandleEdgeSdpIP IP addres rewritten in SDP, orig header: "+r+"; rewritten to: "+l),isNull(i)||i.length<1||!IsNumber(i))return o;if((n=o.indexOf("m=audio"))<1)return o;e=o,a=o.substring(0,n+7),o=o.substring(n+7),o=Trim(o),n=o.indexOf(" ");var p=o.substring(0,n);return o=o.substring(n),(isNull(p)&&(p=""),p=Trim(p),p.length<1||!IsNumber(p))?e:o=a+" "+i+o}catch(s){PutToDebugLogException(2,"common: HandleEdgeSdpIP",s)}return e}function HandleIncomingSIPSignaling(e){try{if(isNull(e)||e.length<1)return e;var o=HandleAmidHeader(e);return o=HandleSpecialCharsInHeaders(o)}catch(n){PutToDebugLogException(2,"common: HandleIncomingSIPSignaling",n)}return e}function HandleSpecialCharsInHeaders(e){try{var o=e,n=o.indexOf("\r\n\r\n"),t=-1,i="";n>0&&(i=o.substring(n),o=o.substring(0,n)),isNull(i)&&(i="");var a=o.split("\r\n");if(isNull(a)||a.length<1)return e;o="";for(var r=0;r<a.length;r++){if(isNull(a[r])&&(a[r]=""),n=a[r].indexOf('"'),t=a[r].lastIndexOf('"'),n>=0&&t>0&&n<t){var l=a[r].substring(n+1,t),p=RemoveSpecialCharaters(l);l!==p&&(PutToDebugLog(2,"EVENT, HandleSpecialCharsInHeaders, rewrite special charaters in header: "+a[r]+"; to: "+p+" because containes invalid charaters"),a[r]=a[r].replace(l,p),(a[r].indexOf("From:")>=0||a[r].indexOf("Contact:")>=0)&&(webphone_api.global.sipunicoderewritefrom=l,webphone_api.global.sipunicoderewriteto=p))}o.length>0&&(o+="\r\n"),o+=a[r]}if(!isNull(o)&&o.length>10)return o+i}catch(s){PutToDebugLogException(2,"common: HandleSpecialCharsInHeaders",s)}return e}function RemoveSpecialCharaters(e){try{if(isNull(e)||e.length<1)return e;for(var o="",n=0;n<e.length;n++)e.charCodeAt(n)>31&&e.charCodeAt(n)<255&&(o+=e.charAt(n));return o}catch(t){PutToDebugLogException(2,"common: RemoveSpecialCharaters",t)}return e}function HandleAmidHeader(e,o){try{if("Firefox"!==GetBrowser())return e;var n=e,t=n.indexOf("INVITE sip");if((t>=0&&t<20||!1===o)&&(t=n.indexOf("a=mid:"))<1)if(PutToDebugLog(5,"EVENT, add a mid for FF"),(t=n.indexOf("m=audio"))>0){var i=n.substring(0,t);n=n.substring(t),t=n.indexOf("\r\n");n=i+n.substring(0,t+2)+"a=mid:1\r\n"+n.substring(t+2),n=RecalculateContentLength(n)}else if((t=n.indexOf("m=video"))>0){var i=n.substring(0,t);n=n.substring(t),t=n.indexOf("\r\n"),n=i+n.substring(0,t+2)+"a=mid:2\r\n"+n.substring(t+2),n=RecalculateContentLength(n)}return n}catch(a){PutToDebugLogException(2,"common: HandleAmidHeader",a)}return e}function FixContentLength(e){try{if(isNull(e)||e.length<1)return e;var o=e;if(o.indexOf("REGISTER sip")<0){var n=o.indexOf("Call-ID:");if(n>0){var t=Trim(o.substring(n+8));t.indexOf("\r\n")>0&&(t=t.substring(0,t.indexOf("\r\n")),!isNull(t)&&t.length>0&&(o=o.substring(0,n)+"X-C-Call-ID: "+t+"\r\n"+o.substring(n)))}}if(webphone_api.global.fcmIsEnabled>0&&(n=o.indexOf("REGISTER sip"))>=0&&n<20&&!isNull(webphone_api.global.fcmtoken)&&webphone_api.global.fcmtoken.length>3){if(o.indexOf("X-MPUSH:")<1&&(n=o.indexOf("\r\n\r\n"))>0){var i="w:"+GetFCMPackageName()+":"+fcmclientid;o=o.substring(0,n)+"\r\nX-MPUSH: "+i+o.substring(n),PutToDebugLog("WARNING, X-MPUSH added at register send")}if(o.indexOf("X-PIID:")<1&&(n=o.indexOf("\r\n\r\n"))>0){var a=GetSipusername()+":"+webphone_api.global.mRealm+":"+GetParameter("password"),r=webphone_api.common.Md5Hash(a);o=o.substring(0,n)+"\r\nX-PIID: "+r+o.substring(n),PutToDebugLog("WARNING, X-PIID added at register send")}}if((n=o.indexOf("INVITE sip"))>=0&&n<20){if(!0===webphone_api.global.add_recall_header&&o.indexOf("X-Autorecall:")<1&&(n=o.indexOf("\r\n\r\n"))>0&&(o=o.substring(0,n)+"\r\nX-Autorecall: yes"+o.substring(n)),!0===webphone_api.global.addauser_header&&o.indexOf("X-AUSR:")<1&&(n=o.indexOf("\r\n\r\n"))>0&&(o=o.substring(0,n)+"\r\nX-AUSR: "+GetSipusername()+o.substring(n),PutToDebugLog("WARNING, Sipusername added at invite send")),o.indexOf("X-Sy.Upperproxy:")<1){var l=GetUpperProxyHeaderForSignaling();!isNull(l)&&l.length>0&&(n=o.indexOf("\r\n\r\n"))>0&&(o=o.substring(0,n)+"\r\nX-Sy.Upperproxy: "+l+o.substring(n),PutToDebugLog("WARNING, Proxyaddress added at invite send"))}CatchWebrtcSignaling(o,SIP_UNKNOWN)}if(n=o.indexOf("INVITE sip"),n>=0&&(o=o.replace("X-Sy.Uppersrv: rtc.mizu-voip.com:6060\r\n","")),n>=0&&n<20&&o.indexOf("X-Sy.Uppersrv:")<1){var p=GetWebrtcSyUpperHeader("invite send");!isNull(p)&&p.length>0&&(n=o.indexOf("\r\n\r\n"))>0&&(o=o.substring(0,n)+"\r\nX-Sy.Uppersrv: "+p+o.substring(n),PutToDebugLog("WARNING, Upperserver added at invite send"))}if(n=o.indexOf("INVITE sip"),n>=0&&(o=o.replace("X-Sy.Uppersrvd: rtc.mizu-voip.com:6060\r\n","")),n>=0&&n<20){var s=GetWebrtcSyUpperDomainHeader("invite send");!isNull(s)&&s.length>0&&o.indexOf("X-Sy.Uppersrv:")<1&&(n=o.indexOf("\r\n\r\n"))>0&&(o=o.substring(0,n)+"\r\nX-Sy.Uppersrvd: "+s+o.substring(n),PutToDebugLog("WARNING, Upperserver domain added at invite send"))}return 4==GetParameterInt("dtmfmode",2)&&o.indexOf("INVITE sip")>=0&&o.indexOf("X-MFlag:2")<0&&(n=o.indexOf("\r\n\r\n"))>0&&(o=o.substring(0,n)+"\r\nX-MFlag:2"+o.substring(n),PutToDebugLog("EVENT, rfc2833 added at invite send")),o=RecalculateContentLength(o)}catch(c){PutToDebugLogException(2,"common: FixContentLength",c)}return e}function StrGetUntill(e,o){if(!e||!o||e.length<1||o.length<1)return"";var n=e.indexOf(o);return n<0&&(n=e.toLowerCase().indexOf(o.toLowerCase())),n<0?"":e.substring(0,n)}function StrGetAfter(e,o){if(!e||!o||e.length<1||o.length<1)return"";var n=e.indexOf(o);return n<0&&(n=e.toLowerCase().indexOf(o.toLowerCase())),n<0?"":e.substring(n+o.length)}function StrGetBetween(e,o,n){if(!e||!o||e.length<1||o.length<1)return"";var t=e.indexOf(o);if(t<0&&(t=e.toLowerCase().indexOf(o.toLowerCase())),t<0)return"";if(e=e.substring(t+o.length),!n||e.length<1||n.length<1)return e;var i=e.indexOf(n);return i<0&&(i=e.toLowerCase().indexOf(n.toLowerCase())),i<0?"":e.substring(0,i)}function StrReplaceBetween(e,o,n,t){if(!e||e.length<1)return"";var i=StrGetAfter(e,o);if(i.length<1)return e;if(i.indexOf(n)<0&&i.toLowerCase().indexOf(n.toLowerCase())<0){if("\r"!==n&&"\r\n"!==n)return e}else i=StrGetAfter(i,n);return StrGetUntill(e,o)+o+t+n+i}function GetDomainPart(e,o){if(void 0!==o&&null!==o||void 0!==(o=e)&&null!==o||(o=""),o=Trim(o),null==e||e.length<1)return o;var n=Trim(e);return n.indexOf(",")>=0&&(","==n.charAt(0)?(n=n.substring(1),n.indexOf(",")>0&&(n=Trim(n.substring(0,n.indexOf(","))))):n=Trim(n.substring(0,n.indexOf(",")))),n.indexOf("<")>0&&(n=Trim(n.substring(n.indexOf("<")+1))),0!=n.indexOf('"')&&0!=n.indexOf("'")||(n=Trim(n.substring(1))),n.indexOf(">")>0&&(n=Trim(n.substring(0,n.indexOf(">")))),n.indexOf("\\")>0&&(n=Trim(n.substring(0,n.indexOf("\\")))),n.indexOf("/")>0&&(n=Trim(n.substring(0,n.indexOf("/")))),n.indexOf("sip:")>=0?n=n.substring(n.indexOf("sip:")+4):n.indexOf("tel:")>=0?n=n.substring(n.indexOf("tel:")+4):n.indexOf("sips:")>=0&&(n=n.substring(n.indexOf("sips:")+5)),n.indexOf("@")>0&&(n=Trim(n.substring(n.indexOf("@")+1))),n.indexOf(":")>0&&(n=Trim(n.substring(0,n.indexOf(":")))),n.indexOf('"')>0&&(n=Trim(n.substring(0,n.indexOf('"')))),n.indexOf("'")>0&&(n=Trim(n.substring(0,n.indexOf("'")))),n.length<1?o:n}function RecalculateContentLength(e){try{var o="\nContent-Length:",n=StrGetBetween(e,o,"\r");if(n.length<1&&(o="\nl:",n=StrGetBetween(e,o,"\r")),n.length<1)return e;var t=StrToIntDef(n,0);if(t<1)return e;var i=e.indexOf("\r\n\r\n");if(i<1)return e;var a=e.length-i-4;return a==t?e:(PutToDebugLog(5,"EVENT, FixContentLength overwrite from: "+t.toString()+" to: "+a.toString()),StrReplaceBetween(e,o,"\r",a.toString()))}catch(r){PutToDebugLogException(2,"common: RecalculateContentLength",r)}return e}function RemoveDuplicateHeaders(e){try{if(isNull(e)||e.length<1)return e;var o=e,n=o.indexOf("REGISTER sip");if(n>=0&&n<20){for(var t=[],i=o.split("\r\n"),a=0;a<i.length;a++)"undefined"!=typeof i[a]&&null!==i[a]&&(i[a].indexOf(":")<0?t.push(i[a]):t.indexOf(i[a])<0&&t.push(i[a]));if(!isNull(t)&&t.length>0){for(var r="",a=0;a<t.length;a++)a>0?r=r+"\r\n"+t[a]:r+=t[a];return r}}}catch(l){PutToDebugLogException(2,"common: RemoveDuplicateHeaders",l)}return e}function AddDtmfConfHeader(e){try{if(!0!==webphone_api.global.isconfdtmf)return e;if(isNull(e)||e.length<1)return e;if(e.indexOf("INFO sip:")<0&&e.indexOf("INFO sips:")<0)return e;var o=e;o.indexOf("Signal=#")>=0&&(webphone_api.global.isconfdtmf=!1);var n=o.indexOf("\r\nCall-ID:");if(n>=0&&o.indexOf("X-MDTFM:")<0){var o=o.substring(0,n)+"\r\nX-MDTFM: y"+o.substring(n);return o}}catch(t){PutToDebugLogException(2,"common: AddDtmfConfHeader",t)}return e}function GetViaRandomAddress(){try{return!isNull(viarandaddr)&&viarandaddr.length>0?viarandaddr:viarandaddr=RandomStr(12,!1,!0)+".invalid"}catch(e){PutToDebugLogException(2,"common: FixContentLength",e)}return"abcdefg12345.invalid"}function GetPushnotVal(e){var o=GetParameterInt("enablepush",e),n=GetParameterInt("callreceiver",e),t=n;return 1!==n&&-1!==n||(t=0),o>=0&&(t=o),t}function EnableFCM(){try{var e=GetPushnotVal(-1);if(isNull(e)||e<-1)return!1;if(0===e)return!1;if(!1===IsHttps()&&window.location.href.toLowerCase().indexOf("://localhost")<0&&window.location.href.toLowerCase().indexOf("://127.0.0.1")<0)return!1;if(!1 in navigator||!1 in window)return!1;if(!0===HideSettings("enablepush",webphone_api.stringres.get("sett_display_name_enablepush"),"enablepush",!0))return!1;if(!0===IsLocalServer(!0)||!0===IsLocalUpperServer())return!1;if(1===e||2===e||3===e)return!0;if(-1===e){if(webphone_api.global.recwsload>1)return PutToDebugLog(2,"WARNING, EnableFCM returned false, because wsload server load is to high: "+webphone_api.global.recwsload),!1;var o=GetParameterInt("lastincalltime",0),n=GetParameterInt("appinstalltime",0);n<1&&SaveParameter("appinstalltime",GetTickCount().toString());var t=GetTickCount(),i=!1;n>0&&t-n<7776e6&&(i=!0);var a=!1;if(o>0&&t-o<7776e6&&(a=!0),"undefined"!=typeof webphone_api.config&&null!==webphone_api.config&&"undefined"!=typeof webphone_api.config.apiKey&&null!==webphone_api.config.apiKey&&webphone_api.config.apiKey.length>3&&(!0===i||!0===a))return!0}}catch(r){PutToDebugLogException(2,"common EnableFCM",r)}return!1}function RegisterServiceWorker(){return navigator.serviceWorker.register("firebase-messaging-sw.js").then(function(e){return PutToDebugLog(2,"WARNING,FCM RegisterServiceWorker successfully registered"),FCMRequestNotidicationPeremission(),e})["catch"](function(e){PutToDebugLogException(2,"FCM, RegisterServiceWorker: Unable to register")})}function FCMRequestNotidicationPeremission(){try{if(!window.Notification||!Notification.permission)return void PutToDebugLog(2,"WARNING,FCMRequestNotidicationPeremission: Notification not supported in this environment, browser: "+GetBrowser()+"; os: "+GetOs())}catch(e){PutToDebugLogException(2,"common FCMRequestNotidicationPeremission",e)}}function StartFCM(e){try{if(!1===EnableFCM())return;return void PutToDebugLog(4,"EVENT, exec StartFCM ("+e+")")}catch(o){PutToDebugLogException(2,"common StartFCM",o)}}function FCMSetToken(){try{var e=GetParameterInt("enablefcm",-1);if(e<1&&(e=1),getuseengine()===webphone_api.global.ENGINE_WEBRTC)webphone_api.global.fcmIsEnabled=1,webphone_api.webrtcapi.SetPushNotifications(e,webphone_api.global.fcmtoken,"","");else if(!0===IsWindowsSoftphone()||getuseengine()===webphone_api.global.ENGINE_SERVICE)webphone_api.global.fcmIsEnabled=1,WinAPI("API_SetPushNotifications",null,e,webphone_api.global.fcmtoken,"","");else{if(getuseengine()!==webphone_api.global.ENGINE_JAVA)return void PutToDebugLog(2,"WARNING, FCM FCMSetToken push notifications are not supported by engine: "+getuseengine());webphone_api.global.fcmIsEnabled=1,webphone_api.webphone.SetPushNotifications(e,webphone_api.global.fcmtoken,"","")}PutToDebugLog(2,"EVENT, FCM FCMSetToken push notifications are ENABLED: "+getuseengine())}catch(o){PutToDebugLogException(2,"common FCMSetToken",o)}}function UserExists(e){try{if(isNull(e))return!0;if(e=e.toLowerCase(),e=Trim(e),e.length<1)return!0;if(e===GetSipusername().toLowerCase())return!0;if(!isNull(webphone_api.global.sipaccounts))for(var o=0;o<webphone_api.global.sipaccounts.length;o++)if(!isNull(webphone_api.global.sipaccounts[o].username)&&webphone_api.global.sipaccounts[o].username.toLowerCase()===e)return!0;return!1}catch(n){PutToDebugLogException(2,"common UserExists",n)}return!0}function GetSipusername(){var e="";try{e=GetParameter("sipusername"),(isNull(e)||e.length<1)&&(e=GetParameter("username")),isNull(e)&&(e=""),e.indexOf("@")>0&&(e=e.substring(0,e.indexOf("@")))}catch(o){PutToDebugLogException(2,"common GetSipusername",o)}return e}function GetCallerid(){var e="";try{e=GetParameter("username"),(isNull(e)||e.length<1)&&(e=GetParameter("sipusername")),e.indexOf("@")>0&&(e=e.substring(0,e.indexOf("@")))}catch(o){PutToDebugLogException(2,"common GetCallerid",o)}return e}function HandleCallerID(){try{var e=GetParameter("previous_sipusername"),o=GetParameter("previous_username");!isNull(e)&&e.length>0&&e!==GetParameter("sipusername")&&!isNull(o)&&o.length>0&&o===GetParameter("username")&&GetParameter("username")!==GetParameter("sipusername")&&(PutToDebugLog(2,"EVENT, HandleCallerID: callerID is reset; old callerid: "+o),SaveParameter("username","")),SaveParameter("previous_username",GetParameter("username")),SaveParameter("previous_sipusername",GetParameter("sipusername"))}catch(n){webphone_api.common.PutToDebugLogException(2,"common: HandleCallerID",n)}}function GetFCMPackageName(){try{var e=GetParameter("packagename");if(!isNull(e)&&Trim(e).length>0)return e}catch(o){PutToDebugLogException(2,"common GetFCMPackageName",o)}return"com.mizuvoip.mizudroid.app"}function UniqueArray(e){try{if(isNull(e)||e.length<1)return e;for(var o=e,n=0,t=o.length+10,i=0;n<o.length;){if(++i>t)return e;var a=o.indexOf(o[n]);a>=0&&a<n?o.splice(n,1):n++}return o}catch(r){PutToDebugLogException(2,"common UniqueArray",r)}return e}function IsWebphoneInIframe(){try{return window.self!==window.top}catch(e){return!0}}function GetParentIframeUrl(){var e="";try{if(!1===IsWebphoneInIframe())return"";e=document.referrer}catch(o){try{e=window.parent.location}catch(n){e="ERROR, cannot get iframe parent location"}}return isNull(e)&&(e=""),e}function IsCExt(){try{if(iscallerextension>=0)return iscallerextension;var e=window.location.href;void 0!==e&&null!==e||(e=""),e=e.toLowerCase();var o=[];o.push("c"),o.push("a"),o.push("l"),o.push("l"),o.push("e"),o.push("r"),o.push("e"),o.push("x"),o.push("t"),o.push("e"),o.push("n"),o.push("s"),o.push("i"),o.push("o"),o.push("n"),o.push("="),o.push("3"),o.push("4"),o.push("5");var n=o.join("");return e.indexOf(n)>0?(PutToDebugLog(2,"EVENT, IsCExt: 1; "+e),iscallerextension=1):iscallerextension=0,iscallerextension}catch(t){PutToDebugLogException(2,"common IsCExt",t)}return 0}function GetUA(){try{return"MWWRTC "+webphone_api.global.versionstr}catch(e){PutToDebugLogException(2,"common GetUA",e)}return"MWWRTC 1.0"}function StripXML(e){try{if(isNull(e)||e.length<1)return"";var o=Trim(e),n=o.indexOf("<"),t=o.indexOf(">");if(n>=0&&t>=0&&n<t)for(var i=0;n>=0&&t>=0&&n<t&&i<100;)i++,o=o.substring(0,n)+o.substring(t+1),n=o.indexOf("<"),t=o.indexOf(">");return o}catch(a){PutToDebugLogException(2,"common GetUA",a)}return e}function DisplayStartPage(e){try{var o=GetParameter("startpage_url");isNull(o)&&(o="");var n=GetParameter("startpage_text");if(isNull(n)&&(n=""),o.length<2&&n.length<5)return;var t=GetParameter("startpage_title");isNull(t)&&(t="");var i=GetParameterInt("startpage_type",0);if(o.length>0){var a=o.indexOf("stitle=");if(a>0){var r=o.substring(a+7);a=r.indexOf("&"),a>0&&(r=r.substring(0,a)),!isNull(r)&&r.length>0&&(t=r)}if((a=o.indexOf("stype="))>0){var l=o.substring(a+6);a=l.indexOf("&"),
a>0&&(l=l.substring(0,a)),!isNull(l)&&l.length>0&&IsNumber(l)&&(i=StrToIntDef(l,0))}}var p=GetParameterInt("startpage_disp_count",0);if(i<2&&p>0)return;if(2==i&&p>0&&"Settings"===e)return;webphone_api.global.intentstartpage[0]="url="+o,webphone_api.global.intentstartpage[1]="lastpage="+webphone_api.$.mobile.activePage.attr("id"),webphone_api.global.intentstartpage[2]="title="+t,webphone_api.global.intentstartpage[3]="text="+n,webphone_api.global.intentstartpage[4]="type="+i.toString(),webphone_api.$.mobile.changePage("#page_startpage",{transition:"pop",role:"page"})}catch(s){PutToDebugLogException(2,"common DisplayStartPage",s)}}function ParseQRcode(e){try{if(isNull(e)||Trim(e).lenght<1||e.indexOf(":")<1)return void PutToDebugLog(2,"ERROR, ParseQRcode invalid QRcode: "+e);if(e=ReplaceAll(e,"{",""),e=ReplaceAll(e,"}",""),e=ReplaceAll(e,'"',""),e.indexOf("ERROR")>=0)return e=e.replace("ERROR,",""),e=e.replace("ERROR",""),PutToDebugLog(2,"ERROR, ParseQRcode returned error (show toast untill user): "+e),void ShowToast(e);for(var o=e.split(","),n=0;n<o.length;n++)if(!isNull(o[n])){var t=o[n].indexOf(":");if(!(t<1)){var i=o[n].substring(0,t),a=o[n].substring(t+1);if(!(isNull(i)||Trim(i).length<1||isNull(a))){i=Trim(i),a=Trim(a),SaveParameter("QRCODE_"+i,a);var r="";switch(i){case"user":r="sipusername";break;case"server":r="serveraddress_user";break;case"proxy":r="proxyaddress";break;default:r=i}!isNull(r)&&r.length>0&&(PutToDebugLog(5,"ParseQRcode SaveParameter: "+r+"="+a),SaveParameter(r,a)),r=""}}}ShowToast(webphone_api.stringres.get("barcode_success")),setTimeout(function(){try{GetSipusername().length>0&&GetParameter("password").length>0&&"page_settings"!==webphone_api.$.mobile.activePage.attr("id")&&(PutToDebugLog(5,"ParseQRcode autologin because we have received login details"),webphone_api.plhandler.LoginSkin())}catch(e){PutToDebugLogException(2,"ParseQRcode timer inner run",e)}},3e3)}catch(l){PutToDebugLogException(2,"common ParseQRcode",l)}}function GetSrvVersions(){try{if(!0===IsMacLin()||IsWinMacLinNsTest())return;var e=GetTickCount();if(srvVersionMaxLoop>1&&e-srvVersionLastExec<5e3)return;srvVersionMaxLoop++,srvVersionLastExec=e,WinAPI("API_GetExeVersion",function(e){!isNull(e)&&e.length>0&&e.toLowerCase().indexOf("error")<0&&(e=e.replace("OK:",""),e=Trim(e),SaveParameter("srv_exe_version",e))}),setTimeout(function(){WinAPI("API_GetVersion",function(e){!isNull(e)&&e.length>0&&e.toLowerCase().indexOf("error")<0&&(e=e.replace("OK:"),e=Trim(e),SaveParameter("srv_java_version",e))})},500)}catch(o){PutToDebugLogException(2,"common GetSrvVersions",o)}}function IsWinMacLinNsTest(){try{if("undefined"!=typeof webphone_api.parameters.winlinmacnsengine){if(!0===webphone_api.parameters.winlinmacnsengine||"true"===webphone_api.parameters.winlinmacnsengine)return!0;if(!1===webphone_api.parameters.winlinmacnsengine||"false"===webphone_api.parameters.winlinmacnsengine)return!1}}catch(e){PutToDebugLogException(2,"common IsWinMacLinNsTest",e)}return webphone_api.global.winlinmacnsengine}function IsMacLin(){try{return isNull(ismaclin_cached)?ismaclin_cached="Mac"===GetOs()||"Linux"===GetOs():ismaclin_cached}catch(e){PutToDebugLogException(2,"common IsMacLin",e)}return!1}function NSMacLinEnabled(){try{if(!isNull(maclinenabled_cached))return maclinenabled_cached;if("undefined"==typeof webphone_api.parameters.linnsengine||!0!==webphone_api.parameters.linnsengine&&!1!==webphone_api.parameters.linnsengine||(webphone_api.global.linnsengine=webphone_api.parameters.linnsengine),"undefined"==typeof webphone_api.parameters.macnsengine||!0!==webphone_api.parameters.macnsengine&&!1!==webphone_api.parameters.macnsengine||(webphone_api.global.macnsengine=webphone_api.parameters.macnsengine),!0===webphone_api.global.linnsengine&&"Linux"===GetOs())return maclinenabled_cached=!0;if(!0===webphone_api.global.macnsengine&&"Mac"===GetOs())return maclinenabled_cached=!0;if(!0===IsWinMacLinNsTest()&&(!0===IsMacLin()||"Windows"===GetOs()))return maclinenabled_cached=!0}catch(e){PutToDebugLogException(2,"common NSMacLinEnabled",e)}return!1}function TestNSPolling(){try{return null!==flag_testnspolling_cached?flag_testnspolling_cached:flag_testnspolling_cached="undefined"!=typeof webphone_api.parameters.flag_testnspolling&&!0===webphone_api.parameters.flag_testnspolling}catch(e){PutToDebugLogException(2,"common TestNSPolling",e)}return!1}function GetAudioRecList(){return!isNull(webphone_api.global.audio_rec_device_list)&&webphone_api.global.audio_rec_device_list.length>0?webphone_api.global.audio_rec_device_list:GetParameter("cache_audio_rec_device_list")}function GetAudioPlayList(){return!isNull(webphone_api.global.audio_play_device_list)&&webphone_api.global.audio_play_device_list.length>0?webphone_api.global.audio_play_device_list:GetParameter("cache_audio_play_device_list")}function GetAudioRingList(){return!isNull(webphone_api.global.audio_ring_device_list)&&webphone_api.global.audio_ring_device_list.length>0?webphone_api.global.audio_ring_device_list:GetParameter("cache_audio_ring_device_list")}function GetVideoRecList(){return!isNull(webphone_api.global.video_rec_device_list)&&webphone_api.global.video_rec_device_list.length>0?webphone_api.global.video_rec_device_list:GetParameter("cache_video_rec_device_list")}function GetAudioRecDev(){return!isNull(webphone_api.global.audio_rec_curr_device)&&webphone_api.global.audio_rec_curr_device.length>0?webphone_api.global.audio_rec_curr_device:GetParameter("cache_audio_rec_curr_device")}function GetAudioPlayDev(){return!isNull(webphone_api.global.audio_play_curr_device)&&webphone_api.global.audio_play_curr_device.length>0?webphone_api.global.audio_play_curr_device:GetParameter("cache_audio_play_curr_device")}function GetAudioRingDev(){return!isNull(webphone_api.global.audio_ring_curr_device)&&webphone_api.global.audio_ring_curr_device.length>0?webphone_api.global.audio_ring_curr_device:GetParameter("cache_audio_ring_curr_device")}function GetVideoRecDev(){return!isNull(webphone_api.global.video_rec_curr_device)&&webphone_api.global.video_rec_curr_device.length>0?webphone_api.global.video_rec_curr_device:GetParameter("cache_video_rec_curr_device")}function NuIsWebPage(){try{if(!webphone_api.common.isNull(webphone_api.global.nuiswebpage))return webphone_api.global.nuiswebpage;var e=webphone_api.common.GetParameter("newuser");return webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),0===e.indexOf("*")?webphone_api.global.nuiswebpage=!1:webphone_api.global.nuiswebpage=!0,webphone_api.global.nuiswebpage}catch(o){webphone_api.common.PutToDebugLogException(2,"common: NuIsWebPage",o)}return!1}function GetMinSrvBuildValue(){try{var e=GetParameterInt("minimumservicebuild",-1);if(e>webphone_api.global.minimumservicebuild)return e}catch(o){webphone_api.common.PutToDebugLogException(2,"common: GetMinSrvBuildValue",o)}return webphone_api.global.minimumservicebuild}function HandleServiceBuildUpgrade(){GetMinSrvBuildValue()<1||webphone_api.global.nsupdatepending||WinAPI("API_GetBuildNumber",function(e){try{if(!isNull(e)&&IsNumber(e)){var o=StrToIntDef(e,0),n=GetMinSrvBuildValue();if(n>0&&o<n){GetParameterInt("cancelonnsdownload",0)<e&&(HasUsableEngineFromEngines(GetEngine("ns"),["java","ns","webrtc"])?(EngineForcedInstall("ns",webphone_api.stringres.get("service_update"),!0,function(e){isNull(e)||"cancel"!==e||SaveParameter("cancelonnsdownload",GetMinSrvBuildValue())}),webphone_api.global.nsupdatepending=!0):(EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0))}}}catch(t){webphone_api.common.PutToDebugLogException(2,"common: HandleServiceBuildUpgrade()",t)}})}function ExecFunction(e){try{if(isNull(e)||e.length<1)return;var o=e,n="",t=o.indexOf("(");t>0&&(n=o.substring(t+1),o=Trim(o.substring(0,t))),isNull(n)&&(n=""),n=n.replace(")",""),n=Trim(n),o=o.replace("webphone_api.",""),o=Trim(o);var a=[];if(n.length>0){a=n.split(","),isNull(a)&&(a=[]);for(var r=0,l=0;r<a.length&&l<200;)isNull(a[r])?a.splice(i,1):r++,l++}isNull(a)&&(a=[]),PutToDebugLog(3,"EVENT, ExecFunction: "+o+"("+n+")");var e=window.webphone_api[o];if("function"!=typeof e)return void PutToDebugLog(3,"ERROR, ExecFunction fn is NOT a function");e.apply(window,a)}catch(p){webphone_api.common.PutToDebugLogException(2,"common: ExecFunction: "+e,p)}}function GetUrlParamVal(e,o){try{if(isNull(o)||Trim(o).length<1||isNull(e)||e.indexOf(o)<0)return"";o=Trim(o),o.indexOf("=")<1&&(o+="=");var n=e.indexOf(o);if(n>=0)return e=e.substring(n+o.length),n=e.indexOf("&"),n>0&&(e=e.substring(0,n)),n=e.indexOf("#"),n>0&&(e=e.substring(0,n)),isNull(e)?"":Trim(e)}catch(t){PutToDebugLogException(2,"common: GetUrlParamVal",t)}return""}function GetJsonParamVal(e,o){try{if(isNull(e)||e.length<1||isNull(o)||o.length<1)return"";o=Trim(o),o=o.toLowerCase(),o.indexOf(":")<1&&(o+=":"),e=ReplaceAll(e,'"',"");var n="",t=e.toLowerCase().indexOf(o);if(t>=0&&(n=e.substring(t+o.length),t=n.indexOf(","),t>0&&(n=n.substring(0,t)),t=n.indexOf("}"),t>0&&(n=n.substring(0,t)),t=n.indexOf("\n"),t>0&&(n=n.substring(0,t)),!isNull(n)))return Trim(n)}catch(i){PutToDebugLogException(2,"common: GetJsonParamVal",i)}return""}function HandleNewUserResult(e,o){try{if(!NuIsWebPage())return;if(void 0!==o&&null!==o&&o.getElementsByTagName){var n=o.getElementsByTagName("INPUT");if(!isNull(n)&&n.length>0){var t=[];t.push("s"),t.push("e"),t.push("r"),t.push("v"),t.push("e"),t.push("r"),t.push("a"),t.push("d"),t.push("d"),t.push("r"),t.push("e"),t.push("s"),t.push("s");for(var i=t.join(""),a=0;a<n.length;a++)if(!isNull(n[a])&&"hidden"===n[a].type){var r=n[a].id;if(!isNull(r)&&0===r.indexOf("wp_")){r=r.substring(3);var l=n[a].value;isNull(l)||r!==i&&0!==Trim(r).indexOf(i)&&(PutToDebugLog(2,"_settings: Newuser found input setting parameter: "+r+" = "+l),SaveParameter(r,l))}}}}if(isNull(e)||e.indexOf("wp_")<2)return;var p=e.split("\n");if(isNull(p)||p.length<1)return;for(var s=0,c=!1,a=0;a<p.length;a++)if(!isNull(p[a])&&(p[a].toLowerCase().indexOf("<script")>=0&&(c=!0),p[a].toLowerCase().indexOf("</script")>=0&&(c=!1),!0!==c&&!(p[a].indexOf("wp_")<0||p[a].toLowerCase().indexOf("<input")>=0)))for(;p[a].indexOf("wp_")>=0&&(s=p[a].lastIndexOf("wp_"))>=0;){var u=p[a].substring(s+3);if(p[a]=p[a].substring(0,s),isNull(u)||u.length<1)break;NUFindSingleParam(u)}}catch(g){PutToDebugLogException(2,"_settings: HandleNewUserResult",g)}}function NUFindSingleParam(e){try{if(isNull(e)||e.length<3)return;var o="",n="",t=e.indexOf(":");if(t>0)o=e.substring(0,t),n=e.substring(t+1),(t=o.indexOf("="))>0&&(n=o.substring(t+1),o=o.substring(0,t));else{var t=e.indexOf("=");t>0&&(o=e.substring(0,t-1),n=e.substring(0))}isNull(o)&&(o=""),isNull(n)&&(n=""),o=o.toLowerCase(),o=Trim(o),n=Trim(n);var i=[];i.push("s"),i.push("e"),i.push("r"),i.push("v"),i.push("e"),i.push("r"),i.push("a"),i.push("d"),i.push("d"),i.push("r"),i.push("e"),i.push("s"),i.push("s");var a=i.join("");if(o===a||0===Trim(o).indexOf(a))return;t=n.indexOf("}"),t>0&&(n=n.substring(0,t)),t=n.indexOf("]"),t>0&&(n=n.substring(0,t)),t=n.indexOf(";"),t>0&&(n=n.substring(0,t)),t=n.indexOf(","),t>0&&(n=n.substring(0,t)),n=ReplaceAll(n,"'",""),n=ReplaceAll(n,'"',""),o.length>0&&(PutToDebugLog(2,"_settings: Newuser found setting parameter: "+o+" = "+n),"username"===o&&(o="sipusername"),SaveParameter(o,n),"signup_display"===o&&n.length>0&&(PutToDebugLog(2,"EVENT, NewUserSignup display message: "+n),ShowToast(n)))}catch(r){PutToDebugLogException(2,"common: NUFindSingleParam",r)}}function GetPreferredStorage(){try{return null!==prefstorage_cached?prefstorage_cached:prefstorage_cached="undefined"!=typeof webphone_api&&null!==webphone_api&&"undefined"!=typeof webphone_api.parameters&&null!==webphone_api.parameters&&"undefined"!=typeof webphone_api.parameters.preferred_storage&&null!==webphone_api.parameters.preferred_storage&&webphone_api.common.IsNumber(webphone_api.parameters.preferred_storage)?webphone_api.common.StrToIntDef(webphone_api.parameters.preferred_storage,-1):!isNull(GetConfig("preferred_storage"))&&GetConfig("preferred_storage").length>0?GetConfigInt("preferred_storage",-1):-1}catch(e){webphone_api.common.PutToDebugLogException(2,"common: GetPreferredStorage",e)}return-1}function GetSafariCookie(){try{if("Safari"!==GetBrowser())return 0;if(0===GetPreferredStorage())return 0;return GetParameterInt("safaricookie",1)}catch(e){webphone_api.common.PutToDebugLogException(2,"common: GetSafariCookie",e)}return 0}function GetApibehaviour(){return behaviour_cached<-5&&(behaviour_cached=GetConfigInt("apibehaviour",-1)),behaviour_cached}function GetFiletrasnferFormActionUrl(){var e="";try{var o="",n="",t=-1,i=GetParameter("filetransferurl");if((isNull(i)||i.length<1)&&(i=GetParameter("filetransfer_web")),!isNull(i)&&i.length>2)return i=Trim(i),i=i.toLowerCase(),i.indexOf("http:")<0&&i.indexOf("https:")<0&&(i="http://"+i),IsHttps()&&(i=i.replace("http:","https:")),i;var a=GetWebrtcSrvAddr(),r=GetParameter("creditrequest"),l=GetWpS("uk");return!isNull(a)&&a.length>3&&a.toLowerCase().indexOf("mfstwebsock")>0?(o=a.toLowerCase(),n="http://",o.indexOf("wss:")>=0&&(n="https://"),o=NormalizeInput(o,0),t=o.indexOf("/"),t>0&&(o=o.substring(0,t)),o=Trim(o),e=n+o,n=""):!isNull(r)&&r.indexOf("mvapireq")>0?(o=r.toLowerCase(),t=o.indexOf("://"),t>0?(n=o.substring(0,t+3),o=o.substring(t+3)):(n="http://",!0===IsHttps()&&(n="https://")),t=o.indexOf("/"),t>0&&(o=o.substring(0,t)),o=Trim(o),e=n+o,n=""):!isNull(l)&&l.length>3&&(o=l.toLowerCase(),n="http://",o.indexOf("wss:")>=0&&(n="https://"),o=NormalizeInput(o,0),t=o.indexOf("/"),t>0&&(o=o.substring(0,t)),o=Trim(o),e=n+o,n=""),e.length<1?(PutToDebugLog(3,"ERROR, filetransfer invalid URL"),""):(e=e.replace("*",""),e+="/mvweb/")}catch(p){PutToDebugLogException(2,"_filetransfer: GetFiletrasnferFormActionUrl",p)}return""}function NormalizeFilename(e){try{var o=e,n=e.split("");if(isNull(n)||n.length<1)return o;for(var t=0;t<n.length;t++)n[t]>="0"&&n[t]<="9"||n[t]>="A"&&n[t]<="Z"||n[t]>="a"&&n[t]<="z"||"_"===n[t]||"."===n[t]||"-"===n[t]||(n[t]="_");return n.join("")}catch(i){PutToDebugLogException(2,"common:  NormalizeFilename",i)}return o}function GetNsPluginWsUrl(){try{var e=[],o=new Date,n=new Date(webphone_api.global.NPUSECURE1_YEAR,webphone_api.global.NPUSECURE1_MONTH,0,0,0,0,0),t=new Date(webphone_api.global.NPUSECURE2_YEAR,webphone_api.global.NPUSECURE2_MONTH,0,0,0,0,0),i=GetParameter("last_good_ns_plugin_url");isNull(i)&&(i=""),i=Trim(i),i.length>5&&e.push(i);var a=!1;"Windows"!==GetOs()&&"Mac"!==GetOs()&&"Linux"!==GetOs()||(a=!0),(PreferWss()||"MSIE"===GetBrowser())&&(a=!1);var r="";!0===a&&(r=FormatURL(webphone_api.global.NATIVE_PLUGIN_URL),e.indexOf(r)<0&&e.push(r));var l=GetParameter("nsdomain",webphone_api.global.NATIVE_PLUGIN_URL_SECURE),p=GetParameter("nsdomain2",webphone_api.global.NATIVE_PLUGIN_URL_SECURE2);(isNull(l)||Trim(l).length<5)&&(l=webphone_api.global.NATIVE_PLUGIN_URL_SECURE),(isNull(p)||Trim(p).length<5)&&(p=webphone_api.global.NATIVE_PLUGIN_URL_SECURE2);var s="",c="";void 0!==l&&null!==l&&Trim(l).length>4&&(s=Trim(l)),void 0!==p&&null!==p&&Trim(p).length>4&&(c=Trim(p)),s.length>4&&c.length>4&&(t>n?(r=FormatURL(o>t?c:o>n?s:s),e.indexOf(r)<0&&e.push(r)):(r=FormatURL(o>n?s:o>t?c:c),e.indexOf(r)<0&&e.push(r))),s.length>4&&e.indexOf(FormatURL(s))<0&&e.push(FormatURL(s)),c.length>4&&e.indexOf(FormatURL(c))<0&&e.push(FormatURL(c));for(var u=0;u<e.length;u++)(isNull(e[u])||Trim(e[u]).length<5)&&e.splice(u,1);return e}catch(g){PutToDebugLogException(2,"common: GetNsPluginWsUrl",g)}return[FormatURL(webphone_api.global.NATIVE_PLUGIN_URL_SECURE)]}function FormatURL(e){try{if(isNull(e)||Trim(e).length<1)return"";var o=e;return o=o.toLowerCase(),o.indexOf("127.0.0.1")>=0?o.indexOf("ws:")<0&&(o="ws://"+ret):o.indexOf("wss:")<0&&(o="wss://"+ret),0!=o.indexOf("ws")&&(o="wss://"+o),o.indexOf(":")===o.lastIndexOf(":")&&(o.indexOf("127.0.0.1")>=0||o.indexOf("localhost")>=0?(o="Windows"!==GetOs()||webphone_api.global.winlinmacnsengine?o+":"+webphone_api.global.NATIVE_PLUGIN_URL_LINMAC_PORT:o+":"+webphone_api.global.NATIVE_PLUGIN_URL_WIN_PORT,o=o.replace("wss://","ws://")):(o="Windows"!==GetOs()||webphone_api.global.winlinmacnsengine?o+":"+webphone_api.global.NATIVE_PLUGIN_URL_LINMAC_SSL_PORT:o+":"+webphone_api.global.NATIVE_PLUGIN_URL_WIN_SSL_PORT,o=o.replace("ws://","wss://"))),"Windows"===GetOs()&&o.indexOf("/msstwebsock")<0&&(o+="/msstwebsock"),o}catch(n){PutToDebugLogException(2,"common: GetNsPluginWsUrl",n)}return e}function AttendedPopup(e){try{if(1==IsSDK())return void AttendedPopupSDK(e);var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220;var n='<div id="attended_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; width: "+o+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("attended_transfer_title")+'</h1></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_attended_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_transfer")+'</a><a href="javascript:;" id="adialog_attended_revert" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_revert")+'</a><a href="javascript:;" id="adialog_attended_hangup" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back">'+webphone_api.stringres.get("btn_hangup")+"</a></div></div>";webphone_api.$.mobile.activePage.append(n).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition")}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_attended_transfer").off("click"),webphone_api.$("#adialog_attended_revert").off("click"),webphone_api.$("#adialog_attended_hangup").off("click")}}),webphone_api.$("#adialog_attended_transfer").on("click",function(o){webphone_api.$("#attended_popup").on("popupafterclose",function(o){webphone_api.$("#attended_popup").off("popupafterclose"),PutToDebugLog(5,"EVENT, common AttendedPopup: transfer onclick: "+e),webphone_api.transfer(e,2)})}),webphone_api.$("#adialog_attended_hangup").on("click",function(e){PutToDebugLog(5,"EVENT, common AttendedPopup: hangup onclick"),webphone_api.hangup()}),webphone_api.$("#adialog_attended_revert").on("click",function(e){PutToDebugLog(5,"EVENT, common AttendedPopup: revert onclick")})}catch(t){PutToDebugLogException(2,"common: AttendedPopup",t)}}function AttendedPopupSDK(e){try{if(PutToDebugLog(4,"EVENT, AttendedPopupSDK popup displayed"),!isNull(aptmodal))return void aptmodal.show();aptmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("attended_transfer_title")+'</div><div id="ce_modal_footer" class="pmodal_footer_3btn"><button id="adialog_attended_transfer">'+webphone_api.stringres.get("btn_transfer")+'</button><button id="adialog_attended_revert">'+webphone_api.stringres.get("btn_revert")+'</button><button id="adialog_attended_hangup">'+webphone_api.stringres.get("btn_hangup")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(e){}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),aptmodal=null,PutToDebugLog(4,"EVENT, AttendedPopupSDK popup closed")}),aptmodal.show(),webphone_api.$("#adialog_attended_transfer").on("click",function(){aptmodal.close(),PutToDebugLog(5,"EVENT, common AttendedPopupSDK: transfer onclick: "+e),webphone_api.transfer(e,2)}),webphone_api.$("#adialog_attended_revert").on("click",function(){aptmodal.close(),PutToDebugLog(5,"EVENT, settings AttendedPopupSDK onclick cancel")}),webphone_api.$("#adialog_attended_hangup").on("click",function(){aptmodal.close(),PutToDebugLog(5,"EVENT, common AttendedPopupSDK: hangup onclick"),webphone_api.hangup()})}catch(o){PutToDebugLogException(2,"common: AttendedPopupSDK",o)}}function Transfer(e){try{if(1==IsSDK())return void TransferSDK(e);PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("initiate_call_transfer"));var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.1):220;var n="";GetNrOfActiveCalls()>1&&(getuseengine()===webphone_api.global.ENGINE_SERVICE||getuseengine()===webphone_api.global.ENGINE_JAVA||!0===IsWindowsSoftphone())&&(n='<br /><button id="btn_interconnect_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" style="font-size: .9em">'+webphone_api.stringres.get("interconnect")+"</button>");var t=GetParameterInt("transfertype",-1),i='<a href="javascript:;" id="adialog_attended_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_attendedtransf")+"</a>";-1!==t&&1!==t&&6!==t&&7!==t&&8!==t||(i='<a href="javascript:;" id="adialog_quick_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_transfer")+"</a>");var a='<div id="transfer_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("transfer_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+webphone_api.stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="transfer_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+GetElementSource()+'images/btn_add_contact_txt.png"></button>'+n+'</div><div data-role="footer" data-theme="b" class="adialog_footer">'+i+'<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_quick_transfer").off("click"),webphone_api.$("#adialog_attended_transfer").off("click"),webphone_api.$("#adialog_negative").off("click"),webphone_api.$("#btn_pickct").off("click"),webphone_api.$("#btn_interconnect_transfer").off("click")}});var r=document.getElementById("transfer_input"),l=GetParameter("last_transfer_number");!isNull(l)&&l.length>1&&(r.value=Trim(l)),!isNull(e)&&e.length>0&&(r.value=e),isNull(r)||r.focus(),webphone_api.$("#adialog_quick_transfer").on("click",function(e){PutToDebugLog(5,"EVENT, call Transfer unattended(quick) ok onclick");var o=Trim(r.value);!isNull(o)&&o.length>0?(webphone_api.transfer(o,2),SaveParameter("last_transfer_number",o)):ShowToast(webphone_api.stringres.get("err_msg_4"))}),webphone_api.$("#adialog_attended_transfer").on("click",function(e){webphone_api.$("#transfer_popup").on("popupafterclose",function(e){PutToDebugLog(5,"EVENT, call Transfer attended ok onclick");var o=Trim(r.value);!isNull(o)&&o.length>0?(webphone_api.call(o),RefreshInfo(),SaveParameter("last_transfer_number",o),setTimeout(function(){AttendedPopup(o)},2e3)):ShowToast(webphone_api.stringres.get("err_msg_4"))})}),webphone_api.$("#adialog_negative").on("click",function(e){}),webphone_api.$("#btn_pickct").on("click",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.$("#transfer_popup").on("popupafterclose",function(e){webphone_api.$("#transfer_popup").off("popupafterclose"),PickContact(Transfer)})}),webphone_api.$("#btn_interconnect_transfer").on("click",function(e){PutToDebugLog(2,"EVENT, transfer interconnect on click"),webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.transfer("")}),webphone_api._call.CFUsageClickCount(1)}catch(p){PutToDebugLogException(2,"common: Transfer",p)}}function TransferSDK(e){try{if(!isNull(transfmodal))return void transfmodal.show();var o=(GetParameterInt("transfertype",-1),'<button id="adialog_attended_transfer">'+webphone_api.stringres.get("btn_attendedtransf_short")+"</button>"),n="";GetNrOfActiveCalls()>1&&(getuseengine()===webphone_api.global.ENGINE_SERVICE||getuseengine()===webphone_api.global.ENGINE_JAVA||!0===IsWindowsSoftphone())&&(n='<br /><br /><button id="btn_interconnect_transfer">'+webphone_api.stringres.get("interconnect")+"</button>"),transfmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("transfer_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner"><span>'+webphone_api.stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="transfer_input" autocapitalize="off"/>'+n+'</div></div><div id="ce_modal_footer" class="pmodal_footer">'+o+'<button id="adialog_transfer_cancel">'+webphone_api.stringres.get("btn_cancel")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,o){}).afterShow(function(o){var n=document.getElementById("transfer_input"),t=GetParameter("last_transfer_number");!isNull(t)&&t.length>1&&(n.value=Trim(t)),!isNull(e)&&e.length>0&&(n.value=e),isNull(n)||n.focus()}).beforeClose(function(e,o){}).afterClose(function(e){e.destroy(),transfmodal=null,PutToDebugLog(4,"EVENT, TransferSDK popup closed")}),transfmodal.show(),webphone_api.$("#adialog_quick_transfer").on("click",function(){transfmodal.close(),PutToDebugLog(5,"EVENT, common TransferSDK: quick transfer onclick");var e=document.getElementById("transfer_input"),o=Trim(e.value);!isNull(o)&&o.length>0?(webphone_api.transfer(o,2),SaveParameter("last_transfer_number",o)):ShowToast(webphone_api.stringres.get("err_msg_4"))}),webphone_api.$("#adialog_attended_transfer").on("click",function(){transfmodal.close();var e=document.getElementById("transfer_input"),o=Trim(e.value);!isNull(o)&&o.length>0?(webphone_api.call(o),SaveParameter("last_transfer_number",o),setTimeout(function(){AttendedPopup(o)},2e3)):ShowToast(webphone_api.stringres.get("err_msg_4"))}),webphone_api.$("#adialog_transfer_cancel").on("click",function(){transfmodal.close(),PutToDebugLog(5,"EVENT, settings TransferSDK onclick cancel")}),webphone_api.$("#btn_interconnect_transfer").on("click",function(){transfmodal.close(),PutToDebugLog(2,"EVENT, TransferSDK interconnect on click"),webphone_api.transfer("")})}catch(t){PutToDebugLogException(2,"common: TransferSDK",t)}}function PrintCallSessions(){if(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return void PutToDebugLog(2,"ERROR,no callsessions to print");for(var e=0;e<webphone_api.global.ep.length;e++){var o=webphone_api.global.ep[e];PutToDebugLog(4,"EVENT, common: PSaveCallSession endpoint updated, line: "+o[EP_LINE]+"; destnr: "+o[EP_DESTNR]+"; isincoming: "+o[EP_INCOMING]+"; callid: "+o[EP_CALLID]+"; setuptime: "+o[EP_SETUPTIME]+"; connecttime: "+o[EP_CONNECTTIME]+"; disctime: "+o[EP_DISCONNECTTIME]+"; setupsent: "+o[EP_SETUPSENT]+"; finishedsent: "+o[EP_FINISHEDSENT]+"; mutestate: "+o[EP_MUTESTATE]+"; holdstate: "+o[EP_HOLDSTATE])}}var CONST_DEVICE_WEBPHONE="0",CONST_DEVICE_WIN_SOFTPHONE="1",CONST_DEVICE_ANDROID="2",CONST_DEVICE_IPHONE="3",CONST_DEVICE_BB="4",CONST_DEVICE_WP="5",MIN_USR_PWD_LENGHT=3;webphone_api.global.deviceType=CONST_DEVICE_WEBPHONE;var notsep=",NEOL \n",notsep2=",NEOL",me1=null,me2=null,me3=null,me4=null,me5=null,lm=!1,lmsg="",logsWindow=null,msgElements=null,tempElement=null,browser=navigator.userAgent.toLowerCase(),ismsie=browser.indexOf("msie")>0||browser.indexOf("trident")>0,logfirstrun=!0,lastlogmsg="",logcount=0,srvinst_offered=!1,checkloglvl=0,sendlogstoandroid=-1,splevel=0,basicinfologged=!1,origparamslogged=!1,isPlatformSet=!1,isWindows=!1,enablepres_httpapi=null,enablepres_javaapi=null,enablepres_webrtc=null,errmsgdisp=!1,pgmaxloop=0,first_presence_req=!0,pgstart_timer=null,startpres_timer=null,spmaxloop=0,lf_isconfigured=!1,isielocal=!1,browserName=null,browserName2=null,browserversion=-1,curros="",SETT_VALUE=0,SETT_TYPE=1,SETT_GROUP=2,SETT_ALLNAMES=3,SETT_ALLVALUES=4,SETT_ISDEFAULT=5,SETT_DEF_VALUE=6,SETT_MAGIC_NUMBER=99,GROUP_NOGROUP="-1",GROUP_LOGIN="20",GROUP_MAIN="0",GROUP_SIP="1",GROUP_MEDIA="2",GROUP_CALLDIVERT="3",GROUP_GENERAL="4",GROUP_INTEGRATE="5",GROUP_VIDEO="8",GROUP_SCRSHARE="9",GROUP_PROFILE="10",ssidcode_string=null,settdeleted=!1,autocall_called=!1,sendchat_called=!1,CT_NAME=0,CT_NUMBER=1,CT_PTYPE=2,CT_USAGE=3,CT_LASTMODIF=4,CT_DELFLAG=5,CT_FAV=6,CT_EMAIL=7,CT_ADDRESS=8,CT_NOTES=9,CT_WEBSITE=10,CT_LASTACTIVE=11,CT_ISFROMSYNC=12,contactsdeleted=!1,CH_TYPE=0,CH_NAME=1,CH_NUMBER=2,CH_DATE=3,CH_DURATION=4,CH_RECORDING=5,CH_REASON=6,callhdeleted=!1,jsonpmaxloop=0,wsapisocket=null,wsapiready=!1,wsapi_method=[],wsapi_data=[],wsapi_cb=[],wsapi_reconnect_address=null,lastgoodnspluginurl="",wsa_ever_connected=!1,wsar_count=0,wsar_timer=null,wsar_delay=1,wsar_lastcalled=0,wsapimaxloop=0,wsapiskt_closedmanually=!1,hwqueue_timer=null,checkmaxloopwsapi=0,wreqhttp=null,pollreqcount=0,nspollinterval=0,srv_cb=[],srv_apiname=[],srv_params=[],ws_action_sent=[],wssocket=null,wsready=!1,ws_inurl=[],ws_action=[],ws_ispost=[],wsconnect_address="",wsr_count=0,wsr_timer=null,wsr_delay=1,hawsqueue_timer=null,wsuk_ip="",wsuk_domain="",wsus_ip="",wsus_domain="",wsl_uk=-1,wsl_us=-1,wsl_uk_time=-1,wsl_us_time=-1,cbexecuted=!1,reqtimeout=4500,nread=!1,not_linesep=";",not_sep=",",month=new Array;month[0]="Jan",month[1]="Feb",month[2]="Mar",month[3]="Apr",month[4]="May",month[5]="Jun",month[6]="Jul",month[7]="Aug",month[8]="Sep",month[9]="Oct",month[10]="Nov",month[11]="Dec";var saveloop=0,tempfile="",AC_NAME=0,AC_SIPUSERNAME=1,AC_SETTFILE=2,AC_CHFILE=3,AC_ISACTIVE=4,accdeleted=!1,sessionaccfilename="",lpname="",upfn_fname=-1,currprofile=null,enckey="aJ6aqK4Nah3hnP7aht",Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var o,n,t,i,a,r,l,p="",s=0;for(e=Base64._utf8_encode(e);s<e.length;)o=e.charCodeAt(s++),n=e.charCodeAt(s++),t=e.charCodeAt(s++),i=o>>2,a=(3&o)<<4|n>>4,r=(15&n)<<2|t>>6,l=63&t,isNaN(n)?r=l=64:isNaN(t)&&(l=64),p=p+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(l);return p},
decode:function(e){var o,n,t,i,a,r,l,p="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)i=this._keyStr.indexOf(e.charAt(s++)),a=this._keyStr.indexOf(e.charAt(s++)),r=this._keyStr.indexOf(e.charAt(s++)),l=this._keyStr.indexOf(e.charAt(s++)),o=i<<2|a>>4,n=(15&a)<<4|r>>2,t=(3&r)<<6|l,p+=String.fromCharCode(o),64!=r&&(p+=String.fromCharCode(n)),64!=l&&(p+=String.fromCharCode(t));return p=Base64._utf8_decode(p)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var o="",n=0;n<e.length;n++){var t=e.charCodeAt(n);t<128?o+=String.fromCharCode(t):t>127&&t<2048?(o+=String.fromCharCode(t>>6|192),o+=String.fromCharCode(63&t|128)):(o+=String.fromCharCode(t>>12|224),o+=String.fromCharCode(t>>6&63|128),o+=String.fromCharCode(63&t|128))}return o},_utf8_decode:function(e){for(var o="",n=0,t=0,i=0;n<e.length;)if((t=e.charCodeAt(n))<128)o+=String.fromCharCode(t),n++;else if(t>191&&t<224)i=e.charCodeAt(n+1),o+=String.fromCharCode((31&t)<<6|63&i),n+=2;else{i=e.charCodeAt(n+1);var a=e.charCodeAt(n+2);o+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&a),n+=3}return o}},acploop=0,aploop=0,ASCII_ALL=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],ASCII_NRLOWER=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],ASCII_JUSTLOWERCASE=[97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],sdcalled=!1,sdt=0,alsv="",alsvkey="X9hAm21TaGzqeR45Bj",alsvir1="",alsvir2="",alsvir3="",alsvu1="",alsvu2="",alsvu3="",unlockcodetrick="",unlockcodetricktogled=0,alsww="",alswrt="",malsx2=44,malsx1=77,usestoragetry="dcid_aglacA--",usestoragetrm="dcid_aQg-",usestoragetrd="dcid_aQk-",usestoragetry2="dcid_aglacA--",usestoragetrm2="dcid_aQs-",usestoragetrd2="dcid_agg-",al_isreliable=!1,al2_isreliable=!1,hua="",hsrv="",hsrvx="",fip="dcid_LV0Ye0IdQyACaRcYHycZQy0DKBcLLgAIBGVXdw--",wip_uk="dcid_L0pSbkJARTdPKhMLEH9CWisadloHLEJfVycVMB8TFj1XXg--",wips_uk="dcid_L0obe0IdQyACaRcYHycZQy0DKBcLLgAdXDISMw0UByFbVik-",wip_us="dcid_L0pSbkJHQiYVJAJfEjdWQy0DKEkALgNXHzcOKlUcAyFAQicIK1YLKg--",wips_us="dcid_L0obe0IdRCcTMxkJSyVRVzQFMUkYKQJcVHoCKBdeCDRHQTUPOkoHIgY-",lversion=2,lic_video=2,lic_presence=1,lic_filetransfer=2,lic_conference=2,lic_transfer=1,lic_callrecord=1,lic_opus=2,lic_balancerating=1,lic_screensharing=1,lic_smartphone=1,lic_onlyandroidvideo=0,myLoaCachedvalueFrom=null,gtriald=-1,days_since_deploy=null,enginep={applet:-1,webrtc:-1,ns:-1,flash:-1},pphe="",wready=!1,wsocket=null,wsocket2=null,wsocket3=null,ws1ready=!1,ws2ready=!1,ws3ready=!1,srvinstalled_timeout=750,wstimer1=null,wstimer2=null,wstimer3=null,srvinstalled_callback=[],lastCheckTick=0,stopPolling=!1,limit=600,pollcount=0,cemodal=null,semaxloop=0,fail_timer=null,gwround=0,cestimer=null,isWebphoneFirstStart=null,backupserver_tried=!1,paramcache=null,lastcalledtick=0,jinstallmodal=null,npmodal=null,npclosehandled=!1,efmodal=null,redirect_timer=null,clear_timer=null,protocolmaxloop=0,admodal=null,toastmodal=null,lccsenr=0,lctmr=null,lcsexp=!1,selectedwserver="",addrtimer=null,addr_maxloop=0,ADDR_TIMERSTART=0,uk_ip=null,uk_domain=null,us_ip=null,us_domain=null,decide_already_run=!1,wsrvL=[],engines=null,selected_engine=null,recommend_engine=null,avoidjavapopup=1,avoidflashpopup=1,canresolvedomain=!0,retusewebrtc=null,wsloadanswersreceived=0,waitingforusukdecide=!1,getsrvsupportcalled=!1,contimer=null,ccmaxloop=0,ws1ok=-2,ws2ok=-2,ws3ok=-2,ws4ok=-2,cic_timer=null,lastnetsucceded=0,lastgood_set=!1,good_succeded=!1,wsconn_timer=null,ils_srv1="",ils_srv2="",ils_srv3="",canshowlickeyinput=null,is_https=null,wsprinted=!1,savectpopup_wasclosed=!0,audiomodal=null,arecL=[],aplayL=[],aringL=[],vrecL=[],wrereg_timer=null,SIP_REGISTER=0,SIP_INVITE_OUT=1,SIP_INVITE_IN=2,SIP_UNKNOWN=9,lastreg="",lastinvite_in="",lastinvite_out="",lastmsg="",displayname="",ismizuserverdetected=-1,shcache=[],tlsrcalled=!1,wsuserka_lasttick=0,currversionstr=null,isnotsdkcache=!1,cachedevid=null,at_addr=[],wsuri_1="",wsuri_2="",wsuri_3="",wsuri_4="",wsuri_5="",wsuri_6="",wsuri_7="",wsuri_8="",wsuri_9="",ws_1=null,ws_2=null,ws_3=null,ws_4=null,ws_5=null,ws_6=null,ws_7=null,ws_8=null,ws_9=null,gmc=null,jscport="",ddu_lastcalled=-1,ddu_lastload=-1,apikey_cache=null,unregcalledtime=0,voice_wasset=!1,proxy_wasset=!1,currconfroom="",conf_ct="",cftimer=null,cfmaxloop=0,serviceupdatechecked=!1,disableoptions=null,enableoptions=null,webct_cb=[],webct_url=null,saved_lastrecinvite="",saved_lastsentinvite="",reqid_cached=0,telshearchcb=[],sessionid_cache=null,elem_basedir=null,audioElem=null,playdtmfsound=-1,playtimer=null,scurlsp_called=!1,callnotification=null,browserWindowActive=!0,reloadtimer=null,cleartimer=!1,statuslang=null,dtisrvcache=null,dreqsrvcache={},dtistrSrv="",dticache=null,dreqcache={},viarandaddr=null,iscallerextension=-1,srvVersionMaxLoop=0,srvVersionLastExec=0,ismaclin_cached=null,maclinenabled_cached=null,flag_testnspolling_cached=null,prefstorage_cached=null,behaviour_cached=-100,aptmodal=null,transfmodal=null,RC_TYPE=0,RC_NAME=1,RC_NUMBER=2,RC_DATE=3,RC_RANK=4,RC_DURATION=5,F_WHAT=0,F_WITH=1,F_MIN=2,F_MAX=3,EP_LINE=0,EP_SESSION=1,EP_DESTNR=2,EP_INCOMING=3,EP_SETUPTIME=4,EP_CONNECTTIME=5,EP_DISCONNECTTIME=6,EP_REASON=7,EP_CALLID=8,EP_FLAGDEL=9,EP_SETUPSENT=10,EP_FINISHEDSENT=11,EP_SIPHEADERS=12,EP_MUTESTATE=13,EP_HOLDSTATE=14,EP_SIPINVITE=15,EP_SESSID=16,EP_PEERCONNECTION=17,PRES_STATUS=0,PRES_TIME=1,ACC_SERVER=0,ACC_USER=1,ACC_PASSWORD=2,ACC_IVAL=3,ACC_ENABLED=4,ACC_ISMAIN=5,ACC_CALLERID=6,ACC_DISPLAYNAME=7,ACC_PROXY=8,ACC_REALM=9;return{InitializeSettings:InitializeSettings,ParamAsBool:ParamAsBool,ParamAsInt:ParamAsInt,GetParameter2:GetParameter2,GetParameter:GetParameter,SaveParameter:SaveParameter,ParameterIsDefault:ParameterIsDefault,GetParameterInt:GetParameterInt,GetParameterBool:GetParameterBool,GetConfigAll:GetConfigAll,GetConfig:GetConfig,GetConfigInt:GetConfigInt,GetConfigBool:GetConfigBool,SaveSettingsFile:SaveSettingsFile,ReadSettingsFile:ReadSettingsFile,HandleSettings:HandleSettings,GetSettingsFromUrl:GetSettingsFromUrl,GetOverWriteSettings:GetOverWriteSettings,SETT_VALUE:SETT_VALUE,SETT_TYPE:SETT_TYPE,SETT_GROUP:SETT_GROUP,SETT_ALLNAMES:SETT_ALLNAMES,SETT_ALLVALUES:SETT_ALLVALUES,SETT_ISDEFAULT:SETT_ISDEFAULT,SETT_DEF_VALUE:SETT_DEF_VALUE,CT_NAME:CT_NAME,CT_NUMBER:CT_NUMBER,CT_PTYPE:CT_PTYPE,CT_USAGE:CT_USAGE,CT_LASTMODIF:CT_LASTMODIF,CT_DELFLAG:CT_DELFLAG,CT_FAV:CT_FAV,CT_EMAIL:CT_EMAIL,CT_ADDRESS:CT_ADDRESS,CT_NOTES:CT_NOTES,CT_WEBSITE:CT_WEBSITE,CT_LASTACTIVE:CT_LASTACTIVE,CT_ISFROMSYNC:CT_ISFROMSYNC,SaveContactsFile:SaveContactsFile,ReadContactsFile:ReadContactsFile,GetContacts:GetContacts,SortContacts:SortContacts,UpdateContactLastActive:UpdateContactLastActive,GetContactIdFromNumber:GetContactIdFromNumber,GetContactNameFromNumber:GetContactNameFromNumber,ContactExists:ContactExists,PickContact:PickContact,PickContactNumber:PickContactNumber,ReceiveNotifications:ReceiveNotifications,OpenLinkInExternalBrowser:OpenLinkInExternalBrowser,OpenLinkInInternalBrowser:OpenLinkInInternalBrowser,UserChooseEnginePopup:UserChooseEnginePopup,UserChooseEnginePopupSDK:UserChooseEnginePopupSDK,AppEngineClick:AppEngineClick,LicenseAgreementWindow:LicenseAgreementWindow,SentWebrtcSignaling:SentWebrtcSignaling,GetMediaConstraints:GetMediaConstraints,GetScreenshareConstraints:GetScreenshareConstraints,GetIceTimeout:GetIceTimeout,ResetIce:ResetIce,GatewayFailower:GatewayFailower,HandleSipProtocol:HandleSipProtocol,HandleEdgeSdpIP:HandleEdgeSdpIP,FixContentLength:FixContentLength,HandleIncomingSIPSignaling:HandleIncomingSIPSignaling,HandleOptions:HandleOptions,HandleAmidHeader:HandleAmidHeader,RemoveDuplicateHeaders:RemoveDuplicateHeaders,AddDtmfConfHeader:AddDtmfConfHeader,LcAc:LcAc,CH_TYPE:CH_TYPE,CH_NAME:CH_NAME,CH_NUMBER:CH_NUMBER,CH_DATE:CH_DATE,CH_DURATION:CH_DURATION,CH_RECORDING:CH_RECORDING,CH_REASON:CH_REASON,SaveCallhistoryFile:SaveCallhistoryFile,ReadCallhistoryFile:ReadCallhistoryFile,AC_NAME:AC_NAME,AC_SIPUSERNAME:AC_SIPUSERNAME,AC_SETTFILE:AC_SETTFILE,AC_CHFILE:AC_CHFILE,AC_ISACTIVE:AC_ISACTIVE,GetNrOfAcc:GetNrOfAcc,SaveAccountsFile:SaveAccountsFile,ReadAccountsFile:ReadAccountsFile,GetActiveAccount:GetActiveAccount,GetAccountsFilename:GetAccountsFilename,GetActiveAccSettingsFilename:GetActiveAccSettingsFilename,GetActiveAccCallhistoryFilename:GetActiveAccCallhistoryFilename,GetLocationPathName:GetLocationPathName,WinAPI:WinAPI,HttpAsyncHandler:HttpAsyncHandler,ApiWinSaveFile:ApiWinSaveFile,ApiWinLoadFile:ApiWinLoadFile,ApiWinSaveFileNew:ApiWinSaveFileNew,StartMsg:StartMsg,CanLog:CanLog,PutToDebugLog:PutToDebugLog,PutToDebugLogException:PutToDebugLogException,PutToDebugLogWarning:PutToDebugLogWarning,PutToDebugLogSpecial:PutToDebugLogSpecial,ReplaceAll:ReplaceAll,Trim:Trim,EscapeRegExp:EscapeRegExp,IsNumber:IsNumber,IsNumeric:IsNumeric,StrToInt:StrToInt,StrToIntDef:StrToIntDef,StrToIntPx:StrToIntPx,StrIsUpperCase:StrIsUpperCase,GetDeviceWidth:GetDeviceWidth,GetDeviceHeight:GetDeviceHeight,IsWindowsSoftphone:IsWindowsSoftphone,DeviceType:DeviceType,DEVICE_WEBPHONE:DEVICE_WEBPHONE,DEVICE_WIN_SOFTPHONE:DEVICE_WIN_SOFTPHONE,DEVICE_ANDROID:DEVICE_ANDROID,DEVICE_IPHONE:DEVICE_IPHONE,DEVICE_BB:DEVICE_BB,DEVICE_WP:DEVICE_WP,isNull:isNull,IsFunction:IsFunction,getBgColor:getBgColor,getElementColor:getElementColor,AlertDialog:AlertDialog,AlertDialogSDK:AlertDialogSDK,ShowToast:ShowToast,ShowToastSDK:ShowToastSDK,UsePresence2:UsePresence2,StartPresence2:StartPresence2,PresenceGet2:PresenceGet2,PresenceSet2:PresenceSet2,SaveReceivedPresence2:SaveReceivedPresence2,PresenceSelector:PresenceSelector,SetSelectedPresence:SetSelectedPresence,HelpWindow:HelpWindow,HoverCalc:HoverCalc,IsIeVersion:IsIeVersion,IsIeLocal:IsIeLocal,GetTickCount:GetTickCount,UpgradeToProVersion:UpgradeToProVersion,OpenSettings:OpenSettings,GetIntentParam:GetIntentParam,NormalizeNumber:NormalizeNumber,NormalizeInput:NormalizeInput,NormalizeInput2:NormalizeInput2,PasswordStringIsValidForServer:PasswordStringIsValidForServer,UsernameStringIsValidForServer:UsernameStringIsValidForServer,OpenWebURL:OpenWebURL,Md5Hash:Md5Hash,UriParser:UriParser,HttpResponseHandler:HttpResponseHandler,PutNotifications:PutNotifications,PutNotifications2:PutNotifications2,ShowNotifications:ShowNotifications,ShowNotifications2:ShowNotifications2,HideCallNotifications:HideCallNotifications,HideMessageNotifications:HideMessageNotifications,HideCallNotifications2:HideCallNotifications2,HideMessageNotifications2:HideMessageNotifications2,HideAllNotifications:HideAllNotifications,NotificationOnClick:NotificationOnClick,NotificationOnClick2:NotificationOnClick2,GetBrowser:GetBrowser,GetBrowserVersion:GetBrowserVersion,Is64BitBrowser:Is64BitBrowser,IsARM:IsARM,GetOs:GetOs,Exit:Exit,CallNumberProtocolHandler:CallNumberProtocolHandler,EnterKeyPress:EnterKeyPress,WinSoftphoneHttpReq:WinSoftphoneHttpReq,bwanswer:bwanswer,Encrypt:Encrypt,Decrypt:Decrypt,StrEc:StrEc,StrDc:StrDc,B64Enc:B64Enc,B64Dec:B64Dec,enckey:"aJ6aqK4Nah3hnP7aht",Base64:Base64,delsettings:delsettings,GetCustomAutoprov:GetCustomAutoprov,UseCustomAutoprov:UseCustomAutoprov,RecAutoprovCustom:RecAutoprovCustom,GetAutoprovisioning:GetAutoprovisioning,ParseAutoprovisioning:ParseAutoprovisioning,UploadAutoprov:UploadAutoprov,RestartPhone:RestartPhone,RandomInt:RandomInt,RandomStr:RandomStr,GetViaRandomAddress:GetViaRandomAddress,ShowModalLoader:ShowModalLoader,HideModalLoader:HideModalLoader,DoVersioning:DoVersioning,ShowServerInput:ShowServerInput,RequestUserServerInput:RequestUserServerInput,GetAllContactsNumbersSipuris:GetAllContactsNumbersSipuris,Hasesw:Hasesw,Us:Us,Te:Te,Te2:Te2,Ted:Ted,Strl:Strl,Awe:Awe,Awre:Awre,Awb:Awb,Awb2:Awb2,onc:onc,GtUc:GtUc,GtUct:GtUct,SetDID:SetDID,CheckDID:CheckDID,GetFp:GetFp,GetWp:GetWp,GetWpS:GetWpS,Loa:Loa,Ch:Ch,Glv:Glv,Glss:Glss,Glsp:Glsp,Glbr:Glbr,Glop:Glop,Glpr:Glpr,Glcr:Glcr,Glcf:Glcf,Glft:Glft,Glvd:Glvd,Glt:Glt,GetPassphrase:GetPassphrase,IsServiceInstalled:IsServiceInstalled,ServiceStartPolling:ServiceStartPolling,GetNPLocation:GetNPLocation,NPDownloadAndInstall:NPDownloadAndInstall,EngineForcedInstall:EngineForcedInstall,CanIUseApplet:CanIUseApplet,CanIUseWebRTC:CanIUseWebRTC,CanIUseService:CanIUseService,CanIUseFlash:CanIUseFlash,GetSinglePossibleEngine:GetSinglePossibleEngine,ApplyParameters:ApplyParameters,GetServerForHttpReq:GetServerForHttpReq,GetWebrtcUpperServer:GetWebrtcUpperServer,GetWebrtcSyUpperHeader:GetWebrtcSyUpperHeader,GetWebrtcSyUpperDomainHeader:GetWebrtcSyUpperDomainHeader,GetWebrtcSrvAddr:GetWebrtcSrvAddr,CORSRequest:CORSRequest,ResetWsapisocket:ResetWsapisocket,WSRequest:WSRequest,GetCfgPriority:GetCfgPriority,EngineSelect:EngineSelect,TestEngineToString:TestEngineToString,GetEngine:GetEngine,SetEngine:SetEngine,ResetEngineClicked:ResetEngineClicked,HasUsableEngine:HasUsableEngine,HasUsableEngineFromEngines:HasUsableEngineFromEngines,IsMizuPublicWebRTCGateway:IsMizuPublicWebRTCGateway,IsMizuWebRTCGatewayAndNotMizuServer:IsMizuWebRTCGatewayAndNotMizuServer,IsMizuServer:IsMizuServer,IsMizuServerOrGateway:IsMizuServerOrGateway,GetEngineList:GetEngineList,GetSelectedEngine:GetSelectedEngine,GetRecommendedEngine:GetRecommendedEngine,GetSelectedEngineName:GetSelectedEngineName,GetRecommendedEngineName:GetRecommendedEngineName,EngineIsSupported:EngineIsSupported,CheckEngineFirstStart:CheckEngineFirstStart,IsCurrentEngineWorking:IsCurrentEngineWorking,IsJavaInstalled:IsJavaInstalled,ShowEngineOptionOnPage:ShowEngineOptionOnPage,GetEngineDisplayName:GetEngineDisplayName,InstallJavaPopup:InstallJavaPopup,Phone2Phone:Phone2Phone,ChooseEngineLogic:ChooseEngineLogic,ChooseEngineLogic2:ChooseEngineLogic2,CheckInternetConnection:CheckInternetConnection,CheckInternetConnectionWS:CheckInternetConnectionWS,GetSettFilenameSDK:GetSettFilenameSDK,GetAvailableCallfunctions:GetAvailableCallfunctions,GetColortheme:GetColortheme,SetCurrTheme:SetCurrTheme,NeedRegister:NeedRegister,IsIPAddrress:IsIPAddrress,IsLanIP:IsLanIP,IsLocalServer:IsLocalServer,IsLocalUpperServer:IsLocalUpperServer,GetWebdomain:GetWebdomain,SvCont:SvCont,GetBrandName:GetBrandName,SendLog:SendLog,CanShowLicKeyInput:CanShowLicKeyInput,BrowserRequiresHttps:BrowserRequiresHttps,IsHttps:IsHttps,PreferWss:PreferWss,MediaStreamPermissionDenied:MediaStreamPermissionDenied,GetTransferDirectoryName:GetTransferDirectoryName,FileTransfer:FileTransfer,GetLastUsedEngine:GetLastUsedEngine,SaveLastUsedEngine:SaveLastUsedEngine,IsConfigChanged:IsConfigChanged,IsLocalFileSystem:IsLocalFileSystem,GetAppEnProtocol:GetAppEnProtocol,HandleProtocol:HandleProtocol,CallScriptingUrl:CallScriptingUrl,OfferSaveContact:OfferSaveContact,ShowOfferSaveContact:ShowOfferSaveContact,ContactIsFavorite:ContactIsFavorite,ContactSetFavorite:ContactSetFavorite,AudioDevicePopup:AudioDevicePopup,IsContactBlocked:IsContactBlocked,IsNumberBlacklisted:IsNumberBlacklisted,BlockContact:BlockContact,UnBlockContact:UnBlockContact,GetTlsProxyUrl:GetTlsProxyUrl,SetLogFormAction:SetLogFormAction,GetWebrtcDisplayName:GetWebrtcDisplayName,GetRecentInviteIn:GetRecentInviteIn,CatchWebrtcSignaling:CatchWebrtcSignaling,GetSipHeaderFromMsg:GetSipHeaderFromMsg,RemoveSipHeadreFromCache:RemoveSipHeadreFromCache,GetSipHeader:GetSipHeader,GetSipHeaderInternal:GetSipHeaderInternal,GetSipMessage:GetSipMessage,UseTLSReload:UseTLSReload,TLSReload:TLSReload,CallWsuserKeepAlive:CallWsuserKeepAlive,GetDomainFromURL:GetDomainFromURL,GetVersionStr:GetVersionStr,IsSDK:IsSDK,GetStunServersStr:GetStunServersStr,GetOneStunSrv:GetOneStunSrv,GetTurnSrv:GetTurnSrv,GetDeviceId:GetDeviceId,LogAllParameters:LogAllParameters,AutodetectDirectWebrtc:AutodetectDirectWebrtc,AddJscommport:AddJscommport,getuseengine:getuseengine,Beep:Beep,GetCodecsFromApiParam:GetCodecsFromApiParam,GetHttpAPIKey:GetHttpAPIKey,Wsunreg:Wsunreg,GetWsuserUrl:GetWsuserUrl,HandleCalldivert:HandleCalldivert,SetVoiceMailNumber:SetVoiceMailNumber,GetProxyaddress:GetProxyaddress,SendConferenceInvites:SendConferenceInvites,ReceivedConferenceInvite:ReceivedConferenceInvite,IsServiceUpToDate:IsServiceUpToDate,GetMinServiceVersion:GetMinServiceVersion,GetAudioBandwidth:GetAudioBandwidth,GetVideoBandwidth:GetVideoBandwidth,GetVideoWidth:GetVideoWidth,GetVideoHeight:GetVideoHeight,EngineSwitchConference:EngineSwitchConference,EngineSwitchTransfer:EngineSwitchTransfer,HideSettings:HideSettings,SetLanguage:SetLanguage,SetNotCounter:SetNotCounter,WebContactGet:WebContactGet,WebContactReceived:WebContactReceived,IsXML:IsXML,GetLastRecInvite:GetLastRecInvite,GetLastSentInvite:GetLastSentInvite,GetCallSession:GetCallSession,SaveCallSession:SaveCallSession,PrintCallSessions:PrintCallSessions,GetEndpoint:GetEndpoint,GetFreeLine:GetFreeLine,IsLineFree:IsLineFree,GetBestLine:GetBestLine,GetNrOfActiveCalls:GetNrOfActiveCalls,RefreshInfo:RefreshInfo,GetRequestId:GetRequestId,IsMultiline:IsMultiline,GetTelsearchName:GetTelsearchName,SetElementsSrc:SetElementsSrc,GetElementSource:GetElementSource,PlayDtmfSound:PlayDtmfSound,GetLogLevel:GetLogLevel,GetHoldState:GetHoldState,SetHoldState:SetHoldState,GetMuteState:GetMuteState,SetMuteState:SetMuteState,IsIncomingCall:IsIncomingCall,GetDiscReasonFromSignaling:GetDiscReasonFromSignaling,HandleScurlSetparameters:HandleScurlSetparameters,ClassSipAccounts:ClassSipAccounts,ParseSipAccounts:ParseSipAccounts,SaveSipAccounts:SaveSipAccounts,AddOneAcc:AddOneAcc,GetOtherPartyName:GetOtherPartyName,CreateConferenceRoom:CreateConferenceRoom,InitiateConference:InitiateConference,GetMaxLogLevel:GetMaxLogLevel,HandleOfflineMessages:HandleOfflineMessages,WebphoneIsLoaded:WebphoneIsLoaded,BrowserWindowIsActive:BrowserWindowIsActive,ShowIncomingCallNotification:ShowIncomingCallNotification,DownloadContacts:DownloadContacts,ArrayBufferToString:ArrayBufferToString,WSAPIReConnect:WSAPIReConnect,WSAPIHandleReConnect:WSAPIHandleReConnect,Translate:Translate,GetLogTimeStamp:GetLogTimeStamp,GetAutostart:GetAutostart,CanIUseVideo:CanIUseVideo,CanIUseScreensharing:CanIUseScreensharing,SwitchToEngine:SwitchToEngine,ExitVideoMode:ExitVideoMode,GetCustomMenus:GetCustomMenus,DecideWebrtcServer:DecideWebrtcServer,GetTextLengthThatFits:GetTextLengthThatFits,DomainToIp:DomainToIp,DomainToIpServer:DomainToIpServer,AboutWindow:AboutWindow,IsUKGateway:IsUKGateway,IsUSGateway:IsUSGateway,EnableFCM:EnableFCM,UserExists:UserExists,GetSipusername:GetSipusername,GetCallerid:GetCallerid,HandleCallerID:HandleCallerID,StartFCM:StartFCM,WSReConnect:WSReConnect,GetFCMPackageName:GetFCMPackageName,UniqueArray:UniqueArray,IsWebphoneInIframe:IsWebphoneInIframe,GetParentIframeUrl:GetParentIframeUrl,IsCExt:IsCExt,GetUA:GetUA,StripXML:StripXML,DisplayStartPage:DisplayStartPage,ParseQRcode:ParseQRcode,GetSrvVersions:GetSrvVersions,IsMacLin:IsMacLin,NSMacLinEnabled:NSMacLinEnabled,PollServiceStatus:PollServiceStatus,GetAudioRecList:GetAudioRecList,GetAudioPlayList:GetAudioPlayList,GetAudioRingList:GetAudioRingList,GetVideoRecList:GetVideoRecList,GetAudioRecDev:GetAudioRecDev,GetAudioPlayDev:GetAudioPlayDev,GetAudioRingDev:GetAudioRingDev,GetVideoRecDev:GetVideoRecDev,NuIsWebPage:NuIsWebPage,GetMinSrvBuildValue:GetMinSrvBuildValue,HandleServiceBuildUpgrade:HandleServiceBuildUpgrade,CanUseIncomingCallNot:CanUseIncomingCallNot,RequestBrowserNotificationPermission:RequestBrowserNotificationPermission,ExecFunction:ExecFunction,StartAppEngine:StartAppEngine,GetUrlParamVal:GetUrlParamVal,GetJsonParamVal:GetJsonParamVal,HandleNewUserResult:HandleNewUserResult,GetActiveAccUsername:GetActiveAccUsername,GetPreferredStorage:GetPreferredStorage,GetSafariCookie:GetSafariCookie,GetApibehaviour:GetApibehaviour,GetFiletrasnferFormActionUrl:GetFiletrasnferFormActionUrl,NormalizeFilename:NormalizeFilename,GetUpperProxyHeaderForSignaling:GetUpperProxyHeaderForSignaling,GetNsPluginWsUrl:GetNsPluginWsUrl,GetExtraRegAccFromAPIparam:GetExtraRegAccFromAPIparam,Transfer:Transfer,RemoveSessionHeadersFromCache:RemoveSessionHeadersFromCache,GetLineForJavaAPI:GetLineForJavaAPI,GetLastCallEPIdx:GetLastCallEPIdx,GetCallEpIdx:GetCallEpIdx,GetWsAddressCfg:GetWsAddressCfg,ParseContactsReadFromFile:ParseContactsReadFromFile,SIP_REGISTER:SIP_REGISTER,SIP_INVITE_OUT:SIP_INVITE_OUT,SIP_INVITE_IN:SIP_INVITE_IN,SIP_UNKNOWN:SIP_UNKNOWN,GROUP_NOGROUP:GROUP_NOGROUP,GROUP_LOGIN:GROUP_LOGIN,GROUP_MAIN:GROUP_MAIN,GROUP_SIP:GROUP_SIP,GROUP_MEDIA:GROUP_MEDIA,GROUP_CALLDIVERT:GROUP_CALLDIVERT,GROUP_GENERAL:GROUP_GENERAL,GROUP_INTEGRATE:GROUP_INTEGRATE,GROUP_VIDEO:GROUP_VIDEO,GROUP_SCRSHARE:GROUP_SCRSHARE,GROUP_PROFILE:GROUP_PROFILE,RC_TYPE:0,RC_NAME:1,RC_NUMBER:2,RC_DATE:3,RC_RANK:4,RC_DURATION:5,F_WHAT:F_WHAT,F_WITH:F_WITH,F_MIN:F_MIN,F_MAX:F_MAX,EP_LINE:EP_LINE,EP_SESSION:EP_SESSION,EP_DESTNR:EP_DESTNR,EP_INCOMING:EP_INCOMING,EP_SETUPTIME:EP_SETUPTIME,EP_CONNECTTIME:EP_CONNECTTIME,EP_DISCONNECTTIME:EP_DISCONNECTTIME,EP_REASON:EP_REASON,EP_CALLID:EP_CALLID,EP_FLAGDEL:EP_FLAGDEL,EP_SETUPSENT:EP_SETUPSENT,EP_FINISHEDSENT:EP_FINISHEDSENT,EP_SIPHEADERS:EP_SIPHEADERS,EP_MUTESTATE:EP_MUTESTATE,EP_HOLDSTATE:EP_HOLDSTATE,EP_SIPINVITE:EP_SIPINVITE,EP_SESSID:EP_SESSID,EP_PEERCONNECTION:17,PRES_STATUS:PRES_STATUS,PRES_TIME:PRES_TIME,ACC_SERVER:ACC_SERVER,ACC_USER:ACC_USER,ACC_PASSWORD:ACC_PASSWORD,ACC_IVAL:ACC_IVAL,ACC_ENABLED:ACC_ENABLED,ACC_ISMAIN:5,ACC_CALLERID:ACC_CALLERID,ACC_DISPLAYNAME:ACC_DISPLAYNAME,ACC_PROXY:ACC_PROXY,MIN_USR_PWD_LENGHT:3}}(),webphone_api.File=function(){function e(){try{if(!0===u)return;var e=webphone_api.common.GetPreferredStorage();-1===e&&"Safari"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>=12&&!0===webphone_api.localforage.supports(webphone_api.localforage.LOCALSTORAGE)&&(webphone_api.localforage.setDriver([webphone_api.localforage.LOCALSTORAGE,webphone_api.localforage.INDEXEDDB,webphone_api.localforage.WEBSQL]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, storage method set to: localStorage (Safari)",!1,"")),e>0&&(1===e?!0===webphone_api.localforage.supports(webphone_api.localforage.INDEXEDDB)?(webphone_api.localforage.setDriver([webphone_api.localforage.INDEXEDDB,webphone_api.localforage.LOCALSTORAGE,webphone_api.localforage.WEBSQL]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: IndexedDB",!1,"")):webphone_api.common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: IndexedDB is not supported",!1,""):2===e?!0===webphone_api.localforage.supports(webphone_api.localforage.LOCALSTORAGE)?(webphone_api.localforage.setDriver([webphone_api.localforage.LOCALSTORAGE,webphone_api.localforage.INDEXEDDB,webphone_api.localforage.WEBSQL]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: localStorage",!1,"")):webphone_api.common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: localStorage is not supported",!1,""):3===e&&(!0===webphone_api.localforage.supports(webphone_api.localforage.WEBSQL)?(webphone_api.localforage.setDriver([webphone_api.localforage.WEBSQL,webphone_api.localforage.INDEXEDDB,webphone_api.localforage.LOCALSTORAGE]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: WebSQL",!1,"")):webphone_api.common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: WebSQL is not supported",!1,""))),u=!0}catch(o){webphone_api.common.PutToDebugLogSpecial(1,"ERROR, file: SetItem",!0,o)}}function o(o,n,t){try{if(!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: SetItem callback not defined");if(e(),webphone_api.common.isNull(o)||webphone_api.common.isNull(n))return void t(!1);webphone_api.global.dispSaveSettMsg<3&&webphone_api.common.CanLog(5)&&webphone_api.common.PutToDebugLog(5,"EVENT, file saved to localforage: "+o),webphone_api.localforage.setItem(o,n,function(e,o){return e?(webphone_api.common.PutToDebugLog(2,"ERROR, file: SetItem localforage returned error: "+e),t(!1),!1):(t(!0),!0)})}catch(i){webphone_api.common.PutToDebugLogException(2,"file: SetItem",i)}}function n(o,n){try{if(!n||"function"!=typeof n)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: GetItem callback not defined");if(webphone_api.common.isNull(o))return webphone_api.common.PutToDebugLog(2,"ERROR, file: GetItem key is NULL"),void n(null);e(),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file read from localforage: "+o),webphone_api.localforage.getItem(o,function(e,o){return e?(webphone_api.common.PutToDebugLog(2,"ERROR, file: GetItem localforage returned error: "+e),n(""),""):(n(o),o)})}catch(t){webphone_api.common.PutToDebugLogException(2,"file: GetItem",t),n("")}}function t(o,n){try{if(!n||"function"!=typeof n)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteItem callback not defined");if(webphone_api.common.isNull(o))return webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteItem key is NULL"),void n(!1);e(),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file deleted from localforage "+o),webphone_api.localforage.removeItem(o,function(e){return e?(webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteItem localforage returned error: "+e),n(!1),!1):(n(!0),!0)})}catch(t){webphone_api.common.PutToDebugLogException(2,"file: DeleteItem",t)}}function i(e,o,n,t){try{if(!t||"function"!=typeof t)return webphone_api.common.PutToDebugLog(2,"ERROR, file: SetCookie callback not defined"),!1;if(webphone_api.common.isNull(e)||webphone_api.common.isNull(o))return webphone_api.common.PutToDebugLog(2,"ERROR, file: SetCookie key is NULL"),t(!1),!1;var i="";if(webphone_api.common.isNull(n))i="";else{var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),i="; expires="+a.toGMTString()}if(e.indexOf("_backup")>=0)for(var r=document.cookie.split(";"),l=0;l<r.length;l++){for(var p=r[l];" "===p.charAt(0);)p=p.substring(1,p.length);if(p.indexOf("_backup=")>=0){var s=p.substring(0,p.indexOf("_backup=")+7),c=new Date;c.setTime(c.getTime()+-864e5);var u="; expires="+c.toGMTString();document.cookie=s+"="+u+"; path=/;SameSite=Lax"}}else 0==e.indexOf("wp_")||0==e.indexOf("MZwebPhone_")||0==e.indexOf("wpdemosett_")||0==e.indexOf("webphone_")||0==e.indexOf("notincoockie")||e.indexOf("_backup")>=0&&e.indexOf("_backup")==e.length-7||e.indexOf("webphone")>=0&&e.indexOf("webphone")==e.length-8||0==e.indexOf(webphone_api.common.GetBrandName())||(e="wp_"+e);return o=webphone_api.common.StrEc(o,webphone_api.common.GetPassphrase(),!1),document.cookie=e+"="+o+i+"; path=/;SameSite=Lax",webphone_api.common.isNull(o)||webphone_api.global.dispSaveSettMsg<3&&webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file saved to cookie: "+e),t(!0),!0}catch(g){webphone_api.common.PutToDebugLogException(2,"file: SetCookie",g)}t(!1)}function a(e,o){try{if(!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: GetCookie callback not defined");if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(2,"ERROR, file: GetCookie key is NULL"),void o(null);if(0==e.indexOf("wp_")||0==e.indexOf("MZwebPhone_")||0==e.indexOf("wpdemosett_")||0==e.indexOf("webphone_")||0==e.indexOf("notincoockie")||e.indexOf("_backup")>=0&&e.indexOf("_backup")==e.length-7||e.indexOf("webphone")>=0&&e.indexOf("webphone")==e.length-8||0==e.indexOf(webphone_api.common.GetBrandName()));else for(var n="wp_"+e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var a=t[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n)){var r=a.substring(n.length,a.length);return r=webphone_api.common.StrDc("encrypted__3__"+r,webphone_api.common.GetPassphrase(),!1),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file read from cookie: "+e),void o(r)}}for(var n=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var a=t[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n)){var r=a.substring(n.length,a.length);return r=webphone_api.common.StrDc("encrypted__3__"+r,webphone_api.common.GetPassphrase(),!1),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file read from cookie: "+e),void o(r)}}}catch(l){webphone_api.common.PutToDebugLogException(2,"file: GetCookie",l)}o(null)}function r(){try{for(var e=document.cookie.split(";"),o=0;o<e.length;o++){var n=e[o],t=n.indexOf("="),i=t>-1?n.substr(0,t):n;(0==i.indexOf("wp_")||0==i.indexOf("MZwebPhone_")||0==i.indexOf("wpdemosett_")||0==i.indexOf("webphone_")||0==i.indexOf("notincoockie")||i.indexOf("_backup")>=0&&i.indexOf("_backup")==i.length-7||i.indexOf("webphone")>=0&&i.indexOf("webphone")==i.length-8||0==i.indexOf(webphone_api.common.GetBrandName()))&&(document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;SameSite=Lax")}return!0}catch(a){webphone_api.common.PutToDebugLogException(2,"file: DeleteAllCookies",a)}return!1}function l(e,o){try{if(!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteCookie callback not defined");if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteCookie key is NULL"),void o(!1);i(e,"",-1,function(n){webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file deleted from cookie: "+e),o(n)})}catch(n){webphone_api.common.PutToDebugLogException(2,"file: DeleteCookie",n)}}function p(e,n,t,r){try{if(!r||"function"!=typeof r)return void(webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"ERROR, file: SaveFile callback not defined"));if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"ERROR, file: SaveFile filename null"),void r(!1);if(webphone_api.common.isNull(n))return webphone_api.common.PutToDebugLog(3,"ERROR, file: SaveFile content is NULL"),void r(!1);if((webphone_api.common.isNull(t)||t<0||t>2)&&(t=webphone_api.global.STORAGE_LOCAL),webphone_api.common.IsIeLocal()&&(t=webphone_api.global.STORAGE_COOKIE),webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: SaveFile content code"),n=webphone_api.common.Encrypt(n,webphone_api.common.enckey),webphone_api.common.isNull(n)&&webphone_api.common.PutToDebugLog(2,"ERROR, file: SaveFile content after code is NULL"),t!==webphone_api.global.STORAGE_LOCAL&&webphone_api.common.IsCExt()>0)return webphone_api.common.PutToDebugLog(4,"EVENT,Not saving data in cookie in webview: "+e),void r(!0);if(t===webphone_api.global.STORAGE_LOCAL)o(e,n,function(e){webphone_api.global.dispSaveSettMsg<3&&webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: SaveFile SetItem callback: "+e),r(e)});else if(t===webphone_api.global.STORAGE_COOKIE)i(e,n,365,function(e){r(e)});else{if(t!==webphone_api.global.STORAGE_AUTO)return webphone_api.common.PutToDebugLog(2,"ERROR, file: SaveFile invalid storagetype"),void r(!1);a("notincoockie",function(t){var a=!1;webphone_api.common.isNull(t)||"true"!==t||(a=!0),!0===a||n.length>1e3?(o(e,n,function(e){r(e)}),n.length>1e3&&i("notincoockie","true",365,function(){})):i(e,n,365,function(e){r(e)})})}}catch(l){webphone_api.common.PutToDebugLogException(2,"file: SaveFile",l)}}function s(e,o,t){try{if(!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: ReadFile callback not defined");if((webphone_api.common.isNull(o)||o<0||o>2)&&(o=webphone_api.global.STORAGE_LOCAL),webphone_api.common.IsIeLocal()&&(o=webphone_api.global.STORAGE_COOKIE),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"ERROR, file: ReadFile filename is NULL"),void t(null);if(o===webphone_api.global.STORAGE_LOCAL)n(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (localstorage)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (localstorage)"),t(e)
});else if(o===webphone_api.global.STORAGE_COOKIE)a(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (cookie)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (cookie)"),t(e)});else{if(o!==webphone_api.global.STORAGE_AUTO)return webphone_api.common.PutToDebugLog(2,"ERROR, file: ReadFile invalid storagetype"),void t(!1);a("notincoockie",function(i){var r=!1;webphone_api.common.isNull(i)||"true"!==i||(r=!0),o===webphone_api.global.STORAGE_LOCAL||!0===r?n(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (auto-localstorage)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (auto-localstorage)"),t(e)}):a(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (auto-cookie)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (auto-cookie)"),t(e)})})}}catch(i){webphone_api.common.PutToDebugLogException(2,"file: ReadFile",i)}}function c(e,o){try{if(!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteFile callback not defined");if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"ERROR, file: DeleteFile filename null"),void o(!1);var n=!1;if(l(e,function(e){n||o(!0),n=!0}),webphone_api.common.IsIeLocal())return;t(e,function(e){n||o(!0),n=!0})}catch(i){webphone_api.common.PutToDebugLogException(2,"file: DeleteFile",i)}}var u=!1;return{SaveFile:p,ReadFile:s,DeleteFile:c,SetItem:o,GetItem:n,SetCookie:i,GetCookie:a,DeleteAllCookies:r}}(),webphone_api.flashapi=function(){function e(){try{webphone_api.common.PutToDebugLog(3,"EVENT, Initializing...");var e=I();!webphone_api.common.isNull(e)&&e.length>0&&(G.rtmp_url="rtmp://"+e+"/phone",webphone_api.global.isdebugversion&&webphone_api.common.PutToDebugLog(3,"EVENT, Flash RTMP server: "+G.rtmp_url));var o=document.getElementById("flashphonehandle");if(webphone_api.common.isNull(o)){var n="https://www.adobe.com/go/getflashplayer",t="https://www.adobe.com/images/shared/download_buttons/get_flash_player.gif";!0===webphone_api.common.IsHttps()&&(n=n.replace("http:","https:"),t=t.replace("http:","https:"));var i='<div id="flashphonehandle" style="float: left; visibility: hidden; position: absolute; top: 0; left: 0; z-index: -1;"><span>You need Adobe Flash Player for the softphone to work.</span><p><a href="'+n+'" target="_blank"><img src="'+t+'" alt="Get Adobe Flash player" /></a></p></div>';webphone_api.$("body").append(i)}webphone_api.swfobject.embedSWF("native/flashphone.swf",L,"1","1","9.0.0","native/expressInstall.swf",G,O,[],function(e){webphone_api.common.PutToDebugLog(2,"EVENT, flashapi embedswf: "+e.success),0==e.success&&webphone_api.common.PutToDebugLog(2,"EVENT, flashapi embed failed, flash player needs to be installed")})}catch(a){webphone_api.common.PutToDebugLogException(2,"flashapi: Start",a)}}function o(){try{if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, onInit cannot get flash handle!");webphone_api.common.PutToDebugLog(3,"EVENT, flash Initialized."),D=!1}catch(e){webphone_api.common.PutToDebugLogException(2,"flashapi: onInit",e)}}function n(e){try{webphone_api.common.PutToDebugLog(3,"EVENT, Connected to flash server: "+e),webphone_api.global.iscurrengineworking=!0,webphone_api.common.SaveParameter("lastsessionsuccess","2"),D=!1,webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2);var o=webphone_api.common.GetSipusername(),n=webphone_api.common.GetParameter("password"),i=I(),a=i,r=a.indexOf(":");r>0&&(a=a.substring(0,r)),o=o+"@"+a,C=o;var l=webphone_api.common.NeedRegister();if(webphone_api.common.PutToDebugLog(3,"Flash connection details:"),webphone_api.common.PutToDebugLog(3,"RTMP server: "+G.rtmp_url),webphone_api.common.PutToDebugLog(3,"username: "+o),webphone_api.common.PutToDebugLog(3,"password: "+n),!0===l){if(webphone_api.common.PutToDebugLog(1,"STATUS,-1,Register..."),webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, trying to register with SIP account, but cannot get flash handle");t().login(o,n)}}catch(p){webphone_api.common.PutToDebugLogException(2,"flashapi: onConnected",p)}}function t(){try{if(!webphone_api.common.isNull(webphone_api.$("#"+L)[0])&&"function"==typeof webphone_api.$("#"+L)[0].login)return webphone_api.$("#"+L)[0]}catch(e){webphone_api.common.PutToDebugLogException(2,"flashapi: GetHandle",e)}return null}function i(e){a(e)}function a(e){try{if(webphone_api.common.isNull(e)||e.length<1)return;var o=e.toLowerCase(),n="";n=o.indexOf("error")>=0?"ERROR, ":o.indexOf("warning")>=0?"WARNING, ":"EVENT, ",webphone_api.common.PutToDebugLog(2,n+"flash, "+e)}catch(t){webphone_api.common.PutToDebugLogException(2,"flashapi: onDebug",t)}}function r(){try{webphone_api.common.PutToDebugLog(3,"WARNING, flashapi onDisconnected: disconnected from flash server"),D=!1,setTimeout(function(){if(webphone_api.common.PutToDebugLog(3,"EVENT, onDisconnected: reconnecting to flash server"),webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle onDisconnect!");t().connect()},5e3)}catch(e){webphone_api.common.PutToDebugLogException(2,"flashapi: onDisconnected",e)}}function l(e){try{if(D=!1,webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");t().logout(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"flashapi: Logout",o)}}function p(e,o,n){try{if("success"!=e)webphone_api.common.PutToDebugLog(1,"ERROR,-1,Register failed"),D=!1;else{webphone_api.global.iscurrengineworking=!0,webphone_api.common.SaveParameter("lastsessionsuccess","2"),webphone_api.common.PutToDebugLog(1,"EVENT,EVENT,authenticated successfully"),D=!0,S(),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"STATUS,-1,Registered.")},1500);var i=o+"@"+n;if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");t().register(i,"")}}catch(a){webphone_api.common.PutToDebugLogException(2,"flashapi: onLogin",a)}}function s(e,o){webphone_api.common.PutToDebugLog(1,"STATUS,-1,Unregistered")}function c(e){try{if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Call: cannot get flash handle!");W=!1,V=e,webphone_api.common.PutToDebugLog(1,"STATUS,1,CallSetup,"+e+","+webphone_api.common.GetSipusername()+",1,"+e);var o=C;return webphone_api.common.isNull(o)&&(o=""),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Starting call to "+e),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Call"),t().makeCall(e,o,[]),!0}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: Call",n)}return!1}function u(){try{if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=y;return webphone_api.common.isNull(e)&&(e=""),t().hangup(e),!0}catch(o){webphone_api.common.PutToDebugLogException(2,"flashapi: Hangup",o)}return!1}function g(){try{if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=y;return webphone_api.common.isNull(e)&&(e=""),t().answer(e),!0}catch(o){webphone_api.common.PutToDebugLogException(2,"flashapi: Accept",o)}return!1}function m(e,o){try{return(webphone_api.common.isNull(o)||o.length<1)&&(o="1500"),webphone_api.common.isNull(t())?void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(t().sendDTMF(e,o),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: sendDTMF",n)}return!1}function b(){try{if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=y;return webphone_api.common.isNull(e)&&(e=""),t().attach(e),!0}catch(o){webphone_api.common.PutToDebugLogException(2,"flashapi: Attach",o)}return!1}function h(e){try{if(webphone_api.common.isNull(t()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var o=y;return webphone_api.common.isNull(o)&&(o=""),t().transfer(o,e),!0}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: Transfer",n)}return!1}function d(e,o){try{return webphone_api.common.isNull(t())?void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(t().three_way(e,o),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: ThreeWay",n)}return!1}function _(e,o){try{return webphone_api.common.isNull(t())?void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(t().join(e,o),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: Join",n)}return!1}function w(e,o){try{if(webphone_api.common.isNull(o)||o.length<1)return;y=e;var n=!1;switch(o){case"RINGING":n=!0,webphone_api.common.PutToDebugLog(1,"STATUS,-1,Ringing...");var t="1";W&&(t="2"),webphone_api.common.PutToDebugLog(1,"STATUS,1,Ringing,"+V+","+webphone_api.common.GetSipusername()+","+t+","+V),A=webphone_api.common.GetTickCount();break;case"ACTIVE":n=!0;var t="1";W&&(t="2"),webphone_api.common.PutToDebugLog(1,"STATUS,1,CallConnect,"+V+","+webphone_api.common.GetSipusername()+","+t+","+V),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"STATUS,-1,InCall"),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Speaking")},1300),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Speaking"),k=webphone_api.common.GetTickCount();break;case"HANGUP":if(webphone_api.common.GetTickCount()-x<110)break;n=!0;var t="1";W&&(t="2"),webphone_api.common.PutToDebugLog(1,"STATUS,1,CallDisconnect,"+V+","+webphone_api.common.GetSipusername()+","+t+","+V),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Call Finished"),webphone_api.common.PutToDebugLog(1,"STATUS,1,Finished"),x=webphone_api.common.GetTickCount()}!0!==n&&webphone_api.common.PutToDebugLog(3,"EVENT, onCallState: "+o+";  uuid: "+e)}catch(i){webphone_api.common.PutToDebugLogException(2,"flashapi: onCallState",i)}}function f(e,o,n,t,i){try{y=e,W=!0,V=n,webphone_api.common.PutToDebugLog(1,"STATUS,1,CallSetup,"+n+","+webphone_api.common.GetSipusername()+",2,"+n),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Incoming...");var a=webphone_api.common.GetParameter2("autoignore");(webphone_api.common.isNull(a)||1!==a.length)&&(a="0");var r=webphone_api.common.StrToInt(a);r>1?(webphone_api.common.PutToDebugLog(3,"EVENT, autoignore Flash hangup(reject)"),Reject()):1===r&&(webphone_api.common.PutToDebugLog(3,"EVENT, autoignore Flash silent ignore"),Reject()),!0===webphone_api.common.GetParameterBool("autoaccept",!1)&&(webphone_api.common.PutToDebugLog(3,"EVENT, autoaccept Flash accept"),g());var l=webphone_api.common.GetParameter2("calltransferalways");!webphone_api.common.isNull(l)&&l.length>1&&(webphone_api.common.PutToDebugLog(3,"EVENT, call transfer Flash calltransferalways: "+l),h(l));var p=webphone_api.common.GetParameter2("callforwardonbusy");!webphone_api.common.isNull(p)&&p.length>1&&webphone_api.common.PutToDebugLog(3,"EVENT, call foward Flash callforwardonbusy: NOT IMPLEMENTED YET");var s=webphone_api.common.GetParameter2("callforwardalways");!webphone_api.common.isNull(s)&&s.length>1&&webphone_api.common.PutToDebugLog(3,"EVENT, call foward Flash callforwardalways: NOT IMPLEMENTED YET")}catch(c){webphone_api.common.PutToDebugLogException(2,"flashapi: onIncomingCall",c)}}function v(e,o){try{webphone_api.common.PutToDebugLog(1,"STATUS,-1,Hangup"),webphone_api.common.PutToDebugLog(3,"EVENT, onHangup reason: "+o+";  "+e),N(),setTimeout(function(){S()},1500)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: onHangup",n)}}function P(e,o,n){try{webphone_api.common.PutToDebugLog(1,"EVENT, flashapi onDisplayUpdate, name: "+o+", number: "+n+", "+e)}catch(t){webphone_api.common.PutToDebugLogException(2,"flashapi: onDisplayUpdate",t)}}function E(e,o,n){webphone_api.common.PutToDebugLog(4,"EVENT, flashapi onMakeCall: "+o)}function T(e){webphone_api.common.PutToDebugLog(4,"EVENT, flashapi onAttach: "+e)}function N(){try{U=webphone_api.common.GetTickCount();var e=0;!webphone_api.common.isNull(k)&&k>0&&!webphone_api.common.isNull(U)&&U>0&&(e=U-k),V=webphone_api.common.isNull(V)?"":webphone_api.common.Trim(V),webphone_api.common.isNull(k)&&(k=0);var o="",n="",t="NA";!webphone_api.common.isNull(k)&&webphone_api.common.IsNumber(k)&&!webphone_api.common.isNull(A)&&webphone_api.common.IsNumber(A)&&(t=(k-A).toString());W?(o=V,n=webphone_api.common.GetSipusername()):(o=webphone_api.common.GetSipusername(),n=V);var i="1";!0===W&&(i="2");var a="CDR,1,"+V+","+o+","+n+",NA,"+t+","+e.toString()+",NA,,"+i;webphone_api.global.lastcallcdr=a,setTimeout(function(){webphone_api.common.PutToDebugLog(1,a)},500),setTimeout(function(){S()},1500),A=0,k=0,U=0,V="",W=!1}catch(r){webphone_api.common.PutToDebugLogException(2,"flashapi: BuildCDR",r)}}function S(){D&&webphone_api.common.PutToDebugLog(1,"STATUS,-1,Registered.")}function I(){var e="";try{if(e=webphone_api.common.GetParameter("rtmpserveraddress"),webphone_api.common.isNull(e)||e.length<2){if(e=webphone_api.common.GetWpS(),webphone_api.common.IsLocalServer())return webphone_api.common.PutToDebugLog(1,"ERROR, Cannot use flash server to connect to local network VoIP server"),alert("ERROR, Cannot use flash server to connect to local network VoIP server"),"";e=e.toLowerCase(),e=webphone_api.common.NormalizeInput(e,0);var o=e.indexOf("/");o>0&&(e=e.substring(0,o)),o=e.indexOf(":"),o>0&&(e=e.substring(0,o)),e+=":1939"}return e}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: GetFlashServerAddress",n)}return""}function R(e,o){}var G={rtmp_url:""},O={allowScriptAccess:"always"},L="flashphonehandle",C="",D=!1,y="",x=0,A=0,k=0,U=0,V="",W=!1;return{Start:e,Call:c,Logout:l,Hangup:u,Accept:g,SendDTMF:m,Attach:b,Transfer:h,ThreeWay:d,Join:_,ShowPermissionRequest:R,onInit:o,onEvent:i,onDebug:a,onConnected:n,onDisconnected:r,onLogin:p,onLogout:s,onCallState:w,onIncomingCall:f,onHangup:v,onDisplayUpdate:P,onMakeCall:E,onAttach:T}}(),webphone_api.init=function(){function e(){webphone_api.$("#loading_bg_txt").hide();var e=window.location.href;e.indexOf("#page_call")>0&&(console&&console.log&&console.log("WARNING, page Call was last started and after browser window reload, go to Settings page"),webphone_api.common.PutToDebugLog(3,"EVENT, page Call was last started and after browser window reload, go to Settings page"),e=e.replace("#page_call",""),window.location.href=e)}function o(){if(!0!==i){if(i=!0,webphone_api.common.SetElementsSrc(),webphone_api.global.domloaded_tick=webphone_api.common.GetTickCount(),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, init: initialize start"),webphone_api.common.Glv()<1)return void(webphone_api.global.webrtcavailable=0);webphone_api.common.IsWindowsSoftphone()||(webphone_api.loadwebrtc_timestamp=webphone_api.common.GetTickCount(),webphone_api.webrtcapi.WebRtcIsSupported(function(e){function o(){if(webphone_api.common.EngineSelect(0,31),webphone_api.common.SetLanguage(),webphone_api.plhandler.ConfigChanged(),!1===webphone_api.global.onloaded_called){webphone_api.global.wploaded=!0,webphone_api.common.PutToDebugLogSpecial(1,"EVENT, init webphone onLoaded",!1,"");try{webphone_api.onAppStateChangeCb("loaded")}catch(e){webphone_api.common.PutToDebugLogException(2,"init: There is an error in onAppStateChange(loaded) callback",e)}try{webphone_api.onLoadedCb()}catch(e){webphone_api.common.PutToDebugLogException(2,"init: There is an error in onLoaded() callback",e)}try{!0===webphone_api.common.IsWebphoneInIframe()&&webphone_api.WebphoneSendMessageToParent("wploadedandready_IFRAME")}catch(e){webphone_api.common.PutToDebugLogException(2,"init: send loaded state message to iframe parent page",e)}webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onload,"onLoad","","","",""),webphone_api.global.onloaded_called=!0,setTimeout(function(){webphone_api.global.onloaded_called=!1},5e3),webphone_api.webphone_loaded=!0,webphone_api.common.WebphoneIsLoaded()}}if("Windows"===webphone_api.common.GetOs()&&("MSIE"===webphone_api.common.GetBrowser()?e=!1:"Edge"===webphone_api.common.GetBrowser()&&(webphone_api.common.GetBrowserVersion()<14?e=!1:!1===e&&webphone_api.common.PutToDebugLog(2,"ERROR,Init Edge webrtc is not supported, getusermedia: "+typeof navigator.getUserMedia+"; RTCPeerConnection: "+typeof window.RTCPeerConnection))),"iOS"===webphone_api.common.GetOs()?(("Safari"===webphone_api.common.GetBrowser()||"iPhone"===webphone_api.common.GetBrowser())&&webphone_api.common.GetBrowserVersion()<11&&(e=!1),"Firefox"!==webphone_api.common.GetBrowser()||navigator.mozGetUserMedia||navigator.GetUserMedia||(e=!1),"Chrome"!==webphone_api.common.GetBrowser()||navigator.webkitGetUserMedia||navigator.GetUserMedia||(e=!1)):"Windows"===webphone_api.common.GetOs()&&"Safari"===webphone_api.common.GetBrowser()&&(e=!1),webphone_api.common.isNull(e)&&(e=""),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, init: initialize LoadWebrtc engine: "+e),!0===e){webphone_api.global.webrtcavailable=1,webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, webrtc engine available (init)");var n=webphone_api.common.GetEngine("webrtc"),t=webphone_api.common.GetParameter2("serveraddress_user");(webphone_api.common.isNull(t)||t.length<2)&&(t=webphone_api.common.GetParameter2("serveraddress")),(webphone_api.common.isNull(t)||t.length<2)&&(t=webphone_api.common.GetConfig("serveraddress")),webphone_api.common.isNull(t)&&(t=""),webphone_api.common.IsLanIP(webphone_api.common.GetWebrtcUpperServer())||t.length>0&&webphone_api.common.IsLanIP(t)?webphone_api.common.isNull(n)||(n.issupported_cache=0,n.available=0):!0===webphone_api.common.BrowserRequiresHttps(!0)?webphone_api.common.isNull(n)||(n.issupported_cache=1,n.available=2):webphone_api.common.isNull(n)||(n.issupported_cache=2,n.available=3)}else!1===e&&(webphone_api.global.webrtcavailable=0,webphone_api.common.PutToDebugLog(2,"webrtc engine NOT available"));!0===webphone_api.common.UseCustomAutoprov(!0)?webphone_api.common.GetCustomAutoprov(function(e){webphone_api.common.RecAutoprovCustom(e),o()}):o()}))}}function n(){try{webphone_api.global.domloaded=!0,webphone_api.$.mobile.pageContainer=webphone_api.$("#android_frame"),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(3,"EVENT, init: mobileinit"),webphone_api.$("body").on("contextmenu",function(e){if(0==webphone_api.common.IsSDK())return t(e)})}catch(e){webphone_api.common.PutToDebugLogException(2,"init: mobileinit",e)}}function t(e){var o="";try{if(o=webphone_api.$.mobile.activePage.attr("id"),webphone_api.common.isNull(o)||o.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, init: OpenMenu NO PAGE"),!1;o=o.replace("page_","");var n="#btn_"+o+"_menu";if("settings"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("dialpad"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("contactslist"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("contactdetails"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("callhistorylist"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("callhistorydetails"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("call"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("addeditcontact"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("messagelist"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("message"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("internalbrowser"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("newuser"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("filetransfer"===o)return webphone_api.$(n).click(),e.preventDefault(),!1;if("smscodeverify"===o)return webphone_api.$(n).click(),e.preventDefault(),!1}catch(t){webphone_api.common.PutToDebugLogException(2,"init: OpenMenu "+o,t)}}webphone_api.$(document).ready(function(){e()}),webphone_api.$(document).on("mobileinit",function(){n(),webphone_api.$.event.special.tap.emitTapOnTaphold=!1});var i=!1;webphone_api.$(".options_menu").on("popupbeforeposition",function(e,o){webphone_api.$(".all_app_pages").css("overflow","hidden")});var a=!1;return window.onunload=window.onbeforeunload=function(e){try{try{if("undefined"==typeof webphone_api||null===webphone_api)return;if(webphone_api.unregisteredcb=null,webphone_api.global.onunload_flag=!0,!0===a)return;a=!0,webphone_api.stop();webphone_api.global.useengine;if(webphone_api.global.useengine="","undefined"!=typeof webphone_api.common&&null!==webphone_api.common){if(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh event detected. reset useengine"),webphone_api.global.wasSettModified){var o=webphone_api.common.GetActiveAccSettingsFilename();!webphone_api.common.isNull(o)&&o.length>0&&webphone_api.common.SaveSettingsFile(6,o,function(e){webphone_api.common.CanLog(2)&&(e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveSettingsFile on exit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveSettingsFile on exit Failed"))})}webphone_api.global.wasCtModified&&webphone_api.common.SaveContactsFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveContactsFile on exit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveContactsFile on exit Failed")}),webphone_api.global.wasChModified&&webphone_api.common.SaveCallhistoryFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveCallhistoryFile on exit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveCallhistoryFile on exit Failed")})}}catch(n){webphone_api.common.PutToDebugLogException(2,"init: Window.OnUnload",n)}}catch(n){}},webphone_api.$(document).on("pagecontainershow",function(e,o){var n="";try{var t=webphone_api.$.mobile.pageContainer.pagecontainer("getActivePage");n=t[0].id,document.getElementById(n).style.minHeight="auto"}catch(i){webphone_api.common.PutToDebugLogException(2,"init: pagecontainershow "+n,i)}}),webphone_api.$(document).on("pageinit",'[data-role="page"]',function(e){var o="";try{if(o=webphone_api.$(this).attr("id"),webphone_api.common.isNull(o)||o.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pageinit NO PAGE");if(o.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings))return void webphone_api._settings.onCreate(e);if(o.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad))return void webphone_api._dialpad.onCreate(e);if(o.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist))return void webphone_api._contactslist.onCreate(e);if(o.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails))return void webphone_api._contactdetails.onCreate(e);if(o.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist))return void webphone_api._callhistorylist.onCreate(e);if(o.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails))return void webphone_api._callhistorydetails.onCreate(e);if(o.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call))return void webphone_api._call.onCreate(e);if(o.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact))return void webphone_api._addeditcontact.onCreate(e);if(o.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api.webphone_api))return void webphone_api._messagelist.onCreate(e);if(o.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message))return void webphone_api._message.onCreate(e);if(o.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser))return void webphone_api._internalbrowser.onCreate(e);if(o.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage))return void webphone_api._startpage.onCreate(e);if(o.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview))return void webphone_api._logview.onCreate(e);if(o.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser))return void webphone_api._newuser.onCreate(e);if(o.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filetransfer))return void webphone_api._filetransfer.onCreate(e);if(o.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters))return void webphone_api._filters.onCreate(e);if(o.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts))return void webphone_api._accounts.onCreate(e);if(o.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify))return void webphone_api._smscodeverify.onCreate(e);if(o.indexOf("extra1")>=0)return void(webphone_api._extra1&&webphone_api._extra1.onCreate&&(webphone_api._extra1.onCreate(e),webphone_api.global.isExtra1Started=!0));if(o.indexOf("extra2")>=0)return void(webphone_api._extra2&&webphone_api._extra2.onCreate&&(webphone_api._extra2.onCreate(e),webphone_api.global.isExtra2Started=!0));if(o.indexOf("extra3")>=0)return void(webphone_api._extra3&&webphone_api._extra3.onCreate&&(webphone_api._extra3.onCreate(e),webphone_api.global.isExtra3Started=!0));if(o.indexOf("extra4")>=0)return void(webphone_api._extra4&&webphone_api._extra4.onCreate&&(webphone_api._extra4.onCreate(e),webphone_api.global.isExtra4Started=!0));if(o.indexOf("extra5")>=0)return void(webphone_api._extra5&&webphone_api._extra5.onCreate&&(webphone_api._extra5.onCreate(e),webphone_api.global.isExtra5Started=!0))}catch(n){webphone_api.common.isNull(o)&&(o=""),webphone_api.common.PutToDebugLogException(2,"init: pageinit "+o,n)}}),webphone_api.$(document).on("pageshow",'[data-role="page"]',function(e){var o="";try{if(o=webphone_api.$(this).attr("id"),webphone_api.common.isNull(o)||o.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pageshow NO PAGE");var n="#"+o.substring(o.indexOf("_")+1,o.length)+"_header";if(document.getElementById(o).style.background=webphone_api.common.getBgColor(n),o.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings))return void webphone_api._settings.onStart(e);if(o.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad))return void webphone_api._dialpad.onStart(e);if(o.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist))return void webphone_api._contactslist.onStart(e);if(o.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails))return void webphone_api._contactdetails.onStart(e);if(o.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist))return void webphone_api._callhistorylist.onStart(e);if(o.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails))return void webphone_api._callhistorydetails.onStart(e);if(o.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call))return void webphone_api._call.onStart(e);if(o.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact))return void webphone_api._addeditcontact.onStart(e);if(o.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api._messagelist))return void webphone_api._messagelist.onStart(e);if(o.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message))return void webphone_api._message.onStart(e);if(o.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser))return void webphone_api._internalbrowser.onStart(e);if(o.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage))return void webphone_api._startpage.onStart(e);if(o.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview))return void webphone_api._logview.onStart(e);if(o.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser))return void webphone_api._newuser.onStart(e);if(o.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filetransfer))return void webphone_api._filetransfer.onStart(e);if(o.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters))return void webphone_api._filters.onStart(e);if(o.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts))return void webphone_api._accounts.onStart(e);if(o.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify))return void webphone_api._smscodeverify.onStart(e);if(o.indexOf("extra1")>=0)return void(webphone_api._extra1&&webphone_api._extra1.onStart&&(webphone_api._extra1.onStart(e),webphone_api.global.isExtra1Started=!0));if(o.indexOf("extra2")>=0)return void(webphone_api._extra2&&webphone_api._extra2.onStart&&(webphone_api._extra2.onStart(e),webphone_api.global.isExtra2Started=!0));if(o.indexOf("extra3")>=0)return void(webphone_api._extra3&&webphone_api._extra3.onStart&&(webphone_api._extra3.onStart(e),webphone_api.global.isExtra3Started=!0));if(o.indexOf("extra4")>=0)return void(webphone_api._extra4&&webphone_api._extra4.onStart&&(webphone_api._extra4.onStart(e),webphone_api.global.isExtra4Started=!0));if(o.indexOf("extra5")>=0)return void(webphone_api._extra5&&webphone_api._extra5.onStart&&(webphone_api._extra5.onStart(e),webphone_api.global.isExtra5Started=!0))}catch(t){webphone_api.common.isNull(o)&&(o=""),webphone_api.common.PutToDebugLogException(2,"init: pageshow "+o,t)}}),webphone_api.$(document).on("pagebeforehide",'[data-role="page"]',function(e){var o="";try{if(o=webphone_api.$(this).attr("id"),webphone_api.common.isNull(o)||o.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pagebeforehide NO PAGE");if(o.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings))return void webphone_api._settings.onStop(e);if(o.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad))return void webphone_api._dialpad.onStop(e);if(o.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist))return void webphone_api._contactslist.onStop(e);if(o.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails))return void webphone_api._contactdetails.onStop(e);if(o.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist))return void webphone_api._callhistorylist.onStop(e);if(o.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails))return void webphone_api._callhistorydetails.onStop(e);if(o.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call))return void webphone_api._call.onStop(e);if(o.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact))return void webphone_api._addeditcontact.onStop(e);if(o.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api._messagelist))return void webphone_api._messagelist.onStop(e);if(o.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message))return void webphone_api._message.onStop(e);if(o.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser))return void webphone_api._internalbrowser.onStop(e);if(o.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage))return void webphone_api._startpage.onStop(e)
;if(o.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview))return void webphone_api._logview.onStop(e);if(o.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser))return void webphone_api._newuser.onStop(e);if(o.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filetransfer))return void webphone_api._filetransfer.onStop(e);if(o.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters))return void webphone_api._filters.onStop(e);if(o.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts))return void webphone_api._accounts.onStop(e);if(o.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify))return void webphone_api._smscodeverify.onStop(e);if(o.indexOf("extra1")>=0)return void(webphone_api._extra1&&webphone_api._extra1.onStop&&(webphone_api._extra1.onStop(e),webphone_api.global.isExtra1Started=!1));if(o.indexOf("extra2")>=0)return void(webphone_api._extra2&&webphone_api._extra2.onStop&&(webphone_api._extra2.onStop(e),webphone_api.global.isExtra2Started=!1));if(o.indexOf("extra3")>=0)return void(webphone_api._extra3&&webphone_api._extra3.onStop&&(webphone_api._extra3.onStop(e),webphone_api.global.isExtra3Started=!1));if(o.indexOf("extra4")>=0)return void(webphone_api._extra4&&webphone_api._extra4.onStop&&(webphone_api._extra4.onStop(e),webphone_api.global.isExtra4Started=!1));if(o.indexOf("extra5")>=0)return void(webphone_api._extra5&&webphone_api._extra5.onStop&&(webphone_api._extra5.onStop(e),webphone_api.global.isExtra5Started=!1))}catch(n){webphone_api.common.isNull(o)&&(o=""),webphone_api.common.PutToDebugLogException(2,"init: pagebeforehide "+o,n)}}),webphone_api.$(document).on("pagehide",'[data-role="page"]',function(e){var o="";try{if(o=webphone_api.$(this).attr("id"),webphone_api.common.isNull(o)||o.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pagehide NO PAGE");if(o.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings)&&webphone_api._settings.onDestroy)return void webphone_api._settings.onDestroy(e);if(o.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad)&&webphone_api._dialpad.onDestroy)return void webphone_api._dialpad.onDestroy(e);if(o.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist)&&webphone_api._contactslist.onDestroy)return void webphone_api._contactslist.onDestroy(e);if(o.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails)&&webphone_api._contactdetails.onDestroy)return void webphone_api._contactdetails.onDestroy(e);if(o.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist)&&webphone_api._callhistorylist.onDestroy)return void webphone_api._callhistorylist.onDestroy(e);if(o.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails)&&webphone_api._callhistorydetails.onDestroy)return void webphone_api._callhistorydetails.onDestroy(e);if(o.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call)&&webphone_api._call.onDestroy)return void webphone_api._call.onDestroy(e);if(o.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact)&&webphone_api._addeditcontact.onDestroy)return void webphone_api._addeditcontact.onDestroy(e);if(o.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api._messagelist)&&webphone_api._messagelist.onDestroy)return void webphone_api._messagelist.onDestroy(e);if(o.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message)&&webphone_api._message.onDestroy)return void webphone_api._message.onDestroy(e);if(o.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser)&&webphone_api._internalbrowser.onDestroy)return void webphone_api._internalbrowser.onDestroy(e);if(o.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage)&&webphone_api._startpage.onDestroy)return void webphone_api._startpage.onDestroy(e);if(o.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview)&&webphone_api._logview.onDestroy)return void webphone_api._logview.onDestroy(e);if(o.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser)&&webphone_api._newuser.onDestroy)return void webphone_api._newuser.onDestroy(e);if(o.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filters)&&webphone_api._filters.onDestroy)return void webphone_api._filetransfer.onDestroy(e);if(o.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters)&&webphone_api._filters.onDestroy)return void webphone_api._filters.onDestroy(e);if(o.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts)&&webphone_api._accounts.onDestroy)return void webphone_api._accounts.onDestroy(e);if(o.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify)&&webphone_api._smscodeverify.onDestroy)return void webphone_api._smscodeverify.onDestroy(e)}catch(n){webphone_api.common.isNull(o)&&(o=""),webphone_api.common.PutToDebugLogException(2,"init: pagehide "+o,n)}}),{initialize:e,mobileinit:n,SkinLoaded:o}}(),webphone_api.webrtcapi=function(){function PutToDebugLogException(e,o,n){webphone_api&&webphone_api.common&&webphone_api.common.PutToDebugLogException&&"function"==typeof webphone_api.common.PutToDebugLogException?webphone_api.common.PutToDebugLogException(e,o,n):console.error(o)}function PutToDebugLog(e,o,n){webphone_api&&webphone_api.common&&webphone_api.common.PutToDebugLog&&"function"==typeof webphone_api.common.PutToDebugLog?webphone_api.common.PutToDebugLog(e,o,n):console.log(o)}function JsObjecSniffer(e,o,n){if(void 0===e)return void console.log("josniffer obj is undefine");if(null===e)return void console.log("josniffer obj is NULL");console.log("=========== JsObjecSniffer ============="),void 0!==o&&null!==o||(o=0),-1===o&&(o=100);var t=e;for(var i in t){0===n?"function"!=typeof t[i]&&console.log("[josniffer] "+i+": "+t[i]):1===n?"function"==typeof t[i]&&console.log("[josniffer] "+i+": "+t[i]):console.log("[josniffer] "+i+": "+t[i]);var a="",r="",l="",p="",s="",c="",u="",g="",m="",b="",h="",d="",_="",w="",f="",v=null,P=null,E=null,T=null,N=null,S=null,I=null,R=null,G=null,O=null,L=null,C=null,D=null,y=null,x=null;if(null!==t&&"undefined"!=typeof t[i]&&null!==t[i]&&(v=t[i],o>0&&null!==v&&"object"==typeof v))for(var a in v)if(0===n?"function"!=typeof v[a]&&console.log("[josniffer] "+i+" - "+a+": "+v[a]):1===n?"function"==typeof v[a]&&console.log("[josniffer] "+i+" - "+a+": "+v[a]):console.log("[josniffer] "+i+" - "+a+": "+v[a]),null!==v&&"undefined"!=typeof v[a]&&null!==v[a]&&(P=v[a],o>1&&null!==P&&"object"==typeof P))for(var r in P)if(0===n?"function"!=typeof P[r]&&console.log("[josniffer] "+i+" - "+a+" - "+r+": "+P[r]):1===n?"function"==typeof P[r]&&console.log("[josniffer] "+i+" - "+a+" - "+r+": "+P[r]):console.log("[josniffer] "+i+" - "+a+" - "+r+": "+P[r]),null!==P&&"undefined"!=typeof P[r]&&null!==P[r]&&(E=P[r],o>2&&null!==E&&"object"==typeof E))for(var l in E)if(0===n?"function"!=typeof E[l]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+": "+E[l]):1===n?"function"==typeof E[l]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+": "+E[l]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+": "+E[l]),null!==E&&"undefined"!=typeof E[l]&&null!==E[l]&&(T=E[l],o>3&&null!==T&&"object"==typeof T))for(var p in T)if(0===n?"function"!=typeof T[p]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+": "+T[p]):1===n?"function"==typeof T[p]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+": "+T[p]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+": "+T[p]),null!==T&&"undefined"!=typeof T[p]&&null!==T[p]&&(N=T[p],o>4&&null!==N&&"object"==typeof N))for(var s in N)if(0===n?"function"!=typeof N[s]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+": "+N[s]):1===n?"function"==typeof N[s]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+": "+N[s]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+": "+N[s]),null!==N&&"undefined"!=typeof N[s]&&null!==N[s]&&(S=N[s],o>5&&null!==S&&"object"==typeof S))for(var c in S)if(0===n?"function"!=typeof S[c]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+": "+S[c]):1===n?"function"==typeof S[c]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+": "+S[c]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+": "+S[c]),null!==S&&"undefined"!=typeof S[c]&&null!==S[c]&&(I=S[c],o>6&&null!==I&&"object"==typeof I))for(var u in I)if(0===n?"function"!=typeof I[u]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+": "+I[u]):1===n?"function"==typeof I[u]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+": "+I[u]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+": "+I[u]),null!==I&&"undefined"!=typeof I[u]&&null!==I[u]&&(R=I[u],o>7&&null!==R&&"object"==typeof R))for(var g in R)if(0===n?"function"!=typeof R[g]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+": "+R[g]):1===n?"function"==typeof R[g]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+": "+R[g]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+": "+R[g]),null!==R&&"undefined"!=typeof R[g]&&null!==R[g]&&(G=R[g],o>8&&null!==G&&"object"==typeof G))for(var m in G)if(0===n?"function"!=typeof G[m]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+": "+G[m]):1===n?"function"==typeof G[m]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+": "+G[m]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+": "+G[m]),null!==G&&"undefined"!=typeof G[m]&&null!==G[m]&&(O=G[m],o>9&&null!==O&&"object"==typeof O))for(var b in O)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+" - "+b+": "+O[b]),null!==O&&"undefined"!=typeof O[b]&&null!==O[b]&&(L=O[b],o>10&&null!==L&&"object"==typeof L))for(var h in L)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+" - "+b+" - "+h+": "+L[h]),null!==L&&"undefined"!=typeof L[h]&&null!==L[h]&&(C=L[h],o>11&&null!==C&&"object"==typeof C))for(var d in C)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+" - "+b+" - "+h+" - "+d+": "+C[d]),null!==C&&"undefined"!=typeof C[d]&&null!==C[d]&&(D=C[d],o>12&&null!==D&&"object"==typeof D))for(var _ in D)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+a+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+" - "+b+" - "+h+" - "+d+" - "+_+": "+D[_]),null!==D&&"undefined"!=typeof D[_]&&null!==D[_]&&(y=D[_],o>13&&null!==y&&"object"==typeof y))for(var w in y)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+" - "+b+" - "+h+" - "+d+" - "+_+" - "+w+": "+y[w]),null!==y&&"undefined"!=typeof y[w]&&null!==y[w]&&(x=y[w],o>14&&null!==x&&"object"==typeof x))for(var f in x)console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+l+" - "+p+" - "+s+" - "+c+" - "+u+" - "+g+" - "+m+" - "+b+" - "+h+" - "+d+" - "+_+" - "+w+" - "+f+": "+x[f])}console.log("=========== End JsObjecSniffer =============")}function WebRtcIsSupported(e){try{var o=document.getElementById("dtmfTone"),n=document.getElementById("justbeep_1");webphone_api.common.isNull(o)&&webphone_api.$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),webphone_api.common.isNull(n)&&webphone_api.$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>');var t=!1;window.WebSocket&&(t=!0);var i=!1;(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&(i=!0);var a=!1;return window.RTCPeerConnection&&(a=!0),!0===t&&!0===i&&!0===a&&(navigator.mediaDevices===undefined&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===undefined&&(navigator.mediaDevices.getUserMedia=function(e){var o=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return o?new Promise(function(n,t){o.call(navigator,e,n,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})),!0===t&&!0===i&&!0===a?("function"==typeof e&&e(!0),!0):(PutToDebugLog(2,"EVENT, WebRtcIsSupported: WebRTC not supported: wssuport: "+t+"; gumSupport: "+i+"; peerconSupport: "+a),"function"==typeof e&&e(!1),!1)}catch(r){PutToDebugLogException(2,"webrtcapi: WebRtcIsSupported",r);try{"function"==typeof e&&e(!1)}catch(r){}}return!1}function LoadScript(e,o,n){try{if(!o||"function"!=typeof o)return void PutToDebugLog(2,"ERROR, webrtcapi: LoadScript success callback NOT set");if(!n||"function"!=typeof n)return void PutToDebugLog(2,"ERROR, webrtcapi: LoadScript error callback NOT set");"undefined"!=typeof webphone_api.jscodeversion&&null!==webphone_api.jscodeversion&&webphone_api.jscodeversion.length>0&&e.indexOf("jscodeversion=")<0&&(e=e.indexOf("?")>0?e+"&jscodeversion="+webphone_api.jscodeversion.toString():e+"?jscodeversion="+webphone_api.jscodeversion.toString()),webphone_api.$.ajax({url:e,dataType:"script",method:"GET",timeout:45e3,success:o,error:n,async:!0})}catch(t){PutToDebugLogException(2,"webrtcapi: LoadScript",t)}}function LoadWebrtc(e,o,n){try{if(initcallback=e,!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, webrtcapi: CheckIfSupported callback is NULL");if(wen_namespace=o,void 0!==n&&null!==n&&acc_arr.push(n),void 0!==o&&null!==o||"undefined"==typeof webphone_api.webrtcstack||null===webphone_api.webrtcstack||"undefined"==typeof webphone_api.webrtcstack.SIPml||null===webphone_api.webrtcstack.SIPml){var t=webphone_api.getbasedir2()+"js/lib/wen.js";void 0!==o&&null!==o&&o.length>1&&("undefined"!=typeof webphone_api.wen_namespace_arr&&null!=webphone_api.wen_namespace_arr||(webphone_api.wen_namespace_arr=[]),webphone_api.wen_namespace_arr.push(o)),0==t.indexOf("file")?(PutToDebugLog(2,"EVENT, Loading WebRTC engine by file script insert: "+t),webphone_api.LoadScriptFile(t,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)},function(){PutToDebugLog(2,"WARNING, LoadWebrtc: failed to load by file script. retry with ajax: "+t),LoadScript(t,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)},function(e,o,n){webphone_api.common.isNull(o)&&(o="");var t="";void 0!==n&&null!==n&&("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(t=t+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(t=t+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(t=t+": "+n.lineNumber)),PutToDebugLog(2,"WARNING, LoadWebrtc: failed to load script; status: "+o+"; trace: "+t+"; exception: "+n)})})):(PutToDebugLog(2,"EVENT, Loading WebRTC engine script by ajax: "+t),LoadScript(t,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)},function(e,o,n){webphone_api.common.isNull(o)&&(o="");var i="";void 0!==n&&null!==n&&("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(i=i+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(i=i+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(i=i+": "+n.lineNumber)),PutToDebugLog(2,"WARNING, LoadWebrtc: failed to load script; status: "+o+"; trace: "+i+"; exception: "+n),PutToDebugLog(2,"EVENT, retry Loading WebRTC engine by file script insert: "+t),webphone_api.LoadScriptFile(t,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)})}))}else{var i=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(i=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(e,wen_namespace,i)}}catch(a){PutToDebugLogException(2,"webrtcapi: LoadWebrtc",a),e(!1)}}function LoadWebrtcInner(e,o,n){try{void 0!==o&&null!==o||(o="webrtcstack"),"webrtcstack"===o&&(webphone_api.$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'),webphone_api.$(document.body).append('<audio id="ringtone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="ringbacktone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),webphone_api.$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>'),PutToDebugLog(2,"EVENT, LoadWebrtc audio files loaded form url: "+webphone_api.getbasedir2()+"sound/"),AddVideoElemnts(!1),setTimeout(function(){AddVideoElemnts(!0);var e=document.getElementById("ringtone"),o=document.getElementById("ringbacktone");!webphone_api.common.isNull(e)&&!webphone_api.common.isNull(o)&&!0===webphone_api.rt_loaded&&!0===webphone_api.rt_canplay&&!0===webphone_api.rbt_loaded&&!0===webphone_api.rbt_canplay&&e.play&&o.play||(webphone_api.$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'),webphone_api.$(document.body).append('<audio id="ringtone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="ringbacktone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),webphone_api.$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>'),PutToDebugLog(2,"EVENT, LoadWebrtc audio files loaded again after document ready form url: "+webphone_api.getbasedir2()+"sound/"))},5e3),document.onkeyup=onKeyUp,document.body.onkeyup=onKeyUp);var t="error";webphone_api.common.GetLogLevel()>1&&(t="info"),webphone_api[o].SIPml.setDebugLevel(t);var i=function(e){for(var o=window.location.search.substring(1),n=o.split("&"),t=0;t<n.length;t++){var i=n[t].split("=");if(decodeURIComponent(i[0])===e)return decodeURIComponent(i[1])}return null},a=function(){var t=i("wt"),a=i("fps"),r=i("mvs"),l=i("mbwu"),p=i("mbwd"),s=i("za"),c=i("ndb");if(webphone_api[o].SIPml.isInitialized())return void e(!0,o,n);t&&webphone_api[o].SIPml.setWebRtcType(t),"webrtcstack"===o?webphone_api.webrtcstack.SIPml.init(CheckIfSupported,function(t){PutToDebugLogException(2,"webrtc: preinit SIPml.init",t),PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (10)"),e(!1,o,n)}):webphone_api[o].SIPml.init(CheckIfSupported,function(t){PutToDebugLogException(2,"webrtc: preinit SIPml.init",t),PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (10)"),e(!1,o,n)}),a&&webphone_api[o].SIPml.setFps(parseFloat(a)),r&&webphone_api[o].SIPml.setMaxVideoSize(r),l&&webphone_api[o].SIPml.setMaxBandwidthUp(parseFloat(l)),p&&webphone_api[o].SIPml.setMaxBandwidthDown(parseFloat(p)),s&&webphone_api[o].SIPml.setZeroArtifacts("true"===s),"true"==c&&webphone_api[o].SIPml.startNativeDebug()};webphone_api.common.isNull(oReadyStateTimer)||clearInterval(oReadyStateTimer);var r=(webphone_api.common.GetTickCount(),0);oReadyStateTimer=setInterval(function(){r++,webphone_api.common.GetTickCount()-webphone_api.loadwebrtc_timestamp>25e3&&"Edge"===webphone_api.common.GetBrowser()&&(PutToDebugLog(2,"ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"),console.log("ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"),window.location.reload()),"complete"!==document.readyState&&!0!==webphone_api.document_loaded||(clearInterval(oReadyStateTimer),a())},50)}catch(l){PutToDebugLogException(2,"webrtcapi: LoadWebrtc inner",l),e(!1,o,n)}}function CheckIfSupported(){function e(e){try{var o="";!webphone_api.common.isNull(lw_namespace_arr)&&lw_namespace_arr.length>0&&(o=lw_namespace_arr.shift());var n=null;!webphone_api.common.isNull(lw_account_arr)&&lw_account_arr.length>0&&(n=lw_account_arr.shift()),!webphone_api.common.isNull(o)&&o.indexOf("webrtcstack")>=0&&"webrtcstack"!==o?LoadWebrtcCb(e,o,n):webphone_api.common.isNull(initcallback)||initcallback(e)}catch(t){return PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported HandleCallback false (4)"),PutToDebugLogException(2,"webrtcapi: CheckIfSupported HandleCallback",t),webphone_api.common.isNull(initcallback)||initcallback(!1),!1}}try{return webphone_api.webrtcstack.SIPml.isWebRtcSupported()?(5,webphone_api.webrtcstack.SIPml.isWebSocketSupported()?(10,viewVideoLocal=videoLocal,viewVideoRemote=videoRemote,11,webphone_api.webrtcstack.SIPml.isWebRtcSupported()?(16,postInit(),17,e(!0),20,!0):(12,PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (3)"),e(!1),15,!1)):(6,PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (2)"),e(!1),9,!1)):(1,PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (1)"),e(!1),4,!1)}catch(o){return e(!1),!1}}function postInit(){try{isregistered=!1,webphone_api.common.isNull(audioRemote)&&PutToDebugLog(2,"ERROR, Cannot find audio_remote html element (incoming audio will not work without this element!!)"),callsipheaders=RemoveDuplicateHeader(callsipheaders),oConfigCall={audio_remote:audioRemote,video_local:viewVideoLocal,video_remote:viewVideoRemote,screencast_window_id:0,bandwidth:{audio:0,video:undefined},video_size:null,events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im"}],sip_headers:callsipheaders},oConfigMessage={events_listener:{events:"*",listener:onSipEventSession}},oConfigSms={events_listener:{events:"*",listener:onSipEventSession}}}catch(e){PutToDebugLogException(2,"webrtcapi: postInit",e)}}function SetSipHeader(e,o){try{var n=webphone_api.common.IsMizuServerOrGateway(),t=webphone_api.common.GetParameter("customsipheader");if(!webphone_api.common.isNull(t)&&t.length>0){var i=null;if(i=t.indexOf(";")>0?t.split(";"):t.indexOf("\r\n")>0?t.split("\r\n"):t.split("\n"),!webphone_api.common.isNull(i)&&i.length>0)for(var a=0;a<i.length;a++)if(!(webphone_api.common.isNull(i[a])||webphone_api.common.Trim(i[a]).length<1||i[a].indexOf(":")<1)){var r=webphone_api.common.Trim(i[a].substring(0,i[a].indexOf(":"))),l=webphone_api.common.Trim(i[a].substring(i[a].indexOf(":")+1,i[a].length));webphone_api.common.isNull(r)||r.length<1||(webphone_api.common.isNull(l)&&(l=""),!0===n&&0!==r.indexOf("X-")&&(r="X-R-"+r),AddSipHeader(sipheaders,r,l),AddSipHeader(callsipheaders,r,l))}}if(webphone_api.common.isNull(o))return;o=webphone_api.common.Trim(o);var p;if(p=o.indexOf(";")>0?o.split(";"):o.indexOf("\r\n")>0?o.split("\r\n"):o.split("\n"),webphone_api.common.isNull(p)||p.length<1)return;if(-1===e&&(e=webphone_api.common.GetBestLine()),o.length<1)if(-2===e||!1===webphone_api.global.checkIfInCall){for(var a=0;a<sipheaders.length;a++){var s=sipheaders[a].name;"User-Agent"!==s&&"Organization"!==s&&s.indexOf("Webdomain")<0&&"P-Sms"!==s&&"X-Sms"!==s&&"Sy.Uppersrv"!==s&&"X-Sy.Uppersrv"!==s&&"Sy.Upperproxy"!==s&&"X-Sy.Upperproxy"!==s&&"X-IMStatus"!==s&&"X-P2P"!==s&&"X-P2PM"!==s&&"X-AUSR"!==s&&"X-Sy.Uppersrvd"!==s&&(sipheaders.splice(a,1),a--)}oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}));for(var a=0;a<webphone_api.global.ep.length;a++)try{var c=webphone_api.global.ep[a][webphone_api.common.EP_SIPHEADERS];if(webphone_api.common.isNull(c)||c.length<1)continue;for(var u=0;u<c.length;u++){var s=c[u].name;"User-Agent"!==s&&"Organization"!==s&&s.indexOf("Webdomain")<0&&"P-Sms"!==s&&"X-Sms"!==s&&"Sy.Uppersrv"!==s&&"X-Sy.Uppersrv"!==s&&"Sy.Upperproxy"!==s&&"X-Sy.Upperproxy"!==s&&"X-IMStatus"!==s&&"X-P2P"!==s&&"X-P2PM"!==s&&"X-AUSR"!==s&&"X-Sy.Uppersrvd"!==s&&(c.splice(u,1),u--)}webphone_api.global.ep[a][webphone_api.common.EP_SIPHEADERS]=c;var g=webphone_api.global.ep[a][webphone_api.common.EP_SESSION];webphone_api.common.isNull(g)||(c=RemoveDuplicateHeader(c),g.setConfiguration({sip_headers:c}))}catch(_){PutToDebugLogException(2,"webrtcapi: SetSipHeader remove from callseesions",_)}}else if(e>0){for(var m=-1,a=0;a<webphone_api.global.ep.length;a++){var b=webphone_api.global.ep[webphone_api.common.EP_LINE];if(b===e){m=a;break}}if(m>-1){var c=webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS];if(!webphone_api.common.isNull(c)&&c.length>0){for(var u=0;u<c.length;u++){var s=c[u].name;"User-Agent"!==s&&"Organization"!==s&&s.indexOf("Webdomain")<0&&"P-Sms"!==s&&"X-Sms"!==s&&"Sy.Uppersrv"!==s&&"X-Sy.Uppersrv"!==s&&"Sy.Upperproxy"!==s&&"X-Sy.Upperproxy"!==s&&"X-IMStatus"!==s&&"X-P2P"!==s&&"X-P2PM"!==s&&"X-AUSR"!==s&&"X-Sy.Uppersrvd"!==s&&(c.splice(u,1),u--)}webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS]=c;var g=webphone_api.global.ep[m][webphone_api.common.EP_SESSION];webphone_api.common.isNull(g)||(c=RemoveDuplicateHeader(c),g.setConfiguration({sip_headers:c}))}}}for(var a=0;a<p.length;a++)if(!(webphone_api.common.isNull(p[a])||p[a].indexOf(":")<1)){var r=p[a].substring(0,p[a].indexOf(":")),h=p[a].substring(p[a].indexOf(":")+1);if(webphone_api.common.isNull(h)&&(h=""),!0===n&&0!==r.indexOf("X-")&&(r="X-R-"+r),-2===e||!1===webphone_api.global.checkIfInCall){AddSipHeader(sipheaders,r,h),oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}));for(var u=0;u<webphone_api.global.ep.length;u++)try{var c=webphone_api.global.ep[u][webphone_api.common.EP_SIPHEADERS];if(webphone_api.common.isNull(c)||c.length<1)continue;AddSipHeader(c,r,h),webphone_api.global.ep[u][webphone_api.common.EP_SIPHEADERS]=c;var g=webphone_api.global.ep[u][webphone_api.common.EP_SESSION];webphone_api.common.isNull(g)||(c=RemoveDuplicateHeader(c),g.setConfiguration({sip_headers:c}))}catch(_){PutToDebugLogException(2,"webrtcapi: SetSipHeader add OR remove from callseesions",_)}AddSipHeader(callsipheaders,r,h)}else if(e>0){for(var m=-1,d=0;d<webphone_api.global.ep.length;d++){var b=webphone_api.global.ep[webphone_api.common.EP_LINE];if(b===e){m=d;break}}if(m>-1){var c=webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS];if(!webphone_api.common.isNull(c)&&c.length>0){AddSipHeader(c,r,h),webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS]=c;var g=webphone_api.global.ep[m][webphone_api.common.EP_SESSION];webphone_api.common.isNull(g)||(c=RemoveDuplicateHeader(c),g.setConfiguration({sip_headers:c}))}}}}}catch(_){PutToDebugLogException(2,"webrtcapi: SetSipHeader",_)}}function AddSipHeader(e,o,n){try{if(webphone_api.common.isNull(e)&&(e=[]),webphone_api.common.isNull(o)||o.length<1)return;webphone_api.common.isNull(n)&&(n=""),PutToDebugLog(4,"EVENT, AddSipHeader: "+o+": "+n);for(var t=o.toLowerCase(),i=!1,a=0;a<e.length;a++){var r=e[a].name;if(!(webphone_api.common.isNull(r)||r.length<1)&&(r=r.toLowerCase(),t===r)){"User-Agent"!==o&&"Organization"!==o&&o.indexOf("Webdomain")<0&&"P-Sms"!==o&&"X-Sms"!==o&&"Sy.Uppersrv"!==o&&"X-Sy.Uppersrv"!==o&&"Sy.Upperproxy"!==o&&"X-Sy.Upperproxy"!==o&&"X-P2P"!==o&&"X-P2PM"!==o&&"X-AUSR"!==o&&"X-Sy.Uppersrvd"!==o&&(o.length<1?e[a].splice(a,1):e[a].value=n),i=!0;break}}!1===i&&o.length>0&&(e[e.length]={},e[e.length-1].name=o,e[e.length-1].value=n),e=RemoveDuplicateHeader(e)}catch(l){PutToDebugLogException(2,"webrtcapi: AddSipHeader",l)}}function RemoveDuplicateHeader(e){try{var o=[];if(webphone_api.common.isNull(e)||e.length<1)return e;for(var n=e.length-1;n>=0;n--)if(!webphone_api.common.isNull(e[n])){for(var t=!1,i=0;i<o.length;i++)if(o[i].name===e[n].name){t=!0;break}!1===t&&o.push(e[n])}if(!webphone_api.common.isNull(o))return o}catch(a){PutToDebugLogException(2,"webrtcapi: RemoveDuplicateHeader",a)}return e}function ReStart(e,o){try{if(webphone_api.common.isNull(te2)&&(te2=webphone_api.common.Te2()),te2)return;if(PutToDebugLog(2,"EVENT, webrtcapi restart flag: "+webphone_api.flagrestartwebrtc.toString()),!1===webphone_api.flagrestartwebrtc)return;if(webphone_api.global.checkIfInCall&&(webphone_api.global.checkIfInCall=!1,PutToDebugLog(1,"STATUS,-1,Call Finished")),!0===o)return PutToDebugLog(2,"EVENT, restarting webrtc sipstack: forced"),restartdelay=2e3,webphone_api.common.CallWsuserKeepAlive(!0),void Start();var n=webphone_api.common.GetTickCount();if(!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(restartdelay=webphone_api.common.StrToInt(e)),n<=lastrestarttick+restartdelay)return;n-lastrestarttick>8e5&&restartdelay>2e3&&(restartdelay=2e3),n>lastrestarttick+restartdelay&&n-lastrestarttick<512e3&&(restartdelay*=2),lastrestarttick=n;var t=new Date(lastrestarttick),i=t.getHours(),a=t.getMinutes(),r=t.getSeconds();a<10&&(a="0"+a),r<10&&(r="0"+r),restarttimestr=i+":"+a+":"+r,setTimeout(function(){PutToDebugLog(2,"EVENT, restarting webrtc sipstack: "+restarttimestr),webphone_api.common.CallWsuserKeepAlive(!0),Start()},restartdelay)}catch(l){PutToDebugLogException(2,"webrtcapi: ReStart",l)}}function Start(){try{LoadWebrtc(function(e){PutToDebugLog(2,"EVENT, webrtcapi: LoadWebrtc returned: "+e),StartInner()})}catch(e){PutToDebugLogException(2,"webrtcapi: Start",e)}}function StartInner(){try{PutToDebugLog(2,"EVENT, webrtcapi start"),webphone_api.flagrestartwebrtc=!0,StartGetDevices(),PutToDebugLog(2,"EVENT, mlogic API_Setvolume on WebRTC start"),webphone_api.setvolume(1,webphone_api.common.GetParameter("volumeout"));var chsptr=webphone_api.common.GetParameter2("changesptoring");(webphone_api.common.isNull(chsptr)||chsptr.length<1||!1===webphone_api.common.IsNumber(chsptr))&&(chsptr=2),changesptoring=webphone_api.common.StrToInt(chsptr);var remonco=webphone_api.common.GetParameter2("recheckmediaonconnect");(webphone_api.common.isNull(remonco)||remonco.length<1||!1===webphone_api.common.IsNumber(remonco))&&(remonco=2),recheckmediaonconnect=webphone_api.common.StrToInt(remonco),(recheckmediaonconnect<0||recheckmediaonconnect>3)&&(recheckmediaonconnect=2),webphone_api.global.autoacceptsipheader=webphone_api.common.GetParameter("autoacceptsipheader")
;var sipusername=webphone_api.common.GetSipusername(),password=webphone_api.common.GetParameter("password"),callerid=webphone_api.common.GetCallerid();(webphone_api.common.isNull(callerid)||webphone_api.common.Trim(callerid).length<1)&&(callerid=sipusername);var udpaddr=GetUDPServerAddress(),wsaddr=webphone_api.common.GetWebrtcSrvAddr(),displayname=webphone_api.common.GetParameter("displayname");if((webphone_api.common.isNull(displayname)||displayname.length<1)&&sipusername!==callerid&&(displayname=sipusername),!0===webphone_api.common.GetParameterBool("hidemyidentity",!1)&&(displayname=""),2===webphone_api.common.GetConfigInt("usemizuwebrtcgateway",1)&&(wsaddr=""),webphone_api.common.isNull(wsaddr)||wsaddr.length<2){wsaddr=webphone_api.common.GetWp();var wstmp=wsaddr;wstmp.indexOf("//")>=0&&(wstmp=wstmp.substring(wstmp.indexOf("//")+2,wstmp.length)),wstmp.indexOf(":")>0&&(wstmp=wstmp.substring(0,wstmp.indexOf(":")))}else wsaddr=webphone_api.common.Trim(wsaddr.toLowerCase());wsaddr=wsaddr.replace("*",""),wsaddr=wsaddr.toLowerCase(),wsaddr=wsaddr.replace("udp://",""),wsaddr=wsaddr.replace("tcp://",""),wsaddr=wsaddr.replace("http://",""),wsaddr=wsaddr.replace("https://","");var sipaddress=udpaddr;sipaddress.indexOf("udp:")<0&&(sipaddress="udp://"+sipaddress);var proxyaddress=webphone_api.common.GetProxyaddress();if(webphone_api.common.isNull(proxyaddress)&&(proxyaddress=""),!0===webphone_api.common.IsMizuServerOrGateway()&&proxyaddress.length<1&&(proxyaddress=sipaddress),proxyaddress=webphone_api.common.GetProxyaddress(proxyaddress),proxyaddress.length>0)if(webphone_api.common.IsMizuServerOrGateway())proxyaddress="udp://"+proxyaddress;else{var transport=webphone_api.common.GetParameterInt("transport",0),transpStr="udp";1===transport?transpStr="tcp":2===transport&&(transpStr="tls"),transpStr.indexOf(":")<0&&(transpStr+="://"),proxyaddress=transpStr+proxyaddress}var wsaddress=wsaddr;wsaddress.indexOf("ws:")<0&&wsaddress.indexOf("wss:")<0&&(wsaddress="ws://"+wsaddress);var hostmp=location.host.toLowerCase();if(!1!==webphone_api.common.IsIPAddrress(wsaddress)&&!0!==webphone_api.common.BrowserRequiresHttps(!0)||(wsaddress=wsaddress.replace("ws:","wss:")),!1===webphone_api.global.decideusuk_finished){var set=!1;if(!0===webphone_api.common.IsUKGateway(wsaddress)?(webphone_api.global.usuk="uk",set=!0):!0===webphone_api.common.IsUSGateway(wsaddress)&&(webphone_api.global.usuk="us",set=!0),set&&!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var selsrv=webphone_api.common.GetWsAddressCfg();selsrv.length>0&&webphone_api.common.SaveParameter("lastwebrtcserver",selsrv),PutToDebugLog(5,"EVENT, DecideUsUk select finished on start "+selsrv)}}var publicsipaddress=webphone_api.common.GetConfig("publicsipaddress");webphone_api.common.isNull(publicsipaddress)&&(publicsipaddress=""),publicsipaddress.length>0&&PutToDebugLog(2,"EVENT, WebRTC publicsipaddress is set to: "+publicsipaddress);var realm=publicsipaddress;realm.length<2&&(realm=webphone_api.common.GetParameter("realm"),(webphone_api.common.isNull(realm)||realm.length<2)&&(realm=udpaddr)),realm=webphone_api.common.NormalizeInput(realm,0),realm.indexOf(":")>0&&(realm=realm.substring(0,realm.indexOf(":"))),realm=webphone_api.common.Trim(realm),webphone_api.global.mRealm=realm;var sipuri=callerid;if(sipuri.indexOf("sip:")<0&&(sipuri="sip:"+callerid),sipuri.indexOf("@")<0)if(sipuri+="@",publicsipaddress.length>1)sipuri+=publicsipaddress;else if(realm.indexOf(".")>0)sipuri+=realm;else{var tmpsrv=sipaddress;tmpsrv=tmpsrv.toLowerCase(),tmpsrv=webphone_api.common.NormalizeInput(tmpsrv,0),tmpsrv.indexOf(":")>0&&(tmpsrv=tmpsrv.substring(0,tmpsrv.indexOf(":"))),tmpsrv.indexOf("/")>0&&(tmpsrv=tmpsrv.substring(0,tmpsrv.indexOf("/"))),sipuri+=tmpsrv}if(!webphone_api.common.isNull(sipuri)&&sipuri.indexOf("@")>0){var addrtmp=sipuri.substr(sipuri.indexOf("@")+1);if(!webphone_api.common.isNull(addrtmp)&&(addrtmp.indexOf(":")>0&&(addrtmp=addrtmp.substring(0,addrtmp.indexOf(":"))),!webphone_api.common.isNull(addrtmp)&&addrtmp.length>0&&webphone_api.common.IsLanIP(addrtmp)&&webphone_api.common.GetWebrtcSrvAddr().length<2))return PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+" (2)"),(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&alert("ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+"\n\n"+webphone_api.stringres.get("all_demo_msg")+" (2)"),!1}var enableRTCWebBreaker=!0;enableRTCWebBreaker=!(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&0===webphone_api.parameters.rtcbreaker)&&(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&1===webphone_api.parameters.rtcbreaker||!webphone_api.common.IsMizuServerOrGateway()),PutToDebugLog(2,"EVENT, webrtcapi: Start rtcbreaker: "+enableRTCWebBreaker.toString());var organization=webphone_api.common.GetConfig("companyname");(webphone_api.common.isNull(organization)||organization.length<1)&&(organization=webphone_api.common.GetConfig("brandname"),(webphone_api.common.isNull(organization)||organization.length<1)&&(organization="Mizutech"));var ua=webphone_api.common.GetUA();webphone_api.common.GetParameter("useragent").length>0&&!1===webphone_api.common.IsMizuPublicWebRTCGateway()&&(ua=webphone_api.common.GetParameter("useragent")),sipheaders=[{name:"User-Agent",value:ua},{name:"Organization",value:organization},{name:"X-Webdomain",value:webphone_api.common.GetWebdomain()}];var xhval="1";!0===webphone_api.common.Hasesw()?xhval="2":!0===webphone_api.common.Us()&&(xhval="0"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-LS",sipheaders[sipheaders.length-1].value=xhval,SetSipHeader(0),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-UT",sipheaders[sipheaders.length-1].value="r";var company=webphone_api.common.GetParameter("companyname");!webphone_api.common.isNull(company)&&company.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Company",sipheaders[sipheaders.length-1].value=company);var brand=webphone_api.common.GetParameter("brandname");!webphone_api.common.isNull(brand)&&brand.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Brand",sipheaders[sipheaders.length-1].value=brand);var uppsrv=webphone_api.common.GetWebrtcSyUpperHeader("start");uppsrv.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Uppersrv",sipheaders[sipheaders.length-1].value=uppsrv);var uppsrvd=webphone_api.common.GetWebrtcSyUpperDomainHeader("start");uppsrvd.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Uppersrvd",sipheaders[sipheaders.length-1].value=uppsrvd);var dtmfmode=webphone_api.common.GetParameterInt("dtmfmode",2);4==dtmfmode&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-MFlag",sipheaders[sipheaders.length-1].value="2"),webphone_api.global.addauser_header=!1,!webphone_api.common.isNull(sipusername)&&sipusername.length>0&&!webphone_api.common.isNull(callerid)&&callerid.length>0&&sipusername!==callerid&&(webphone_api.global.addauser_header=!0,sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-AUSR",sipheaders[sipheaders.length-1].value=sipusername);var prxy=webphone_api.common.GetUpperProxyHeaderForSignaling();!webphone_api.common.isNull(prxy)&&prxy.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Upperproxy",sipheaders[sipheaders.length-1].value=prxy),!0===webphone_api.common.UsePresence2()&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-IMStatus",sipheaders[sipheaders.length-1].value="Online");var p2psignaling=webphone_api.common.GetParameterInt("p2psignaling",1);if(1!==p2psignaling){var valTmp="unknown";0===p2psignaling?valTmp="no":2===p2psignaling?valTmp="proxy":3===p2psignaling&&(valTmp="process"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2P",sipheaders[sipheaders.length-1].value=valTmp}var use_fast_ice=webphone_api.common.GetParameterInt("use_fast_ice",1);-1===use_fast_ice&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2PM",sipheaders[sipheaders.length-1].value="1"),sipheaders=RemoveDuplicateHeader(sipheaders);var loglevel="error";webphone_api.common.GetLogLevel()>1&&(loglevel="info"),webphone_api.webrtcstack.SIPml.setDebugLevel(loglevel),window.webkitNotifications&&0!=window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission(),(webphone_api.common.isNull(sipusername)||sipusername.length<1)&&(PutToDebugLog(2,"ERROR, WebRTC invalid username: "+sipusername),PutToDebugLog(1,"ERROR, Invalid username")),(webphone_api.common.isNull(password)||password.length<1)&&(PutToDebugLog(2,"ERROR, WebRTC invalid password: "+password),PutToDebugLog(1,"ERROR, Invalid password")),(webphone_api.common.isNull(sipuri)||sipuri.length<2||sipuri.indexOf("@")<1||sipuri.indexOf(".")<1)&&PutToDebugLog(2,"ERROR, WebRTC invalid sipuri: "+sipuri);var stun_turn=[],stun=webphone_api.common.GetStunServersStr(),turn=webphone_api.common.GetTurnSrv();if(!webphone_api.common.isNull(stun)&&stun.length>2){var sarr=stun.split(","),useurls=!1;if(("Chrome"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40||"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40)&&(useurls=!0),!webphone_api.common.isNull(sarr))for(var i=0;i<sarr.length;i++)if(!(webphone_api.common.isNull(sarr[i])||sarr[i].length<1))if(!0===useurls){var obj={urls:sarr[i]};stun_turn.push(obj)}else{var obj={url:sarr[i]};stun_turn.push(obj)}}webphone_api.common.isNull(turn)||webphone_api.common.IsLocalServer()||stun_turn.push(turn);var ldebug=!1;(webphone_api.common.GetLogLevel()>=7||!0===webphone_api.global.isdebugversion&&webphone_api.common.GetLogLevel()>=5)&&(ldebug=!0);var logparams={};if(!webphone_api.common.isNull(webphone_api.global.settmap2)){for(var key in webphone_api.global.settmap2)if(!(webphone_api.common.isNull(key)||key.length<1)){var value=webphone_api.global.settmap2[key];webphone_api.common.isNull(value)||value.length<1||(ldebug||"mclientid"!==key&&"wstestservers"!==key)&&(key.indexOf("server")<0&&key.indexOf("username")<0&&key.indexOf("password")<0&&"1"===value[webphone_api.common.SETT_ISDEFAULT]||"-1"===value[webphone_api.common.SETT_ISDEFAULT]&&(key.indexOf("transfer")>=0||key.indexOf("refer")>=0||key.indexOf("allowreplace")>=0)||(!ldebug&&(key.indexOf("password")>=0||"extraregisteraccounts"===key)?logparams[key]="*":logparams[key]=value[webphone_api.common.SETT_VALUE]))}var extraoption=webphone_api.common.GetParameter("extraoption");if(!webphone_api.common.isNull(extraoption)&&extraoption.length>0){extraoption=webphone_api.common.Trim(extraoption);var optionlist=extraoption.split(";");if(!webphone_api.common.isNull(optionlist)&&optionlist.length>0)for(var i=0;i<optionlist.length;i++)if(!(webphone_api.common.isNull(optionlist[i])||optionlist[i].length<1||optionlist[i].indexOf("=")<1)){var key=webphone_api.common.Trim(optionlist[i].substring(0,optionlist[i].indexOf("="))),value=webphone_api.common.Trim(optionlist[i].substring(optionlist[i].indexOf("=")+1));!webphone_api.common.isNull(key)&&key.length>0&&!webphone_api.common.isNull(value)&&(logparams[key]=value)}}}if(webphone_api.common.IsCExt()>0&&(webphone_api.global.add_recall_header=!0),webphone_api.common.LogAllParameters("WebRTC all parameters (just informative):",logparams),PutToDebugLog(3,"Webrtc connection details:"),PutToDebugLog(3,"sipusername: "+sipusername),ldebug?PutToDebugLog(3,"password: "+password):!webphone_api.common.isNull(password)&&password.length>0?PutToDebugLog(3,"password: *"):PutToDebugLog(3,"password: null"),PutToDebugLog(3,"sipuri: "+sipuri),PutToDebugLog(3,"displayname: "+displayname),PutToDebugLog(3,"wsaddress: "+wsaddress),PutToDebugLog(3,"proxyaddress: "+proxyaddress),PutToDebugLog(3,"realm: "+realm),(webphone_api.common.isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)&&(webphone_api.common.IsUKGateway(wsaddress)?(PutToDebugLog(2,"WARNING, webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="uk"):webphone_api.common.IsUSGateway(wsaddress)&&(PutToDebugLog(2,"WARNING, webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="us")),mSipuri=sipuri,mDisplayname=displayname,!webphone_api.common.isNull(stun_turn)&&stun_turn.length>0){for(var i=0;i<stun_turn.length;i++)if(!webphone_api.common.isNull(stun_turn[i])){var sobj=stun_turn[i];for(var key in sobj){var msgtmp="turn server";!webphone_api.common.isNull(sobj[key])&&sobj[key].toString().indexOf("stun")>=0&&(msgtmp="stun server"),PutToDebugLog(3,msgtmp+"["+i+"]: "+key+": "+sobj[key])}}}else PutToDebugLog(3,"stun server: NOT set");var iceobj=null,icestr=webphone_api.common.GetParameter("ice");if(!webphone_api.common.isNull(icestr)&&icestr.length>0)try{iceobj=eval(icestr)}catch(eice){iceobj=null,PutToDebugLogException(2,"ERROR, webrtcapi parse ICE servers",eice)}if(!webphone_api.common.isNull(iceobj)){try{PutToDebugLog(2,"EVENT, webrtcapi found ICE (STUN/TURN) server: "+JSON.stringify(iceobj))}catch(eice2){}stun_turn=iceobj}var earlymediaint=webphone_api.common.GetParameterInt("earlymedia",2),earlymedia=!0;earlymediaint<1&&(earlymedia=!1),webphone_api.common.isNull(te2)&&(te2=webphone_api.common.Te2()),te2&&(stun_turn=null),webphone_api.webrtcMicVolume=GetVolume(0)/100,webphone_api.global.minten=!1;try{sipheaders=RemoveDuplicateHeader(sipheaders),oSipStack=new webphone_api.webrtcstack.SIPml.Stack({realm:realm,impi:sipusername,impu:sipuri,password:password,display_name:displayname,websocket_proxy_url:wsaddress,outbound_proxy_url:proxyaddress,ice_servers:stun_turn,enable_rtcweb_breaker:enableRTCWebBreaker,events_listener:{events:"*",listener:onSipEventStack},enable_early_ims:earlymedia,enable_media_stream_cache:!0,bandwidth:null,video_size:null,sip_headers:sipheaders})}catch(err_reg){var reason="";webphone_api.common.isNull(err_reg)||(reason=err_reg.toString()),!webphone_api.common.isNull(reason)&&reason.indexOf("is not valid as SIP Uri")>=0&&(reason=webphone_api.common.NormalizeInput2(sipusername,1)!==sipusername?"invalid SIP Uri because username contains special characters: "+sipusername:"invalid serveraddress: "+realm),!webphone_api.common.isNull(reason)&&reason.length>0&&(lastregfailreason=reason,PutToDebugLog(1,"ERROR, Register failed: "+reason));try{webphone_api.onRegStateChangeCb("failed",reason)}catch(errin){PutToDebugLogException(2,"webrtcapi: Start: There is an error in onRegisterFailed(failed) callback",errin)}try{webphone_api.onRegisterFailedCb(reason)}catch(errin){PutToDebugLogException(2,"webrtcapi: Start: There is an error in onRegisterFailed() callback",errin)}PutToDebugLogException(2,"webrtcapi: Start failed to create SIPstack",err_reg)}return webphone_api.common.GetParameterInt("forcereregister",1)>1&&StartReRegister(!0),webphone_api.global.webrtc_regstate=0,webphone_api.common.CallWsuserKeepAlive(!1),setTimeout(function(){if(!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>1)for(var e=0;e<webphone_api.global.sipaccounts.length;e++)if("true"!==webphone_api.global.sipaccounts[e].ismain.toString()){var o=webphone_api.global.sipaccounts[e],n=o.serveraddress+","+o.username+","+o.password+","+o.ival+","+o.callerid+","+o.displayname+","+o.proxyaddress+","+o.realm;RegisterEx(n)}var t=webphone_api.common.GetExtraRegAccFromAPIparam();if(!webphone_api.common.isNull(t)&&t.length>5){var i=[];if(i=t.indexOf("#")>=0?t.split("#"):t.split(";"),!webphone_api.common.isNull(i)&&i.length>0)for(var e=0;e<i.length;e++)webphone_api.common.isNull(i[e])||i[e].length<5||RegisterEx(i[e])}},2500),0!=oSipStack.start()?(PutToDebugLog(2,"ERROR, webrtcapi: Start, Failed to start the SIP stack"),!1):(setTimeout(function(){webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2)},500),!0)}catch(err){PutToDebugLogException(2,"webrtcapi: StartInner",err)}return!1}function GetUDPServerAddress(){try{var e="";if((webphone_api.common.isNull(e)||e.length<3)&&(e=webphone_api.common.GetParameter("serveraddress_user")),(webphone_api.common.isNull(e)||e.length<3)&&(e=webphone_api.common.GetConfig("serverdomain")),(webphone_api.common.isNull(e)||e.length<3)&&(e=webphone_api.common.GetConfig("serveraddress")),(webphone_api.common.isNull(e)||e.length<3)&&(e=webphone_api.common.GetConfig("server")),(webphone_api.common.isNull(e)||e.length<3)&&(e=webphone_api.common.GetConfig("serverip")),!webphone_api.common.isNull(e)&&e.length>2&&e.indexOf(":")<1){var o=webphone_api.common.GetConfig("serverport");!webphone_api.common.isNull(o)&&o.length>0&&"5060"!==o&&(e=e+":"+o)}return(webphone_api.common.isNull(e)||e.length<3||e.indexOf(".")<1)&&(e=webphone_api.common.GetParameter("upperserver")),(webphone_api.common.isNull(e)||e.length<3)&&(e=webphone_api.common.GetFp()),e=e.toLowerCase(),e=e.replace("udp://",""),e=e.replace("tcp://",""),e=e.replace("http://",""),e=e.replace("https://","")}catch(n){PutToDebugLogException(2,"webrtcapi: GetUDPServerAddress",n)}return""}function SipUnRegister(){try{if(oSipSessionRegister)return oSipSessionRegister.unregister(),setTimeout(function(){PutToDebugLog(1,"STATUS,-1,Unregistered")},100),!0}catch(e){PutToDebugLogException(2,"webrtcapi: SipUnRegister",e)}return!1}function SipStop(){try{if(!0===webphone_api.isregistered()&&SipUnRegister(),oSipStack)return oSipStack.stop(),PutToDebugLog(2,"EVENT,SipStack Stopped"),setTimeout(function(){try{"undefined"!=typeof webphone_api.webrtc_socket&&null!==webphone_api.webrtc_socket&&(webphone_api.webrtc_socket.close(),webphone_api.webrtc_socket=null,PutToDebugLog(2,"EVENT,SipStack Destroyed")),PutToDebugLog(2,"webrtcapi: SipStop websocket closed")}catch(e){PutToDebugLogException(2,"webrtcapi: SipStop inner",e)}},500),!0;if(!webphone_api.common.isNull(registerExSipstackArray)&&registerExSipstackArray.length>0)for(var e=0;e<registerExSipstackArray.length;e++)!webphone_api.common.isNull(registerExSipstackArray[e])&&registerExSipstackArray[e]&&registerExSipstackArray[e].stop&&registerExSipstackArray[e].stop()}catch(o){PutToDebugLogException(2,"webrtcapi: SipStop",o)}return registerExSipstackArray=[],!1}function HandleOconfigCall(e,o){try{var n=e;return!0===webphone_api.isincall()&&webphone_api.common.isNull(document.getElementById("audio_remote_"+o))&&webphone_api.$(document.body).append('<audio id="audio_remote_'+o+'" autoplay="autoplay" ></audio>'),webphone_api.common.isNull(document.getElementById("audio_remote_"+o))?oConfigCall.audio_remote=audioRemote:oConfigCall.audio_remote=document.getElementById("audio_remote_"+o),n}catch(t){PutToDebugLogException(2,"webrtcapi: HandleOconfigCall",t)}return e}function RemoveUnusedAudioElements(){try{for(var e=1;e<15;e++)webphone_api.$("#audio_remote_"+e).remove()}catch(o){PutToDebugLogException(2,"webrtcapi: RemoveUnusedAudioElements",o)}}function SipCall(e,o,n,t){try{if(!oSipStack&&!1===sipstackstarted)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipCall sipstack not started"),PutToDebugLog(1,"ERROR, Reconnecting, try to call again"),PutToDebugLog(1,"EVENT, POPUP, Reconnecting, try to call again"),ReStart(1500),sipstackstarted=!0,setTimeout(function(){SipCall(e,o,n)},2500),!1;if(webphone_api.common.isNull(n)||n.length<1)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipCall number is NULL"),!1;setTimeout(function(){!1===webphone_api.global.webrtcpermissionaccepted&&(PutToDebugLog(2,"ERROR, call accepted, but permission not yet accepted"),webphone_api.common.AlertDialog(webphone_api.stringres.get("request_permission2_title"),webphone_api.common.ReplaceAll(webphone_api.stringres.get("request_permission2"),"[BRANDNAME]",webphone_api.common.GetBrandName())))},7e3),oConfigCall.bandwidth=undefined,oConfigCall.video_size=undefined;var i=webphone_api.common.GetVideoBandwidth(),a=webphone_api.common.GetAudioBandwidth();if(oConfigCall.bandwidth={audio:a,video:i},"call-audiovideo"===e||"call-screenshare"===e){var r=document.getElementById("video_container");webphone_api.common.isNull(r)&&(PutToDebugLog(2,"ERROR, VideoCall cannot find video container"),(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&webphone_api.common.ShowToast('ERROR, For the video to work, you must add a DIV html element to your page with id="video_container"',1e4)),PutToDebugLog(2,"EVENT, webrtcapi: video bandwidth: "+i),"call-audiovideo"===e&&(oConfigCall.video_size=GetVideoSizeObj()),PutToDebugLog(1,"STATUS,-1,Starting video call to "+n)}else PutToDebugLog(2,"EVENT, webrtcapi: audio bandwidth: "+a),PutToDebugLog(1,"STATUS,-1,Starting call to "+n);if(SetSipHeader(1),!1===webphone_api.global.wsuser_succeded?(webphone_api.common.CallWsuserKeepAlive(!0),PutToDebugLog(3,"WARNING, wsuser NOT YET succeeded")):(webphone_api.common.CallWsuserKeepAlive(!1),PutToDebugLog(3,"EVENT, wsuser already succeeded")),webphone_api.common.isNull(t)||!0!==t)try{var l=webphone_api.common.GetEndpoint(o,"","",!1);if(!webphone_api.common.isNull(l)&&l.length>2&&"false"===l[webphone_api.common.EP_FLAGDEL]){var p=webphone_api.common.StrToInt(o)+1;PutToDebugLog(2,"WARNING, webrtc: call to: "+n+" line set to: "+p.toString()+" because we already have a call on line: "+o.toString()),o=p}}catch(u){PutToDebugLogException(2,"webrtcapi: detect multiple call on same line",u)}else;calltype=e,callline=o,destnumber=n,oSipSessionCall=oSipStack.newSession(e,HandleOconfigCall(oConfigCall,o)),sipstackstarted=!1;var s=webphone_api.common.GetTickCount();if(0!=oSipSessionCall.call(n,HandleOconfigCall(oConfigCall,o)))return oSipSessionCall=null,PutToDebugLog(2,"WRTC, ERROR, Failed to make call"),webphone_api.global.stacknotstarted_time>0&&s-webphone_api.global.stacknotstarted_time<300&&!0===webphone_api.global.stacknotstarted_retry&&(webphone_api.global.stacknotstarted_retry=!1,setTimeout(function(){PutToDebugLog(2,"WRTC, WARNING, Retry failed webrtc call (Stack not started)"),SipCall(e,o,n)},2500)),!1;webphone_api.global.checkIfInCall=!0,PutToDebugLog(1,"STATUS,-1,Call"),webphone_api.common.SaveCallSession(o,oSipSessionCall,n,"1",webphone_api.common.GetTickCount(),-1,-1,"",oSipSessionCall.getId(),"","",oConfigCall.sip_headers),setTimeout(function(){if(!1===webphone_api.common.Awb()){var e=[];e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push(" "),e.push("w"),e.push("e"),e.push("b"),e.push("s"),e.push("r"),e.push("v"),e.push("8");PutToDebugLog(2,"EVENT, "+e.join("")),webphone_api.common.GetCallSession(!0,o,n).hangup({events_listener:{events:"*",listener:onSipEventSession}}),setTimeout(function(){webphone_api.common.GetEndpoint(o,"","",!0)},400)}},15e3),setTimeout(function(){if(!1===webphone_api.common.Loa()){var e=[];e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push(" "),e.push("a"),e.push("n"),e.push("d"),e.push("r"),e.push("o"),e.push("i"),e.push("d");var t=e.join("");setTimeout(function(){PutToDebugLog(2,"ERROR, "+t)},1200),setTimeout(function(){webphone_api.common.GetCallSession(!0,o,n).hangup({events_listener:{events:"*",listener:onSipEventSession}})},1300),setTimeout(function(){webphone_api.common.GetEndpoint(o,"","",!0)},1700)}},6e3);var c=webphone_api.common.GetIceTimeout()+4500;return!webphone_api.common.isNull(e)&&e.indexOf("video")>0&&(c+=4e3),1===webphone_api.common.GetParameterInt("redialonfail",0)&&(red_line=o,red_sessioncall=oSipSessionCall,red_number=n,red_setuptime=webphone_api.common.GetTickCount(),red_callid=oSipSessionCall.getId(),red_headers=oConfigCall.sip_headers,red_delaytime=c,red_s_type=e),!0}catch(g){PutToDebugLogException(2,"webrtcapi: SipCall",g)}return!1}function RedialOnFail(){try{if(!1===webphone_api.global.redialof)return;redialonfailtimer=setTimeout(function(){try{if(!0===webphone_api.global.redialof){var e=!1;if("Firefox"===webphone_api.common.GetBrowser()){webphone_api.common.GetParameterInt("webrtc_successfulcalls",0)<3&&(e=!0)}!1===webphone_api.global.webrtcpermissionaccepted?(PutToDebugLog(2,"ERROR, initiate outgoing call, but permission not yet accepted"),webphone_api.common.ShowToast(webphone_api.stringres.get("request_permission"),12e3)):(PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: "+red_number+"; delay after first attempt: "+red_delaytime.toString()),webphone_api.global.redialof=!1,webphone_api.global.redialhideevt=!0,webphone_api.common.isNull(red_sessioncall)?(PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: create new session"),red_sessioncall=oSipStack.newSession(red_s_type,oConfigCall)):(PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: hangup previous call"),!0===e?webphone_api.hangup():red_sessioncall.hangup()),setTimeout(function(){PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: initiate call again (redial)"),!0===e?webphone_api.call(red_number):red_sessioncall.call(red_number),webphone_api.common.SaveCallSession(red_line,red_sessioncall,red_number,"1",red_setuptime,-1,-1,"",red_callid,"","",red_headers)},1e3))}}catch(o){PutToDebugLogException(2,"webrtcapi: RedialOnFail",o)}},red_delaytime),setTimeout(function(){webphone_api.global.redialhideevt=!1,webphone_api.common.isNull(redialonfailtimer)||clearTimeout(redialonfailtimer),redialonfailtimer=null,red_line=null,red_sessioncall=null,red_number=null,red_setuptime=0,red_callid=null,red_headers=null,red_delaytime=5e3,red_s_type="call-audio"},red_delaytime+2e3)}catch(e){PutToDebugLogException(2,"webrtcapi: RedialOnFail",e)}}function SipHangup(e,o){var n=0;try{webphone_api.global.redialof=!1,webphone_api.global.redialhideevt=!1,n=1,webphone_api.common.isNull(redialonfailtimer)||clearTimeout(redialonfailtimer),n=2,redialonfailtimer=null,n=3;var t=webphone_api.common.GetCallSession(!0,o,"");if(n=4,setTimeout(function(){webphone_api.common.GetEndpoint(o,"","",!0)},400),n=5,t||!oSipStack){try{n=6,1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Hangup"),n=7,e&&(n=8,PutToDebugLog(1,"EVENT,Rejected")),n=9,oSipStack&&o>0&&webphone_api.common.GetNrOfActiveCalls()>1&&(n=20,webphone_api.dont_remove_remote_stream=!0,n=21,PutToDebugLog(2,"WARNING, on hangup dont_remove_remote_stream set to true"),n=22,setTimeout(function(){webphone_api.dont_remove_remote_stream=!1,PutToDebugLog(2,"WARNING, after hangup reset dont_remove_remote_stream")},300)),n=23}catch(i){PutToDebugLogException(2,"webrtcapi: SipHangup inner ("+n.toString()+")",i)}return n=24,t&&t.hangup({events_listener:{events:"*",listener:onSipEventSession}}),n=25,!0}PutToDebugLog(2,"EVENT, no session to hangup")}catch(i){PutToDebugLogException(2,"webrtcapi: SipHangup ("+n.toString()+")",i)}return!1}function SipAccept(e,o){try{var n=webphone_api.common.GetCallSession(!1,e,"","",null,"2");if(n){var t=webphone_api.common.GetEndpoint(e,"","",!1);if(!webphone_api.common.isNull(t)&&t.length>5){var i=t[webphone_api.common.EP_CONNECTTIME];if(webphone_api.common.isNull(i)&&(i=-1),(i=webphone_api.common.StrToIntDef(i,-1))>0)for(var a=0;a<webphone_api.global.ep.length;a++){var r=webphone_api.global.ep[a];if(!webphone_api.common.isNull(r)){var l=r[webphone_api.common.EP_INCOMING];webphone_api.common.isNull(l)&&(l=1);var p=r[webphone_api.common.EP_SETUPTIME];webphone_api.common.isNull(p)&&(p=-1);var s=r[webphone_api.common.EP_CONNECTTIME];if(webphone_api.common.isNull(s)&&(s=-1),2===webphone_api.common.StrToIntDef(l,1)&&webphone_api.common.StrToIntDef(p,-1)>0&&webphone_api.common.StrToIntDef(s,1)<0&&!webphone_api.common.isNull(webphone_api.common.GetCallSession(!1,webphone_api.common.StrToInt(r[webphone_api.common.EP_LINE]),""))){PutToDebugLog(2,"EVENT, API_Accept: call is already connected on line: "+e+"; incoming call found to be accepted on line: "+r[webphone_api.common.EP_LINE]),e=webphone_api.common.StrToInt(r[webphone_api.common.EP_LINE]),n=webphone_api.common.GetCallSession(!1,e,"");break}}}}try{var c=webphone_api.common.GetTickCount()-webphone_api.global.ringstart_time,u=!1;if(1===recheckmediaonconnect&&c>14e3&&webphone_api.common.IsMizuServerOrGateway()?(PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_1: "+c),u=!0):2===recheckmediaonconnect&&c>14e3?(PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_2: "+c),u=!0):3===recheckmediaonconnect&&(PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_3"),u=!0),u){var g=null;void 0!==wen_namespace&&null!==wen_namespace||(wen_namespace="webrtcstack"),g=webphone_api[wen_namespace].SIPml.getsavethis(),webphone_api.common.isNull(g)?PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect no savethis"):webphone_api.common.isNull(tmedia_session_jsep01)?webphone_api.common.isNull(webphone_api[wen_namespace])||webphone_api.common.isNull(webphone_api[wen_namespace].tmedia_session_jsep01)?PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect no tmedia_session_jsep01"):webphone_api[wen_namespace].tmedia_session_jsep01.prototype.__get_lo.call(g,!0):tmedia_session_jsep01.prototype.__get_lo.call(g,!0)}}catch(b){PutToDebugLogException(2,"webrtcapi: SipAccept longring",b)}if(webphone_api.global.ice_callaccepted=!0,SetSipHeader(1),n.accept(HandleOconfigCall(oConfigCall,e)),PutToDebugLog(1,"EVENT,Accepted"),!1!==o){var m=webphone_api.common.GetParameterInt("beeponconnect",0);1!==m&&2!==m&&4!==m||webphone_api.common.Beep("1")}return!0}PutToDebugLog(2,"ERROR,webrtcapi session is NULL"),PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress2"))}catch(h){PutToDebugLogException(2,"webrtcapi: SipAccept",h)}return!1}function SipIgnore(){try{stopRingTone()}catch(e){PutToDebugLogException(2,"webrtcapi: SipIgnore",e)}return!1}function SipSendChat(e,o,n,t){try{if(!oSipStack)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat sipstack not started"),!1;if(webphone_api.common.isNull(o)||o.length<1)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat number is NULL"),!1;if(webphone_api.common.isNull(n)||n.length<1)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat message is NULL"),!1;if(!0===t){var i=sipheaders;i[i.length]={},i[i.length-1].name="X-Sms",i[i.length-1].value="Yes",i=RemoveDuplicateHeader(i),oSipSessionMessage=oSipStack.newSession("message",oConfigSms),oSipSessionMessage.setConfiguration({sip_headers:i})}else{var a=sipheaders;a=RemoveDuplicateHeader(a),oSipSessionMessage=oSipStack.newSession("message",oConfigMessage),oSipSessionMessage.setConfiguration({sip_headers:a})}return 0==oSipSessionMessage.send(o,n,"text/plain;charset=utf-8")||(oSipSessionMessage=null,PutToDebugLog(2,"WRTC, ERROR, Failed to send message chat"),!1)}catch(r){PutToDebugLogException(2,"webrtcapi: SipSendChat",r),oSipSessionMessage=null}return!1}function sipShareScreen(){if("w4a"===webphone_api.webrtcstack.SIPml.getWebRtcType()){if(!oSipSessionCall)return void(txtCallStatus.innerHTML="<i>No active session</i>");oSipSessionCall.bfcpSharing?(SetSipHeader(2),0!=oSipSessionCall.stopBfcpShare(oConfigCall)?txtCallStatus.value="Failed to stop BFCP share":oSipSessionCall.bfcpSharing=!1):(SetSipHeader(2),oConfigCall.screencast_window_id=0,0!=oSipSessionCall.startBfcpShare(oConfigCall)?txtCallStatus.value="Failed to start BFCP share":oSipSessionCall.bfcpSharing=!0)}else sipCall("call-screenshare")}function Forward(e){try{if(webphone_api.common.isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, webrtcapi Forward, invalid number: "+e),!1;if(0===webphone_api.common.GetParameterInt("allowcallredirect",1))return PutToDebugLog(2,"EVENT, webrtcapi Forward dropped, because allowcallredirect is 0 (disabled)"),!1;var o=webphone_api.common.GetRecentInviteIn();if(webphone_api.common.isNull(o)||o.toString().length<10)return PutToDebugLog(2,"ERROR, webrtcapi Forward, invalid INVITE msg: "+o),!1
;webphone_api.common.GetParameterInt("fwd_msg_displayed",0)<1&&(webphone_api.common.SaveParameter("fwd_msg_displayed","1"),webphone_api.common.ShowToast(webphone_api.stringres.get("call_forward_warn")));var n="<sip:"+webphone_api.common.Trim(e)+"@"+GetUDPServerAddress()+">",t="SIP/2.0 302 Moved Temporarily\r\n";return t=t+"Via: "+webphone_api.common.GetSipHeaderFromMsg(o,"via")+"\r\n",t=t+"From: "+webphone_api.common.GetSipHeaderFromMsg(o,"from")+"\r\n",t=t+"To: "+webphone_api.common.GetSipHeaderFromMsg(o,"to")+";totag=227A1\r\n",t=t+"Call-ID: "+webphone_api.common.GetSipHeaderFromMsg(o,"call-id")+"\r\n",t=t+"CSeq: "+webphone_api.common.GetSipHeaderFromMsg(o,"cseq")+"\r\n",t=t+"Contact: "+n+"\r\n",t+="Content-Length: 0 \r\n",t+="\r\n",PutToDebugLog(3,"EVENT, send Forward SIP message:\r\n"+t),webphone_api.webrtc_socket.send(t),PutToDebugLog(2,"EVENT, Hangup because call Forward: "+e),SipHangup(!0,webphone_api.global.aline),!0}catch(i){PutToDebugLogException(2,"webrtcapi: Forward",i)}return!1}function SipTransferEx(e){try{var o=webphone_api.common.GetCallSession(!1,webphone_api.global.aline,e);if(!o)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),!1;if(!webphone_api.common.isNull(e)&&e.length>0){var n=webphone_api.common.GetParameterInt("transfertype",-1);if(PutToDebugLog(2,"EVENT, WEBRTC: Transfer call to: "+e+"; type: "+n.toString()),1===n){if(0!=o.transfer(e))return PutToDebugLog(1,"ERROR, Transfer failed ("+n.toString()+")"),!1;var t=webphone_api.global.aline;return setTimeout(function(){PutToDebugLog(2,"EVENT, WEBRTC: exec Hangup on call Transfer"),SipHangup(!1,t)},1100),!0}if(-1===n||6===n){var t=webphone_api.global.aline;return SipToggleHoldResume(!0,t),setTimeout(function(){if(0!=o.transfer(e))return SipToggleHoldResume(!1,t),PutToDebugLog(1,"ERROR, Transfer failed ("+n.toString()+")"),PutToDebugLog(2,"EVENT, Transfer failed Unhold-Reload call"),!1},1100),!0}if(7===n)return 0==o.transfer(e)||(PutToDebugLog(1,"ERROR, Transfer failed ("+n.toString()+")"),!1);if(8===n){var t=webphone_api.global.aline;return webphone_api.plhandler.MuteEx(!0),setTimeout(function(){webphone_api.conference(e,!0)},250),!0}var t=webphone_api.global.aline;return SipToggleHoldResume(!0,t),setTimeout(function(){if(0!=o.transfer(e))return SipToggleHoldResume(!1,t),PutToDebugLog(1,"ERROR, Transfer failed ("+n.toString()+")"),PutToDebugLog(2,"EVENT, Transfer failed Unhold-Reload call"),!1},1100),!0}}catch(i){PutToDebugLogException(2,"webrtcapi: SipTransferEx",i)}return!1}function SipTransfer(e){try{var o=webphone_api.common.GetCallSession(!1,webphone_api.global.aline,e);if(!o)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),!1;if(!webphone_api.common.isNull(e)&&e.length>0){var n=webphone_api.common.GetParameterInt("transfertype",-1);if(0!=o.transfer(e))return PutToDebugLog(1,"ERROR,Transfer failed."),!1;PutToDebugLog(2,"WRTC, EVENT, SipTransfer ("+n+"): "+e)}}catch(t){PutToDebugLogException(2,"webrtcapi: SipTransfer",t)}return!1}function SipToggleHoldResume(e,o){try{webphone_api.common.isNull(o)&&(o=webphone_api.global.aline);var n=webphone_api.common.GetCallSession(!1,o,"");if(n){"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.global.firefoxholdcount++,e?PutToDebugLog(1,"EVENT,Hold"):PutToDebugLog(1,"EVENT,Reload");var t=-1;if(webphone_api.global.isholdresume=!0,webphone_api.global.holdresumecount++,PutToDebugLog(2,"EVENT, Webrtc hold exec: "+e),!0===e?t=n.hold():(webphone_api.global.isresume=!0,t=n.resume()),0!=t){var i=webphone_api.common.GetCallSession(!1,o,"","",null,"0",n);i&&i!==n&&(n=i,t=!0===e?n.hold():n.resume())}return!0!==e&&(webphone_api.common.isNull(lastmuste_mute)||!1!==lastmuste_mute||(PutToDebugLog(5,"webrtcapi: SipToggleHoldResume also unmute call, because user unmuted when was on hold"),SipToggleMute(lastmuste_mute,lastmuste_direction,lastmuste_line,lastmuste_log),lastmuste_mute=null,lastmuste_direction=null,lastmuste_line=null,lastmuste_log=null)),0==t||(PutToDebugLog(1,"ERROR,Hold / Resume failed."),!1)}return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),!1}catch(a){PutToDebugLogException(2,"webrtcapi: SipToggleHoldResume",a)}return!1}function SipMuteVideo(e,o){try{var n=!1,t=webphone_api.common.GetCallSession(!1,webphone_api.global.aline,"");if(!t)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),!1;var i=!e;if((webphone_api.common.isNull(o)||!1===webphone_api.common.IsNumber(o))&&(o=0),o=webphone_api.common.StrToInt(o),(o<0||o>2)&&(o=0),0===o||1===o)if(null!=t.o_session)if(null!=t.o_session.o_stream_remote)if(t.o_session.o_stream_remote.getVideoTracks().length>0){for(var a=0;a<t.o_session.o_stream_remote.getVideoTracks().length;a++)PutToDebugLog(2,"EVENT, webrtcapi MuteVideo REMOTE Setting Video Tracks ["+a+"] to state = "+i.toString()),t.o_session.o_stream_remote.getVideoTracks()[a].enabled=i;t.o_session.o_stream_remote.getVideoTracks().length>0&&(n=!0)}else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote-> NO VIDEO TRACKS");else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote is NULL");else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session is NULL");if(0===o||2===o)if(null!=t.o_session)if(null!=t.o_session.o_stream_local)if(t.o_session.o_stream_local.getVideoTracks().length>0){for(var a=0;a<t.o_session.o_stream_local.getVideoTracks().length;a++)PutToDebugLog(2,"EVENT, webrtcapi MuteVideo LOCAL Setting Video Tracks ["+a+"] to state = "+i.toString()),t.o_session.o_stream_local.getVideoTracks()[a].enabled=i;t.o_session.o_stream_local.getVideoTracks().length>0&&(n=!0)}else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local-> NO VIDEO TRACKS");else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local is NULL");else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session is NULL");return n}catch(r){PutToDebugLogException(2,"webrtcapi: SipMuteVideo",r)}return!1}function MuteMic(e,o){try{if(o=!o,null===e)PutToDebugLog(2,"WARNING, webrtcapi MuteMic session is NULL");else if(null!=e.o_session)if(null!=e.o_session.o_stream_local)if(e.o_session.o_stream_local.getAudioTracks().length>0){for(var n=0;n<e.o_session.o_stream_local.getAudioTracks().length;n++)PutToDebugLog(2,"EVENT, webrtcapi MuteMic Setting Audio Tracks ["+n+"] to state = "+o.toString()),e.o_session.o_stream_local.getAudioTracks()[n].enabled=o;if(e.o_session.o_stream_local.getAudioTracks().length>0)return!0}else PutToDebugLog(2,"WARNING, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local-> NO AUDIO TRACKS");else PutToDebugLog(2,"WARNING, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local is NULL");else PutToDebugLog(2,"WARNING, webrtcapi MuteMic oSipSessionCall.o_session is NULL")}catch(t){PutToDebugLogException(2,"webrtcapi: MuteMic",t)}return!1}function MuteSpeaker(e,o){try{if(o=!o,null!=e.o_session)if(null!=e.o_session.o_stream_remote)if(e.o_session.o_stream_remote.getAudioTracks().length>0){for(var n=0;n<e.o_session.o_stream_remote.getAudioTracks().length;n++)PutToDebugLog(2,"EVENT, webrtcapi MuteSpeaker Setting Audio Tracks ["+n+"] to state = "+o.toString()),e.o_session.o_stream_remote.getAudioTracks()[n].enabled=o;if(e.o_session.o_stream_remote.getAudioTracks().length>0)return!0}else PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote-> NO AUDIO TRACKS");else PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote is NULL");else PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session is NULL")}catch(t){PutToDebugLogException(2,"webrtcapi: MuteSpeaker",t)}return!1}function SipToggleMute(e,o,n,t){try{webphone_api.common.isNull(n)&&(n=webphone_api.global.aline);var i=webphone_api.common.GetCallSession(!1,n,"");if(!i)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),!1;if(lastmuste_mute=e,lastmuste_direction=o,lastmuste_line=n,lastmuste_log=t,(webphone_api.common.isNull(o)||"0"!=o&&"1"!=o&&"2"!=o)&&(o="2"),"2"==o){var a=MuteMic(i,e);if(!1===a){var r=webphone_api.common.GetCallSession(!1,n,"","",null,"0",i);r&&r!==i&&(i=r,a=MuteMic(i,e))}return!1!==a||(!1!==t&&!1===webphone_api.isonhold()&&PutToDebugLog(1,"ERROR,Mute / Unmute failed."),!1)}if("1"==o){var a=MuteSpeaker(i,e);if(!1===a){var r=webphone_api.common.GetCallSession(!1,n,"","",null,"0",i);r&&r!==i&&(i=r,a=MuteSpeaker(i,e))}return!1!==a||(!1!==t&&!1===webphone_api.isonhold()&&PutToDebugLog(1,"ERROR,Mute / Unmute failed."),!1)}if("0"==o){var a=MuteMic(i,e),l=MuteSpeaker(i,e);if(!1===a||!1===l){var r=webphone_api.common.GetCallSession(!1,n,"","",null,"0",i);r&&r!==i&&(i=r,a=MuteMic(i,e),l=MuteSpeaker(i,e))}return!1!==a&&!1!==l||(!1!==t&&!1===webphone_api.isonhold()&&(PutToDebugLog(1,"ERROR,Mute / Unmute failed."),PutToDebugLog(2,"ERROR,Mute / Unmute failed state: "+e+"; ret: "+a+"; ret2: "+l)),!1)}return PutToDebugLog(1,"ERROR,Mute / Unmute failed."),PutToDebugLog(2,"ERROR,Mute / Unmute invalid direction: "+o),!1}catch(p){PutToDebugLogException(2,"webrtcapi: SipToggleMute",p)}return!1}function SipSendDTMF(e){try{var o=webphone_api.common.GetCallSession(!1,webphone_api.global.aline,"");if(webphone_api.common.isNull(e)||e.length<1)return;e=e.toString();var n=!1;if(0!==webphone_api.common.Trim(e).indexOf("*1*")&&0!==webphone_api.common.Trim(e).indexOf("*6*")||(n=!0),1===e.length)Dtmf(e,o,n);else{var t=e.substring(0,1);if(" "!==t&&Dtmf(t,o,n),e=e.substring(1),!webphone_api.common.isNull(e)&&e.length>0){var i=1;" "===e.substring(0,1)&&(i=1e3),setTimeout(function(){SipSendDTMF(e)},i)}}}catch(a){PutToDebugLogException(2,"webrtcapi: SipSendDTMF",a)}return!1}function Dtmf(e,o,n){try{return o&&e?(!0===n&&(webphone_api.global.isconfdtmf=!0),0==o.dtmf(e)?(PutToDebugLog(3,"EVENT, DTMFsent: "+e),!0):(PutToDebugLog(2,"WRTC, ERROR, webrtcapi Dtmf failed."),!1)):(PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),!1)}catch(t){PutToDebugLogException(2,"webrtcapi: Dtmf",t)}}function PresenceSet(e){try{if(!1===isregistered)return void PutToDebugLog(2,"WARNING, webrtcapi cannot set presence, because not registered");if(webphone_api.common.isNull(mSipuri)||mSipuri.length<2)return void PutToDebugLog(2,"ERROR, webrtcapi PresenceSet invalid sipuri: "+mSipuri);if(webphone_api.common.isNull(e)||e.length<2)return void PutToDebugLog(2,"ERROR, webrtcapi PresenceSet invalid status: "+e);webphone_api.common.isNull(mDisplayname)&&(mDisplayname=""),publishSession=oSipStack.newSession("publish",{events_listener:{events:"*",listener:onSipEventSession}});PutToDebugLog(2,"EVENT, PresenceSet: "+e+"; for: "+mSipuri+"; displayname: "+mDisplayname);var o='<?xml version="1.0" encoding="UTF-8"?>\n<presence xmlns="urn:ietf:params:xml:ns:pidf"\n xmlns:im="urn:ietf:params:xml:ns:pidf:im" entity="'+mSipuri+'">\n<tuple id="s8794">\n<status>\n   <basic>'+e+"</basic>\n   <im:im>"+e+'</im:im>\n</status>\n<contact priority="0.8">tel:'+mDisplayname+'</contact>\n<note  xml:lang="en"></note>\n</tuple>\n</presence>';sipheaders=RemoveDuplicateHeader(sipheaders),publishSession.publish(o,"application/pidf+xml",{sip_caps:[{name:"+g.oma.sip-im"},{name:"+sip.ice"}],sip_headers:sipheaders})}catch(n){PutToDebugLogException(2,"webrtcapi: PresenceSet",n)}}function PresenceGet(e){try{if(webphone_api.common.isNull(e)||e.length<1)return;if(!1===isregistered&&pgmaxloop<15)return pgmaxloop++,void setTimeout(function(){PresenceGet(e)},1e3);pgmaxloop=0;var o=sipheaders;webphone_api.common.isNull(o)&&(o=[]);for(var n=!1,t=!1,i=0;i<o.length;i++){var a=o[i];webphone_api.common.isNull(a)||webphone_api.common.isNull(a.name)||("event"===a.name.toLowerCase()&&(n=!0),"accept"===a.name.toLowerCase()&&(t=!0))}!1===n&&o.push({name:"Event",value:"presence"}),!1===t&&o.push({name:"Accept",value:"application/pidf+xml"}),o=RemoveDuplicateHeader(o);var r=e.split(",");if(r.length>60&&PutToDebugLog(2,"EVENT, PresenceGet skip for too lmany users"),PutToDebugLog(2,"EVENT, PresenceGet for: "+e),!webphone_api.common.isNull(r)&&r.length>0)for(var i=0;i<r.length&&!(i>maxnrofusers);i++)if(!(webphone_api.common.isNull(r[i])||r[i].length<1)){var l=r[i];PutToDebugLog(5,"EVENT, PresenceGet for user: "+l);var p=oSipStack.newSession("subscribe",{events_listener:{events:"*",listener:onSipEventSession},sip_headers:o,sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]});p.subscribe(l)}}catch(s){PutToDebugLogException(2,"webrtcapi: PresenceGet",s)}}function startRingTone(){try{if(webphone_api.common.isNull(ringtone)&&(ringtone=document.getElementById("ringtone")),webphone_api.common.isNull(ringtone))return void PutToDebugLog(2,"EVENT, webrtcapi: startRingTone is NULL");PutToDebugLog(5,"EVENT, webrtcapi: startRingTone play"),!0!==webphone_api.rt_loaded&&PutToDebugLog(2,"WARNING,webrtcapi: startRingTone cannot load media"),!0!==webphone_api.rt_canplay&&PutToDebugLog(2,"WARNING,webrtcapi: startRingTone cannot play through media"),ringtone.play?ringtone.play():(ringtone=document.getElementById("ringtone"),ringtone&&ringtone.play?ringtone.play():PutToDebugLog(2,"EVENT, webrtcapi: startRingTone play function is not available: "+ringtone.play))}catch(e){PutToDebugLogException(2,"webrtcapi: startRingTone",e)}}function stopRingTone(){try{if(webphone_api.common.isNull(ringtone)&&(ringtone=document.getElementById("ringtone")),webphone_api.common.isNull(ringtone))return void PutToDebugLog(2,"EVENT, webrtcapi: stopRingTone is NULL");!0!==webphone_api.rt_loaded&&PutToDebugLog(2,"ERROR,webrtcapi: stopRingTone cannot load media"),ringtone&&ringtone.pause?ringtone.pause():(ringtone=document.getElementById("ringtone"),ringtone&&ringtone.pause?ringtone.pause():PutToDebugLog(2,"EVENT, webrtcapi: stopRingTone pause function is not available: "+ringtone.pause))}catch(e){PutToDebugLogException(2,"webrtcapi: stopRingTone",e)}}function startRingbackTone(){try{if(webphone_api.common.isNull(ringbacktone)&&(ringbacktone=document.getElementById("ringbacktone")),webphone_api.common.isNull(ringbacktone))return void PutToDebugLog(2,"EVENT, webrtcapi: startRingbackTone is NULL");PutToDebugLog(4,"EVENT, webrtcapi: startRingbackTone play"),!0!==webphone_api.rbt_loaded&&PutToDebugLog(2,"WARNING,webrtcapi: startRingbackTone cannot load media"),!0!==webphone_api.rbt_canplay&&PutToDebugLog(2,"WARNING,webrtcapi: startRingbackTone cannot play through media"),ringbacktone.play?ringbacktone.play():PutToDebugLog(2,"WARNING, webrtcapi: startRingbackTone play function is not available: "+ringbacktone.play)}catch(e){PutToDebugLogException(2,"webrtcapi: startRingbackTone",e)}}function stopRingbackTone(){try{if(webphone_api.common.isNull(ringbacktone)&&(ringbacktone=document.getElementById("ringbacktone")),webphone_api.common.isNull(ringbacktone))return void PutToDebugLog(2,"EVENT, webrtcapi: stopRingBackTone is NULL");!0!==webphone_api.rbt_loaded&&PutToDebugLog(2,"ERROR,webrtcapi: stopRingbackTone cannot load media"),ringbacktone&&ringbacktone.pause?ringbacktone.pause():PutToDebugLog(2,"EVENT, webrtcapi: stopRingbackTone pause function is not available: "+ringbacktone+" "+ringbacktone.pause)}catch(e){PutToDebugLogException(2,"webrtcapi: stopRingbackTone",e)}}function toggleFullScreen(){fullScreen(videoRemote.webkitSupportsFullscreen?!videoRemote.webkitDisplayingFullscreen:!0)}function fullScreen(e){function o(){try{document.exitFullscreen&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&document.exitFullscreen()}catch(e){PutToDebugLogException(2,"webrtcapi: ExitFullScreen",e)}}if(bFullScreen=e,void 0!==videoRemote&&null!==videoRemote)if(webphone_api.webrtcstack.tsk_utils_have_webrtc4native()&&bFullScreen&&videoRemote.webkitSupportsFullscreen){if(webphone_api.common.isNull(videoRemote))return!1;bFullScreen?videoRemote.webkitEnterFullScreen():videoRemote.webkitExitFullscreen()}else videoRemote.requestFullscreen?bFullScreen?videoRemote.requestFullscreen():o():videoRemote.mozRequestFullScreen?bFullScreen?videoRemote.mozRequestFullScreen():o():videoRemote.webkitRequestFullscreen&&(bFullScreen?videoRemote.webkitRequestFullscreen():o());else if(webphone_api.webrtcstack.tsk_utils_have_webrtc4npapi())try{window.__o_display_remote&&window.__o_display_remote.setFullScreen(e)}catch(n){webphone_api.common.isNull(divVideo)||divVideo.setAttribute("class",e?"full-screen":"normal-screen")}else webphone_api.common.isNull(divVideo)||divVideo.setAttribute("class",e?"full-screen":"normal-screen")}function showNotifICall(e){window.webkitNotifications&&0==window.webkitNotifications.checkPermission()&&(oNotifICall&&oNotifICall.cancel(),oNotifICall=window.webkitNotifications.createNotification(webphone_api.common.GetElementSource()+"images/sipml-34x39.png","Incaming call","Incoming call from "+e),oNotifICall.onclose=function(){oNotifICall=null},oNotifICall.show())}function onKeyUp(e){e=e||window.event,27==e.keyCode?fullScreen(!1):e.ctrlKey&&e.shiftKey&&(65!=e.keyCode&&86!=e.keyCode||(bDisableVideo=65==e.keyCode,txtCallStatus.innerHTML="<i>Video "+(bDisableVideo?"disabled":"enabled")+"</i>",window.localStorage.setItem("org.doubango.expert.disable_video",bDisableVideo)))}function onDivCallCtrlMouseMove(e){try{webphone_api.webrtcstack.tsk_utils_have_stream()&&(btnCall.disabled=!webphone_api.webrtcstack.tsk_utils_have_stream()||!oSipSessionRegister||!oSipSessionRegister.is_connected(),document.getElementById("divCallCtrl").onmousemove=null)}catch(o){}}function uiOnConnectionEvent(e,o){}function uiVideoDisplayEvent(e,o){if(!1===webphone_api.common.CanIUseVideo())return void PutToDebugLog(5,"EVENT, uiDisplayEvent ret");if(webphone_api.common.isNull(videoRemote))return void PutToDebugLog(2,"EVENT, webrtcapi uiVideoDisplayEvent videoRemote is NULL");var n=e?videoLocal:videoRemote;o?(n.style.opacity=1,uiVideoDisplayShowHide(!0)):(n.style.opacity=0,fullScreen(!1))}function uiVideoDisplayShowHide(e){webphone_api.common.isNull(divVideo)||(e?(divVideo.style.height="Microsoft Internet Explorer"==navigator.appName?"100%":"340px",webphone_api.$("#contact_details").hide(),webphone_api.$("#video_container").show(),1===webphone_api.common.GetParameterInt("softphonevideomode",0)&&webphone_api.$("#div_video_fullscreen_button").hide(),PutToDebugLog(2,"EVENT, webrtcapi uiVideoDisplayShowHide video container displayed")):(divVideo.style.height="0px",webphone_api.$("#contact_details").show(),webphone_api.$("#video_container").hide()))}function uiBtnCallSetText(e){switch(e){case"Call":var o=window.localStorage&&"true"==window.localStorage.getItem("org.doubango.expert.disable_callbtn_options");btnCall.value=btnCall.innerHTML=o?"Call":'Call <span id="spanCaret" class="caret">',btnCall.setAttribute("class",o?"btn btn-primary":"btn btn-primary dropdown-toggle"),btnCall.onclick=o?function(){sipCall(bDisableVideo?"call-audio":"call-audiovideo")}:null,ulCallOptions.style.visibility=o?"hidden":"visible",o||ulCallOptions.parentNode==divBtnCallGroup?o&&ulCallOptions.parentNode==divBtnCallGroup&&document.body.appendChild(ulCallOptions):divBtnCallGroup.appendChild(ulCallOptions);break;default:btnCall.value=btnCall.innerHTML=e,btnCall.setAttribute("class","btn btn-primary"),btnCall.onclick=function(){sipCall(bDisableVideo?"call-audio":"call-audiovideo")},ulCallOptions.style.visibility="hidden",ulCallOptions.parentNode==divBtnCallGroup&&document.body.appendChild(ulCallOptions)}}function uiCallTerminated(e,o){webphone_api.global.restartice_time=0,oSipSessionCall=null,stopRingbackTone(),stopRingTone(),uiVideoDisplayShowHide(!1),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null),uiVideoDisplayEvent(!1,!1),uiVideoDisplayEvent(!0,!1);var n=webphone_api.global.aline;void 0!==o&&null!==o&&webphone_api.common.IsNumber(o)&&webphone_api.common.StrToIntDef(o,-5)>0&&(n=o),PutToDebugLog(1,"STATUS,-1,"+e),"Call Finished"===e&&PutToDebugLog(1,"STATUS,"+n.toString()+",Finished")}function GetRegisterivalWebRTC(){try{var e=webphone_api.common.GetParameter2("registerinterval");return(webphone_api.common.isNull(e)||e.length<1||!webphone_api.common.IsNumber(e))&&(e=0),e<5&&(e=webphone_api.common.GetConfigInt("registerinterval",0)),e<5&&(e=200),webphone_api.global.recwsload>1&&e<400&&(e=600),e}catch(o){PutToDebugLogException(2,"webrtcapi: GetRegisterivalWebRTC",o)}return 200}function TerminateRegexTimer(){webphone_api.common.isNull(regextimer)||clearInterval(regextimer),regextimer=null,regex_idx=0}function RegisterEx(e){try{if(webphone_api.common.isNull(e)||e.length<5)return;var o=null;if(o=e.indexOf("#")>0?e.split("#"):e.split(";"),webphone_api.common.isNull(o)||o.length<1)return;TerminateRegexTimer();var n=0;regextimer=setInterval(function(){if(++n>25)return void TerminateRegexTimer();if(webphone_api.common.isNull(o)||o.length<1)return void TerminateRegexTimer();var e=o.shift();if(!webphone_api.common.isNull(e)){var t=e.split(",");webphone_api.common.isNull(t)||t.length<3||(webphone_api.common.isNull(lw_namespace_arr)&&(lw_namespace_arr=[]),webphone_api.common.isNull(lw_account_arr)&&(lw_account_arr=[]),lw_namespace_arr.push("webrtcstack"+regex_idx),lw_account_arr.push(t),LoadWebrtc(function(e,o,n){},"webrtcstack"+regex_idx,t),regex_idx++)}},1500)}catch(t){PutToDebugLogException(2,"webrtcapi: RegisterEx sipuri: "+sipuri+"; password: "+password,t)}}function LoadWebrtcCb(avail,namespc,oneacc){function onSEventStack(e){function o(o){PutToDebugLog(5,"EVENT, ExSessionEvent_"+username+": "+e.type+", "+e.description)}try{if(PutToDebugLog(5,"EVENT, ExStackEvent_"+username+": "+e.type+", "+e.description),"started"===e.type){if(!0===webphone_api.common.NeedRegister()){var n=200;!webphone_api.common.isNull(aival)&&webphone_api.common.IsNumber(aival)&&(n=aival);var t=this.newSession("register",{expires:n,events_listener:{events:"*",listener:o},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]});t.register()}}else"starting"===e.type&&"terminating"===e.type&&"terminated"===e.type||onSipEventStack(e)}catch(i){PutToDebugLogException(2,"webrtcapi: ExEventStack_"+username,i)}}try{if(PutToDebugLog(2,"EVENT, webrtcapi: LoadWebrtc extrareg returned: "+avail+"; namespace: "+namespc),webphone_api.common.isNull(namespc))return void PutToDebugLog(2,"ERROR, webrtcapi: LoadWebrtc extrareg namespace is NULL");if(webphone_api.common.isNull(oneacc)||oneacc.length<3)return void PutToDebugLog(2,"ERROR, webrtcapi: LoadWebrtc extrareg account is NULL");PutToDebugLog(2,"EVENT, RegisterEx ("+i+"): "+oneacc.toString());var asrv=oneacc[0],ausr=oneacc[1],apwd=oneacc[2],aival=webphone_api.common.GetParameterInt("registerinterval",180);oneacc.length>3&&!webphone_api.common.isNull(oneacc[3])&&oneacc[3].length>0&&webphone_api.common.IsNumber(oneacc[3])&&(aival=webphone_api.common.StrToInt(oneacc[3]));var callerid="",displayname="",proxy="",realm="";if(oneacc.length>4&&!webphone_api.common.isNull(oneacc[4])&&oneacc[4].length>0&&(callerid=oneacc[4]),oneacc.length>5&&!webphone_api.common.isNull(oneacc[5])&&oneacc[5].length>0&&(displayname=oneacc[5]),oneacc.length>6&&!webphone_api.common.isNull(oneacc[6])&&oneacc[6].length>0&&(proxy=oneacc[6]),oneacc.length>7&&!webphone_api.common.isNull(oneacc[7])&&oneacc[7].length>0&&(realm=oneacc[7]),webphone_api.common.isNull(ausr)||ausr.length<1||webphone_api.common.isNull(apwd)||apwd.length<1||webphone_api.common.isNull(aival)||aival.length<1)return void PutToDebugLog(2,"ERROR, RegisterEx invalid account");var username=ausr,password=apwd;(webphone_api.common.isNull(callerid)||callerid.length<0)&&(callerid=ausr),(webphone_api.common.isNull(displayname)||displayname.length<0)&&(displayname=ausr);var udpaddr=asrv;(webphone_api.common.isNull(udpaddr)||udpaddr.length<1)&&(udpaddr=GetUDPServerAddress());var wsaddr=webphone_api.common.GetWebrtcSrvAddr();if(2===webphone_api.common.GetConfigInt("usemizuwebrtcgateway",1)&&(wsaddr=""),webphone_api.common.isNull(wsaddr)||wsaddr.length<2){wsaddr=webphone_api.common.GetWp();var wstmp=wsaddr;wstmp.indexOf("//")>=0&&(wstmp=wstmp.substring(wstmp.indexOf("//")+2,wstmp.length)),wstmp.indexOf(":")>0&&(wstmp=wstmp.substring(0,wstmp.indexOf(":")))}else wsaddr=webphone_api.common.Trim(wsaddr.toLowerCase());wsaddr=wsaddr.replace("*",""),wsaddr=wsaddr.toLowerCase(),wsaddr=wsaddr.replace("udp://",""),wsaddr=wsaddr.replace("tcp://",""),wsaddr=wsaddr.replace("http://",""),wsaddr=wsaddr.replace("https://","");var sipaddress=udpaddr;sipaddress.indexOf("udp:")<0&&(sipaddress="udp://"+sipaddress);var proxyaddress=sipaddress,wsaddress=wsaddr;wsaddress.indexOf("ws:")<0&&wsaddress.indexOf("wss:")<0&&(wsaddress="ws://"+wsaddress);var hostmp=location.host.toLowerCase();!1!==webphone_api.common.IsIPAddrress(wsaddress)&&!0!==webphone_api.common.BrowserRequiresHttps(!0)||(wsaddress=wsaddress.replace("ws:","wss:"));var publicsipaddress=webphone_api.common.GetConfig("publicsipaddress");webphone_api.common.isNull(publicsipaddress)&&(publicsipaddress=""),(webphone_api.common.isNull(realm)||realm.length<1)&&(realm=udpaddr,realm=webphone_api.common.NormalizeInput(realm,0),realm.indexOf(":")>0&&(realm=realm.substring(0,realm.indexOf(":"))),realm=webphone_api.common.Trim(realm));var sipuri=username;sipuri.indexOf("sip:")<0&&(sipuri="sip:"+username),sipuri.indexOf("@")<0&&(sipuri=sipuri+"@"+realm);var enableRTCWebBreaker=!0;enableRTCWebBreaker=!(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&0===webphone_api.parameters.rtcbreaker)&&(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&1===webphone_api.parameters.rtcbreaker||!webphone_api.common.IsMizuServerOrGateway());var organization=webphone_api.common.GetConfig("companyname");(webphone_api.common.isNull(organization)||organization.length<1)&&(organization=webphone_api.common.GetConfig("brandname"),(webphone_api.common.isNull(organization)||organization.length<1)&&(organization="Mizutech"));var ua=webphone_api.common.GetUA();webphone_api.common.GetParameter("useragent").length>0&&!1===webphone_api.common.IsMizuPublicWebRTCGateway()&&(ua=webphone_api.common.GetParameter("useragent"));var sheaders=[{name:"User-Agent",value:ua},{name:"Organization",value:organization},{name:"X-Webdomain",value:webphone_api.common.GetWebdomain()}],xhval="1";!0===webphone_api.common.Hasesw()?xhval="2":!0===webphone_api.common.Us()&&(xhval="0"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-LS",sipheaders[sipheaders.length-1].value=xhval;var company=webphone_api.common.GetParameter("companyname");!webphone_api.common.isNull(company)&&company.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Company",sheaders[sheaders.length-1].value=company);var brand=webphone_api.common.GetParameter("brandname");!webphone_api.common.isNull(brand)&&brand.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Brand",sheaders[sheaders.length-1].value=brand);var uppsrv=webphone_api.common.GetWebrtcSyUpperHeader("RegisterEx");uppsrv.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Sy.Uppersrv",sheaders[sheaders.length-1].value=uppsrv);var uppsrvd=webphone_api.common.GetWebrtcSyUpperDomainHeader("RegisterEx");uppsrvd.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Sy.Uppersrvd",sheaders[sheaders.length-1].value=uppsrvd);var dtmfmode=webphone_api.common.GetParameterInt("dtmfmode",2);4==dtmfmode&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-MFlag",sheaders[sheaders.length-1].value="2");var p2psignaling=webphone_api.common.GetParameterInt("p2psignaling",1);if(1!==p2psignaling){var valTmp="no";2===p2psignaling?valTmp="proxy":2===p2psignaling&&(valTmp="process"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2P",sipheaders[sipheaders.length-1].value=valTmp}sheaders=RemoveDuplicateHeader(sheaders),(webphone_api.common.isNull(username)||username.length<1)&&PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid username: "+username),(webphone_api.common.isNull(password)||password.length<1)&&PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid password: "+password),(webphone_api.common.isNull(sipuri)||sipuri.length<2||sipuri.indexOf("@")<1||sipuri.indexOf(".")<1)&&PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid sipuri: "+sipuri);var stun_turn=[],stun=webphone_api.common.GetStunServersStr(),turn=webphone_api.common.GetTurnSrv();if(!webphone_api.common.isNull(stun)&&stun.length>2){var sarr=stun.split(","),useurls=!1;if(("Chrome"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40||"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40)&&(useurls=!0),!webphone_api.common.isNull(sarr))for(var i=0;i<sarr.length;i++)if(!(webphone_api.common.isNull(sarr[i])||sarr[i].length<1))if(!0===useurls){var obj={urls:sarr[i]};stun_turn.push(obj)}else{var obj={url:sarr[i]};stun_turn.push(obj)}}if(webphone_api.common.isNull(turn)||webphone_api.common.IsLocalServer()||stun_turn.push(turn),PutToDebugLog(3,"Webrtc RegisterEx connection details:"),PutToDebugLog(3,"RegisterEx username: "+username),ldebug?PutToDebugLog(3,"RegisterEx password: "+password):!webphone_api.common.isNull(password)&&password.length>0?PutToDebugLog(3,"RegisterEx password: *"):PutToDebugLog(3,"RegisterEx password: null"),PutToDebugLog(3,"RegisterEx sipuri: "+sipuri),PutToDebugLog(3,"RegisterEx displayname: "+displayname),PutToDebugLog(3,"RegisterEx wsaddress: "+wsaddress),PutToDebugLog(3,"RegisterEx proxyaddress: "+proxyaddress),PutToDebugLog(3,"RegisterEx realm: "+realm),(webphone_api.common.isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)&&(webphone_api.common.IsUKGateway(wsaddress)?(PutToDebugLog(2,"WARNING, RegisterEx webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="uk"):webphone_api.common.IsUSGateway(wsaddress)&&(PutToDebugLog(2,"WARNING, RegisterEx webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="us")),!webphone_api.common.isNull(stun_turn)&&stun_turn.length>0){for(var i=0;i<stun_turn.length;i++)if(!webphone_api.common.isNull(stun_turn[i])){var sobj=stun_turn[i];for(var key in sobj){var msgtmp="RegisterEx turn server";!webphone_api.common.isNull(sobj[key])&&sobj[key].toString().indexOf("stun")>=0&&(msgtmp="RegisterEx stun server"),PutToDebugLog(3,msgtmp+"["+i+"]: "+key+": "+sobj[key])}}}else PutToDebugLog(3,"RegisterEx stun server: NOT set");var iceobj=null,icestr=webphone_api.common.GetParameter("ice");if(!webphone_api.common.isNull(icestr)&&icestr.length>0)try{iceobj=eval(icestr)}catch(eice){iceobj=null,PutToDebugLogException(2,"ERROR, RegisterEx webrtcapi parse ICE servers",eice)}if(!webphone_api.common.isNull(iceobj)){try{PutToDebugLog(2,"EVENT, RegisterEx webrtcapi found ICE (STUN/TURN) server: "+JSON.stringify(iceobj))}catch(eice2){}stun_turn=iceobj}var earlymediaint=webphone_api.common.GetParameterInt("earlymedia",2),earlymedia=!0;earlymediaint<1&&(earlymedia=!1);var sStack=new webphone_api[namespc].SIPml.Stack({realm:realm,impi:username,impu:sipuri,password:password,display_name:displayname,websocket_proxy_url:wsaddress,outbound_proxy_url:proxyaddress,ice_servers:stun_turn,enable_rtcweb_breaker:enableRTCWebBreaker,events_listener:{events:"*",listener:onSEventStack},enable_early_ims:earlymedia,enable_media_stream_cache:!0,bandwidth:null,video_size:null,sip_headers:sheaders});webphone_api.common.isNull(registerExSipstackArray)&&(registerExSipstackArray=[]),0!=sStack.start()?PutToDebugLog(2,"ERROR, webrtcapi: RegisterEx, Failed to start SIP stack sipuri: "+sipuri+"; password: "+password):registerExSipstackArray.push(sStack)}catch(err){PutToDebugLogException(2,"webrtcapi: LoadWebrtcCb",err)}}function ResendRegister(){try{oSipSessionRegister&&oSipSessionRegister.register?(PutToDebugLog(2,"EVENT, ResendRegister resending..."),
sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}),oSipSessionRegister.register()):PutToDebugLog(2,"ERROR, ResendRegister failed, invalid register session"),webphone_api.common.isNull(check_reg_timer)||clearTimeout(check_reg_timer),check_reg_timer=null,check_reg_timer=setTimeout(function(){try{if(webphone_api.common.GetTickCount()-webphone_api.global.webrtclastregsent>3e3){if(PutToDebugLog(2,"WARNING, ResendRegister: restart SipStack, because REGISTER was not resent"),!0===webphone_api.isincall())return void PutToDebugLog(2,"WARNING, ResendRegister: skip SipStack restart, because a call is in progress");ReStart(1,!0)}}catch(e){PutToDebugLogException(2,"webrtcapi: ResendRegister inner timer",e)}},2900)}catch(e){PutToDebugLogException(2,"webrtcapi: ResendRegister",e)}}function StartReRegister(e){try{if(webphone_api.common.GetParameterInt("forcereregister",1)<1)return;if(!0===e&&!0===reregstarted)return;if(webphone_api.global.phonestarted<1)return void(reregstarted=!1);reregstarted=!0,webphone_api.common.isNull(rereg_timer)||clearTimeout(rereg_timer),rereg_timer=null,rereg_timer=setTimeout(function(){if(webphone_api.global.phonestarted<1)return webphone_api.common.isNull(rereg_timer)||clearTimeout(rereg_timer),rereg_timer=null,reregstarted=!1,rereg_ival=1e4,void(webphone_api.global.webrtc_regstate=-1);if(1===webphone_api.global.webrtc_regstate)return void StartReRegister(!1);if(0===webphone_api.global.webrtc_regstate){rereg_ival<12e4?rereg_ival*=2:rereg_ival=1e4;var e=webphone_api.common.GetParameterInt("forcereregister",1);0===rereg_action&&oSipSessionRegister&&oSipSessionRegister.register?(PutToDebugLog(2,"ERROR, ReRegister new session (forcereregister: "+e.toString()+")"),rereg_action=1,ResendRegister()):(PutToDebugLog(2,"ERROR, ReRegister restart SipStack (forcereregister: "+e.toString()+")"),rereg_action=0,ReStart(1,!0)),StartReRegister(!1)}},rereg_ival)}catch(o){PutToDebugLogException(2,"webrtcapi: StartReRegister",o)}}function onSipEventStack(e){switch(webphone_api.global.isdebugversionwebrtc&&console.log("WRTCEVENT_STACK: "+e.type+", "+e.description),PutToDebugLog(2,"==stack event = "+e.type),e.type){case"started":webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),webphone_api.common.SaveParameter("lastsessionsuccess","2");try{!0===webphone_api.common.NeedRegister()?(oSipSessionRegister=this.newSession("register",{expires:GetRegisterivalWebRTC(),events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]}),oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders})),oSipSessionRegister.register()):PutToDebugLog(1,"STATUS,-1,Ready.")}catch(e){PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack register")}break;case"stopping":case"stopped":case"failed_to_start":case"failed_to_stop":"failed_to_start"==e.type||e.type;oSipStack=null,oSipSessionRegister=null,oSipSessionCall=null,uiOnConnectionEvent(!1,!1),stopRingbackTone(),stopRingTone(),uiVideoDisplayShowHide(!1),"failed_to_start"==e.type?(PutToDebugLog(1,"ERROR,-1,Register failed"),PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack failed_to_start"),webphone_api.common.CheckInternetConnection(),webphone_api.common.CheckInternetConnectionWS(),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!1),ReStart()):"failed_to_stop"==e.type?(PutToDebugLog(1,"ERROR,-1,UnRegister failed"),PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack failed_to_stop")):"stopping"==e.type?PutToDebugLog(2,"EVENT, WebRTC sipstack stopping"):"stopped"==e.type&&(PutToDebugLog(2,"EVENT, WebRTC sipstack stopped"),webphone_api.common.CheckInternetConnection(),webphone_api.common.CheckInternetConnectionWS(),webphone_api.global.webrtcsipsignalingreceived=0,ReStart()),webphone_api.global.webrtc_regstate=0;break;case"i_new_call":if(webphone_api.common.RemoveSipHeadreFromCache("X-reason"),webphone_api.common.RemoveSipHeadreFromCache("Reason"),webphone_api.common.RemoveSipHeadreFromCache("Warning"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),!0===webphone_api.global.dontSendSignaling&&webphone_api.global.dontSendSignalingTimer>0&&webphone_api.common.GetTickCount()-webphone_api.global.dontSendSignalingTimer<200)return e.newSession.hangup(),void PutToDebugLog(2,"WARNING, webrtcapi, API_Hangup call because retring with optimized SDP");if(!webphone_api.common.onc()){var o=[];o.push("h"),o.push("a"),o.push("n"),o.push("g"),o.push("u"),o.push("p"),o.push(" "),o.push("5"),o.push(" ");return PutToDebugLog(2,"EVENT, "+o.join("")),SipHangup(!0,-2),void e.newSession.hangup()}if(webphone_api.common.SaveParameter("lastsessionsuccess","2"),!0===webphone_api.common.UsePresence2()&&"dnd"===webphone_api.common.GetParameter("presencestatus").toLowerCase())return PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, because presence is DND"),e.newSession.hangup(),setTimeout(function(){SendRegisteredStatus()},500),setTimeout(function(){SendRegisteredStatus()},1e3),void(webphone_api.global.webrtc_regstate=1);if(webphone_api.common.GetNrOfActiveCalls()>0){var n="";if(oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),webphone_api.common.isNull(n)&&(n=""),n=webphone_api.common.Trim(n),n.length>0&&n===webphone_api.global.currcallnumber){var t=webphone_api.common.GetParameterInt("dropsameoldcall",0);if(1===t){var i=webphone_api.common.GetSipHeaderInternal("X-Autorecall");webphone_api.common.isNull(i)&&(i=""),i=webphone_api.common.Trim(i),i=i.toLowerCase(),"yes"===i&&(PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(1) from: "+n),e.newSession.hangup())}else if(2===t){var i=webphone_api.common.GetSipHeaderInternal("X-Autorecall");webphone_api.common.isNull(i)&&(i=""),i=webphone_api.common.Trim(i),i=i.toLowerCase(),!0===webphone_api.global.isvideocall&&"yes"===i&&(PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(2) from: "+n),e.newSession.hangup())}else 3===t&&(PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(3) from: "+n),e.newSession.hangup())}}if(webphone_api.common.GetNrOfActiveCalls()>0&&1!==webphone_api.common.IsMultiline()){var a=webphone_api.common.GetParameter2("rejectonbusy");if("false"!==a){PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, because rejectonbusy is: "+a),e.newSession.hangup();var n="";oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),webphone_api.common.isNull(n)&&(n=""),"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?webphone_api.notifications.AddToCallLog(n,"2","recfile",0,webphone_api.global.aline,"Rejected busy"):console&&console.log&&console.log("ERROR, webrtcapi onSipEventStack webphone_api.notifications is not defined")}}else{webphone_api.common.GetNrOfActiveCalls()>0&&(webphone_api.global.aline=webphone_api.common.GetFreeLine()),webphone_api.global.restartice_time=webphone_api.common.GetTickCount(),oSipSessionCall=e.newSession,SetSipHeader(1),oSipSessionCall.setConfiguration(HandleOconfigCall(oConfigCall,webphone_api.global.aline)),startRingTone();var n="";oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),showNotifICall(n);var r=webphone_api.global.aline.toString();webphone_api.common.StrToInt(r)<1&&(webphone_api.global.aline=webphone_api.common.GetFreeLine());var l=null;oSipSessionCall.o_session&&oSipSessionCall.o_session&&oSipSessionCall.o_session.o_stack&&oSipSessionCall.o_session.o_stack.ao_headers&&oSipSessionCall.o_session.o_stack.ao_headers.length>0&&(l=oSipSessionCall.o_session.o_stack.ao_headers),webphone_api.common.SaveCallSession(webphone_api.global.aline,oSipSessionCall,n,"2",webphone_api.common.GetTickCount(),-1,-1,"",oSipSessionCall.getId(),"true","",l);try{var p="recv=\n"+e.o_event.o_message;webphone_api.common.CatchWebrtcSignaling(p,webphone_api.common.SIP_REGISTER)}catch(v){PutToDebugLogException(2,"webrtcapi: onSipEventStack i_new_call CatchWebrtcSignaling",v)}var s=webphone_api.common.GetEndpoint(-1,n,oSipSessionCall.getId(),!1),c="";webphone_api.common.isNull(s)||(c=s[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallSetup,"+n+","+webphone_api.common.GetSipusername()+",2,"+n+",["+c+"],,,,,"),1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Ringing..."),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Ringing,"+n+","+webphone_api.common.GetSipusername()+",2,"+n+",["+c+"]"),PutToDebugLog(1,"STATUS,-1,Incoming..."),istypeincoming=!0;var u=webphone_api.common.GetParameter2("autoignore");(webphone_api.common.isNull(u)||1!==u.length)&&(u="0");var g=webphone_api.common.StrToInt(u);if(g>1?(PutToDebugLog(3,"EVENT, autoignore WebRTC hangup(reject)"),SipHangup(!0,webphone_api.global.aline)):1===g&&(PutToDebugLog(3,"EVENT, autoignore WebRTC silent ignore"),stopRingTone()),!0===webphone_api.common.GetParameterBool("autoaccept",!1)){var m=webphone_api.common.GetParameterInt("beeponconnect",0);1!==m&&2!==m&&4!==m||webphone_api.common.Beep("1"),PutToDebugLog(3,"EVENT, autoaccept WebRTC accept"),SipAccept(webphone_api.global.aline,!1)}var b=webphone_api.common.GetParameter2("calltransferalways");!webphone_api.common.isNull(b)&&b.length>1&&(PutToDebugLog(3,"EVENT, call transfer WebRTC calltransferalways: "+b),SipTransferEx(b));var h=webphone_api.common.GetParameter2("callforwardonbusy");!webphone_api.common.isNull(h)&&h.length>1&&Forward(h);var d=webphone_api.common.GetParameter2("callforwardalways");!webphone_api.common.isNull(d)&&d.length>1&&Forward(d)}break;case"i_new_message":webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),webphone_api.common.SaveParameter("lastsessionsuccess","2"),e.newSession.accept();var _=e.newSession.getRemoteFriendlyName(),o=e.getContentString();if(webphone_api.common.isNull(_)||_.length<1)return void PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack chat received, from is NULL");if(webphone_api.common.isNull(o)||o.length<1)return void PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack chat received, from: "+_+"; message is NULL");PutToDebugLog(1,"CHAT,-1,"+_+","+o);break;case"m_permission_requested":PutToDebugLog(5,"EVENT, webrtcapi: permission requested"),webphone_api.global.lastpermreq=webphone_api.common.GetTickCount(),last_event=webphone_api.global.last_event,PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Waiting for permission"),setTimeout(function(){!1===webphone_api.global.webrtcpermissionaccepted&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Waiting for permission")},3500);break;case"m_permission_accepted":if(PutToDebugLog(5,"EVENT, webrtcapi: MediaStream permission granted"),!webphone_api.common.isNull(last_event)&&last_event.length>0&&PutToDebugLog(1,"EVENT,"+last_event),webphone_api.global.webrtcpermissionaccepted=!0,RedialOnFail(),!0===webphone_api.global.incommingCall){var w=webphone_api.common.GetTickCount(),f=webphone_api.common.GetParameterInt("acceptcall_onsharedevice",1);2===f?(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_1"),SipAccept(webphone_api.global.aline)):1===f&&("Firefox"===webphone_api.common.GetBrowser()&&!1===webphone_api.common.IsHttps()&&webphone_api.common.GetBrowserVersion()<75?(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_2"),SipAccept(webphone_api.global.aline)):"Chrome"===webphone_api.common.GetBrowser()&&!0===webphone_api.common.IsLocalFileSystem()?(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_3"),SipAccept(webphone_api.global.aline)):webphone_api.global.lastpermreq>0&&w-webphone_api.global.lastpermreq>8e3&&(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_4"),SipAccept(webphone_api.global.aline)))}break;case"m_permission_refused":if("m_permission_refused"==e.type){if(webphone_api.global.webrtcpermissionaccepted=!1,PutToDebugLog(5,"EVENT, webrtcapi: MediaStream permission denied"),uiCallTerminated("Media stream permission denied"),!webphone_api.common.isNull(destnumber)&&destnumber.length>0&&"call-audiovideo"===calltype)return PutToDebugLog(2,"WARNING, MediaStream permission denied, retry audio call with no video: "+destnumber),webphone_api.$("#div_video_fullscreen_button").hide(),void SipCall("call-audio",callline,destnumber,!0);PutToDebugLog(2,"EVENT, Hangup incoming call, because MediaStream permission denied: "+destnumber),SipHangup(!0,webphone_api.global.aline),setTimeout(function(){webphone_api.common.MediaStreamPermissionDenied()},150)}}}function onSipEventSession(e){switch(webphone_api.global.isdebugversionwebrtc&&console.log("WRTCEVENT_SESSION: "+e.type+", "+e.description),webphone_api.common.isNull(e.session.o_session)||webphone_api.common.isNull(e.session.o_session.s_type),webphone_api.common.SaveParameter("lastsessionsuccess","2"),PutToDebugLog(2,"==session event = "+e.type),e.type){case"connecting":case"connected":var o="connected"==e.type;if(e.session==oSipSessionRegister)"connecting"==e.type&&PutToDebugLog(1,"STATUS,-1,Registering..."),"connected"==e.type&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),isregistered=!0,SendRegisteredStatus(),webphone_api.global.webrtc_regstate=1);else if(e.session==oSipSessionMessage);else if(e.session==oSipSessionTransferCall);else if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){var n=!1;if(e.session==oSipSessionCall&&(n=!0),!1===n&&!webphone_api.common.isNull(webphone_api.global.ep))for(var t=0;t<webphone_api.global.ep.length;t++){var i=webphone_api.global.ep[t][webphone_api.common.EP_SESSION];if(!webphone_api.common.isNull(i)&&e.session==i){n=!0;break}}if(!0===n){var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var r="1";istypeincoming&&(r="2");try{if("undefined"!=typeof e.session.o_session&&null!==e.session.o_session&&"undefined"!=typeof e.session.o_session.o_uri_from&&null!==e.session.o_session.o_uri_from&&"undefined"!=typeof e.session.o_session.o_uri_from.s_user_name&&null!==e.session.o_session.o_uri_from.s_user_name&&e.session.o_session.o_uri_from.s_user_name.length>0){var l=e.session.o_session.o_uri_from.s_user_name;!webphone_api.common.isNull(l)&&l.length>0&&(r=webphone_api.common.GetSipusername().toLowerCase()===l.toLowerCase()?"1":"2")}}catch(S){PutToDebugLogException(2,"webrtcapi: onSipEventSession: connecting or connected",S)}if(o){stopRingbackTone(),stopRingTone(),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null);var p=webphone_api.common.GetEndpoint(-1,a,e.session.getId(),!1),s="";webphone_api.common.isNull(p)||(s=p[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallConnect,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a+",,,,,,["+s+"]"),webphone_api.common.SaveCallSession(webphone_api.global.aline,e.session,a,r,-1,webphone_api.common.GetTickCount(),-1,"",e.session.getId(),"",""),setTimeout(function(){PutToDebugLog(1,"STATUS,-1,In Call"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Speaking,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a)},1100),PutToDebugLog(1,"STATUS,-1,Speaking"),"2"===r&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",InCall,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a)}else PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+","+e.description),webphone_api.common.SaveCallSession(webphone_api.global.aline,e.session,a,r,webphone_api.common.GetTickCount(),-1,-1,"",e.session.getId(),"","",null);webphone_api.webrtcstack.SIPml.isWebRtc4AllSupported()&&(PutToDebugLog(2,"EVENT, webrtc4all supported connect uiVideoDisplayEvent"),uiVideoDisplayEvent(!1,!0),uiVideoDisplayEvent(!0,!0))}}break;case"terminating":case"terminated":if(e.session==oSipSessionRegister)if(uiOnConnectionEvent(!1,!1),oSipSessionCall=null,oSipSessionRegister=null,isregistered=!1,webphone_api.global.webrtc_regstate=0,!0===webphone_api.global.onunregistered_flag||!1===webphone_api.flagrestartwebrtc);else{PutToDebugLog(2,"ERROR,register failed with reason: "+e.description),PutToDebugLog(1,"STATUS,-1,Register failed: "+e.description),!webphone_api.common.isNull(e.description)&&e.description.length>0&&(lastregfailreason=e.description);try{webphone_api.onRegStateChangeCb("failed",e.description)}catch(S){PutToDebugLogException(2,"webrtcapi: There is an error in onRegStateChangeCb(failed) callback",S)}try{webphone_api.onRegisterFailedCb(e.description)}catch(S){PutToDebugLogException(2,"webrtcapi: There is an error in onRegisterFailed() callback",S)}webphone_api.common.CheckInternetConnection(),webphone_api.common.CheckInternetConnectionWS()}else if(e.session==oSipSessionMessage)PutToDebugLog(2,"EVENT,EventSession message: "+e.type);else if(e.session==oSipSessionTransferCall)PutToDebugLog(2,"EVENT,EventSession call transfer: "+e.type);else if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){if(PutToDebugLog(2,"EVENT,EventSession call: "+e.type),e.session===lastsession)return void PutToDebugLog(2,"EVENT, webrtcap: skip because duplicate session received");lastsession=e.session;var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var r="1";istypeincoming&&(r="2"),setTimeout(function(){calltype="",callline=1,destnumber=""},200);var c=webphone_api.global.aline,p=webphone_api.common.GetEndpoint(webphone_api.global.aline,a,e.session.getId(),!1,!0);!webphone_api.common.isNull(p[webphone_api.common.EP_LINE])&&webphone_api.common.IsNumber(p[webphone_api.common.EP_LINE])&&webphone_api.common.StrToInt(p[webphone_api.common.EP_LINE])>0&&(c=webphone_api.common.StrToInt(p[webphone_api.common.EP_LINE]));var s="";webphone_api.common.isNull(p)||(s=p[webphone_api.common.EP_CALLID]),!webphone_api.common.isNull(p)&&"true"===p[webphone_api.common.EP_FINISHEDSENT]||lastsessionid===e.session.getId()?PutToDebugLog(3,"EVENT, webrtc finished status already sent for this session"):(lastsessionid=e.session.getId(),setTimeout(function(){lastsessionid=-1e3},150),!1===webphone_api.global.calltransf_completed&&(c=webphone_api.common.SaveCallSession(null,e.session,a,r,-1,-1,webphone_api.common.GetTickCount(),"",e.session.getId(),"","true",null)),c<-4&&(c=webphone_api.global.aline),PutToDebugLog(1,"STATUS,"+c.toString()+",CallDisconnect,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a+",,,,,,["+s+"]"),uiCallTerminated("Call Finished",c),BuildCDR(c,a,e.session.getId(),e.description))}break;case"i_notify":if(PutToDebugLog(4,"EVENT, NOTIFY content-type: "+e.getContentType()),PutToDebugLog(4,"EVENT, NOTIFY content: "+e.getContentString()),"application/pidf+xml"==e.getContentType()&&window.DOMParser){var u=new DOMParser,g=u?u.parseFromString(e.getContentString(),"text/xml"):null,m=g?g.getElementsByTagName("presence")[0]:null;if(m){var b=m.getAttribute("entity"),h=m.getElementsByTagName("tuple")[0];if(b&&h){var d=h.getElementsByTagName("status")[0];if(d){var _=d.getElementsByTagName("basic")[0];if(_){var w=b,f=_.textContent;w=w.toLowerCase(),w=w.replace("sip:","");var v=w.indexOf("@");v>0&&(w=w.substring(0,v));var P=webphone_api.common.SaveReceivedPresence2(w,f);PutToDebugLog(4,"EVENT, Presence notification: number: "+w+" status: "+f),!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._dialpad)||webphone_api._dialpad.PopulateListRecents(),!0!==webphone_api.global.isContactdetailsStarted||!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._contactdetails)||webphone_api._contactdetails.PopulateData(),!0!==webphone_api.global.isMessageStarted||webphone_api.common.isNull(webphone_api._message)||webphone_api._message.DisplayPresence(P)}}}}}break;case"m_stream_video_local_added":PutToDebugLog(2,"EVENT, local video stream added"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!0,!0);break;case"m_stream_video_local_removed":PutToDebugLog(2,"EVENT, local video stream removed"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!0,!1);break;case"m_stream_video_remote_added":PutToDebugLog(2,"EVENT, remote video stream added"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!1,!0);break;case"m_stream_video_remote_removed":PutToDebugLog(2,"EVENT, remote video stream removed"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!1,!1);break;case"m_stream_audio_local_added":PutToDebugLog(2,"EVENT, local audio stream added");break;case"m_stream_audio_local_removed":PutToDebugLog(2,"EVENT, local audio stream removed");break;case"m_stream_audio_remote_added":PutToDebugLog(2,"EVENT, remote audio stream added");break;case"m_stream_audio_remote_removed":PutToDebugLog(2,"EVENT, remote audio stream removed");break;case"i_ect_new_call":oSipSessionTransferCall=e.session;break;case"i_ao_request":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){var E=webphone_api.global.aline.toString(),T=webphone_api.common.StrToInt(E);T<1&&(webphone_api.global.aline=webphone_api.common.GetFreeLine());var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var p=webphone_api.common.GetEndpoint(-1,a,e.session.getId(),!1),s="";webphone_api.common.isNull(p)||(s=p[webphone_api.common.EP_CALLID]),!webphone_api.common.isNull(p)&&p.length>webphone_api.common.EP_SETUPSENT&&"true"===p[webphone_api.common.EP_SETUPSENT]||(1===webphone_api.common.GetApibehaviour()&&(PutToDebugLog(1,"STATUS,-1,Call Initiated"),PutToDebugLog(1,"STATUS,-1,Calling...")),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallSetup,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+s+"],,,,,"),webphone_api.common.SaveCallSession(webphone_api.global.aline,e.session,a,"1",webphone_api.common.GetTickCount(),-1,-1,"",e.session.getId(),"true","",null));var N=e.getSipResponseCode();180==N||183==N?(istypeincoming=!1,PutToDebugLog(1,"STATUS,-1,Ringing..."),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Ringing,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+s+"]"),0===changesptoring?180==N&&(!webphone_api.common.isNull(e.session.ringdone)&&e.session.ringdone||(startRingbackTone(),e.session.ringdone=!0)):2!==changesptoring&&5!==changesptoring||!webphone_api.common.isNull(e.session.ringdone)&&e.session.ringdone||(startRingbackTone(),e.session.ringdone=!0)):100==N&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",InProgress,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+s+"]")}break;case"m_early_media":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(5!==changesptoring&&setTimeout(function(){stopRingbackTone(),stopRingTone()},100),PutToDebugLog(1,"STATUS,-1,Early media started"));break;case"m_local_hold_ok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering&&(e.session.bTransfering=!1),e.session.bHeld=!0);break;case"m_local_hold_nok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering=!1);break;case"m_local_resume_ok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering=!1,e.session.bHeld=!1,webphone_api.webrtcstack.SIPml.isWebRtc4AllSupported()&&(uiVideoDisplayEvent(!1,!0),uiVideoDisplayEvent(!0,!0)));break;case"m_local_resume_nok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering=!1,PutToDebugLog(1,"STATUS,-1,Failed to unhold call"));break;case"m_remote_hold":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,-1,Placed on hold by remote party");break;case"m_remote_resume":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,-1,Taken off hold by remote party");break;case"m_bfcp_info":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,-1,BFCP Info: "+e.description);break;case"o_ect_trying":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(PutToDebugLog(1,"EVENT,transfer initiated successfully"),1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Transfer"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer in progress..._"));break;case"o_ect_accepted":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer accepted");break;case"o_ect_completed":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){var a="";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var p=webphone_api.common.GetEndpoint(-1,a,e.session.getId(),!1),s="";webphone_api.common.isNull(p)||(s=p[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Midcall,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+s+"],,,,,")}break;case"i_ect_completed":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){webphone_api.global.calltransf_completed=!0,setTimeout(function(){webphone_api.global.calltransf_completed=!1,webphone_api.common.RefreshInfo()},3e3),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer completed"),oSipSessionTransferCall&&(oSipSessionCall=oSipSessionTransferCall),oSipSessionTransferCall=null;var a="";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var p=webphone_api.common.GetEndpoint(-1,a,e.session.getId(),!1),s="";webphone_api.common.isNull(p)||(s=p[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Midcall,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+s+"],,,,,")}break;case"o_ect_failed":PutToDebugLog(1,"ERROR,"+webphone_api.global.aline+",Call transfer failed");break;case"i_ect_failed":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer failed");break;case"o_ect_notify":PutToDebugLog(1,"EVENT,transfer initiated"),PutToDebugLog(2,"STATUS,"+webphone_api.global.aline+",Call Transfer: "+e.getSipResponseCode()+" "+e.description+"_o");break;case"i_ect_notify":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(PutToDebugLog(1,"EVENT,transfer initiated"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call Transfer: "+e.getSipResponseCode()+" "+e.description),e.getSipResponseCode()>=300&&e.session.bHeld&&e.session.resume(),1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Transfer"));break;case"i_ect_requested":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){if(0===webphone_api.common.GetParameterInt("transfertype",-1))PutToDebugLog(2,"EVENT, incoming SIP REFER transfer rejected."),e.session.rejectTransfer();else{PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer in progress...");var E=webphone_api.global.aline.toString(),T=webphone_api.common.StrToInt(E);T<1&&(webphone_api.global.aline=webphone_api.common.GetFreeLine());var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var p=webphone_api.common.GetEndpoint(-1,a,e.session.getId(),!1),s="";webphone_api.common.isNull(p)||(s=p[webphone_api.common.EP_CALLID]),!webphone_api.common.isNull(p)&&p.length>webphone_api.common.EP_SETUPSENT&&"true"===p[webphone_api.common.EP_SETUPSENT]||(PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallSetup,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+s+"],,,,,"),webphone_api.common.SaveCallSession(webphone_api.global.aline,e.session,a,"1",webphone_api.common.GetTickCount(),-5,-5,"",e.session.getId(),"true","",null));var N=e.getSipResponseCode();e.session.acceptTransfer()}}}}function BuildCDR(e,o,n,t){try{2===webphone_api.common.GetParameterInt("androidspeaker",1)&&!1===adev_hack_called&&"Android"===webphone_api.common.GetOs()&&(webphone_api.common.isNull(audioinput_id)||audioinput_id.length<1||audioinput_name[0].toLowerCase().indexOf("microphone")>=0&&audioinput_name[0].indexOf("1")>=0)&&(adev_hack_called=!0,StartGetDevices(),setTimeout(function(){webphone_api.plhandler.GetAudioDevicesForMenu(0,!0)},200));var i=!0;!0===webphone_api.global.calltransf_completed&&(i=!1);var a=webphone_api.common.GetEndpoint(e,o,n,i);if(webphone_api.common.isNull(a)||a.length<5)return void PutToDebugLog(2,"ERROR, webrtcapi: BuildCDR invalid endpoint");var r=0,l=0,p=0,s="",c=!1;!webphone_api.common.isNull(a[webphone_api.common.EP_SETUPTIME])&&webphone_api.common.IsNumber(a[webphone_api.common.EP_SETUPTIME])&&(r=webphone_api.common.StrToInt(a[webphone_api.common.EP_SETUPTIME])),!webphone_api.common.isNull(a[webphone_api.common.EP_CONNECTTIME])&&webphone_api.common.IsNumber(a[webphone_api.common.EP_CONNECTTIME])&&(l=webphone_api.common.StrToInt(a[webphone_api.common.EP_CONNECTTIME])),!webphone_api.common.isNull(a[webphone_api.common.EP_DESTNR])&&a[webphone_api.common.EP_DESTNR].length>0&&(s=a[webphone_api.common.EP_DESTNR]),webphone_api.common.isNull(a[webphone_api.common.EP_INCOMING])||1!==a[webphone_api.common.EP_INCOMING].length||"2"===a[webphone_api.common.EP_INCOMING]&&(c=!0),p=webphone_api.common.GetTickCount();var u=0;!webphone_api.common.isNull(l)&&l>0&&!webphone_api.common.isNull(p)&&p>0&&(u=p-l),s=webphone_api.common.isNull(s)?"":webphone_api.common.Trim(s),webphone_api.common.isNull(l)&&(l=0);var g="",m="",b="NA";!webphone_api.common.isNull(l)&&webphone_api.common.IsNumber(l)&&!webphone_api.common.isNull(r)&&webphone_api.common.IsNumber(r)&&(b=(l-r).toString());c?(g=s,m=webphone_api.common.GetSipusername()):(g=webphone_api.common.GetSipusername(),m=s),webphone_api.common.isNull(t)&&(t="");var h=a[webphone_api.common.EP_CALLID];(webphone_api.common.isNull(n)||n.length<1)&&(h=n),webphone_api.common.GetDiscReasonFromSignaling(function(o){!webphone_api.common.isNull(o)&&o.length>0&&(t=o);var n="CDR,"+e+","+s+","+g+","+m+",NA,"+b+","+u.toString()+",NA,"+t+","+h;webphone_api.global.lastcallcdr=n,webphone_api.common.RemoveSessionHeadersFromCache(webphone_api.common.StrToIntDef(e,-1)),setTimeout(function(){PutToDebugLog(1,n)},500),setTimeout(function(){SendRegisteredStatus()},1500)})}catch(d){PutToDebugLogException(2,"webrtcapi: BuildCDR",d)}}function SendRegisteredStatus(){isregistered&&PutToDebugLog(1,"STATUS,-1,Registered.")}function GetWebrtcStats(){try{return}catch(e){PutToDebugLogException(2,"webrtcapi: GetWebrtcStats",e)}}function DumpStats(e){try{var o="";return Object.keys(e).forEach(function(n,t){var i=e[n];o+="<h3>Report ",o+=t,o+="</h3>\n",o+="time "+i.timestamp+"<br>\n",o+="type "+i.type+"<br>\n",Object.keys(i).forEach(function(e){"timestamp"!==e&&"type"!==e&&(o+=e+": "+i[e]+"<br>\n")})}),o}catch(n){PutToDebugLogException(2,"webrtcapi: DumpStats",n)}return""}function SetVolume(e,o){try{if(webphone_api.common.isNull(o)||!webphone_api.common.IsNumber(o))return void PutToDebugLog(2,"ERROR, webrtcapi: SetVolume is NULL: "+o);var n=webphone_api.common.StrToInt(o);if(n<0||n>100)return void PutToDebugLog(2,"ERROR, webrtcapi: SetVolume invalid value. Accepted varulue range is from 0 - 100: "+n);var t=document.getElementById("audio_remote");if(webphone_api.common.isNull(t))return PutToDebugLog(2,"ERROR, webrtcapi: SetVolume cannot find audio element"),!1;0==e||"0"==e?(n>100&&(n=100),n<0&&(n=0),n/=100,webphone_api.webrtcMicVolume=n):2==e&&"2"==e?(n>100&&(n=100),webphone_api.$("#ringtone").prop("volvalueforgetvolume",n),webphone_api.$("#ringbacktone").prop("volvalueforgetvolume",n),n=n/100*2,n>1&&(n=1),
webphone_api.$("#ringtone").prop("volume",n),webphone_api.$("#ringbacktone").prop("volume",n)):0!=e&&"0"!=e&&(n>100&&(n=100),webphone_api.$("#audio_remote").prop("volvalueforgetvolume",n),n=n/100*2,n>1&&(n=1),webphone_api.$("#audio_remote").prop("volume",n),webphone_api.$("#video_remote").prop("volume",n))}catch(i){PutToDebugLogException(2,"webrtcapi: SetVolume",i)}}function GetVolume(e){try{if(0==e||"0"==e){return webphone_api.common.GetParameterInt("volumein",50)}if(0!=e){var o=webphone_api.$("#audio_remote").prop("volume");o=100*o/2;var n=webphone_api.$("#audio_remote").prop("volvalueforgetvolume");return!webphone_api.common.isNull(n)&&webphone_api.common.IsNumber(n)&&(o=webphone_api.common.StrToInt(n)),PutToDebugLog(2,"webrtcapi: GetVolume returned: "+o.toString()),o}}catch(t){PutToDebugLogException(2,"webrtcapi: GetVolume",t)}}function GetAudioDeviceList(e){try{var o=[];o=0==e?audioinput_name:1===e||2===e?audiooutput_name:videoinput_name;var n="";if(!webphone_api.common.isNull(o)&&o.length>0)for(var t=0;t<o.length;t++)n.length>0&&(n+="\r\n"),n+=o[t];return n}catch(i){PutToDebugLogException(2,"webrtcapi: GetAudioDeviceList",i)}return""}function GetAudioDevice(e){try{var o="";if(0==e){o=audioinput_name[0];var n=webphone_api.common.GetParameter("sel_rtc_audio_in");if(!webphone_api.common.isNull(n)&&n.length>0)for(var t=0;t<audioinput_name.length;t++)if(n===audioinput_name[t]){o=n;break}(webphone_api.common.isNull(o)||o.length<1)&&(o=n),webphone_api.common.SaveParameter("sel_rtc_audio_in",o)}else if(1==e||2==e){o=audiooutput_name[0];var n=webphone_api.common.GetParameter("sel_rtc_audio_out");if(!webphone_api.common.isNull(n)&&n.length>0)for(var t=0;t<audiooutput_name.length;t++)if(n===audiooutput_name[t]){o=n;break}(webphone_api.common.isNull(o)||o.length<1)&&(o=n),webphone_api.common.SaveParameter("sel_rtc_audio_out",o)}if(3==e){o=videoinput_name[0];var n=webphone_api.common.GetParameter("sel_rtc_video_in");if(!webphone_api.common.isNull(n)&&n.length>0)for(var t=0;t<videoinput_name.length;t++)if(n===videoinput_name[t]){o=n;break}(webphone_api.common.isNull(o)||o.length<1)&&(o=n),webphone_api.common.SaveParameter("sel_rtc_video_in",o)}return o}catch(i){PutToDebugLogException(2,"webrtcapi: GetAudioDevice",i)}return""}function SetAudioDevice(e,o,n){try{var t=!1;if(webphone_api.common.isNull(o)||o.length<0)return void PutToDebugLog(2,"ERROR, webrtcapi SetAudioDevice: invalid devicename: "+o);if(PutToDebugLog(3,"EVENT, webrtcapi SetAudioDevice: device: "+e+", devicename: "+o),o=o.toLowerCase(),0===e){for(var i=0;i<audioinput_name.length;i++)if(!webphone_api.common.isNull(audioinput_name[i])&&audioinput_name[i].toLowerCase()===o){webphone_api.common.SaveParameter("sel_rtc_audio_in",audioinput_name[i]),GetSetDevices(audioinput_id[i],"",n),t=!0;break}}else if(1===e||2===e){for(var i=0;i<audiooutput_name.length;i++)if(!webphone_api.common.isNull(audiooutput_name[i])&&audiooutput_name[i].toLowerCase()===o){var a=audiooutput_name[i];webphone_api.common.SaveParameter("sel_rtc_audio_out",a.toString()),webphone_api.common.isNull(videoElement)?PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice videoElement is NULL"):attachSinkId(videoElement,audiooutput_id[i],"audio output_v"),attachSinkId(audioRemoteElement,audiooutput_id[i],"audio output"),t=!0;break}}else for(var i=0;i<videoinput_name.length;i++)if(!webphone_api.common.isNull(videoinput_name[i])&&videoinput_name[i].toLowerCase()===o){webphone_api.common.SaveParameter("sel_rtc_video_in",videoinput_name[i]),!0===n&&(webphone_api.common.isNull(videoElement)?PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice for video videoElement is NULL"):attachSinkId(videoElement,videoinput_id[i],"video")),t=!0;break}!1===t&&PutToDebugLog(2,"ERROR, webrtcapi SetAudioDevice device not found")}catch(r){PutToDebugLogException(2,"webrtcapi: SetAudioDevice",r)}}function StartGetDevices(){try{videoElement=document.getElementById("video_remote"),audioRemoteElement=document.getElementById("audio_remote"),webphone_api.common.isNull(navigator.mediaDevices)||webphone_api.common.isNull(navigator.mediaDevices.enumerateDevices)||eval("navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(errorCallback);")}catch(err){PutToDebugLogException(2,"webrtcapi: StartGetDevices",err)}}function GetSetDevices(audioSource,videoSource,setalsovideo,vid_prev_elem){try{window.stream&&window.stream.getTracks().forEach(function(e){e.stop()});var constraints=null;constraints=!0===setalsovideo?{audio:{deviceId:audioSource?{exact:audioSource}:undefined},video:{deviceId:videoSource?{exact:videoSource}:undefined}}:{audio:{deviceId:audioSource?{exact:audioSource}:undefined}},webphone_api.common.isNull(navigator.mediaDevices)||webphone_api.common.isNull(navigator.mediaDevices.getUserMedia)||eval("navigator.mediaDevices.getUserMedia(constraints).then(function(stream){window.stream = stream;if(typeof(vid_prev_elem) !== 'undefined' && vid_prev_elem !== null) { attachMediaStream(vid_prev_elem, stream); }}).then(gotDevices).catch(errorCallback);")}catch(err){PutToDebugLogException(2,"webrtcapi: GetSetDevices",err)}}function SwitchOffAndroidSpeaker(callback){function GUMHandleSuccess(stream){function ENUMgotdevices(e){try{if(!webphone_api.common.isNull(e)&&e.length>0){audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[];for(var o=0;o!==e.length;++o){var n=e[o],t=n.deviceId;if("audioinput"===n.kind){var i=n.label||"microphone "+(audioinput_name.length+1);audioinput_name.push(i),audioinput_id.push(t)}else if("audiooutput"===n.kind){var i=n.label||"speaker "+(audiooutput_name.length+1);audiooutput_name.push(i),audiooutput_id.push(t)}else if("videoinput"===n.kind){var i=n.label||"camera "+(videoinput_name.length+1);videoinput_name.push(i),videoinput_id.push(t)}else PutToDebugLog(3,"EVENT, webrtcapi GUMgotdevices: Some other kind of source/device: ",n)}PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 0"),webphone_api.getdevicelist(0,function(){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 1"),webphone_api.getdevicelist(1,function(){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 3"),webphone_api.getdevicelist(3,function(){}),PutToDebugLog(3,"EVENT, webrtcapi SwitchOffAndroidSpeaker GUMgotdevices executed successfully"),callback()}else PutToDebugLog(2,"WARNING, webrtrcapi GUMgotdevices: no devices found"),callback()}catch(a){PutToDebugLogException(2,"webrtcapi: ENUMgotdevices",a),callback()}}function ENUMerrorCallback(e){PutToDebugLog(2,"ERROR, GUMerrorCallback webrtcapi navigator.getUserMedia: "+e),callback()}try{eval("navigator.mediaDevices.enumerateDevices().then(ENUMgotdevices).catch(ENUMerrorCallback);")}catch(err){PutToDebugLogException(2,"webrtcapi: GUMHandleSuccess",err),callback()}}function GUMHandleError(e){try{PutToDebugLog(2,"ERROR, GUMHandleError webrtcapi navigator.getUserMedia: "+e),callback()}catch(o){PutToDebugLogException(2,"webrtcapi: GUMHandleError",o),callback()}}try{if(callback&&"function"==typeof callback||(callback=function(){}),"MSIE"===webphone_api.common.GetBrowser())return void callback();if(!0===switchas_called||"Android"!==webphone_api.common.GetOs())return void callback();var as=webphone_api.common.GetParameterInt("androidspeaker",1);if(as<1)return void callback();switchas_called=!0;var constraints={audio:!0,video:!1};eval("navigator.mediaDevices.getUserMedia(constraints).then(GUMHandleSuccess).catch(GUMHandleError);")}catch(err){PutToDebugLogException(2,"webrtcapi: SwitchOffAndroidSpeaker",err),callback()}}function MyCameraPreview(e){try{if(webphone_api.common.GetParameterInt("displayvideodevice",0)<1)return;PutToDebugLog(2,"EVENT, webrtcapi MyCameraPreview: "+e);var o='<div id="preview_div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="preview_video_local" autoplay="autoplay" muted="true"></video><button id="preview_btn_close">'+webphone_api.stringres.get("btn_close")+"</button></div>";if(!1===webphone_api.common.IsSDK()){var n=webphone_api.$.mobile.activePage.attr("id");webphone_api.$("#"+n).append(o)}else webphone_api.$("body").append(o);var t=document.getElementById("preview_video_local");if(webphone_api.common.isNull(t))return void PutToDebugLog(2,"EVENT, MyCameraPreview video element is NULL");webphone_api.$("#preview_btn_close").on("click",function(){HideVideoPriview()});GetSetDevices(GetAudioVideoInputId(webphone_api.common.GetParameter("sel_rtc_audio_in"),!1),GetAudioVideoInputId(webphone_api.common.GetParameter("sel_rtc_video_in"),!0),!0,t),setTimeout(function(){HideVideoPriview()},1e4)}catch(i){PutToDebugLogException(2,"webrtcapi: MyCameraPreview",i)}}function HideVideoPriview(){try{var e=document.getElementById("preview_video_local");if(webphone_api.common.isNull(e))return;"undefined"!=typeof URL.revokeObjectURL&&URL.revokeObjectURL(e.src),e.src&&(e.src=null),webphone_api.$("#preview_div_video_local").remove()}catch(o){PutToDebugLogException(2,"webrtcapi: HideVideoPriview",o)}}function PrintWebRTCAudioDevices(){try{if(!0===webphone_api.global.printwad_called)return;webphone_api.global.printwad_called=!0,webphone_api.common.isNull(audioinput_name)||webphone_api.common.isNull(audioinput_id)||PutToDebugLog(2,"EVENT, webrtcdevices: audio input devices name: "+audioinput_name.toString()+"; ids: "+audioinput_id.toString()),webphone_api.common.isNull(audiooutput_name)||webphone_api.common.isNull(audiooutput_id)||PutToDebugLog(2,"EVENT, webrtcdevices: audio output devices name: "+audiooutput_name.toString()+"; ids: "+audiooutput_id.toString()),webphone_api.common.isNull(videoinput_name)||webphone_api.common.isNull(videoinput_id)||PutToDebugLog(2,"EVENT, webrtcdevices: video input devices name: "+videoinput_name.toString()+"; ids: "+videoinput_id.toString())}catch(e){PutToDebugLogException(2,"webrtcapi: PrintWebRTCAudioDevices",e)}}function GetAudioVideoInputId(e,o){try{if(webphone_api.common.isNull(e)||e.length<1)return e;if(!0===o){if(webphone_api.common.isNull(videoinput_name)||videoinput_name.length<1||webphone_api.common.isNull(videoinput_id)||videoinput_id.length<1)return e;for(var n=0;n<videoinput_name.length;n++)if(e===videoinput_name[n])return videoinput_id[n]}else{if(webphone_api.common.isNull(audioinput_name)||audioinput_name.length<1||webphone_api.common.isNull(audioinput_id)||audioinput_id.length<1)return e;for(var n=0;n<audioinput_name.length;n++)if(e===audioinput_name[n])return audioinput_id[n]}}catch(t){PutToDebugLogException(2,"webrtcapi: GetAudioInputId",t)}return e}function gotDevices(e){try{if(!webphone_api.common.isNull(e)&&e.length>0){audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[];for(var o=0;o!==e.length;++o){var n=e[o],t=n.deviceId;if("audioinput"===n.kind){var i=n.label||"microphone "+(audioinput_name.length+1);audioinput_name.push(i),audioinput_id.push(t)}else if("audiooutput"===n.kind){var i=n.label||"speaker "+(audiooutput_name.length+1);audiooutput_name.push(i),audiooutput_id.push(t)}else if("videoinput"===n.kind){var i=n.label||"camera "+(videoinput_name.length+1);videoinput_name.push(i),videoinput_id.push(t)}else PutToDebugLog(3,"EVENT, webrtcapi gotDevices: Some other kind of source/device: ",n)}PrintWebRTCAudioDevices()}else PutToDebugLog(2,"WARNING, webrtrcapi gotDevices: no devices found")}catch(a){PutToDebugLogException(2,"webrtcapi: gotDevices",a)}}function attachSinkId(element,sinkId,msg){try{"undefined"!=typeof element.sinkId?eval("element.setSinkId(sinkId).then(function(){PutToDebugLog(3, 'EVENT, webrtcapi attachSinkId: Success, ' + msg + ' device: ' + element.toString() + '; attached: ' + sinkId);}).catch(function(error){var errorMessage = error;if (error.name === 'SecurityError'){errorMessage = 'You need to use HTTPS for selecting audio output device: ' + error;}PutToDebugLog(2, 'ERROR, webrtcapi attachSinkId to: ' + element.toString() + '; sinkId: ' + sinkId + ' error: ' + errorMessage);});"):PutToDebugLog(2,"WARNING, webrtcapi attachSinkId: Browser does not support output device selection.")}catch(err){PutToDebugLogException(2,"webrtcapi: attachSinkId",err)}}function errorCallback(e){PutToDebugLog(2,"ERROR, webrtcapi navigator.getUserMedia: "+e)}function AddVideoElemnts(e){try{var o='<div id="div_video"><div id="div_video_remote"><video class="video" width="100%" height="100%" id="video_remote" autoplay="autoplay"></video></div><div id="div_video_local_wrapper"><iframe allow="microphone; camera" class="previewvideo"> </iframe><div id="div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="video_local" autoplay="autoplay" muted="true"></video></div></div><div id="div_video_fullscreen_button"><button id="btn_video_fullscreen" class="ui-btn ui-btn-corner-all ui-btn-b noshadow">'+webphone_api.stringres.get("btn_video_fullscreen")+"</button></div></div>";videocontainer=document.getElementById("video_container"),webphone_api.common.isNull(videocontainer)?!0===e?PutToDebugLog(2,"EVENT, (warn) AddVideoElemnts cannot find video_container DIV"):PutToDebugLog(2,"EVENT, AddVideoElemnts cannot find video_container DIV"):webphone_api.common.isNull(divVideo)&&(PutToDebugLog(2,"EVENT, AddVideoElemnts video elements added"),videocontainer.innerHTML=o),divVideo=document.getElementById("div_video"),videoLocal=document.getElementById("video_local"),videoRemote=document.getElementById("video_remote"),audioRemote=document.getElementById("audio_remote"),webphone_api.$("#btn_video_fullscreen").off("click"),webphone_api.$("#btn_video_fullscreen").on("click",function(){toggleFullScreen()})}catch(n){PutToDebugLogException(2,"webrtcapi: AddVideoElemnts",n)}}function GetVideoSizeObj(){var e=undefined;try{var o=webphone_api.common.GetParameter2("video_min_width"),n=webphone_api.common.GetParameter2("video_min_height"),t=webphone_api.common.GetParameter2("video_max_width"),i=webphone_api.common.GetParameter2("video_max_height"),a=webphone_api.common.GetParameter2("video_width"),r=webphone_api.common.GetParameter2("video_height"),l=0,p=0,s=0,c=0,u=0,g=0;l=!webphone_api.common.isNull(o)&&o.length>0&&webphone_api.common.IsNumber(o)?webphone_api.common.StrToInt(o):100,p=!webphone_api.common.isNull(n)&&n.length>0&&webphone_api.common.IsNumber(n)?webphone_api.common.StrToInt(n):80,s=!webphone_api.common.isNull(t)&&t.length>0&&webphone_api.common.IsNumber(t)?webphone_api.common.StrToInt(t):1920,c=!webphone_api.common.isNull(i)&&i.length>0&&webphone_api.common.IsNumber(i)?webphone_api.common.StrToInt(i):1080,u=!webphone_api.common.isNull(a)&&a.length>0&&webphone_api.common.IsNumber(a)?webphone_api.common.StrToInt(a):960,g=!webphone_api.common.isNull(r)&&r.length>0&&webphone_api.common.IsNumber(r)?webphone_api.common.StrToInt(r):540,71===webphone_api.common.GetConfigInt("brandid",-1)&&(u>0&&(l=u),g>0&&(p=g)),l>0&&p>0&&s>0&&c>0&&(PutToDebugLog(2,"EVENT, webrtcapi: video minw: "+l+"; minh: "+p+"; maxw: "+s+"; maxh: "+c),e={minWidth:l,minHeight:p,maxWidth:s,maxHeight:c,width:u,height:g})}catch(m){PutToDebugLogException(2,"webrtcapi: GetVideoSizeObj",m)}return e}function GetRegFailReason(){return webphone_api.common.isNull(lastregfailreason)&&(lastregfailreason=""),lastregfailreason}function SetPushNotifications(e,o,n,t){try{if(webphone_api.common.isNull(o)||o.length<3)return void PutToDebugLog(2,"ERROR, webrtcapi SetPushNotifications invalid TOKEN: "+o);webphone_api.common.isNull(n)&&(n=""),webphone_api.common.isNull(t)&&(t="");var i="X-MPUSH: w:"+webphone_api.common.GetFCMPackageName()+":"+o,a=webphone_api.common.GetSipusername()+":"+webphone_api.global.mRealm+":"+webphone_api.common.GetParameter("password"),r="X-PIID: "+webphone_api.common.Md5Hash(a);SetSipHeader(0,i),SetSipHeader(0,r),webphone_api.global.phonestarted>2&&ResendRegister()}catch(l){PutToDebugLogException(2,"webrtcapi: SetPushNotifications",l)}}function PlaySound(e,o,n,t){try{return!webphone_api.common.isNull(ps_audio)&&ps_audio.pause&&ps_audio.pause(),ps_audio=null,1==e&&!webphone_api.common.isNull(o)&&o.length>0&&(ps_audio=new Audio(o),!0===n&&ps_audio.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),ps_audio.play()),!0}catch(i){PutToDebugLogException(2,"webrtcapi: PlaySound",i)}return!1}function LineToCallID(e){try{var o=webphone_api.common.StrToInt(e);if(webphone_api.common.isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return"";for(var n=0;n<webphone_api.global.ep.length;n++){var t=webphone_api.global.ep[n];if(!(webphone_api.common.isNull(t)||t.length<9)&&t[webphone_api.common.EP_LINE]==o)return t[webphone_api.common.EP_CALLID]}}catch(i){PutToDebugLogException(2,"webrtcapi: LineToCallID",i)}return""}function CallIDToLine(e){try{if(e=e.toString(),e.length<1)return-10;if(webphone_api.common.isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return"";for(var o=0;o<webphone_api.global.ep.length;o++){var n=webphone_api.global.ep[o];if(!(webphone_api.common.isNull(n)||n.length<9)&&n[webphone_api.common.EP_CALLID]==e)return n[webphone_api.common.EP_LINE]}}catch(t){PutToDebugLogException(2,"webrtcapi: CallIDToLine",t)}return-10}var sTransferNumber,oRingTone,oRingbackTone,oSipStack,oSipSessionRegister,oSipSessionCall,oSipSessionMessage,oSipSessionTransferCall,registerExSipstackArray=[],videoRemote,videoLocal,audioRemote,divVideo,bFullScreen=!1,oNotifICall,bDisableVideo=!1,viewVideoLocal,viewVideoRemote,viewLocalScreencast,oConfigCall,oConfigMessage,oConfigSms,oReadyStateTimer,isregistered=!1,sipheaders=[],callsipheaders=[],mSipuri="",mDisplayname="",changesptoring=2,recheckmediaonconnect=2,lastregfailreason="",C={divKeyPadWidth:220},initcallback=null,wen_namespace="",acc_arr=[],lastrestarttick=0,restartdelay=2e3,restarttimestr="",te2=null,sipstackstarted=!1,redialonfailtimer=null,calltype="",callline=1,destnumber="",last_vid_device="",red_line=null,red_sessioncall=null,red_number=null,red_setuptime=0,red_callid=null,red_headers=null,red_delaytime=6e3,red_s_type="call-audio",lastmuste_mute=null,lastmuste_direction=null,lastmuste_line=null,lastmuste_log=null,publishSession,maxnrofusers=25,pgmaxloop=0,regextimer=null,regex_idx=0,lw_namespace_arr=[],lw_account_arr=[],check_reg_timer=null,reregstarted=!1,rereg_timer=null,rereg_ival=1e4,rereg_action=0,last_event="",lastsession=null,lastsessionid=-1e3,istypeincoming=!1,adev_hack_called=!1,videoElement=null,audioRemoteElement=null,switchas_called=!1,audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[],videocontainer=null,ps_audio=null;return{WebRtcIsSupported:WebRtcIsSupported,Start:Start,RegisterEx:RegisterEx,SipUnRegister:SipUnRegister,SipStop:SipStop,SipCall:SipCall,SipHangup:SipHangup,SipAccept:SipAccept,SipIgnore:SipIgnore,SipSendChat:SipSendChat,Forward:Forward,SipTransfer:SipTransfer,SipTransferEx:SipTransferEx,SipMuteVideo:SipMuteVideo,SipToggleHoldResume:SipToggleHoldResume,SipToggleMute:SipToggleMute,SipSendDTMF:SipSendDTMF,PresenceSet:PresenceSet,PresenceGet:PresenceGet,SetSipHeader:SetSipHeader,GetRegFailReason:GetRegFailReason,SetVolume:SetVolume,GetVolume:GetVolume,GetAudioDeviceList:GetAudioDeviceList,GetAudioDevice:GetAudioDevice,SetAudioDevice:SetAudioDevice,SwitchOffAndroidSpeaker:SwitchOffAndroidSpeaker,PlaySound:PlaySound,LineToCallID:LineToCallID,CallIDToLine:CallIDToLine,GetUDPServerAddress:GetUDPServerAddress,ReStart:ReStart,GetWebrtcStats:GetWebrtcStats,GetAudioVideoInputId:GetAudioVideoInputId,MyCameraPreview:MyCameraPreview,HideVideoPriview:HideVideoPriview,RemoveUnusedAudioElements:RemoveUnusedAudioElements,JsObjecSniffer:JsObjecSniffer,ResendRegister:ResendRegister,StartReRegister:StartReRegister,GetVideoSizeObj:GetVideoSizeObj,SetPushNotifications:SetPushNotifications}}(),webphone_api.plhandler=function(){function e(o,i){try{Fo("Start");var a=webphone_api.common.GetTickCount(),r=a-webphone_api.global.laststarttick;if(webphone_api.global.laststarttick>0&&r<250)return webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start already called"),!1;webphone_api.common.HandleCallerID(),webphone_api.global.laststarttick=a,webphone_api.global.pres_set_at_start=!1,webphone_api.global.pingpong=0,webphone_api.global.ever_received_pong=!1,webphone_api.common.GetCustomMenus(),webphone_api.global.nuiswebpage=null,webphone_api.global.phonestarttick<0&&(webphone_api.global.phonestarttick=webphone_api.common.GetTickCount());var l=webphone_api.common.GetAutostart();if(!1===i&&0===l)return webphone_api.common.PutToDebugLog(3,"EVENT, plhandler autologin disabled because autostart is FALSE"),!1;webphone_api.global.colorizelog=webphone_api.common.GetParameterInt("colorizelog",0),webphone_api.global.authenticated_displayed=!1,webphone_api.global.applet_started=!1,nn=o,webphone_api.global.lastengine_working_ok="",webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, plhandler onstart"),webphone_api.common.PutToDebugLog(1,"STATUS,-1,"+webphone_api.stringres.get("initializing"));var p=webphone_api.common.GetParameter("serveraddress_user");(webphone_api.common.isNull(p)||p.length<2)&&(p=webphone_api.common.GetParameter("serveraddress")),(webphone_api.common.isNull(p)||p.length<2)&&webphone_api.common.PutToDebugLog(2,"EVENT, plhandler start serveraddress not set");var s=!0;if(!1===webphone_api.global.usestorage&&!webphone_api.common.CheckDID(p,!1))if(!webphone_api.common.IsIPAddrress(p)&&p.indexOf(".")>0){var c=webphone_api.common.DomainToIp(p,function(){});if(!(!webphone_api.common.isNull(c)&&c.length>0&&!0===webphone_api.common.IsIPAddrress(c)||""===c))return rn=o,ln=i,void webphone_api.common.DomainToIp(p,function(o){if(!webphone_api.common.isNull(o)&&o.length>0&&!0===webphone_api.common.IsIPAddrress(o)&&!webphone_api.common.CheckDID(o,!1)){s=!1;var n=[];n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push("S"),n.push("e"),n.push("r"),n.push("v"),n.push("e"),n.push("r"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("a"),n.push("l"),n.push("l"),n.push("o"),n.push("w"),n.push("e"),n.push("d"),n.push("_");var t=n.join("");setTimeout(function(){webphone_api.common.PutToDebugLog(1,t+" "+p)},853)}e(rn,ln)});webphone_api.common.CheckDID(c,!0)||(s=!1)}else s=!1;if(!1===s){var u=[];u.push("E"),u.push("R"),u.push("R"),u.push("O"),u.push("R"),u.push(","),u.push("S"),u.push("e"),u.push("r"),u.push("v"),u.push("e"),u.push("r"),u.push(" "),u.push("n"),u.push("o"),u.push("t"),u.push(" "),u.push("a"),u.push("l"),u.push("l"),u.push("o"),u.push("w"),u.push("e"),u.push("d"),u.push("_");var g=u.join("");return setTimeout(function(){webphone_api.common.PutToDebugLog(1,g+" "+p),webphone_api.common.ShowToast(g+" "+p)},851),!1}Zo=!0,webphone_api.common.isNull(Qo)||clearTimeout(Qo),Qo=setTimeout(function(){Zo=!1},2e3),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler onstart reset useengine"),webphone_api.global.useengine="",webphone_api.global.readcallhistoryforrecents=!0,webphone_api.common.IsWindowsSoftphone()?webphone_api.common.SaveParameter("devicetype",webphone_api.common.DEVICE_WIN_SOFTPHONE()):webphone_api.common.SaveParameter("devicetype",webphone_api.common.DEVICE_WEBPHONE());var m=window.location.href;webphone_api.common.isNull(m)&&(m="");var b=m.indexOf("#");if(b>0&&(m=m.substring(0,b)),b=m.indexOf("?"),b>0&&(m=m.substring(0,b)),webphone_api.common.SaveParameter("wphoneappurl",m),!webphone_api.common.Glsp()){tn--;var u=[];u.push("E"),u.push("R"),u.push("R"),u.push("O"),u.push("R"),u.push(","),u.push(" "),u.push("U"),u.push("s"),u.push("a"),u.push("g"),u.push("e"),u.push(" "),u.push("o"),u.push("n"),u.push(" "),u.push("t"),u.push("h"),u.push("i"),u.push("s"),u.push(" "),u.push("o"),u.push("p"),u.push("e"),u.push("r"),u.push("a"),u.push("t"),u.push("i"),u.push("n"),u.push("g"),u.push(" "),u.push("s"),u.push("y"),u.push("s"),u.push("t"),u.push("e"),u.push("m"),u.push(" "),u.push("i"),u.push("s"),u.push(" "),u.push("n"),u.push("o"),u.push("t"),u.push(" "),u.push("p"),u.push("e"),u.push("r"),u.push("m"),u.push("i"),u.push("t"),u.push("t"),u.push("e"),u.push("d"),u.push(" "),u.push("b"),u.push("y"),u.push(" "),u.push("t"),u.push("h"),u.push("i"),u.push("s"),u.push(" "),u.push("l"),u.push("i"),u.push("c"),u.push("e"),u.push("n"),u.push("s"),u.push("e"),u.push("."),u.push(" "),u.push("U"),u.push("p"),u.push("g"),u.push("r"),u.push("a"),u.push("d"),u.push("e"),u.push(" "),u.push("t"),u.push("o"),u.push(" "),u.push("t"),u.push("h"),u.push("e"),u.push(" "),u.push("A"),u.push("d"),u.push("v"),u.push("a"),u.push("n"),u.push("c"),u.push("e"),u.push("d"),u.push(" "),u.push("v"),u.push("e"),u.push("r"),u.push("s"),u.push("i"),u.push("o"),u.push("n"),u.push(" "),u.push("t"),u.push("o"),u.push(" "),u.push("e"),u.push("n"),u.push("a"),u.push("b"),u.push("l"),u.push("e"),u.push(" "),u.push("t"),u.push("h"),u.push("e"),u.push(" "),u.push("w"),u.push("e"),u.push("b"),u.push("p"),u.push("h"),u.push("o"),u.push("n"),u.push("e"),u.push(" "),u.push("o"),u.push("n"),u.push(" "),u.push("s"),u.push("m"),u.push("a"),u.push("r"),u.push("t"),u.push("p"),u.push("h"),u.push("o"),u.push("n"),u.push("e"),u.push("s"),u.push(" "),u.push("a"),u.push("n"),u.push("d"),u.push(" "),u.push("t"),u.push("a"),u.push("b"),u.push("l"),u.push("e"),u.push("t"),u.push("s"),u.push(".");var h=[];h.push("E"),h.push("R"),h.push("R"),h.push("O"),h.push("R");var d=h.join(""),g=u.join("");webphone_api.global.dontclosecurrpopup=!0,setTimeout(function(){webphone_api.global.dontclosecurrpopup=!1},3e4),setTimeout(function(){webphone_api.common.PutToDebugLog(1,g)},2e3),setTimeout(function(){webphone_api.common.AlertDialog(d,g,function(){webphone_api.global.dontclosecurrpopup=!1})},759),an+=10}if(tn<10)return;return webphone_api.common.IsWindowsSoftphone()?(webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start softphone"),t()):(!0===webphone_api.common.IsSDK()?webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start webphone sdk"):webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start webphone app"),n()),!0}catch(_){webphone_api.common.PutToDebugLogException(2,"plhandler: Start",_)}return!1}function o(){try{if(!webphone_api.common.IsMizuServerOrGateway())return void(webphone_api.global.isfirstwsu=!1);if(webphone_api.common.IsLocalServer()){var e=webphone_api.common.GetWebrtcSrvAddr();webphone_api.common.isNull(e)&&(e=""),e=e.toLowerCase(),e=e.replace("ws://",""),e=e.replace("wss://","");var n=e.indexOf("/");if(n>0&&(e=e.substring(0,n)),e.length>0&&!webphone_api.common.IsLanIP(e))return webphone_api.common.PutToDebugLog(2,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+" (4)"),void((!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&console.log("ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+"\n\n"+webphone_api.stringres.get("all_demo_msg")+" (5)"))}var t=webphone_api.common.GetSipusername(),i=webphone_api.common.GetParameter("password");if(webphone_api.common.IsMizuServerOrGateway()){var a=webphone_api.common.GetParameter("serveraddress_user");(webphone_api.common.isNull(a)||a.length<2)&&(a=webphone_api.common.GetParameter("serveraddress"));var r=webphone_api.common.GetParameter("mainconfigs"),l=t+":"+i+":"+a+":"+webphone_api.common.GetWebrtcSrvAddr();if((webphone_api.common.isNull(r)||r.length<1||r!==l)&&(pn=!0),t.length<1&&i.length<1&&sn<25)return sn++,void setTimeout(function(){o()},80);if((webphone_api.common.isNull(t)||t.length<1)&&webphone_api.common.PutToDebugLog(2,"ERROR, will NOT send wsuser, because username is not set: "+t),(webphone_api.common.isNull(i)||i.length<1)&&webphone_api.common.PutToDebugLog(2,"EVENT, CallWsuser password is not set: "+i),cn=webphone_api.common.GetWsuserUrl(t,i),cn.length<3)return webphone_api.common.PutToDebugLog(3,"EVENT, plhandler CallWsuser wsuser not needed"),webphone_api.global.isfirstwsu=!1,pn=!1,void(webphone_api.global.wsuser_succeded=!0);if(webphone_api.global.isfirstwsu)if(webphone_api.common.isNull(r)||r.length<1||r!==l)un=!0;else{var p=webphone_api.common.GetParameter("wsusers"),s=p.split(",");if(!webphone_api.common.isNull(s)&&s.length>0&&t.length>0)for(var c=0;c<s.length;c++)if(!webphone_api.common.isNull(s[c])&&s[c]===t){webphone_api.global.isfirstwsu=!1;break}}sn=0,webphone_api.common.isNull(t)||t.length<2||webphone_api.common.isNull(i)||i.length<2?webphone_api.common.PutToDebugLog(2,"WARNING, common CallWsuserKeepAlive invalid username ("+t+") or invalid password ("+i+")"):webphone_api.common.UriParser(cn,"","","","","webrtccreateuser"),setTimeout(function(){webphone_api.global.webrtcavailable>0&&!1===webphone_api.global.wsuser_succeded&&(t=webphone_api.common.GetSipusername(),i=webphone_api.common.GetParameter("password"),cn=webphone_api.common.GetWsuserUrl(t,i),webphone_api.common.UriParser(cn,"","","","","webrtccreateuser"))},4500)}}catch(u){webphone_api.common.PutToDebugLogException(2,"plhandler: CallWsuser",u)}}function n(){try{webphone_api.common.isNull(gn)||clearInterval(gn),gn=null,gn=setInterval(function(){++mn>100&&(webphone_api.common.PutToDebugLog(2,"WARNING, EngineSelect timeout"),clearInterval(gn),webphone_api.common.PutToDebugLog(2,"WARNING, WaitForEngineSelect not ready, but start anyway"),webphone_api.common.ChooseEngineLogic(function(){t()},!0));var e=webphone_api.common.GetSipusername(),o=!1;if(webphone_api.global.isfirstwsu&&webphone_api.common.CanIUseWebRTC()&&pn){if(bn<10){var n=webphone_api.common.GetParameter("wsusers"),i=n.split(",");if(!webphone_api.common.isNull(i)&&i.length>0)for(var a=0;a<i.length;a++)if(!webphone_api.common.isNull(i[a])&&e.length>0&&i[a]===e){bn=webphone_api.common.GetTickCount();break}}bn>10&&webphone_api.common.GetTickCount()-bn>2500&&(webphone_api.common.PutToDebugLog(4,"EVENT, wsuser can be sent (first time)"),o=!0)}else webphone_api.common.PutToDebugLog(4,"EVENT, wsuser can be sent"),o=!0;if(!1!==o||!webphone_api.common.CanIUseWebRTC()){var r=webphone_api.common.EngineSelect(1,28);r<1||webphone_api.global.webrtcavailable<0?(r<1&&webphone_api.common.PutToDebugLog(2,"EVENT, waiting for EngineSelect ("+mn+")"),webphone_api.global.webrtcavailable<0&&webphone_api.common.PutToDebugLog(2,"EVENT, waiting for WebRTC to load ("+mn+")")):(clearInterval(gn),webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"EVENT, selected engine("+webphone_api.global.engineselectstage+"): "+webphone_api.common.TestEngineToString(webphone_api.common.GetSelectedEngine(),!1)),webphone_api.common.PutToDebugLog(2,"EVENT, recommended engine("+webphone_api.global.engineselectstage+"): "+webphone_api.common.TestEngineToString(webphone_api.common.GetRecommendedEngine(),!1))),setTimeout(function(){webphone_api.common.ChooseEngineLogic(function(){t()},!0)},1e3))}},200)}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: WaitForEngineSelect",e)}}function t(){try{webphone_api.common.IsCurrentEngineWorking(nn),webphone_api.common.CheckEngineFirstStart(nn),webphone_api.common.GatewayFailower(-1,"startUp"),1==webphone_api.common.IsSDK()?(webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler StartUp call HandleSettingsSDK",!1,""),i(function(e){webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler StartUp HandleSettingsSDK FINISHED: "+e,!1,"")})):(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, plhandler StartUp call StartEngine"),a())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: StartUp",e)}return!1}function i(e){try{if(Xo)return webphone_api.common.PutToDebugLog(3,"EVENT, HandleSettingsSDK call StartEngine"),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, HandleSettingsSDK call StartEngine",!1,""),a(),void e("Already called");if(!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLogSpecial(1,"ERROR, HandleSettingsSDK call StartEngine",!0,"");webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler HandleSettingsSDK called",!1,""),webphone_api.common.PutToDebugLog(3,"EVENT, HandleSettingsSDK called");var o=webphone_api.parameters.serveraddress
;!webphone_api.common.isNull(o)&&o.length>1&&(webphone_api.common.SaveParameter("serveraddress",o,!0),webphone_api.common.SaveParameter("serveraddress_user",o,!0),webphone_api.common.SaveParameter("serveraddress_orig",o,!0),webphone_api.common.SaveParameter("iswebrtcuppersrvfromuser","true")),Jo.length<1&&(Jo=webphone_api.common.GetSettFilenameSDK()),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, HandleSettingsSDK settfilename: "+Jo,!1,""),webphone_api.common.PutToDebugLog(3,"EVENT, HandleSettingsSDK settfilename: "+Jo),webphone_api.common.ReadSettingsFile(Jo,function(o){webphone_api.common.PutToDebugLog(5,"EVENT, plhandler GetSettings callback"),o||webphone_api.common.PutToDebugLog(5,"EVENT, plhandler GetSettings ReadSettings no content");var t=webphone_api.parameters.serveraddress;!webphone_api.common.isNull(t)&&t.length>1&&(webphone_api.common.SaveParameter("serveraddress",t,!0),webphone_api.common.SaveParameter("serveraddress_user",t,!0),webphone_api.common.SaveParameter("serveraddress_orig",t,!0)),webphone_api.common.isNull(Yo)||(clearTimeout(Yo),Yo=null),webphone_api.common.SaveSettingsFile(3,Jo,function(o){if(webphone_api.common.PutToDebugLog(3,"EVENT, plhandler: HandleSettingsSDK settings SAVED"),!Xo){Xo=!0;var t=webphone_api.common.GetParameter2("register");(webphone_api.common.isNull(t)||t.length<1)&&(t="0");var i=webphone_api.common.StrToInt(t);if(0===webphone_api.common.GetAutostart())return webphone_api.common.PutToDebugLog(2,"EVENT, autostart is disabled, Start must be called manually"),void e("autostart is disabled");i<1?n():webphone_api.common.GetSipusername().length>0&&webphone_api.common.GetParameter("password").length>0&&n(),webphone_api.common.HandleScurlSetparameters(),webphone_api.common.ParseSipAccounts(),e("finished normally")}Xo=!0})})}catch(t){webphone_api.common.PutToDebugLogSpecial(1,"ERROR, plhandler HandleSettingsSDK",!0,t),webphone_api.common.PutToDebugLogException(2,"plhandler: HandleSettingsSDK",t),e("ERROR,exception")}}function a(){try{if(hn)return;if(!1===dn&&!0===webphone_api.common.IsSDK()&&webphone_api.common.ReadCallhistoryFile(function(e){e||webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: Load call history failed")}),an>190)return;!1===webphone_api.common.IsWindowsSoftphone()&&webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(4,"EVENT, plhandler StartEngine called"),webphone_api.common.PutToDebugLog(2,"EVENT, starting engine...")),webphone_api.common.HideSettings("voicemail","","voicemail",!0)&&webphone_api.common.SaveParameter("voicemail","0"),(webphone_api.common.HideSettings("chat","","chat",!0)||3==webphone_api.common.GetParameterInt("chatsms",0)||0==webphone_api.common.GetParameterInt("textmessaging",-1))&&(webphone_api.global.textmessaging=0);var e=webphone_api.common.GetParameter("serveraddress_user"),o=webphone_api.common.GetSipusername();(webphone_api.common.isNull(o)||o.length<1)&&(o=webphone_api.common.GetSipusername());var t=webphone_api.common.GetParameter("password"),i=webphone_api.common.GetParameter("registerinterval");if(!webphone_api.common.isNull(o)&&o.length>0&&!webphone_api.common.isNull(t)&&t.length>0){webphone_api.common.isNull(e)&&(e=""),(webphone_api.common.isNull(i)||0==webphone_api.common.IsNumber(i))&&(i="3600");var a=webphone_api.common.StrToInt(i),r=!1;if(webphone_api.global.sipaccounts.length<1)r=!0;else for(var p=0;p<webphone_api.global.sipaccounts.length;p++){var s=webphone_api.global.sipaccounts[p];if(!webphone_api.common.isNull(s)&&(s.username===o&&s.password===t&&s.serveraddress===e)){r=s.ismain;break}}var c=webphone_api.common.GetParameter("username"),u=webphone_api.common.GetParameter("displayname"),g=webphone_api.common.GetParameter("proxyaddress"),m=webphone_api.common.GetParameter("realm");webphone_api.common.AddOneAcc(e,o,t,a,!0,r,!0,c,u,g,m)}hn=!0,setTimeout(function(){hn=!1},2e3),nn=null,webphone_api.common.IsWindowsSoftphone()?we("platform","desktop"):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&we("platform","web");var b=webphone_api.common.GetParameter("messagepopup");if(!webphone_api.common.isNull(b)&&b.length>1&&setTimeout(function(){(!0===webphone_api.common.IsSDK()||webphone_api.$(".ui-page-active .ui-popup-active").length<1)&&(webphone_api.common.ShowToast(b),webphone_api.common.SaveParameter("messagepopup",""))},4500),webphone_api.common.IsWindowsSoftphone())return webphone_api.common.PutToDebugLog(2,"EVENT, start engine: windows softphone - NS engine"),webphone_api.webphone.StartWin(),!0;var h=webphone_api.common.GetSelectedEngineName(),d=webphone_api.common.GetRecommendedEngineName();if(webphone_api.common.isNull(h)||h.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler StartUp no selected engine available"),!1;if(!0===webphone_api.global.isfirststart||webphone_api.common.isNull(webphone_api.global.useengine)||webphone_api.global.useengine.length<2)webphone_api.common.PutToDebugLog(2,"EVENT, StartEngine set useengine: "+h),webphone_api.global.useengine=h,webphone_api.global.isfirststart=!1;else{if(webphone_api.common.isNull(d)||d.length<1){var _=webphone_api.common.GetEngine(h);return _.failed=1,webphone_api.common.SetEngine(h,_),webphone_api.common.PutToDebugLog(4,"EVENT, WaitForEngineSelect called_3"),webphone_api.common.EngineSelect(1,29),n(),!1}webphone_api.common.PutToDebugLog(2,"EVENT, StartEngine recommended set useengine: "+d),webphone_api.global.useengine=d}if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&"flash"===webphone_api.common.getuseengine()){var w=window.location.protocol;!webphone_api.common.isNull(w)&&w.length>0&&w.toLowerCase().indexOf("file")>=0&&("0"===webphone_api.common.GetParameter2("enginepriority_java")&&"0"===webphone_api.common.GetParameter2("enginepriority_webrtc")&&"0"===webphone_api.common.GetParameter2("enginepriority_ns")||"flash"===webphone_api.common.getuseengine())&&(webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_flash_local")),console.log(webphone_api.stringres.get("err_flash_local")))}try{webphone_api.onAppStateChangeCb("started")}catch(P){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(started) callback",P)}try{webphone_api.onStartCb()}catch(P){webphone_api.common.PutToDebugLogException(2,"There is an error in onStart() callback",P)}if(webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onstart,"onStart","","","",""),!0===webphone_api.common.UseCustomAutoprov(!1)&&webphone_api.common.GetCustomAutoprov(function(e){webphone_api.common.RecAutoprovCustom(e)}),!1===webphone_api.common.Loa()){var f=[];f.push("E"),f.push("R"),f.push("R"),f.push("O"),f.push("R"),f.push(","),f.push(" "),f.push("o"),f.push("n"),f.push("l"),f.push("y"),f.push(" "),f.push("a"),f.push("n"),f.push("d"),f.push("r"),f.push("o"),f.push("i"),f.push("d");var v=f.join("");setTimeout(function(){webphone_api.common.PutToDebugLog(2,v)},1214),setTimeout(function(){l(!1,"a")},6e4)}else l(!1,"b");Eo()}catch(P){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngine",P)}}function r(e){try{(webphone_api.common.isNull(e)||e.length<1)&&(webphone_api.common.PutToDebugLog(2,"ERROR, ParseReceivedParameters invalid parameters: "+e),l(!0,"c")),e=webphone_api.common.Trim(e),e.indexOf("error")>=0&&(webphone_api.common.PutToDebugLog(2,"ERROR, ParseReceivedParameters error received: "+e),l(!0,"d"));var o=e.split(",");if(!webphone_api.common.isNull(o)&&o.length>0)for(var n=0;n<o.length;n++)if(!(webphone_api.common.isNull(o[n])||o[n].length<3||o[n].indexOf("=")<1)){var t=webphone_api.common.Trim(o[n].substring(0,o[n].indexOf("="))),i=webphone_api.common.Trim(o[n].substring(o[n].indexOf("=")+1,o[n].length));!webphone_api.common.isNull(t)&&t.length>0&&!webphone_api.common.isNull(i)&&(t=t.toLowerCase(),webphone_api.common.SaveParameter(t,i))}}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: ParseReceivedParameters",a)}webphone_api.common.PutToDebugLog(2,"EVENT, scurl_setparameters STOP"),ke(),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Start scurl_setparameters START"),webphone_api.start()},1500)}function l(e,o){p(e,o)}function p(e,o){try{if(webphone_api.common.PutToDebugLog(4,"EVENT, start engine delayed "+o),webphone_api.global.startendelayed_wascalled=!0,e&&(webphone_api.global.flagnsreconnect=!0),webphone_api.global.phonestarted>1&&!1===webphone_api.global.enstarteddisplayed){webphone_api.global.enstarteddisplayed=!0;var n="",t=webphone_api.common.getuseengine();n=t===webphone_api.global.ENGINE_JAVA?"jv":t===webphone_api.global.ENGINE_SERVICE?"ns":t===webphone_api.global.ENGINE_WEBRTC?"rtc":t,!1===webphone_api.common.IsWindowsSoftphone()&&webphone_api.common.PutToDebugLog(1,"EVENT,"+webphone_api.stringres.get("status_enginestarted")+" ("+n+")")}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||(webphone_api.common.getuseengine(),webphone_api.global.ENGINE_JAVA),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var i=1e3;1!==webphone_api.common.GetParameterInt("autoaction",0)&&3!==webphone_api.common.GetParameterInt("autoaction",0)||(i=1e4),g(i)}webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_java: "+webphone_api.common.GetCfgPriority("java")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_webrtc: "+webphone_api.common.GetCfgPriority("webrtc")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_ns: "+webphone_api.common.GetCfgPriority("ns")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_flash: "+webphone_api.common.GetCfgPriority("flash")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_app: "+webphone_api.common.GetCfgPriority("app")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_p2p: "+webphone_api.common.GetCfgPriority("p2p")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_accessnum: "+webphone_api.common.GetCfgPriority("accessnum")),webphone_api.common.PutToDebugLog(2,"EVENT, enginepriority_nativedial: "+webphone_api.common.GetCfgPriority("nativedial"))),webphone_api.common.SaveParameter("lastsessionsuccess","1");var n="",t=webphone_api.common.getuseengine();n=t===webphone_api.global.ENGINE_JAVA?"jv":t===webphone_api.global.ENGINE_SERVICE?"ns":t===webphone_api.global.ENGINE_WEBRTC?"rtc":t,!1===webphone_api.common.IsWindowsSoftphone()&&(webphone_api.common.PutToDebugLog(1,"STATUS,-1,"+webphone_api.stringres.get("status_startingengine")+" ("+n+")"),webphone_api.common.PutToDebugLog(3,"EVENT, starting useengine: "+webphone_api.common.getuseengine()));var a=[];if(a.push("E"),a.push("R"),a.push("R"),a.push("O"),a.push("R"),a.push(","),a.push(" "),a.push("T"),a.push("h"),a.push("e"),a.push(" "),a.push("B"),a.push("a"),a.push("s"),a.push("i"),a.push("c"),a.push(" "),a.push("v"),a.push("e"),a.push("r"),a.push("s"),a.push("i"),a.push("o"),a.push("n"),a.push(" "),a.push("o"),a.push("f"),a.push(" "),a.push("W"),a.push("e"),a.push("b"),a.push("p"),a.push("h"),a.push("o"),a.push("n"),a.push("e"),a.push(" "),a.push("d"),a.push("o"),a.push("e"),a.push("s"),a.push(" "),a.push("n"),a.push("o"),a.push("t"),a.push(" "),a.push("s"),a.push("u"),a.push("p"),a.push("p"),a.push("o"),a.push("r"),a.push("t"),a.push(" "),a.push("["),a.push("B"),a.push("R"),a.push("S"),a.push("]"),a.push(" "),a.push("b"),a.push("r"),a.push("o"),a.push("w"),a.push("s"),a.push("e"),a.push("r"),webphone_api.common.Glv()<=0&&"Chrome"===webphone_api.common.GetBrowser()){var r=a.join("");return r=r.replace("[BRS]",webphone_api.common.GetBrowser()),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r)},1500),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r.replace("ERROR","STATUS"))},2500),void setTimeout(function(){webphone_api.common.AlertDialog("",r)},2500)}if(webphone_api.common.Glv()<=0&&!1===webphone_api.common.CanIUseApplet()){var r=a.join("");return r=r.replace("[BRS]",webphone_api.common.GetBrowser()),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r)},1450),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r.replace("ERROR","STATUS"))},2450),void setTimeout(function(){webphone_api.common.AlertDialog("",r)},2450)}var l=webphone_api.common.GetEngine(webphone_api.global.useengine);webphone_api.global.useengineclicked_cache=l.clicked,l.clicked=1,webphone_api.common.SetEngine(webphone_api.global.useengine,l),webphone_api.common.AutodetectDirectWebrtc(),webphone_api.global.lastconfroom="";var p=webphone_api.common.GetParameter("username"),m=webphone_api.common.GetParameter("sipusername"),b="";if(p.indexOf("@")>0?b=p:m.indexOf("@")>0&&(b=m),b.length>0&&webphone_api.common.GetParameterInt("allowsipuriasusername",0)>0){b=b.substring(m.indexOf("@")+1);var h=webphone_api.common.GetParameter2("serveraddress");(webphone_api.common.isNull(h)||h.length<1)&&(h=webphone_api.common.GetParameter2("serveraddress_user")),!webphone_api.common.isNull(h)&&h.length<2&&"YOURSIPDOMAIN.COM"!==h&&"YOURSIPSERVER.COM"!==h&&"SIPSERVER"!==h&&"VOIPSERVER"!==h&&"SERVERADDRESS"!==h&&(webphone_api.common.SaveParameter("serveraddress",b),webphone_api.common.SaveParameter("serveraddress_user",b))}var d=webphone_api.common.GetParameter2("serveraddress");if((webphone_api.common.isNull(d)||d.length<2||"YOURSIPDOMAIN.COM"===d||"YOURSIPSERVER.COM"===d||"SIPSERVER"===d||"VOIPSERVER"===d||"SERVERADDRESS"===d)&&(webphone_api.common.SaveParameter("serveraddress",""),d=webphone_api.common.GetParameter2("serveraddress_user"),webphone_api.common.isNull(d)||d.length<2||"YOURSIPDOMAIN.COM"===d||"YOURSIPSERVER.COM"===d||"SIPSERVER"===d||"VOIPSERVER"===d||"SERVERADDRESS"===d))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("error_noserver")),webphone_api.common.PutToDebugLog(2,"ERROR,"+webphone_api.stringres.get("error_noserver")+"; srv: "+webphone_api.common.GetParameter("serveraddress")+"; srv_user: "+webphone_api.common.GetParameter("serveraddress_user")),webphone_api.common.AlertDialog("ERROR","ERROR,"+webphone_api.stringres.get("error_noserver")),"undefined"!=typeof webphone_api.global.worktimer&&null!==webphone_api.global.worktimer&&clearTimeout(webphone_api.global.worktimer),void(webphone_api.global.worktimer=null);var _=webphone_api.common.GetSipusername(),w=webphone_api.common.GetParameter2("password");if("USERNAME"===_&&"PASSWORD"===w&&("USERNAME"===webphone_api.common.GetParameter("username")&&webphone_api.common.SaveParameter("username",""),"USERNAME"===webphone_api.common.GetParameter("sipusername")&&webphone_api.common.SaveParameter("sipusername",""),webphone_api.common.SaveParameter("password","")),webphone_api.common.StartFCM(webphone_api.common.getuseengine()),"java"===webphone_api.common.getuseengine()){webphone_api.common.ResetWsapisocket("plhandler start java");var f=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_java")),v=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_webrtc")),P=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_ns")),E=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_flash")),T=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_app")),N=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_p2p")),S=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_accessnum")),I=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_nativedial"));return(5===f||f>0&&v<1&&P<1&&E<1&&T<1&&N<1&&S<1&&I<1)&&0===webphone_api.common.IsJavaInstalled()&&webphone_api.common.EngineForcedInstall("java"),webphone_api.common.IsCurrentEngineWorking(nn),webphone_api.common.PutToDebugLog(2,"EVENT, start engine: java"),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),u(),webphone_api.webphone.Start()}if("ns"===webphone_api.common.getuseengine())return 5===webphone_api.common.GetParameterInt("enginepriority_ns",2)&&webphone_api.common.IsServiceInstalled(function(e){!1===e&&(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: StartEngineDelayed, service upgrade: "+webphone_api.common.GetMinServiceVersion().toString()),webphone_api.common.EngineForcedInstall("ns"))},!0),void webphone_api.common.IsServiceInstalled(function(e){if(!0===e){webphone_api.common.PutToDebugLog(2,"EVENT, start engine: service");var o=!1,n=webphone_api.common.GetParameterInt("lnsengine",-1);!1===webphone_api.global.usestorage&&!1===webphone_api.common.Strl(60)&&0===n&&(o=!0,webphone_api.common.SaveParameter("lnsengine","1"));var t=6e3;o&&(webphone_api.common.PutToDebugLog(2,"EVENT, Force NS engine upgrade because release version changed"),webphone_api.common.EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0,t=18e4),setTimeout(function(){webphone_api.common.IsServiceUpToDate()},t),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),u(),webphone_api.webphone.StartService()}else webphone_api.common.isNull(webphone_api.global.worktimer)||clearTimeout(webphone_api.global.worktimer),webphone_api.common.PutToDebugLog(2,"EVENT, start engine: service; NOT starting because it is not installed")},!0);if("webrtc"===webphone_api.common.getuseengine()){var R=0;R=webphone_api.common.GetParameterInt("autoprovisioning",1);var G=fe("serveraddress_user");if(webphone_api.common.isNull(G)&&(G=""),0===R||G.length<1||1===R&&G.indexOf(".")>0)s();else{var O=webphone_api.common.GetParameterInt("lastautoprov",0);O<1?webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e),s()}):(s(),webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e)}))}return}if("flash"===webphone_api.common.getuseengine()){var R=0;R=webphone_api.common.GetParameterInt("autoprovisioning",1);var G=fe("serveraddress_user");if(webphone_api.common.isNull(G)&&(G=""),0===R||G.length<1||1===R&&G.indexOf(".")>0)c();else{var O=webphone_api.common.GetParameterInt("lastautoprov",0);O<1?webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e),c()}):(c(),webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e)}))}return}if("app"===webphone_api.common.getuseengine()){var L=webphone_api.common.GetParameterInt("appengine_startat",2);1===L||2===L&&!1===webphone_api.common.IsSDK()?webphone_api.common.StartAppEngine(!0,"EVENT, start engine: app HandleProtocol, open native app"):(webphone_api.common.PutToDebugLog(2,"EVENT, start engine: skip APP engine start, appengine_startat: "+L+"; isSDK: "+webphone_api.common.IsSDK()),webphone_api.common.PutToDebugLog(1,"EVENT, Ready."))}else webphone_api.common.PutToDebugLog(2,"ERROR, start engine: invalid engine: "+webphone_api.common.getuseengine());setTimeout(function(){webphone_api.global.startendelayed_wascalled=!1},12e3)}catch(C){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngineDelayedEx",C)}}function s(){try{if(wn<0&&(wn=webphone_api.common.GetTickCount()),!1===webphone_api.global.decideusuk_finished&&(webphone_api.common.isNull(_n)||clearTimeout(_n),_n=null,_n=setTimeout(function(){s()},150)),webphone_api.common.isNull(_n)||clearTimeout(_n),_n=null,wn>0&&webphone_api.common.GetTickCount()-wn>6500&&!0===webphone_api.common.GetParameterBool("firststart_webrtc",!0)&&!0===webphone_api.common.CanIUseService()){webphone_api.common.PutToDebugLog(2,"WARNING, StartEngineWebRTC Failover to NS engine, because no response received from Websocket wsload"),webphone_api.common.SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,webphone_api.common.ResetEngineClicked();var e=GetEngine("ns");e.clicked=2,webphone_api.common.SetEngine("ns",e),webphone_api.common.EngineSelect(1,30),webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: offer ns engine because webrtc not received"),webphone_api.common.IsServiceInstalled(function(e){!1===e?webphone_api.common.EngineForcedInstall("ns",webphone_api.stringres.get("serviceengine_msg"),null,function(){webphone_api.startInner()}):webphone_api.startInner()},!0)}wn=-1,webphone_api.common.ResetWsapisocket("plhandler start webrtc");var n=webphone_api.common.GetParameter("password");(webphone_api.common.isNull(n)||n.length<1)&&!1===webphone_api.common.NeedRegister()||o(),!0===webphone_api.common.UseTLSReload()&&webphone_api.common.TLSReload(),webphone_api.common.Ch(),webphone_api.common.PutToDebugLog(2,"EVENT, start engine: webrtc"),webphone_api.common.CheckEngineFirstStart(nn),webphone_api.common.GatewayFailower(-1,"starten");var t=webphone_api.common.GetWebrtcSrvAddr();if(2===webphone_api.common.GetConfigInt("usemizuwebrtcgateway",1)&&(t=""),(webphone_api.common.isNull(t)||t.length<2)&&(t=webphone_api.common.GetWp()),t.indexOf("mfstwebsock")<0){var i=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_java")),a=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_webrtc")),r=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_ns")),l=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_flash")),p=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_app")),c=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_p2p")),g=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_accessnum")),m=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_nativedial"));i<3&&a<3&&r<3&&l<3&&p<3&&c<3&&g<3&&m<3&&(a=3,webphone_api.common.SaveParameter("enginepriority_webrtc",a),webphone_api.common.PutToDebugLog(2,"EVENT,WebRtc engine priority set to higher, because not Mgateway: "+a))}return"Android"===webphone_api.common.GetOs()&&3===webphone_api.common.GetParameterInt("androidspeaker",1)&&setTimeout(function(){webphone_api.webrtcapi.SwitchOffAndroidSpeaker()},500),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),u(),webphone_api.webrtcapi.Start()}catch(b){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngineWebRTC",b)}}function c(){try{return webphone_api.common.PutToDebugLog(2,"EVENT, start engine: flash"),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),u(),webphone_api.flashapi.Start()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngineFlash",e)}}function u(){try{var e=webphone_api.common.GetAutostart();if(!0===webphone_api.common.IsSDK()||0!==e)return!1;setTimeout(function(){if("page_settings"===webphone_api.$.mobile.activePage.attr("id")){webphone_api.common.PutToDebugLog(2,"EVENT, plhandler LoginSkin exec");var e=webphone_api.common.GetSipusername(),o=webphone_api.common.GetParameter("password");return!webphone_api.common.isNull(e)&&e.length>0&&!webphone_api.common.isNull(o)&&o.length>0?(webphone_api.global.laststarttick=webphone_api.common.GetTickCount()+100,void(webphone_api.common.isNull(webphone_api._settings)||webphone_api._settings.SaveSettings())):void 0}},600)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: LoginSkin",o)}}function g(e,o){try{if(fn>0&&webphone_api.common.GetTickCount()-fn<3e3)return;fn=webphone_api.common.GetTickCount(),(webphone_api.common.isNull(e)||!1===webphone_api.common.IsNumber(e)||e<0)&&(e=2e3);var n=200;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(n=150),webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu called delay: "+e+"; delayaddition: "+n),!0===o)return setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 0"),webphone_api.getdevicelist(0,function(e){}),webphone_api.getdevice(0,function(e){})},e),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 1"),webphone_api.getdevicelist(1,function(e){}),webphone_api.getdevice(1,function(e){})},e+150),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 2"),webphone_api.getdevicelist(2,function(e){}),webphone_api.getdevice(2,function(e){})},e+300),void webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu return forced");(webphone_api.common.isNull(webphone_api.global.audio_rec_device_list)||webphone_api.global.audio_rec_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist mic"),webphone_api.getdevicelist(0,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec mic 1")}),webphone_api.getdevice(0,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec mic 2")})},e+n),(webphone_api.common.isNull(webphone_api.global.audio_play_device_list)||webphone_api.global.audio_play_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist play"),webphone_api.getdevicelist(1,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec play 1")}),webphone_api.getdevice(1,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec play 2")})},e+2*n),(webphone_api.common.isNull(webphone_api.global.audio_ring_device_list)||webphone_api.global.audio_ring_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist ring"),webphone_api.getdevicelist(2,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec ring 1")}),webphone_api.getdevice(2,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec ring 2")})},e+3*n),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.common.isNull(webphone_api.global.video_rec_device_list)||webphone_api.global.video_rec_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist video"),webphone_api.getdevicelist(3,function(e){}),webphone_api.getdevice(3,function(e){})},e+4*n),setTimeout(function(){if(webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu START checking audio_rec_device_list: "+webphone_api.global.audio_rec_device_list+"; audio_play_device_list: "+webphone_api.global.audio_play_device_list),!webphone_api.common.isNull(webphone_api.global.audio_rec_device_list)&&webphone_api.global.audio_rec_device_list.length>0&&!webphone_api.common.isNull(webphone_api.global.audio_play_device_list)&&webphone_api.global.audio_play_device_list.length>0){var o=webphone_api.common.GetTickCount()-fn;webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu READY on first try after delay: "+o),webphone_api.global.audio_devices_loaded=!0}else setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 0"),webphone_api.getdevicelist(0,function(e){}),webphone_api.getdevice(0,function(e){})},e+2e4+n),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 1"),webphone_api.getdevicelist(1,function(e){}),webphone_api.getdevice(1,function(e){})},e+2e4+2*n),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 2"),webphone_api.getdevicelist(2,function(e){}),webphone_api.getdevice(2,function(e){})},e+2e4+3*n),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 3"),webphone_api.getdevicelist(3,function(e){}),webphone_api.getdevice(3,function(e){})},e+2e4+4*n),setTimeout(function(){if(!webphone_api.common.isNull(webphone_api.global.audio_rec_device_list)&&webphone_api.global.audio_rec_device_list.length>0&&!webphone_api.common.isNull(webphone_api.global.audio_play_device_list)&&webphone_api.global.audio_play_device_list.length>0){var e=webphone_api.common.GetTickCount()-fn;webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu READY on second try after delay: "+e),webphone_api.global.audio_devices_loaded=!0}},e+4*n)},e+3*n+500)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetAudioDevicesForMenu",t)}}function m(o){try{Fo("Register");var n=webphone_api.common.GetParameterInt("register",1);if(webphone_api.parameters.register=2,webphone_api.common.SaveParameter("register","2"),webphone_api.common.PutToDebugLog(2,"EVENT, user, register (API_Register) called"),Zo)return void webphone_api.common.PutToDebugLog(3,"EVENT, plhandler register, Start already called");on=!0,webphone_api.common.isNull(en)||clearTimeout(en),en=setTimeout(function(){on=!1},6e3);var t=webphone_api.common.IsConfigChanged();!0===t&&!0===webphone_api.isregistered()||!0===webphone_api.global.pres_unreg_called||0===n||0!=vn&&webphone_api.common.GetTickCount()-vn>12e3&&!webphone_api.isregistered()?(!0===t&&!0===webphone_api.isregistered()?webphone_api.common.PutToDebugLog(5,"EVENT, rst on config changhe"):!0===webphone_api.global.pres_unreg_called?webphone_api.common.PutToDebugLog(5,"EVENT, rst on after unreg"):0===n?webphone_api.common.PutToDebugLog(5,"EVENT, rst on no orig reg"):0!=vn&&webphone_api.common.GetTickCount()-vn>12e3&&!webphone_api.isregistered()?webphone_api.common.PutToDebugLog(5,"EVENT, rst on not registered"):webphone_api.common.PutToDebugLog(5,"EVENT, rst on unknown"),vn=webphone_api.common.GetTickCount(),e(o)):0==vn||on||b()}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: Register",i)}}function b(){try{if(webphone_api.common.PutToDebugLog(3,"EVENT, Reregister ..."),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void(webphone_api.webrtcapi&&webphone_api.webrtcapi.ResendRegister());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_RegisterNoParam",null,-1);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&webphone_api.webphone&&webphone_api.webphone.applethandle)return webphone_api.webphone.ReRegister()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: ReRegister",e)}}function h(e){try{Fo("RegisterEx");var o=25;if(webphone_api.common.Glv()<2&&(o=13),webphone_api.common.isNull(e)||e.length<4)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler RegisterEx no acocunts passed: "+e);if(e=e.toString(),e=webphone_api.common.ReplaceAll(e," ",""),webphone_api.common.isNull(e)||e.length<4)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler RegisterEx no acocunts passed: "+e);if(o<21){var n=[];n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push("R"),n.push("e"),n.push("g"),n.push("i"),n.push("s"),n.push("t"),n.push("e"),n.push("r"),n.push("E"),n.push("x"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("a"),n.push("l"),n.push("l"),n.push("o"),n.push("w"),n.push("e"),n.push("d"),n.push(" "),n.push("b"),n.push("y"),n.push(" "),n.push("l"),n.push("i"),n.push("c"),n.push("e"),n.push("n"),n.push("s"),n.push("e");var t=n.join("");return void setTimeout(function(){webphone_api.common.PutToDebugLog(1,t)},851)}webphone_api.common.SaveParameter("extraregisteraccounts",e),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler RegisterEx: "+e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.RegisterEx(e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH&&webphone_api.common.PutToDebugLog(2,"ERROR, RegisterEx is not supported by flash engine"),
webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_RegisterEx",null,e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.RegisterEx(e)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: RegisterEx",i)}}function d(e,o){try{if(Fo("CheckPresence"),webphone_api.common.isNull(e)||e.length<1)return"";if(webphone_api.global.phonestarted<2)return void Ho("CheckPresence",[e,o]);if(webphone_api.common.PutToDebugLog(2,"EVENT, user, checkpresence (API_CheckPresence), userlist: "+e),o&&"function"==typeof o&&(webphone_api.common.isNull(webphone_api.global.checkpres_callback)&&(webphone_api.global.checkpres_callback=[]),webphone_api.global.checkpres_callback.push(o)),webphone_api.common.PresenceGet2(e),!webphone_api.common.isNull(webphone_api.global.presenceHM)){var n={5:"online",4:"DND",3:"pending",2:"idle",1:"invisible",0:"offline","-1":"not exists"},t="";for(var i in webphone_api.global.presenceHM)webphone_api.common.isNull(i)||i.length<1||webphone_api.common.isNull(webphone_api.global.presenceHM.num)||(t.length>1&&(t+=";"),t=t+i+","+n[t.num[webphone_api.common.PRES_STATUS]]);return webphone_api.common.isNull(t)&&(t=""),t}}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: CheckPresence",a)}return""}function _(e){if(Fo("SetPresenceStatus"),webphone_api.global.phonestarted<2)return void Ho("SetPresenceStatus",[e]);webphone_api.common.PutToDebugLog(2,"EVENT, user, setpresencestatus (API_SetPresenceStatus), status: "+e),webphone_api.common.PresenceSet2(e)}function w(e){Fo("CheckBLF");try{if(webphone_api.common.isNull(e)||e.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler checkblf empty userkist"),!1;if(webphone_api.global.phonestarted<2)return void Ho("CheckBLF",[e]);if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler API_CheckBLF: "+e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(2,"WARNING, BLF is not yet supported on WebRTC"),!1;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, BLF is not yet supported on flash"),!1;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_CheckBLF",null,e),!0;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.CheckBLF(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: CheckBLF",o)}return!1}function f(e){Fo("GetVersionNS");try{if(!e||"function"!=typeof e)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVersionNS: no callback function specified"),"ERROR, no callback function specified";if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler getversionns"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetExeVersion",function(o){webphone_api.common.isNull(o)&&(o=""),o=o.toString(),o=o.replace("OK:",""),o=webphone_api.common.Trim(o),e(o)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var o=webphone_api.webphone.GetVersionNS();o=o.toString(),o=o.replace("OK:",""),o=webphone_api.common.Trim(o),e(o)}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVersionNS",n)}}function v(e){Fo("GetVersionNSNum");try{if(!e||"function"!=typeof e)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVersionNSNum: no callback function specified"),"ERROR, no callback function specified";if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler getversionnsnum"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetExeVersionNumber",function(o){webphone_api.common.isNull(o)&&(o=""),o=o.toString(),o=o.replace("OK:",""),o=webphone_api.common.Trim(o),e(o)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var o=webphone_api.webphone.GetVersionNSNum();webphone_api.common.isNull(o)&&(o=""),o=o.toString(),o=o.replace("OK:",""),o=webphone_api.common.Trim(o),e(o)}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVersionNS",n)}}function P(e){Fo("GetVersionJava");try{if(!e||"function"!=typeof e)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVersionJava: no callback function specified"),"ERROR, no callback function specified";if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler getversionjava"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetExeVersion",function(o){webphone_api.common.isNull(o)&&(o=""),e(o)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return void e(webphone_api.webphone.GetVersionJava())}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVersionJava",o)}}function E(){try{if(Fo("IsEncrypted"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return 3;if(webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.global.useengine!==webphone_api.global.ENGINE_SERVICE&&webphone_api.global.useengine!==webphone_api.global.ENGINE_JAVA)return 0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_IsEncrypted",function(e){!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(webphone_api.global.isencrypted=e)}),0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.IsEncrypted()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: IsEncrypted",e)}return 0}function T(e,o){try{if(Fo("SetSipHeader"),webphone_api.common.isNull(e))return void webphone_api.common.PutToDebugLog(2,"ERROR, SetSipHeader invalid header. A valid SIP header consists of a name/value pair separated by a colon, ex. Headername: Value");if(webphone_api.global.phonestarted<2)return void Ho("SetSipHeader",[e]);webphone_api.common.PutToDebugLog(2,"EVENT, setsipheader: "+e);var n=webphone_api.global.aline;if(!webphone_api.common.isNull(o)&&webphone_api.common.IsNumber(o)&&(n=o),(webphone_api.common.isNull(n)||-3===n)&&(n=-1),e=webphone_api.common.Trim(e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SetSipHeader(n,e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"ERROR, setsipheader is not supported by flash engine");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SetSIPHeader",null,webphone_api.common.GetLineForJavaAPI(o),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SetSipHeader(webphone_api.common.GetLineForJavaAPI(o),e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: SetSipHeader",t)}}function N(e,o){try{if(Fo("GetSipHeaderInternal"),!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetSipHeaderInternal callback is not defined");var n=webphone_api.global.aline;if((webphone_api.common.isNull(n)||-3===n)&&(n=-1),webphone_api.common.isNull(e)||e.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, Invalid header: "+e),void o("ERROR, Invalid header: "+e);if(e=e.toString(),e=e.replace(":",""),webphone_api.global.phonestarted<2)return void Ho("GetSipHeaderInternal",[e,o]);if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: GetSipHeaderInternal: "+e+"; ("+webphone_api.common.getuseengine()+")"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void o(webphone_api.common.GetSipHeaderInternal(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, GetSipHeaderInternal is not supported by flash engine"),void o("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetSipHeaderInternal",function(e){o(e)},webphone_api.common.GetLineForJavaAPI(n,1),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void o(webphone_api.webphone.GetSipHeaderInternal(webphone_api.common.GetLineForJavaAPI(n,1),e,o))}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetSipHeaderInternal",t)}}function S(e,o){try{if(Fo("GetSipHeader"),!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetSipHeader callback is not defined");var n=webphone_api.global.aline;if((webphone_api.common.isNull(n)||-3===n)&&(n=-1),webphone_api.common.isNull(e)||e.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, Invalid header: "+e),void o("ERROR, Invalid header: "+e);if(e=e.toString(),e=e.replace(":",""),webphone_api.global.phonestarted<2)return void Ho("GetSipHeader",[e,o]);if(webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: getsipheader: "+e+"; ("+webphone_api.common.getuseengine()+")"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void o(webphone_api.common.GetSipHeader(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getsipheader is not supported by flash engine"),void o("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetSIPHeader",function(e){o(e)},webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void o(webphone_api.webphone.GetSipHeader(webphone_api.common.GetLineForJavaAPI(),e,o))}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetSipHeader",t)}}function I(e,o,n){try{if(Fo("GetSipMessage"),!n||"function"!=typeof n)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetSipMessage callback is not defined");var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.global.phonestarted<2)return void Ho("GetSipMessage",[e,o,n]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void n(webphone_api.common.GetSipMessage(t,e,o));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, GetSipMessage is not supported by flash engine"),void n("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetSIPMessage",function(e){n(e)},webphone_api.common.GetLineForJavaAPI(),e,o);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void n(webphone_api.webphone.GetSipMessage(webphone_api.common.GetLineForJavaAPI(),e,o))}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: GetSipMessage",i)}}function R(e){try{if(Fo("GetSipMessage"),webphone_api.common.isNull(e)||!webphone_api.common.IsNumber(e))return!1;var o=webphone_api.common.StrToInt(e);if(o<0||o>45)return!1;if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler changetheme to: "+o.toString()),webphone_api.common.SaveParameter("theme",o.toString()),webphone_api.common.SetCurrTheme(),webphone_api.common.IsWindowsSoftphone()){var n=webphone_api.common.AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_theme="+mSettValue;webphone_api.common.WinSoftphoneHttpReq(n,"GET","","",function(e){webphone_api.common.PutToDebugLog(2,"EVENT, plhandler, send theme to softphone response: "+e)})}}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: ChangeTheme",t)}return!1}function G(e){try{if(Fo("GetWorkDir"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetWorkDir callback is not definaed");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(2,"ERROR, getworkdir: only for ns and java"),void e("ERROR, etworkdir: only for ns and java");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getworkdir: only for ns and java"),void e("ERROR, etworkdir: only for ns and java");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetWorkdir",function(o){e(o)});if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetWorkDir())}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetWorkDir",o)}}function O(e){Fo("VideoCall"),!1!==webphone_api.common.Glvd()&&y(e,1)}function L(e,o){try{return Fo("MuteVideo"),!1===webphone_api.global.checkIfCallActive?(webphone_api.common.PutToDebugLog(2,"ERROR, MuteVideo there is no active call at the moment."),!1):!1===webphone_api.global.isvideocall?(webphone_api.common.PutToDebugLog(2,"ERROR, MuteVideo this is not a video call."),!1):webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC?(webphone_api.common.PutToDebugLog(2,"ERROR, MuteVideo this is not WebRTC engine."),!1):(e?webphone_api.common.PutToDebugLog(1,"STATUS, "+webphone_api.stringres.get("muted_video")):webphone_api.common.PutToDebugLog(1,"STATUS, "+webphone_api.stringres.get("unmuted_video")),webphone_api.common.PutToDebugLog(2,"EVENT, USER, mutevideo (API_MuteVideo), "+e+", "+o),webphone_api.webrtcapi.SipMuteVideo(e,o))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: MuteVideo",n)}return!1}function C(e,o){function n(){y(e,2)}try{if(Fo("ScreenShare"),!1===webphone_api.common.Glss())return;webphone_api.common.IsWindowsSoftphone(),n()}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: ScreenShare",t)}}function D(){try{if(!webphone_api.global.usestorage)return;webphone_api.common.isNull(Pn)||(clearTimeout(Pn),Pn=null)}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: Cfin",e)}}function y(e,o){try{Fo("Call"),webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_APP&&!1===webphone_api.global.isappenginestarted&&webphone_api.common.StartAppEngine(!0,"EVENT, start engine: because initiating call",!0,e),Tn=!1;var n=115e3;if((webphone_api.common.isNull(o)||!1===webphone_api.common.IsNumber(o))&&(o=0),webphone_api.common.SvCont()&&(n=23e4),webphone_api.global.usestorage&&(Pn=setTimeout(function(){clearTimeout(Pn),Pn=null;var e=[];e.push("L"),e.push("i"),e.push("c"),e.push("e"),e.push("n"),e.push("s"),e.push("e"),e.push(" "),e.push("o"),e.push("r"),e.push(" "),e.push("d"),e.push("e"),e.push("m"),e.push("o "),e.push("l"),e.push("i"),e.push("m"),e.push("i"),e.push("t"),e.push(". "),e.push("R"),e.push("e"),e.push("s"),e.push("t"),e.push("a"),e.push("r"),e.push("t "),e.push("r"),e.push("e"),e.push("q"),e.push("u"),e.push("i"),e.push("r"),e.push("e"),e.push("d"),e.push(" "),e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("9");var o=e.join("");U(),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+o)},100),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+o),webphone_api.common.ShowToast("ERROR,"+o,15e3)},250)},n)),!webphone_api.common.onc())return!1;var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.IsLineFree(t)||(t=webphone_api.common.GetFreeLine(),ve(t)),webphone_api.common.isNull(e)||webphone_api.common.Trim(e).lengh<1)return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")+": "+e),!1;if(e=webphone_api.common.Trim(e),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler initiate Call with engine: "+webphone_api.global.useengine+", to number: "+e),webphone_api.common.RemoveSipHeadreFromCache("X-reason"),webphone_api.common.RemoveSipHeadreFromCache("Reason"),webphone_api.common.RemoveSipHeadreFromCache("Warning"),"p2p"===webphone_api.common.getuseengine())return void webphone_api.common.Phone2Phone("",e);if("accessnum"===webphone_api.common.getuseengine())var i=webphone_api.common.GetParameter("accessnumber"),a="tel://"+i;else if("nativedial"===webphone_api.common.getuseengine()||"app"===webphone_api.common.getuseengine()){var a="tel://"+encodeURIComponent(e),r='<a href="'+a+'" id="make_native_call" style="display: none;">call</a>';return webphone_api.$("body").append(r),webphone_api.$("#make_native_call").on("click",function(){var e=webphone_api.$("#make_native_call").attr("href");webphone_api.$("#make_native_call").remove(),window.location=e}),webphone_api.$("#make_native_call").click(),void webphone_api.common.ShowToast(webphone_api.stringres.get("native_call"))}var l=!1;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.GetNrOfActiveCalls()>0&&"Firefox"===webphone_api.common.GetBrowser()&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0)for(var p=0;p<webphone_api.global.ep.length;p++)if(!webphone_api.common.isNull(webphone_api.global.ep[p])&&"true"==webphone_api.global.ep[p][webphone_api.common.EP_HOLDSTATE]){var s=webphone_api.global.ep[p][webphone_api.common.EP_LINE];webphone_api.mysetline(s),webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mainlogic resume call from pl and mute because webrtc multiline call; peer: "+webphone_api.global.ep[p][webphone_api.common.EP_DESTNR]+" on line: "+s),webphone_api.hold(!1),webphone_api.mute(!0),l=!0}l?setTimeout(function(){webphone_api.mysetline(t),x(t,e,o)},150):x(t,e,o)}catch(c){webphone_api.common.PutToDebugLogException(2,"plhandler: Call",c)}return!1}function x(o,n,t){try{webphone_api.common.isNull(En)||clearTimeout(En),En=null,webphone_api.global.phonestarted<1&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_APP&&(webphone_api.global.phonestarted=1,e(webphone_api.parameters));var i=webphone_api.common.NeedRegister(),a=webphone_api.common.GetTickCount();if(Nn<1&&(Nn=a),!0===webphone_api.common.GetParameterBool("mustconnect",!1)&&webphone_api.global.phonestarted<3)return webphone_api.common.PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("warning_notreg")),void webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notreg"));if(i&&webphone_api.global.phonestarted<3&&a-Nn<4e3||webphone_api.global.phonestarted<2){var r=webphone_api.common.GetParameterInt("register",1);return r>1&&!1===Tn&&a-Nn>3500&&(Tn=!0,!1===i?(webphone_api.common.PutToDebugLog(2,"WARNING, Cannot initiate call because SipStack is not started: "),webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notstarted"))):(webphone_api.common.PutToDebugLog(2,"WARNING, "+webphone_api.stringres.get("warning_notreg")),2===r&&webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notreg")))),void(En=setTimeout(function(){x(o,n,t)},250))}var l="audio";1===t&&(l="video"),2===t&&(l="screenshare"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Call ("+webphone_api.global.useengine+"), to: "+n+", on line: "+o.toString()+", type: "+l),Tn=!1,Nn=0,0==webphone_api.common.IsSDK()&&(webphone_api.global.intentcall[0]="number="+n,webphone_api.global.intentcall[1]="calltype=outgoing",webphone_api.global.intentcall[2]="name=",webphone_api.global.intentcall[3]="callmode="+t,setTimeout(function(){webphone_api.$.mobile.changePage("#page_call",{transition:"pop",role:"page"})},10)),!0===webphone_api.global.isfirstcall&&"Android"===webphone_api.common.GetOs()&&1===webphone_api.common.GetParameterInt("androidspeaker",1)&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?(webphone_api.common.PutToDebugLog(2,"EVENT, call handle SwitchOffAndroidSpeaker"),webphone_api.webrtcapi.SwitchOffAndroidSpeaker(function(){webphone_api.common.PutToDebugLog(2,"EVENT, call SwitchOffAndroidSpeaker handled"),A(o,n,t)})):A(o,n,t)}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: CallDelayed",p)}}function A(e,o,n){try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.global.stacknotstarted_retry=!0,setTimeout(function(){return 0===n?webphone_api.webrtcapi.SipCall("call-audio",e,o):1===n?(webphone_api.global.isvideocall=!0,webphone_api.webrtcapi.SipCall("call-audiovideo",e,o)):2===n?(webphone_api.isscreensharecall=!0,webphone_api.webrtcapi.SipCall("call-screenshare",e,o)):webphone_api.webrtcapi.SipCall("call-audio",e,o)},100),!0;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Call(o);if(!0===webphone_api.common.IsWindowsSoftphone())return 0===n?void webphone_api.common.WinAPI("API_Call",null,webphone_api.common.GetLineForJavaAPI(e),o):1===n?(webphone_api.global.isvideocall=!0,void webphone_api.common.WinAPI("API_SoftphoneVideoCall",null,o)):2===n?(webphone_api.isscreensharecall=!0,void webphone_api.common.WinAPI("API_SoftphoneScreenshare",null,o)):void webphone_api.common.WinAPI("API_Call",null,webphone_api.common.GetLineForJavaAPI(e),o);if(n>0&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE&&!0===webphone_api.common.CanIUseWebRTC())return webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_WEBRTC),void setTimeout(function(){x(e,o,n)},3e3);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Call",null,webphone_api.common.GetLineForJavaAPI(e),o);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Call(webphone_api.common.GetLineForJavaAPI(e),o)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: CallDelayedSecond",t)}}function k(){try{Fo("StopScreenShare");var e=webphone_api.global.aline;(webphone_api.common.isNull(e)||-3===e)&&(e=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, stopscreenshare (API_StopScreenShare) ("+webphone_api.global.useengine+") on line: "+e.toString());var o=webphone_api.common.GetCallSession(!0,e,"");if(webphone_api.common.isNull(o)&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1),setTimeout(function(){webphone_api.common.GetEndpoint(e,"","",!0)},400),setTimeout(function(){if(webphone_api.common.GetNrOfActiveCalls()>0){ve(webphone_api.common.GetBestLine()),!1!==webphone_api.common.IsSDK()||!0!==webphone_api.global.isCallStarted||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons()}},350),-2===e&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0){for(var n=0;n<webphone_api.global.ep.length;n++){var t=webphone_api.global.ep[n][webphone_api.common.EP_LINE];webphone_api.common.isNull(t)||!0!==webphone_api.common.IsNumber(t)||V(webphone_api.common.StrToInt(t))}return!0}return V(e)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: StopScreenShare",i)}return!1}function U(e){try{Fo("Hangup");var o=-10;o=!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)?webphone_api.common.StrToInt(e):webphone_api.global.aline,(webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, hangup (API_Hangup) ("+webphone_api.global.useengine+") on line: "+o.toString()),webphone_api.common.GetNrOfActiveCalls()<2&&(webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout",3e3));var n=webphone_api.common.GetCallSession(!0,o,"");if(webphone_api.common.isNull(n)&&webphone_api.common.GetNrOfActiveCalls()<2&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1),setTimeout(function(){webphone_api.common.GetEndpoint(o,"","",!0)},400),setTimeout(function(){if(webphone_api.common.GetNrOfActiveCalls()>0){ve(webphone_api.common.GetBestLine()),!1!==webphone_api.common.IsSDK()||!0!==webphone_api.global.isCallStarted||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons()}},350),-2===o&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0){if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())V(-2,-2);else for(var t=0;t<webphone_api.global.ep.length;t++){var i=webphone_api.global.ep[t][webphone_api.common.EP_LINE];webphone_api.common.isNull(i)||!0!==webphone_api.common.IsNumber(i)||(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?function(){var e=350*t+1,o=i;setTimeout(function(){V(webphone_api.common.StrToInt(o))},e)}():V(webphone_api.common.StrToInt(i)))}return!0}return V(o,e)}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: Hangup",a)}return!1}function V(e,o){try{Fo("HangupLine"),webphone_api.common.PutToDebugLog(3,"EVENT, hangupline: "+e.toString());try{"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_BUTTON")}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: HangupLine inner AndroidWebphoneJsInterface",n)}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipHangup(!1,e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Hangup();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Hangup",null,webphone_api.common.GetLineForJavaAPI(o));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Hangup(webphone_api.common.GetLineForJavaAPI(o))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: HangupLine",n)}return!1}function W(e){try{Fo("Accept");var o=-10;if(o=!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)?webphone_api.common.StrToInt(e):webphone_api.global.aline,(webphone_api.common.isNull(o)||-3===o)&&(o=-2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, accept (API_Accept) ("+webphone_api.global.useengine+") on line: "+o.toString()),webphone_api.global.active_incoming_call=!1,!0===webphone_api.common.CanUseIncomingCallNot()&&webphone_api.common.RequestBrowserNotificationPermission(function(){},"","",""),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return!1===webphone_api.global.webrtcpermissionaccepted&&(webphone_api.common.PutToDebugLog(2,"ERROR, call accepted, but permission not yet accepted"),webphone_api.common.AlertDialog(webphone_api.stringres.get("request_permission2_title"),webphone_api.common.ReplaceAll(webphone_api.stringres.get("request_permission2"),"[BRANDNAME]",webphone_api.common.GetBrandName()))),webphone_api.webrtcapi.SipAccept(o);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Accept();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_Accept",null,webphone_api.common.GetLineForJavaAPI(e)),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Accept(webphone_api.common.GetLineForJavaAPI(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Accept",n)}return!1}function M(e){try{Fo("Reject");var o=-10;if(o=!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)?webphone_api.common.StrToInt(e):webphone_api.global.aline,(webphone_api.common.isNull(o)||-3===o)&&(o=-2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, reject (API_Reject) ("+webphone_api.global.useengine+") on line: "+o.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipHangup(!0,o);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Hangup();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Reject",null,webphone_api.common.GetLineForJavaAPI(e));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Reject(webphone_api.common.GetLineForJavaAPI(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Reject",n)}return!1}function F(){try{Fo("Ignore");var e=webphone_api.global.aline;(webphone_api.common.isNull(e)||-3===e)&&(e=-2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, ignore (API_Ignore) ("+webphone_api.global.useengine+") on line: "+e.toString());try{!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||"page_call"!==webphone_api.$.mobile.activePage.attr("id")||webphone_api._call.CloseCall()}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: Ignore inner",o)}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipIgnore();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Ignore",null,webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Ignore(webphone_api.common.GetLineForJavaAPI())}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Ignore",n)}return!1}function H(e,o,n){var t=0;try{!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(t=webphone_api.common.StrToInt(e));var i=0,a=0;!webphone_api.common.isNull(o)&&webphone_api.common.IsNumber(o)&&(i=webphone_api.common.StrToInt(o)),!webphone_api.common.isNull(n)&&webphone_api.common.IsNumber(n)&&(a=webphone_api.common.StrToInt(n)),i>0&&(1===t?(webphone_api.common.PutToDebugLog(5,"EVENT, USER SetVideoSize remote width: "+o+"; height: "+n),webphone_api.$("#div_video_remote").width(i),a>0&&webphone_api.$("#div_video_remote").height(a)):2===t&&(webphone_api.common.PutToDebugLog(5,"EVENT, USER SetVideoSize local width: "+o+"; height: "+n),webphone_api.$("#div_video_remote").width(i),a>0&&webphone_api.$(".previewvideo").height(a)))}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: SetVideoSize",r)}}function B(){try{Fo("GetAvailableCallfunc")
;var e="conference,transfer,mute,hold,chat";return webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?e="transfer,chat":webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH&&(e="transfer,chat"),e}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetAvailableCallfunc",o)}return""}function $(e){try{if(Fo("Forward"),!1===webphone_api.common.Glt())return;var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, forward (API_Forward), "+e+" on line: "+o.toString()),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(e=webphone_api.common.Trim(e),!0===webphone_api.common.GetParameterBool("isfirstcallfwd",!0)&&(webphone_api.common.SaveParameter("isfirstcallfwd","false"),(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&webphone_api.common.ShowToast("Call forward will work only if the remote peer has support for it.",6e3)),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.Forward(e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Forward",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Forward(webphone_api.common.GetLineForJavaAPI(),e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Forward",n)}return!1}function j(){webphone_api.common.isNull(Sn)||clearInterval(Sn),Sn=null,In=0}function q(e,o){try{if(Fo("Conference"),!1===webphone_api.common.Glcf())return!1;if(webphone_api.common.isNull(e)&&(e=""),e.length>0&&(webphone_api.global.lastcontarget=e),!webphone_api.global.checkIfInCall&&e.length>0)return y(e);var n=webphone_api.common.GetParameterInt("conferencetype",1);if(0===n)return webphone_api.common.PutToDebugLog(1,"ERROR, conference is disabled"),!1;if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, conference (API_Conf) ("+webphone_api.global.useengine+"), "+e),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(webphone_api.common.isNull(o)&&(o=!0,webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference add is NULL, used as true")),e=webphone_api.common.Trim(e),!0===webphone_api.global.active_incoming_call&&(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Accept Conf"),webphone_api.accept()),!0===o&&webphone_api.common.GetParameterInt("multilinegui",0)<1){if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.global.isconfcall=!0,webphone_api.common.WinAPI("API_Conf",null,e),!1;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.global.isconfcall=!0,webphone_api.webphone.Conference(e)}else{if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.global.isconfcall=!0,webphone_api.common.WinAPI("API_ConfEx",null,webphone_api.common.GetLineForJavaAPI(),e,o);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.global.isconfcall=!0,webphone_api.webphone.ConferenceEx(webphone_api.common.GetLineForJavaAPI(),e,o)}var t=webphone_api.common.GetSipHeaderInternal("X-UT");if(webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&e.length>0){var i=!1,a=!1;if(2!=n&&4!=n&&("g"===t||"s"===t||webphone_api.common.IsMizuServerOrGateway())){for(var r=!0,l=0;l<e.length;l++)if(!(e.charAt(l)>="0"&&e.charAt(l)<="9"||e.charAt(l)>="A"&&e.charAt(l)<="D"||"*"==e.charAt(l)||"#"==e.charAt(l))){r=!1;break}if(o&&(1===n||n>=5)){a=!0,r&&"g"===t&&(webphone_api.global.confcanfailover=!0);var p=webphone_api.common.CreateConferenceRoom(!1,e);webphone_api.common.isNull(p)||p.length<3?webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference webrtc invalid URL: "+p):(webphone_api.common.UriParser(p,"","","","","getconferenceroom"),webphone_api.common.PutToDebugLog(1,"EVENT,conference created"),webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)&&(webphone_api.global.waiting_conf_numbers=""),webphone_api.global.waiting_conf_numbers.length>0&&(webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+","),webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+e,i=!0)}if(!i&&n<5&&("g"===t||"s"===t)&&r&&(!0===o?!1===webphone_api.global.checkIfInCall||(webphone_api.common.PutToDebugLog(2,"EVENT, Add to DTMF conference: "+e),webphone_api.dtmf("*1*"+e+"#")):webphone_api.dtmf("*6*"+e+"#"),i=!0),!i&&!a&&o){r&&"g"===t&&(webphone_api.global.confcanfailover=!0);var p=webphone_api.common.CreateConferenceRoom(!1,e);webphone_api.common.isNull(p)||p.length<3?webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference webrtc invalid URL: "+p):(webphone_api.common.UriParser(p,"","","","","getconferenceroom"),webphone_api.common.PutToDebugLog(1,"EVENT,conference created"),webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)&&(webphone_api.global.waiting_conf_numbers=""),webphone_api.global.waiting_conf_numbers.length>0&&(webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+","),webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+e,i=!0)}}if(!i&&o&&e.length>0&&!0===webphone_api.common.CanIUseApplet()&&(r&&(webphone_api.global.confcanfailover=!1),webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_JAVA),i=!0),!i&&o&&!0===webphone_api.common.CanIUseService()&&(r&&(webphone_api.global.confcanfailover=!1),webphone_api.common.IsServiceInstalled(function(o){try{i=!0,!0===o?(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because Conference engine switch to NS(1)"),webphone_api.hangup(),!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api.common.PutToDebugLog(4,"EVENT, Close call page because Conference engine switch to NS(1)"),webphone_api._call.CloseCall()),webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_SERVICE),webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("switch_conf")),webphone_api.common.ShowToast(webphone_api.stringres.get("switch_conf")),setTimeout(function(){if(!webphone_api.common.isNull(Sn))return j(),!0;var o=!1,n=0;Sn=setInterval(function(){return++In>50?(j(),!0):(n<1&&!1===o&&!0===webphone_api.isregistered()&&(n=webphone_api.common.GetTickCount()),n>0&&webphone_api.common.GetTickCount()-n>1e3&&!1===o&&(o=!0,webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Call Conf switch: "+currcallnumber),webphone_api.call(webphone_api.global.currcallnumber)),!0===webphone_api.global.checkIfInCall?(webphone_api.global.isconfcall=!0,webphone_api.common.WinAPI("API_Conf",null,e),j(),!0):void 0)},500)},4e3)):(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because Conference engine switch to NS(2)"),webphone_api.hangup(),!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api.common.PutToDebugLog(4,"EVENT, Close call page because Conference engine switch to NS(2)"),webphone_api._call.CloseCall()),setTimeout(function(){webphone_api.common.AlertDialog(webphone_api.stringres.get("switch_conf_title"),webphone_api.stringres.get("switch_confmessage"),function(e){if(!0===e){var o=webphone_api.common.GetNPLocation();!webphone_api.common.isNull(o)&&o.length>0&&window.open(o),setTimeout(function(){return webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_SERVICE),!0},1e3)}},webphone_api.stringres.get("btn_ok"))},500))}catch(n){i=!1,webphone_api.common.PutToDebugLogException(2,"plhandler: Conference InnerService",n)}},!0)),!i&&!a&&o&&("g"===t||"s"===t||webphone_api.common.IsMizuServerOrGateway())){r&&(webphone_api.global.confcanfailover=!1);var p=webphone_api.common.CreateConferenceRoom(!1,e);webphone_api.common.isNull(p)||p.length<3?webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference webrtc invalid URL: "+p):(webphone_api.common.UriParser(p,"","","","","getconferenceroom"),webphone_api.common.PutToDebugLog(1,"EVENT,conference created"),webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)&&(webphone_api.global.waiting_conf_numbers=""),webphone_api.global.waiting_conf_numbers.length>0&&(webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+","),webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+e,i=!0)}return i||(r&&(webphone_api.global.confcanfailover=!1),o?e.length>0?webphone_api.common.PutToDebugLog(1,"ERROR, Conference not available in this environment"):webphone_api.common.PutToDebugLog(1,"ERROR, No target number for conference"):webphone_api.common.PutToDebugLog(1,"EVENT, conference stop skipped")),i}}catch(s){webphone_api.common.PutToDebugLogException(2,"plhandler: Conference",s)}return!1}function z(e){try{if(Fo("Transfer"),!1===webphone_api.common.Glt())return;var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, transfer (API_Transfer), "+e+" on line: "+o.toString()),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(e=webphone_api.common.Trim(e),webphone_api.global.last_transfer_tick=webphone_api.common.GetTickCount(),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipTransferEx(e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Transfer(e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Transfer",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Transfer(webphone_api.common.GetLineForJavaAPI(),e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Transfer",n)}return!1}function K(e){try{Fo("Dtmf");var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, dtmf (API_Dtmf), "+e+" on line: "+o.toString()),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(e=webphone_api.common.Trim(e),webphone_api.common.PlayDtmfSound(e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(1,"EVENT,Send DTMF "+e),webphone_api.webrtcapi.SipSendDTMF(e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(1,"EVENT,Send DTMF "+e),webphone_api.flashapi.SendDTMF(e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Dtmf",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Dtmf(o,e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Dtmf",n)}return!1}function J(e,o){try{Fo("MuteEx");var n=[];n.push("h"),n.push("a"),n.push("s"),n.push("m"),n.push("u"),n.push("t"),n.push("e");var t=n.join("");if(!1===webphone_api.common.GetParameterBool(t,!0)){var i="N";return i+="o",i+=" ",webphone_api.common.PutToDebugLog(2,"WARNING, "+i+t),!1}var a=webphone_api.global.aline;(webphone_api.common.isNull(a)||-3===a)&&(a=-1);var r=webphone_api.common.ParamAsBool(e),l=webphone_api.common.GetParameterInt("muteholdalllines",0);if(!0===webphone_api.global.isconfcall&&l>1&&(a=-2,webphone_api.global.aline=-2,webphone_api.global.lastalineset=-2,webphone_api.global.lastalinesettick=webphone_api.common.GetTickCount()),(webphone_api.common.isNull(o)||o.length<1)&&(o=webphone_api.common.GetParameterInt("defmute",2)),5===(o=webphone_api.common.StrToIntDef(o,0)))return webphone_api.common.PutToDebugLog(2,"WARNING, USER, mute (API_MutEx), "+r+", "+o+" on line: "+a.toString()+" Mute is disabled!"),!1;if(3!==o&&4!==o||(o=0),r?webphone_api.common.PutToDebugLog(1,"STATUS,"+a.toString()+","+webphone_api.stringres.get("muted")):webphone_api.common.PutToDebugLog(1,"STATUS,"+a.toString()+","+webphone_api.stringres.get("unmuted")),webphone_api.common.SetMuteState(a,r),webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_MutEx, "+r+", "+o+" on line: "+a.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipToggleMute(r,o);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_MuteEx",null,webphone_api.common.GetLineForJavaAPI(),r,o),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.MuteEx(webphone_api.common.GetLineForJavaAPI(),r,o)}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: MuteEx",p)}return!1}function X(){try{Fo("IsMuted");var e=webphone_api.global.aline;return(webphone_api.common.isNull(e)||-3===e)&&(e=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, ismuted (API_IsMuted) on line: "+e.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.webphone.IsMuted(e):webphone_api.common.GetMuteState(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: IsMuted",o)}return!1}function Y(e,o){try{Fo("Hold");var n=[];n.push("h"),n.push("a"),n.push("s"),n.push("h"),n.push("o"),n.push("l"),n.push("d");var t=n.join("");if(!1===webphone_api.common.GetParameterBool(t,!0)){var i="N";return i+="o",i+=" ",webphone_api.common.PutToDebugLog(2,"WARNING, "+i+t),!1}var a=-10;a=!webphone_api.common.isNull(o)&&webphone_api.common.IsNumber(o)?webphone_api.common.StrToInt(o):webphone_api.global.aline,(webphone_api.common.isNull(a)||-3===a)&&(a=-1);var r=webphone_api.common.ParamAsBool(e),l=webphone_api.common.GetParameterInt("muteholdalllines",0);!0===webphone_api.global.isconfcall&&l>1&&(a=-2,webphone_api.global.aline=-2,webphone_api.global.lastalineset=-2,webphone_api.global.lastalinesettick=webphone_api.common.GetTickCount());var p=webphone_api.common.GetHoldState(a);webphone_api.common.SetHoldState(a,r);var s=webphone_api.common.ParamAsInt(webphone_api.common.GetParameter2("fasthold"),-1);if(1===s)return webphone_api.common.PutToDebugLog(2,"EVENT, fasthold: "+r),J(r,0);if(-1===s&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&"Firefox"===webphone_api.common.GetBrowser())return webphone_api.common.PutToDebugLog(2,"EVENT, fasthold firefox: "+r),J(r,0);if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, hold (API_Hold), "+r+" on line: "+a.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){if(r===p)return!0===r?webphone_api.common.PutToDebugLog(2,"WARNING, USER, hold (API_Hold), skip putting call on hold, because it is already on hold"):webphone_api.common.PutToDebugLog(2,"WARNING, USER, hold (API_Hold), skip reloading call , because it is not on hold"),!1;var c=webphone_api.common.GetParameterInt("holdtype",-1);if(-2===c||0===c)return webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold ignored because holdtype is: "+c.toString()),!1;if(webphone_api.common.GetNrOfActiveCalls()>1&&"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.common.GetParameterInt("multilineoop",0)<2&&(webphone_api.global.usemutemutiline=!0),webphone_api.common.GetNrOfActiveCalls()>1&&webphone_api.common.GetParameterInt("multilineoop",0)<1){webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mute instead because multiline call ("+webphone_api.common.GetNrOfActiveCalls()+")");var u=webphone_api.common.GetParameterInt("defmute",0);return webphone_api.mute(r,u,-1)}return Q(r,a),!0}if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_Hold",null,webphone_api.common.GetLineForJavaAPI(),r),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Hold(webphone_api.common.GetLineForJavaAPI(),r)}catch(g){webphone_api.common.PutToDebugLogException(2,"plhandler: Hold",g)}return!1}function Q(e,o){function n(){webphone_api.common.isNull(Gn)||clearInterval(Gn),Gn=null}try{var t=webphone_api.common.GetTickCount();Rn>0&&t-Rn<1e3?(webphone_api.common.isNull(On)&&(On=[]),webphone_api.common.isNull(Ln)&&(Ln=[]),On.push(e),Ln.push(o),n(),Gn=setInterval(function(){if(webphone_api.common.isNull(On)&&(On=[]),webphone_api.common.isNull(Ln)&&(Ln=[]),On.length<1&&n(),webphone_api.common.GetTickCount()-Rn>950){Rn=webphone_api.common.GetTickCount();var e=On.shift(),o=Ln.shift();webphone_api.common.PutToDebugLog(2,"EVENT, execute API_Hold delayed on line: "+o.toString()+"; state: "+e),webphone_api.webrtcapi.SipToggleHoldResume(e,o)}},100)):webphone_api.webrtcapi.SipToggleHoldResume(e,o),Rn=t}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: HoldDelayedWebrtc",i)}}function Z(){try{Fo("IsOnHold");var e=webphone_api.global.aline;return(webphone_api.common.isNull(e)||-3===e)&&(e=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, isonhold (API_IsOnHold) on line: "+e.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.webphone.IsOnHold(e):webphone_api.common.GetHoldState(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: IsOnHold",o)}return!1}function ee(e,o,n,t){try{if(Fo("SendChat"),!webphone_api.common.isNull(e)&&e.indexOf(",")>0){webphone_api.common.isNull(n)&&(n="");var i=e.split(","),a=n.split("|");if(webphone_api.common.isNull(n)||n.length<1||webphone_api.common.isNull(a)||a.length<i.length){n="";for(var r=0;r<i.length;r++)webphone_api.common.isNull(i[r])||webphone_api.common.Trim(i[r]).length<1||(n.length>0&&(n+="|"),n+=webphone_api.common.Trim(i[r]))}for(var r=0;r<i.length;r++)webphone_api.common.isNull(i[r])||webphone_api.common.Trim(i[r]).length<1||oe(i[r],o,n,t)}else oe(e,o,t)}catch(l){webphone_api.common.PutToDebugLogException(2,"SendChatProcesser: IsOnHold",l)}}function oe(o,n,t,i){try{Fo("SendChatAction");var a=webphone_api.global.aline;if((webphone_api.common.isNull(a)||-3===a)&&(a=1),webphone_api.global.phonestarted<2)return void Ho("SendChatAction",[o,n,t,i]);if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, sendchat (API_Chat), "+o+", "+n),webphone_api.common.isNull(o)||webphone_api.common.Trim(o).length<1)return webphone_api.common.PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("err_msg_6")),!1;webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t),webphone_api.common.isNull(Cn)||clearTimeout(Cn),Cn=null,webphone_api.global.phonestarted<1&&(webphone_api.global.phonestarted=1,e(webphone_api.parameters));if(webphone_api.common.NeedRegister()&&webphone_api.global.phonestarted<3||webphone_api.global.phonestarted<2)return void(Cn=setTimeout(function(){ee(o,n,i)},250));if(!webphone_api.common.LcAc(!1,!1))return!1;if(webphone_api.common.Te()){var r=[];r.push("T"),r.push("r"),r.push("i"),r.push("a"),r.push("l"),r.push(" "),r.push("e"),r.push("x"),r.push("p"),r.push("i"),r.push("r"),r.push("e"),r.push("d");var l=r.join("");return setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR, "+l)},1150),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR, "+l)},2150),!1}webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Chat, "+o);var p=!1;if(0===webphone_api.common.Trim(n).indexOf("[DONT_START_CHAT_WINDOW]")&&(n=n.replace("[DONT_START_CHAT_WINDOW]",""),p=!0),webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutchat,"outChat","",o,o,n),!1!==webphone_api.common.IsSDK()||webphone_api.global.isMessageStarted||!1!==p||(webphone_api.global.intentmsg[0]="action=chat",webphone_api.global.intentmsg[1]="to="+o,webphone_api.global.intentmsg[2]="message="+n,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipSendChat(a,o,n,i);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SendChat",null,webphone_api.common.GetLineForJavaAPI(),o,t,n);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(1,"EVENT, Chat not supported by flash engine"),!1;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SendChat(webphone_api.common.GetLineForJavaAPI(),o,t,n)}catch(s){webphone_api.common.PutToDebugLogException(2,"plhandler: SendChat",s)}return!1}function ne(e,o,n){try{if(Fo("SendSms"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, sendsms (API_Sms), "+e+", "+o+", "+n),webphone_api.common.isNull(e)||webphone_api.common.Trim(e).length<1)return webphone_api.common.PutToDebugLog(1,"ERROR, Sms "+webphone_api.stringres.get("err_msg_6")),!1;if(webphone_api.global.phonestarted<2)return void Ho("SendSms",[e,o,n]);var t=webphone_api.common.GetParameter2("sms");(webphone_api.common.isNull(t)||t.length<2)&&(t=webphone_api.common.GetConfig("sms")),!webphone_api.common.isNull(t)&&t.length>2?((webphone_api.common.isNull(n)||n.length<1)&&(n=webphone_api.common.GetSipusername()),UriParser(t,"",n,e,o,"sendsms")):ee(e,o,"",!0)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: SendSms",i)}return!1}function te(e,o){try{if(Fo("Voicerecord"),!1===webphone_api.common.Glcr())return;if(webphone_api.global.phonestarted<2)return void Ho("Voicerecord",[e,o]);if(webphone_api.common.isNull(o)&&(o=""),!1===e&&(o="null"),!0===e&&(o.length<1||"null"===o||"NULL"===o))return void webphone_api.common.PutToDebugLog(2,"WARNING, voicerecord (API_Voicerecord) skipped start with no url, "+e+", "+o);webphone_api.common.PutToDebugLog(2,"EVENT, voicerecord (API_Voicerecord), "+e+", "+o);var n=!1;if((!1===e||webphone_api.common.isNull(o)||o.length<1||"null"===o||"NULL"===o)&&(o="null",n=!0),webphone_api.common.SaveParameter("voicerecupload",o),webphone_api.common.isNull(webphone_api.parameters.voicerecupload)||(webphone_api.parameters.voicerecupload=o),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void webphone_api.common.CallWsuserKeepAlive(!0);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void(!1===n?webphone_api.common.WinAPI("API_VoiceRecord",null,4,2,o,webphone_api.common.GetLineForJavaAPI()):webphone_api.common.WinAPI("API_VoiceRecord",null,0,2,o,webphone_api.common.GetLineForJavaAPI()));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return void(!1===n?webphone_api.webphone.VoiceRecord(4,2,o,webphone_api.common.GetLineForJavaAPI()):webphone_api.webphone.VoiceRecord(0,2,o,webphone_api.common.GetLineForJavaAPI()))}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: Voicerecord",t)}}function ie(){try{if("undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications)return webphone_api.notifications.GetStatus();console&&console.log&&console.log("ERROR, plhandler GetStatus webphone_api.notifications is not defined")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: GetStatus",e)}return""}function ae(e,o){try{if(Fo("GetRegFailReason"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetRegFailReason callback is not definaed");var n=!0;if((webphone_api.common.isNull(o)||"true"!=o&&"false"!=o||"false"==o||0==o)&&(n=!1),webphone_api.global.phonestarted<2)return void Ho("GetRegFailReason",[e,o]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.webrtcapi.GetRegFailReason());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, GetRegFailReason is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetRegFailReason",function(o){e(o)},n);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.GetRegFailReason(e,n)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetRegFailReason",t)}return""}function re(){try{if(Fo("DevicePopup"),webphone_api.common.isNull(Dn)||clearTimeout(Dn),Dn=null,webphone_api.global.phonestarted<1&&(webphone_api.global.phonestarted=1,e(webphone_api.parameters)),webphone_api.global.phonestarted<2)return void(Dn=setTimeout(function(){re()},250));if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, devicepopup (API_DevicePopup)"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.AudioDevice();webphone_api.common.AudioDevicePopup()}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: DevicePopup",o)}return!1}function le(e,o){try{if(Fo("SetVolume"),webphone_api.common.isNull(e)||e.length<1||webphone_api.common.isNull(o)||o.length<1||!webphone_api.common.IsNumber(e)||!webphone_api.common.IsNumber(o))return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: setvolume device or volume is NULL"),!1;if(webphone_api.global.phonestarted<2)return void Ho("SetVolume",[e,o]);webphone_api.common.PutToDebugLog(2,"EVENT, plhandler setvolume engine: "+webphone_api.common.getuseengine()+"; dev: "+e+"; volume: "+o);var n=webphone_api.common.StrToInt(e),t=webphone_api.common.StrToInt(o);if(n<0||n>2)return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: setvolume invalid device"),!1;if(t<0||t>100)return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: setvolume invalid valume value"),!1;if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_SetVolume, "+e+", "+o),0==e?webphone_api.common.SaveParameter("volumein",o):webphone_api.common.SaveParameter("volumeout",o),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"EVENT, setvolume is not supported by flash engine");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void webphone_api.webrtcapi.SetVolume(e,o);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SetVolume",null,e,o);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SetVolume(e,o)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: SetVolume",i)}return!1}function pe(e,o){try{if(Fo("GetVolume"),!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetVolume callback is not defined");if(webphone_api.common.isNull(e)||e.length<1||!webphone_api.common.IsNumber(e))return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: getvolume device is NULL"),o(-1),!1;var n=webphone_api.common.StrToInt(e);if(n<0||n>2)return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: getvolume invalid device"),!1;if(webphone_api.global.phonestarted<2)return void Ho("GetVolume",[e,o]);if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, getvolume (API_GetVolume), "+e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"EVENT, getvolume is not supported by flash engine");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void o(webphone_api.webrtcapi.GetVolume(e));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetVolume",function(e){var n=50;webphone_api.common.isNull(e)||e.length<1||!1===webphone_api.common.IsNumber(e)?webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVolume invalid return value: "+e):n=webphone_api.common.StrToInt(e),webphone_api.common.PutToDebugLog(2,"plhandler: GetVolume NS returned: "+n.toString()),o(n)},e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void o(webphone_api.webphone.GetVolume(e))}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVolume",t)}return!1}function se(e){try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void(!0===e||"true"===e?webphone_api.common.SaveParameter("androidspeaker","0"):webphone_api.common.SaveParameter("androidspeaker","1"));webphone_api.common.PutToDebugLog(2,"WARNING, setloudspeaker not iplemented for this engine: "+webphone_api.common.getuseengine())}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: SetLoudspeaker",o)}return!1}function ce(e,o,n,t){try{if(Fo("PlaySound"),webphone_api.global.phonestarted<2)return void Ho("PlaySound",[e,o,n,t]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.PlaySound(e,o,n,t);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_PlaySound",null,e,o,n,!1,!1,t,webphone_api.common.GetLineForJavaAPI()),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.PlaySound(e,o,n,!1,!1,t,webphone_api.common.GetLineForJavaAPI());webphone_api.common.PutToDebugLog(2,"ERROR, plhandler API_PlaySuond is not supported by "+webphone_api.common.getuseengine()+" engine")}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: PlaySound",i)}return!1}function ue(e,o,n,t,i,a){try{if(Fo("AddContact"),webphone_api.common.isNull(o)||webphone_api.common.Trim(o).length<1)return webphone_api.common.PutToDebugLog(3,"ERROR, plhandler AddContact invalid number: "+o),!1;o=webphone_api.common.Trim(o),webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),o=webphone_api.common.NormalizeInput2(o,3);var r=webphone_api.common.GetParameterInt("normalize_contact",1);r>0&&(e=webphone_api.common.NormalizeInput2(e,2)),webphone_api.common.isNull(n)&&(n=""),r>0&&(n=webphone_api.common.NormalizeInput2(n,3),n=webphone_api.common.Trim(n)),webphone_api.common.isNull(t)&&(t=""),r>0&&(t=webphone_api.common.NormalizeInput2(t,3),t=webphone_api.common.Trim(t)),webphone_api.common.isNull(i)&&(i=""),r>0&&(i=webphone_api.common.NormalizeInput2(i,3),i=webphone_api.common.Trim(i)),webphone_api.common.isNull(a)&&(a=""),r>0&&(a=webphone_api.common.NormalizeInput2(a,2),a=webphone_api.common.Trim(a));var l="sip";webphone_api.common.IsNumber(o)&&(l="phone")
;return webphone_api.common.PutToDebugLog(2,"EVENT, AddContact name: "+e+"; number: "+o+"; email: "+n+"; address: "+t+"; notes: "+i+"; website: "+a+"; isfromsync: 0"),ge(e,o,"0",l,webphone_api.common.GetTickCount(),n,t,i,a,"0"),!0}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: AddContact",p)}return!1}function ge(e,o,n,t,i,a,r,l,p,s){try{webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]);var c=[];c[webphone_api.common.CT_NAME]=e,c[webphone_api.common.CT_NUMBER]=[o],c[webphone_api.common.CT_PTYPE]=[t],c[webphone_api.common.CT_USAGE]="0",c[webphone_api.common.CT_LASTMODIF]=i,c[webphone_api.common.CT_DELFLAG]="0",c[webphone_api.common.CT_FAV]=n,c[webphone_api.common.CT_EMAIL]=a,c[webphone_api.common.CT_ADDRESS]=r,c[webphone_api.common.CT_NOTES]=l,c[webphone_api.common.CT_WEBSITE]=p,c[webphone_api.common.CT_LASTACTIVE]=webphone_api.common.GetTickCount().toString(),c[webphone_api.common.CT_ISFROMSYNC]=s;for(var u=0;u<webphone_api.global.ctlist.length;u++){if(webphone_api.global.ctlist[u][webphone_api.common.CT_NUMBER]===o){webphone_api.global.ctlist.splice(u,1);break}}webphone_api.global.ctlist.push(c),webphone_api.global.wasCtModified=!0,webphone_api.common.SortContacts()}catch(g){webphone_api.common.PutToDebugLogException(2,"plhandler: SaveTheContact",g)}}function me(e,o){try{return Fo("DeleteContact"),(webphone_api.common.isNull(e)&&(e=""),e=e.toString(),webphone_api.common.isNull(o)&&(o=""),o=o.toString(),e.length<0&&o.length<0)?(webphone_api.common.PutToDebugLog(2,"ERROR, plhandler DeleteContact invalid name and number"),!1):(webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]),be(e,o),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: DeleteContact",n)}return!1}function be(e,o){try{if(webphone_api.common.isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler RemoveTheContact no contacts in list");if(e.length>0&&o.length>0)for(var n=0;n<webphone_api.global.ctlist.length;n++){var t=webphone_api.global.ctlist[n];if(t[webphone_api.common.CT_NAME]===e||t[webphone_api.common.CT_NAME]===o){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}for(var i=0;i<t[webphone_api.common.CT_NUMBER].length;i++)if(t[webphone_api.common.CT_NUMBER][i]===e||t[webphone_api.common.CT_NUMBER][i]===o){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}}else if(e.length>0)for(var n=0;n<webphone_api.global.ctlist.length;n++){var t=webphone_api.global.ctlist[n];if(t[webphone_api.common.CT_NAME]===e){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}for(var i=0;i<t[webphone_api.common.CT_NUMBER].length;i++)if(t[webphone_api.common.CT_NUMBER][i]===e){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}}else if(o.length>0)for(var n=0;n<webphone_api.global.ctlist.length;n++){var t=webphone_api.global.ctlist[n];if(t[webphone_api.common.CT_NAME]===o){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}for(var i=0;i<t[webphone_api.common.CT_NUMBER].length;i++)if(t[webphone_api.common.CT_NUMBER][i]===o){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}}}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: RemoveTheContact",a)}}function he(e,o){try{return Fo("GetContact"),(webphone_api.common.isNull(e)&&(e=""),e=e.toString(),webphone_api.common.isNull(o)&&(o=""),o=o.toString(),e.length<0&&o.length<0)?(webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetContact invalid name and number"),null):(webphone_api.common.PutToDebugLog(4,"EVENT, plhandler getcontact with name: "+e+" and number: "+o),webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]),function(e,o){try{var n="";if(e.length>0)for(var t=0;t<webphone_api.global.ctlist.length;t++){var i=webphone_api.global.ctlist[t];i[webphone_api.common.CT_NAME]===e&&(n=i[webphone_api.common.CT_NAME]+"\t"+i[webphone_api.common.CT_NUMBER].join("|")+"\t"+i[webphone_api.common.CT_FAV]+"\t"+i[webphone_api.common.CT_EMAIL]+"\t"+i[webphone_api.common.CT_ADDRESS]+"\t"+i[webphone_api.common.CT_NOTES]+"\t"+i[webphone_api.common.CT_WEBSITE])}else if(o.length>0)for(var t=0;t<webphone_api.global.ctlist.length;t++){var i=webphone_api.global.ctlist[t];i[webphone_api.common.CT_NAME]===o&&(n=i[webphone_api.common.CT_NAME]+"\t"+i[webphone_api.common.CT_NUMBER].join("|")+"\t"+i[webphone_api.common.CT_FAV]+"\t"+i[webphone_api.common.CT_EMAIL]+"\t"+i[webphone_api.common.CT_ADDRESS]+"\t"+i[webphone_api.common.CT_NOTES]+"\t"+i[webphone_api.common.CT_WEBSITE]);for(var a=0;a<i[webphone_api.common.CT_NUMBER].length;a++)i[webphone_api.common.CT_NUMBER][a]===o&&(n=i[webphone_api.common.CT_NAME]+"\t"+i[webphone_api.common.CT_NUMBER].join("|")+"\t"+i[webphone_api.common.CT_FAV]+"\t"+i[webphone_api.common.CT_EMAIL]+"\t"+i[webphone_api.common.CT_ADDRESS]+"\t"+i[webphone_api.common.CT_NOTES]+"\t"+i[webphone_api.common.CT_WEBSITE])}if(!webphone_api.common.isNull(n))return n}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: FindContactInList",r)}return null}(e,o))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetContact",n)}return null}function de(e){try{return Fo("ListContacts"),webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]),webphone_api.common.PutToDebugLog(4,"EVENT, plhandler listcontacts called"),function(e){try{for(var o="",n=0;n<webphone_api.global.ctlist.length;n++){var t=webphone_api.global.ctlist[n];if(!1!==e||"Echo delayed"!==t[webphone_api.common.CT_NAME]&&"Echo"!==t[webphone_api.common.CT_NAME]&&"Funny"!==t[webphone_api.common.CT_NAME]&&"Music"!==t[webphone_api.common.CT_NAME]&&"Playback"!==t[webphone_api.common.CT_NAME]&&"Record"!==t[webphone_api.common.CT_NAME]&&"Redial"!==t[webphone_api.common.CT_NAME]&&"Voicemail"!==t[webphone_api.common.CT_NAME]){!webphone_api.common.isNull(o)&&o.length>0&&(o+="\r\n");for(var i="",a=0;a<t[webphone_api.common.CT_NUMBER].length;a++)webphone_api.common.isNull(t[webphone_api.common.CT_NUMBER][a])||t[webphone_api.common.CT_NUMBER][a].length<1||(i.length>0&&(i+="|"),i+=t[webphone_api.common.CT_NUMBER][a]);o+=t[webphone_api.common.CT_NAME]+"\t"+i+"\t"+t[webphone_api.common.CT_FAV]+"\t"+t[webphone_api.common.CT_EMAIL]+"\t"+t[webphone_api.common.CT_ADDRESS]+"\t"+t[webphone_api.common.CT_NOTES]+"\t"+t[webphone_api.common.CT_WEBSITE]}}if(!webphone_api.common.isNull(o)&&o.length>0)return o}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: BuildCtList",r)}return null}(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: ListContacts",o)}return null}function _e(){try{Fo("ListCallhistory"),webphone_api.common.isNull(webphone_api.global.chlist)&&(webphone_api.global.chlist=[]),webphone_api.common.PutToDebugLog(4,"EVENT, plhandler listcallhistory called");for(var e="",o=0;o<webphone_api.global.chlist.length;o++){var n=webphone_api.global.chlist[o];!webphone_api.common.isNull(e)&&e.length>0&&(e+="\r\n");e+=n[webphone_api.common.CH_TYPE]+"\t"+n[webphone_api.common.CH_NAME]+"\t"+n[webphone_api.common.CH_NUMBER]+"\t"+n[webphone_api.common.CH_DATE]+"\t"+n[webphone_api.common.CH_DURATION]+"\t"+n[webphone_api.common.CH_REASON]}if(!webphone_api.common.isNull(e)&&e.length>0)return e}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: ListCallhistory",t)}return null}function we(e,o){try{if(webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLogSpecial(2,"EVENT, SetParameter user, "+e+": "+o,!1,""),Fo("SetParameter: "+e+": "+o),webphone_api.common.isNull(e)||e.length<1)return!1;if(e=e.toLowerCase(),webphone_api.common.isNull(o)&&(o="null"),o=webphone_api.common.Trim(o),0===o.indexOf("encrypted__3__")&&(o=webphone_api.common.StrDc(o,webphone_api.common.GetPassphrase())),e.indexOf("server")>=0){if("YOURSIPDOMAIN.COM"===o||"YOURSIPSERVER.COM"===o||"SIPSERVER"===o||"VOIPSERVER"===o||"SERVERADDRESS"===o||"yoursipdomain.com"===o||"SERVER_ADDRESS"===o||"serveraddress"===o||"YOURSIPDOMAIN"===o)return!1}else if(e.indexOf("username")>=0){if("USERNAME"===o||"SIPUSERNAME"===o)return!1}else if(e.indexOf("password")>=0){if("PASSWORD"===o||"SIPPASSWORD"===o||"SIPASSWORD"===o)return!1}else if(e.indexOf("callto")>=0&&("DESTINATION"===o||"CALLTO"===o))return!1;"webrtcserver"!==e&&"webrtcaddress"!==e&&"rtcserver"!==e&&"rtcaddress"!==e||(e="webrtcserveraddress");try{window.location.href.indexOf("isdemopage=true")>0&&!webphone_api.common.isNull(o)&&o.toString().length>0&&("sipusername"===e||"username"===e||"password"===e||"sippassword"===e||"serveraddress_user"===e||"serveraddress_orig"===e||"serveraddress"===e||"upperserver"===e||"callto"===e||"destination"===e)&&webphone_api.SetCookie("wpdemosett_"+e,o,365)}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: SetParameter inner",a)}var n=o;("password"===e||"sippassword"===e||webphone_api.common.GetParameterInt("loglevel",1)<5)&&(n="*****"),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLogSpecial(2,"EVENT, SetParameter "+e+": "+n,!1,""),"serveraddress"===e&&o.length>0?webphone_api.common.SaveParameter("serveraddress_user",o):"theme"===e&&o.length>0?webphone_api.common.SaveParameter("colortheme",o):"colortheme"===e&&o.length>0&&webphone_api.common.SaveParameter("theme",o),webphone_api.common.SaveParameter(e,o),webphone_api.common.isNull(webphone_api.parameters)||webphone_api.common.isNull(webphone_api.parameters[e])||(webphone_api.parameters[e]=o);var t=webphone_api.common.GetParameter("devicetype");if(t===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SetParameter",null,e,o);if(t===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SetParameter(e,o)}catch(r){var i=e;i=webphone_api.common.isNull(i)?"":": "+i,webphone_api.common.PutToDebugLogException(2,"plhandler: SetParameter"+i,r)}return!1}function fe(e){try{if(webphone_api.common.isNull(e)||e.length<1)return null;e=e.toLowerCase();var o=webphone_api.common.GetParameter(e);try{if(window.location.href.indexOf("isdemopage=true")>0&&("sipusername"===e||"username"===e||"password"===e||"sippassword"===e||"serveraddress_user"===e||"serveraddress_orig"===e||"serveraddress"===e||"upperserver"===e||"callto"===e||"destination"===e)){var n=webphone_api.GetCookie("wpdemosett_"+e);if(!webphone_api.common.isNull(n)&&n.length>0&&(webphone_api.common.isNull(o)||o.length<1))return n}}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetParameter inner",t)}return o}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: GetParameter",i)}return null}function ve(e,o){try{if(Fo("SetLine"),webphone_api.common.isNull(e)||e.toString().length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: SetLine invalid line (1): "+e);webphone_api.common.PutToDebugLog(2,"EVENT, USER, setline (API_SetLine), "+e.toString());var n=!1,t=-10;if(webphone_api.common.IsNumber(e)&&e.toString().length<3){if((t=webphone_api.common.StrToInt(webphone_api.common.Trim(e)))<-2||t>50)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: SetLine invalid line (2): "+e);var i=t;-1===t&&(t=webphone_api.common.GetBestLine()),webphone_api.global.lastalineset=i,webphone_api.global.lastalinesettick=webphone_api.common.GetTickCount(),!0!==o&&(webphone_api.global.lastalinesetreal=i,webphone_api.global.lastalinesetrealtick=webphone_api.common.GetTickCount())}if(e=e.toString(),t<-5){n=!0;for(var a=0;a<webphone_api.global.ep.length;a++)if(!webphone_api.common.isNull(webphone_api.global.ep[a])){var r=webphone_api.global.ep[a][webphone_api.common.EP_DESTNR];!webphone_api.common.isNull(r)&&r.length>1&&e===r&&(t=webphone_api.common.StrToInt(webphone_api.global.ep[a][webphone_api.common.EP_LINE]))}}if(t<-5)for(var a=0;a<webphone_api.global.ep.length;a++)if(!webphone_api.common.isNull(webphone_api.global.ep[a])){var l=webphone_api.global.ep[a][webphone_api.common.EP_CALLID];!webphone_api.common.isNull(r)&&r.length>1&&e===l&&(t=webphone_api.common.StrToInt(webphone_api.global.ep[a][webphone_api.common.EP_LINE]))}if(0===webphone_api.common.IsMultiline())return void setTimeout(function(){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("M"),e.push("u"),e.push("l"),e.push("t"),e.push("i"),e.push("l"),e.push("i"),e.push("n"),e.push("e"),e.push(" "),e.push("f"),e.push("e"),e.push("a"),e.push("t"),e.push("u"),e.push("r"),e.push("e"),e.push(" "),e.push("i"),e.push("s"),e.push("d"),e.push("i"),e.push("s"),e.push("a"),e.push("b"),e.push("l"),e.push("e"),e.push("d");var o=e.join("");webphone_api.common.PutToDebugLog(1,o)},550);if(webphone_api.global.aline=t,!1===yn&&(webphone_api.common.SaveParameter("multilinegui","1"),yn=!0),webphone_api.common.RefreshInfo(),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"WARNING, SetLine method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return!0===n?webphone_api.common.WinAPI("API_SetLine",null,e):webphone_api.common.WinAPI("API_SetLine",null,t),void webphone_api.common.SaveParameter("line",t.toString());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return!0===n?webphone_api.webphone.SetLineEx(e):webphone_api.webphone.SetLine(t),void webphone_api.common.SaveParameter("line",t.toString())}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: SetLine",p)}return null}function Pe(){var e=webphone_api.global.aline;try{if(Fo("GetLine"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine)"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return e;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, GetLine method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)),e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.global.aline=webphone_api.webphone.GetLine(),webphone_api.global.aline}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLine",o)}return e}function Ee(e,o){try{if(Fo("LineToCallID"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, linetocallid (API_LineToCallID)"),webphone_api.common.isNull(e)||!webphone_api.common.IsNumber(e))return void o("ERROR, linetocallid: Invalid line");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void o(webphone_api.webrtcapi.LineToCallID(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, LineToCallID method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)),"";if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_LineToCallID",function(e){o(e)},e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void o(webphone_api.webphone.LineToCallID(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: LineToCallID",n)}}function Te(e,o){try{if(Fo("CallIDToLine"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, callidtoline (API_CallIDToLine)"),webphone_api.common.isNull(e)||e.length<1)return void o("ERROR, CallIDToLine: Invalid callid");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void o(webphone_api.webrtcapi.CallIDToLine(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, CallIDToLine method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)),"";if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_CallIDToLine",function(e){o(e)},e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void o(webphone_api.webphone.CallIDToLine(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: CallIDToLine",n)}}function Ne(e){try{var o=-5;if(!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(o=webphone_api.common.StrToInt(e)),o<1&&(o=webphone_api.common.GetBestLine()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var n=webphone_api.webphone.GetLineDetails(o);if(!webphone_api.common.isNull(n)&&n.length>0){var t=n.split(",");if(!webphone_api.common.isNull(t)&&t.length>0){n="";for(var i=0;i<t.length;i++)webphone_api.common.isNull(t[i])&&(t[i]=""),t[i]=webphone_api.common.Trim(t[i]),0===t[i].indexOf("_BASE64_")&&(t[i]=webphone_api.common.B64Dec(t[i]),webphone_api.common.isNull(t[i])&&(t[i]=""),t[i]=webphone_api.common.Trim(t[i])),n.length>0&&(n+=","),n+=t[i]}}return n}var a=o.toString(),r="Unused line",l="",p="",s="",c="-1",u=webphone_api.common.GetParameter("serveraddress_user"),g="",m="false",b="false",h="",d=webphone_api.common.GetTickCount(),_=webphone_api.global.lnstat[o];if(!webphone_api.common.isNull(_)&&_.length>1){var w=webphone_api.common.GetConfigInt("registerinterval",0);w<1&&(w=90),w*=6e4,!webphone_api.common.isNull(_[0])&&webphone_api.common.IsNumber(_[0])&&d-_[0]<=w&&!webphone_api.common.isNull(_[1]&&_[1].length)&&(r=_[1])}var f=webphone_api.common.GetEndpoint(o,"","",!1);!webphone_api.common.isNull(f)&&f.length>2&&(l=f[webphone_api.common.EP_CALLID],p=f[webphone_api.common.EP_DESTNR],s=webphone_api.common.GetSipusername(),c=f[webphone_api.common.EP_INCOMING],u=webphone_api.common.GetParameter("serveraddress_user"),g="",m=f[webphone_api.common.EP_MUTESTATE],b=f[webphone_api.common.EP_HOLDSTATE],h="");var v="LINEDETAILS,"+a+","+r+","+l+","+p+","+s+","+c+","+u+","+g+","+m+","+b+","+h;return webphone_api.common.PutToDebugLog(4,"EVENT, GetLineDetails user: "+v),v}catch(P){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLineDetails",P)}return""}function Se(){try{Fo("GetLastCallDetails");var e=webphone_api.global.lastcalldetails;if(webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),webphone_api.global.phonestarted<2)return void Ho("GetLastCallDetails",[]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return e;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.GetLastCallDetails()}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastCallDetails",o)}return""}function Ie(e){try{if(Fo("GetIcomingDisplay"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetIncomingDisplay callback is not definaed");if(webphone_api.global.phonestarted<2)return void Ho("GetIncomingDisplay",[e]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.common.GetWebrtcDisplayName());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetIncomingDisplay",function(o){webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o),0===o.indexOf("_BASE64_")&&(o=webphone_api.common.B64Dec(o),webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o)),e(o)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()){var o=webphone_api.webphone.GetIncomingDisplay();return webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o),0===o.indexOf("_BASE64_")&&(o=webphone_api.common.B64Dec(o),webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o)),void e(o)}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetIncomingDisplay",n)}return""}function Re(){try{webphone_api.global.printwad_called=!1,webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Unregister"),webphone_api.global.authenticated_displayed=!1,webphone_api.global.dispSaveSettMsg=0,webphone_api.global.pres_unreg_called=!0,webphone_api.global.last_presence_enabled=webphone_api.common.UsePresence2(),webphone_api.global.onregisteredcalled=!1;var e=webphone_api.global.dispregfailed;if(webphone_api.global.dispregfailed=2,setTimeout(function(){webphone_api.global.dispregfailed=e},500),!1===webphone_api.global.onunregistered_flag){webphone_api.global.onunregistered_flag=!0,setTimeout(function(){webphone_api.global.onunregistered_flag=!1},2e3);try{webphone_api.onRegStateChangeCb("unregistered",null)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onUnRegistered(unregistered) callback",n)}try{webphone_api.onUnRegisteredCb()}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onUnRegistered() callback",n)}}var o=webphone_api.common.getuseengine();if((webphone_api.common.isNull(o)||o.length<1)&&(o=webphone_api.global.last_useengine),o===webphone_api.global.ENGINE_WEBRTC)return webphone_api.flagrestartwebrtc=!1,webphone_api.webrtcapi.SipUnRegister(),webphone_api.common.Wsunreg(),webphone_api.global.phonestarted=2,void(webphone_api.global.webrtcsipsignalingreceived=0);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||o===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_Unregister",null),void(webphone_api.global.phonestarted=2);if(o===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Logout(null),void(webphone_api.global.phonestarted=2);if(o===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.Unregister(),void(webphone_api.global.phonestarted=2)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Unregister",n)}}function Ge(e){try{return webphone_api.global.onregisteredcalled=!1,e===webphone_api.global.ENGINE_WEBRTC?(!0===webphone_api.global.checkIfInCall&&(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_1: "+e),webphone_api.webrtcapi.SipHangup(!1,-2)),webphone_api.flagrestartwebrtc=!1,webphone_api.webrtcapi.SipStop(),webphone_api.common.Wsunreg(),void(webphone_api.global.phonestarted=2)):e===webphone_api.global.ENGINE_FLASH?(!0===webphone_api.global.checkIfInCall&&(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_2: "+e),webphone_api.flashapi.Hangup()),webphone_api.flashapi.Logout(null),void(webphone_api.global.phonestarted=2)):e===webphone_api.global.ENGINE_JAVA?(!0===webphone_api.global.checkIfInCall&&(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_3: "+e),webphone_api.webphone.Hangup(-2)),webphone_api.webphone.Unregister(),void(webphone_api.global.phonestarted=2)):(!0===webphone_api.global.checkIfInCall||webphone_api.common.WinAPI("API_Unregister",null),void(webphone_api.global.phonestarted=2))}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: UnregisterEngine",o)}}function Oe(){try{if(Fo("HTTPKeepAlive"),webphone_api.common.PutToDebugLog(5,"EVENT, httpkeepalive (API_HTTPKeepAlive)"),webphone_api.global.useengine!==webphone_api.global.ENGINE_JAVA)return;return webphone_api.webphone.HTTPKeepAlive()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: HTTPKeepAlive",e)}}function Le(){Fo("IsRegistered");try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var e=webphone_api.webphone.IsRegistered();return webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_IsRegistered: wp "+e.toString()),e}if(webphone_api.global.phonestarted>2)return webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_IsRegistered: true"),!0;webphone_api.common.PutToDebugLog(2,"EVENT, USER, isregistered (API_IsRegistered)")}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: IsRegistered",o)}return!1}function Ce(){Fo("IsInCall");try{webphone_api.common.PutToDebugLog(4,"EVENT, isincall: "+webphone_api.global.checkIfInCall.toString())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: IsInCall",e)}return webphone_api.global.checkIfInCall}function De(e,o,n){var t=0;try{if(webphone_api.common.isNull(e)||e<-2)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList dev is null "+e);if(!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetDeviceList callback is not defined");if(!0!==n){Fo("GetDeviceList");for(var i=!1,a=xn.length-1;a>=0;a--)if(xn[a]===e&&An[a]===o){i=!0;break}i||(xn.push(e),An.push(o))}if(xn.length<1&&(xn.push(e),An.push(o)),xn.length<1)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList no request is waiting a");if(An.length<1)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList no request is waiting b");if(!An[0]||"function"!=typeof An[0])return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList no request is waiting c");if(webphone_api.common.getuseengine().length<1&&webphone_api.global.phonestarted<2){webphone_api.common.isNull(kn)||clearTimeout(kn),kn=null;var r=xn[0],l=An[0];return void(kn=setTimeout(function(){webphone_api.common.isNull(r)&&(r="-41"),De(r,l,!0)},300))}if(webphone_api.common.isNull(kn)||clearTimeout(kn),kn=null,webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetAudioDeviceList",function(e){try{if(t=1,webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"PROCESSING_AUDIOLIST ("+e.length.toString()+") : "+e),xn.length<1)null!=e&&e.length>0&&webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist unexpected answer: "+e);else{t=2;var o=An.shift();t=3;var n=xn.shift();if(t=4,0===e.indexOf("_BASE64_")&&(e=webphone_api.common.B64Dec(e),webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e)),t=5,0==n?(t=6,webphone_api.global.audio_rec_device_list=e,webphone_api.common.SaveParameter("cache_audio_rec_device_list",e),t=7,o(e)):1==n?(t=8,webphone_api.global.audio_play_device_list=e,webphone_api.common.SaveParameter("cache_audio_play_device_list",e),t=9,o(e)):2==n?(t=10,!webphone_api.common.isNull(e)&&e.length>0&&e.indexOf("\r\nAll")<1&&(e+="\r\nAll"),webphone_api.global.audio_ring_device_list=e,webphone_api.common.SaveParameter("cache_audio_ring_device_list",e),t=11,o(e)):3==n?(t=12,webphone_api.global.video_rec_device_list=e,webphone_api.common.SaveParameter("cache_video_rec_device_list",e),o(e)):webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist answer with unknow dev: "+e),t=13,!webphone_api.common.isNull(An)&&An.length>0){t=14;var i=xn[0];t=15;var a=An[0];t=16,setTimeout(function(){t=17,webphone_api.common.isNull(i)&&(i="-42"),De(i,a,!0)},8)}}}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: GetDeviceListInner "+t,r)}},xn[0]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var p="",s=xn.shift(),c=An.shift();if(p=webphone_api.webphone.GetAudioDeviceList(s),webphone_api.common.isNull(p)&&(p=""),p=webphone_api.common.Trim(p),0===p.indexOf("_BASE64_")&&(p=webphone_api.common.B64Dec(p),webphone_api.common.isNull(p)&&(p=""),p=webphone_api.common.Trim(p)),0==s?(webphone_api.global.audio_rec_device_list=p,webphone_api.common.SaveParameter("cache_audio_rec_device_list",p)):1==s?(webphone_api.global.audio_play_device_list=p,webphone_api.common.SaveParameter("cache_audio_play_device_list",p)):2==s?(!webphone_api.common.isNull(p)&&p.length>0&&p.indexOf("\r\nAll")<1&&(p+="\r\nAll"),webphone_api.global.audio_ring_device_list=p,webphone_api.common.SaveParameter("cache_audio_ring_device_list",p)):(webphone_api.global.video_rec_device_list=p,webphone_api.common.SaveParameter("cache_video_rec_device_list",p)),c(p),!webphone_api.common.isNull(An)&&An.length>0){var r=xn[0],l=An[0];setTimeout(function(){webphone_api.common.isNull(r)&&(r="-43"),De(r,l,!0)},8)}return}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var p="",s=xn.shift(),c=An.shift();if(0==s?(p=webphone_api.webrtcapi.GetAudioDeviceList(s),webphone_api.global.audio_rec_device_list=p,webphone_api.common.SaveParameter("cache_audio_rec_device_list",p)):1==s?(p=webphone_api.webrtcapi.GetAudioDeviceList(s),webphone_api.global.audio_play_device_list=p,webphone_api.common.SaveParameter("cache_audio_play_device_list",p)):2==s?(p=webphone_api.webrtcapi.GetAudioDeviceList(s),webphone_api.global.audio_ring_device_list=p,webphone_api.common.SaveParameter("cache_audio_ring_device_list",p)):(p=webphone_api.webrtcapi.GetAudioDeviceList(s),webphone_api.global.video_rec_device_list=p,webphone_api.common.SaveParameter("cache_video_rec_device_list",p)),c(p),!webphone_api.common.isNull(An)&&An.length>0){var r=xn[0],l=An[0];setTimeout(function(){webphone_api.common.isNull(r)&&(r="-44"),De(r,l,!0)},8)}return}var c=An.shift();xn.shift(),c("ERROR, Cannot get device list because no engine is started at the moment")}catch(u){webphone_api.common.PutToDebugLogException(2,"plhandler: GetDeviceList",u)}}function ye(e,o,n){try{if(!0!==n){if(Fo("GetDevice"),!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetDevice callback is not defined");Un.push(e),Vn.push(o)}if(webphone_api.common.getuseengine().length<1||webphone_api.global.phonestarted<2){webphone_api.common.isNull(Wn)||clearTimeout(Wn),Wn=null;var t=Un[0];return void(Wn=setTimeout(function(){ye(t,null,!0)},250))}if(webphone_api.common.isNull(Wn)||clearTimeout(Wn),Wn=null,webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetAudioDevice",function(e){if(webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"PROCESSING_AUDIODEV ("+e.length.toString()+") : "+e),Un.length<1)null!=e&&e.length>0&&webphone_api.common.PutToDebugLog(3,"WARNING, audidevice unexpected answer: "+e);else{var o=Un.shift();0===e.indexOf("_BASE64_")&&(e=webphone_api.common.B64Dec(e),webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e)),0==o?(webphone_api.global.audio_rec_curr_device=e,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",e)):1==o?(webphone_api.global.audio_play_curr_device=e,
webphone_api.common.SaveParameter("cache_audio_play_curr_device",e)):2==o?(webphone_api.global.audio_ring_curr_device=e,webphone_api.common.SaveParameter("cache_audio_ring_curr_device",e)):3==o?(webphone_api.global.video_rec_curr_device=e,webphone_api.common.SaveParameter("cache_video_rec_curr_device",e)):webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist answer with unknow dev: "+e);var n=Vn.shift();if(webphone_api.common.PutToDebugLog(4,"EVENT, GetDevice (1), res: "+e),n(e),!webphone_api.common.isNull(Vn)&&Vn.length>0){var t=Un[0];setTimeout(function(){ye(t,null,!0)},8)}}},e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var i="",a=Un.shift();i=webphone_api.webphone.GetAudioDevice(e),webphone_api.common.isNull(i)&&(i=""),i=webphone_api.common.Trim(i),0===i.indexOf("_BASE64_")&&(i=webphone_api.common.B64Dec(i),webphone_api.common.isNull(i)&&(i=""),i=webphone_api.common.Trim(i)),0==a?(webphone_api.global.audio_rec_curr_device=i,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",i)):1==a?(webphone_api.global.audio_play_curr_device=i,webphone_api.common.SaveParameter("cache_audio_play_curr_device",i)):2==a?(webphone_api.global.audio_ring_curr_device=i,webphone_api.common.SaveParameter("cache_audio_ring_curr_device",i)):(webphone_api.global.video_rec_curr_device=i,webphone_api.common.SaveParameter("cache_video_rec_curr_device",i));var r=Vn.shift();if(webphone_api.common.PutToDebugLog(4,"EVENT, GetDevice (2), dev: "+a+"; res: "+i),r(i),!webphone_api.common.isNull(Vn)&&Vn.length>0){var t=Un[0];setTimeout(function(){ye(t,null,!0)},8)}return}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var i="",a=Un.shift();0==a?(i=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.audio_rec_curr_device=i,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",i)):1==a?(i=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.audio_play_curr_device=i,webphone_api.common.SaveParameter("cache_audio_play_curr_device",i)):2==a?(i=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.audio_ring_curr_device=i,webphone_api.common.SaveParameter("cache_audio_ring_curr_device",i)):(i=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.video_rec_curr_device=i,webphone_api.common.SaveParameter("cache_video_rec_curr_device",i));var r=Vn.shift();if(webphone_api.common.PutToDebugLog(4,"EVENT, GetDevice (3), dev: "+a+"; res: "+i),r(i),!webphone_api.common.isNull(Vn)&&Vn.length>0){var t=Un[0];setTimeout(function(){ye(t,null,!0)},100)}return}}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: GetDevice",l)}}function xe(e,o,n,t,i){try{if(!0!==i&&(Fo("SetDevice"),Mn.push(e),Fn.push(o),Hn.push(n),Bn.push(t)),webphone_api.common.getuseengine().length<1||webphone_api.global.phonestarted<2)return webphone_api.common.isNull($n)||clearTimeout($n),$n=null,void($n=setTimeout(function(){xe(null,null,null,null,!0)},250));if(webphone_api.common.isNull($n)||clearTimeout($n),$n=null,null===e&&!webphone_api.common.isNull(Mn)&&Mn.length>0&&(e=Mn.shift(),o=Fn.shift(),n=Hn.shift(),t=Bn.shift()),null===e&&null===o)return;if(webphone_api.common.PutToDebugLog(4,"EVENT, setdevice, dev: "+e+"; devicename: "+o+"; immediate: "+n),webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_SetAudioDevice",null,e,o,n),void(!webphone_api.common.isNull(Mn)&&Mn.length>0&&setTimeout(function(){xe(null,null,null,null)},100));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.SetAudioDevice(e,o,n),!webphone_api.common.isNull(Mn)&&Mn.length>0&&setTimeout(function(){xe(null,null,null,null)},100),!0;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SetAudioDevice(e,o,t),!webphone_api.common.isNull(Mn)&&Mn.length>0&&setTimeout(function(){xe(null,null,null,null)},100),!0}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: SetDevice",a)}}function Ae(e,o){try{if(webphone_api.global.isappenginestarted=!1,(webphone_api.common.isNull(e)||e.length<1)&&(e=webphone_api.common.getuseengine()),(webphone_api.common.isNull(e)||e.length<1)&&(e=webphone_api.global.last_useengine),webphone_api.common.isNull(e)||e.length<1)return void webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: StopEngine engine is not defined");webphone_api.global.webrtc_regstate=0,webphone_api.common.PutToDebugLog(2,"EVENT, USER, stopengine (API_StopEngine)");if(!1===webphone_api.common.GetParameterBool("needunregister",!0)&&!0!==o)return void webphone_api.common.PutToDebugLog(2,"EVENT, API_StopEngine needunregister is FALSE");if(webphone_api.common.Glsp()){if(e===webphone_api.global.ENGINE_SERVICE)return webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.wnotstartedsession=!1,void(!1===webphone_api.common.NSMacLinEnabled()&&webphone_api.common.WinAPI("API_Exit",null));if(e===webphone_api.global.ENGINE_JAVA)return webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.wnotstartedsession=!1,webphone_api.webphone.Exit()}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: StopEngine",n)}}function ke(e){try{webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Stop"),webphone_api.flagrestartwebrtc=!1,webphone_api.global.laststarttick=0,webphone_api.global.webrtc_regstate=0,webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.webrtcsipsignalingreceived=0,webphone_api.global.wnotstartedsession=!1,webphone_api.global.isappenginestarted=!1,setTimeout(function(){Ae(webphone_api.common.getuseengine(),e)},900),setTimeout(function(){webphone_api.common.isNull(webphone_api.global.maintimerid)||(clearInterval(webphone_api.global.maintimerid),webphone_api.global.maintimerid=null,webphone_api.common.isNull(webphone_api.global.initcalled)||(webphone_api.global.initcalled=!1)),webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.webrtcsipsignalingreceived=0,webphone_api.global.wnotstartedsession=!1},1100),setTimeout(function(){try{webphone_api.onAppStateChangeCb("stopped")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(stopped) callback",e)}try{webphone_api.onStopCb()}catch(e){webphone_api.common.PutToDebugLogException(2,"There is an error in onStop() callback",e)}},1250),webphone_api.common.isNull(webphone_api.global.serviceStatusPollTimer)||clearInterval(webphone_api.global.serviceStatusPollTimer),webphone_api.common.isNull(webphone_api.global.polltimerid)||clearInterval(webphone_api.global.polltimerid),webphone_api.common.isNull(webphone_api.global.worktimer)||clearTimeout(webphone_api.global.worktimer),webphone_api.global.worktimer=null;if(!1===webphone_api.common.GetParameterBool("needunregister",!0)&&!0!==e)return void webphone_api.common.PutToDebugLog(2,"EVENT, API_Stop needunregister is FALSE");webphone_api.common.Glsp()&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?webphone_api.global.phonestarted>2&&(webphone_api.webrtcapi.SipStop(),webphone_api.common.Wsunreg()):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?!1===webphone_api.common.NSMacLinEnabled()&&webphone_api.common.WinAPI("API_Exit",null):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.Exit())}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: Stop",o)}webphone_api.global.phonestarted=0}function Ue(e){try{if(Fo("SendChatIsComposing"),webphone_api.common.isNull(e)||e.lebgth<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, SendChatIsComposing invalid destination");var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SendChatIsComposing",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.SendChatIsComposing(o,e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: SendChatIsComposing",n)}}function Ve(){return webphone_api.common.BrowserWindowIsActive()}function We(){try{return Fo("HelpWindow"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, helpwindow (API_HelpWindow)"),webphone_api.common.HelpWindow()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: HelpWindow",e)}return!1}function Me(){try{return Fo("SettingsPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, settingspage (API_SettingsPage)"),webphone_api.common.OpenSettings(!0,9),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: SettingsPage",e)}return!1}function Fe(){try{return Fo("DialPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, dialpage (API_DialPage)"),webphone_api.$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: DialPage",e)}return!1}function He(){try{return Fo("MessageInboxPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, messageinboxpage (API_MessageInboxPage)"),webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: MessageInboxPage",e)}return!1}function Be(){try{return Fo("MessagePage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, messagepage (API_MessagePage)"),webphone_api.global.intentmsg[0]="action=",webphone_api.global.intentmsg[1]="to=",webphone_api.global.intentmsg[2]="message=",webphone_api.$.mobile.changePage("#page_message",{transition:"none",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: MessagePage",e)}return!1}function $e(){try{return Fo("AddContactPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, addcontactpage (API_AddContactPage)"),webphone_api.global.intentaddeditct[0]="action=add",webphone_api.$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: AddContactPage",e)}return!1}function je(e){try{webphone_api.webphone.InsertApplet(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: InsertApplet",o)}}function qe(){try{return webphone_api.common.EnterKeyPress()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: EnterKeyPress",e)}return!1}function ze(e){ee(e,"FILETRANSFER_DELIVERED:"+e)}function Ke(e,o){try{if(Fo("GetTelSearchName"),!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetTelsearchName callback is not definaed");if(webphone_api.common.isNull(e)||e.length<2)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetTelsearchName invalid number: "+e);webphone_api.common.GetTelsearchName(e,o)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: EnterKeyPress",n)}}function Je(e){try{webphone_api.common.bwanswer(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: bwanswer",o)}}function Xe(){try{if(webphone_api.global.wasSettModified){var e=webphone_api.common.GetActiveAccSettingsFilename();!isNull(e)&&e.length>0&&webphone_api.common.SaveSettingsFile(5,e,function(e){webphone_api.common.CanLog(2)&&(e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveSettingsFile from onappexit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveSettingsFile from onappexit Failed"))})}}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: onappexit",o)}}function Ye(){Fo("getlogs"),webphone_api.common.PutToDebugLog(2,"EVENT, getlogs called");var e=webphone_api.global.logs;return webphone_api.global.logs="",e}function Qe(){try{Fo("getlogsex"),webphone_api.common.PutToDebugLog(2,"EVENT, getlogsex called"),webphone_api.common.WinAPI("API_SetLogs",null,webphone_api.global.logs)}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: getlogsex",e)}}function Ze(e){try{webphone_api.common.isNull(e)&&(e=""),webphone_api.common.PutToDebugLog(2,"APILOGS: "+e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: putlogs",o)}}function eo(){try{Fo("ImportContacts"),webphone_api.common.PutToDebugLog(2,"EVENT, importcontacts called"),webphone_api.common.DownloadContacts()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: ImportContacts",e)}}function oo(e,o){try{Fo("delsettings"),webphone_api.global.phonestarted<2&&(webphone_api.common.PutToDebugLog(2,"EVENT, resetsettings set to TRUE"),webphone_api.common.SaveParameter("resetsettings","true")),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_DelSettings",null,e):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.DelSettings(e),!0!==o&&webphone_api.common.delsettings(e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: delsettings",n)}}function no(e){try{if(Fo("needratingrequest"),!e||"function"!=typeof e)return!1;if(webphone_api.global.phonestarted<2)return void Ho("needratingrequest",[e]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_IsEncrypted",function(o){e(webphone_api.common.isNull(o)?"true"===o||!0===o?!0:!1:!1)});webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.NeedRatingRequest(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: needratingrequest",o),e(!1)}}function to(){try{if(!webphone_api.common.isNull(platform)&&!webphone_api.common.isNull(platform.name)){var e=webphone_api.platform.name.toString();if(e=e.toLowerCase(),e.indexOf("mobile")>=0)return!0}var o=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(o=!0)}(navigator.userAgent||navigator.vendor||window.opera),o}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: IsMobileBrowser",n)}return!1}function io(){try{return webphone_api.common.isNull(webphone_api.global.useengine)?"":webphone_api.global.useengine}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: Getenginename",e)}}function ao(e){try{if(Fo("GetLastInvite"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: getlastinvite callback is not defined");if(webphone_api.global.phonestarted<2)return void Ho("GetLastInvite",[e]);var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){o<1&&(o=webphone_api.common.GetBestLine());var n=webphone_api.common.GetEndpoint(o,"","",!1),t="";return isNull(n)||(t=n[webphone_api.common.EP_SIPINVITE]),void e(t)}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getlastinvite is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetLastInvite",function(o){e(o)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetGetLastInvite(webphone_api.common.GetLineForJavaAPI(),e))}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastInvite",i)}}function ro(e){try{if(Fo("GetLastRecInvite"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: getlastrecinvite callback is not defined");if(webphone_api.global.phonestarted<2)return void Ho("GetLastRecInvite",[e]);var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.common.GetLastRecInvite());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getlastrecinvite is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetLastRecInvite",function(o){e(o)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetGetLastRecInvite(webphone_api.common.GetLineForJavaAPI(),e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastRecInvite",n)}}function lo(e){try{if(Fo("GetLastSentInvite"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: getlastsentinvite callback is not defined");if(webphone_api.global.phonestarted<2)return void Ho("GetLastSentInvite",[e]);var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.common.GetLastSentInvite());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getlastsentinvite is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetLastSentInvite",function(o){e(o)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetLastSentInvite(webphone_api.common.GetLineForJavaAPI(),e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastSentInvite",n)}}function po(){try{if(Fo("API_RecFiles_Upload"),webphone_api.global.phonestarted<2)return void Ho("API_RecFiles_Upload",[]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_Upload",null),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_Upload();webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_Upload not supported by engine: "+webphone_api.common.getuseengine())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_Upload",e)}return!1}function so(e,o){try{if(Fo("API_RecFiles_UploadEx"),webphone_api.global.phonestarted<2)return void Ho("API_RecFiles_UploadEx",[e,o]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_UploadEx",null,e,o),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_UploadEx(e,o);webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_UploadEx not supported by engine: "+webphone_api.common.getuseengine())}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_UploadEx",n)}return!1}function co(){try{if(Fo("API_RecFiles_Clear"),webphone_api.global.phonestarted<2)return void Ho("API_RecFiles_Clear",[]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_Clear",null),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_Clear();webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_Clear not supported by engine: "+webphone_api.common.getuseengine())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_Clear",e)}return!1}function uo(){try{if(Fo("API_RecFiles_Del"),webphone_api.global.phonestarted<2)return void Ho("API_RecFiles_Del",[]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_Del",null),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_Del();webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_Del not supported by engine: "+webphone_api.common.getuseengine())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_Del",e)}return!1}function go(e){try{return webphone_api.stringres.get(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: getstringresource",o)}return""}function mo(e,o){try{Fo("Jvoip-"+e);var n=io();if(webphone_api.common.isNull(n)||n.length<2)return void webphone_api.common.PutToDebugLog(2,"ERROR, Jvoip no engine available at the moment");if(n!==webphone_api.global.ENGINE_JAVA&&n!==webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.PutToDebugLog(2,"ERROR, Jvoip not applicable for engine: "+webphone_api.common.GetEngineDisplayName(n));if(webphone_api.common.isNull(e)||e.length<3)return void webphone_api.common.PutToDebugLog(2,"ERROR, Jvoip invalid api function name: "+e);var t=e.indexOf("(");t>0&&(e=e.substring(0,t)),e=webphone_api.common.Trim(e),webphone_api.common.isNull(o)&&(o=[]);for(var i="",a=0;a<o.length;a++)a>0&&(i+=","),i+=o[a];webphone_api.common.PutToDebugLog(2,"EVENT, USER, jvoip (API_Jvoip): "+e+"; arguments: ["+i+"]"),webphone_api.webphone.Jvoip(e,o)}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: Jvoip",r)}}function bo(){return webphone_api.common.GetOneStunSrv()}function ho(e,o){try{Fo("RemoveCodecMaudio");var n=e;if(webphone_api.common.isNull(o)||!1===webphone_api.common.IsNumber(o))return webphone_api.common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio invalid codec: "+o),e;if(webphone_api.common.isNull(n)||e.indexOf("m=audio")<0)return webphone_api.common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio invalid m=audio: "+n),e;var t=n.indexOf("/");if(t<0)return webphone_api.common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio cannot parse m=audio: "+n),e;var i=n.substring(0,t);return n=n.substring(t),n.indexOf(" "+o+" ")>=0?n=n.replace(" "+o+" "," "):n.indexOf(" "+o+"\r")>=0&&(n=n.replace(" "+o+"\r","\r")),i+n}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: RemoveCodecMaudio",a)}return e}function _o(e,o){try{Fo("SetPrefCodecMaudio");var n=e;if(webphone_api.common.isNull(o)||!1===webphone_api.common.IsNumber(o))return webphone_api.common.PutToDebugLog(2,"ERROR, SetPrefCodecMaudio invalid codec: "+o),e;if(webphone_api.common.isNull(n)||e.indexOf("m=audio")<0)return webphone_api.common.PutToDebugLog(2,"ERROR, SetPrefCodecMaudio invalid m=audio: "+n),e;var t=n.indexOf("/");if(t<0)return webphone_api.common.PutToDebugLog(2,"ERROR, SetPrefCodecMaudio cannot parse m=audio: "+n),e;var i=n.substring(0,t);if(n=n.substring(t),(t=n.indexOf(" "))>0)return i+=n.substring(0,t),n=n.substring(t),n.indexOf(" "+o+" ")>=0?(n=n.replace(" "+o+" "," "),n=" "+o+n):n.indexOf(" "+o+"\r")>=0&&(n=n.replace(" "+o+"\r","\r"),n=" "+o+n),i+n}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: RemoveCodecMaudio",a)}return e}function wo(e){try{var o=e,n=webphone_api.common.GetParameter("codec");if(webphone_api.common.isNull(n)||n.length<1||"-1"===n||","===n)return e;var t=n.split(",");if(webphone_api.common.isNull(t)||t.length<1)return e;for(var i=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_pcmu")),a=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_pcma")),r=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_speexwb")),l=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_opuswb")),p=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_isac")),s=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_g722")),c=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_h264")),u=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_h265")),g=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp8")),m=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp9")),b=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp10")),h=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_av1")),d=0;d<t.length;d++)if(!webphone_api.common.isNull(t[d])){var _=t[d].toLowerCase().trim();"1"===_?i=!0:"2"===_?a=!0:"5"===_||"6"===_?r=!0:"10"===_||"11"===_||"12"===_||"13"===_?l=!0:"14"===_?s=!0:"15"===_?p=!0:"50"===_?c=!0:"51"===_?u=!0:"52"===_?g=!0:"53"===_?m=!0:"54"===_?b=!0:"55"===_?h=!0:"pcmu"===_?i=!0:"pcma"===_?a=!0:"g.711"===_||"g711"===_?(i=!0,a=!0):"speex"===_||"speexwb"===_?r=!0:"opus"===_||"opuswb"===_?l=!0:"isac"===_?p=!0:"g.722"===_||"g722"===_?s=!0:"h.264"===_||"h264"===_?c=!0:"h.265"===_||"h265"===_?u=!0:"vp8"===_?g=!0:"vp9"===_?m=!0:"vp10"===_?b=!0:"av1"===_&&(h=!0)}!1===webphone_api.common.Glop()&&(l=!1);var w=!1;(i||a||r||l||p||s)&&(w=!0);var f=!1;if((c||u||g||m||b||h)&&(f=!0),!w&&!f)return webphone_api.common.PutToDebugLog(2,"EVENT, HandleWebrtcCodecs skip setting disabling all audio codec"),e;var v=o.split("\n");if(webphone_api.common.isNull(v)&&v.length<10)return e;for(var P=-1,d=0;d<v.length;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("m=audio")>=0){P=d;break}if(P<0)return webphone_api.common.PutToDebugLog(2,"ERROR, HandleWebrtcCodecs m=audio not found"),e;if(!1===i&&w){var E="0";v[P]=ho(v[P],E);for(var T=v.length,d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}if(!1===a&&w){var E="8";v[P]=ho(v[P],E);for(var T=v.length,d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}if(!1===r&&w){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("speex")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===l&&w){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("opus")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===p&&w){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("isac/16000")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===p&&w){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("isac/32000")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===p&&w){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("isac")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===s&&w){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("g722")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===c&&f){
for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("h264")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===u&&f){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("h265")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===g&&f){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("vp8")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===m&&f){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("vp9")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===b&&f){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("vp10")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}if(!1===h&&f){for(var E="",T=v.length,d=0;d<T;d++)if(!webphone_api.common.isNull(v[d])&&v[d].indexOf("a=rtpmap:")>=0&&v[d].toLowerCase().indexOf("av1")>0){E=v[d].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=ho(v[P],E);for(var d=0;d<T;d++)!webphone_api.common.isNull(v[d])&&(v[d].indexOf("a=rtpmap:"+E)>=0||v[d].indexOf("a=rtcp-fb:"+E)>=0||v[d].indexOf("a=fmtp:"+E)>=0)&&(v.splice(d,1),d--,T--)}}o="";for(var d=0;d<v.length;d++)o.length>0&&(o+="\n"),o+=v[d];return o}catch(S){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcCodecs",S)}return e}function fo(e){try{var o=e,n=webphone_api.common.GetParameter("prefcodec");if(webphone_api.common.isNull(n)||n.length<1||"-1"===n||","===n)return e;var t=!1,i=!1,a=!1,r=!1,l=!1,p=!1,s=!1,c=!1,u=!1,g=!1,m=!1,b=!1,h=n.toLowerCase().trim();if("1"===h?t=!0:"2"===h?i=!0:"5"===h||"6"===h?a=!0:"10"===h||"11"===h||"12"===h||"13"===h?r=!0:"14"===h?p=!0:"15"===h?l=!0:"50"===h?s=!0:"51"===h?c=!0:"52"===h?u=!0:"53"===h?g=!0:"54"===h?m=!0:"55"===h?b=!0:"pcmu"===h?t=!0:"pcma"===h?i=!0:"g.711"===h||"g711"===h?t=!0:"speex"===h||"speexwb"===h?a=!0:"opus"===h||"opuswb"===h?r=!0:"isac"===h?l=!0:"g.722"===h||"g722"===h?p=!0:"h.264"===h||"h264"===h?s=!0:"h.265"===h||"h265"===h?c=!0:"vp8"===h?u=!0:"vp9"===h?g=!0:"vp10"===h?m=!0:"av1"===h&&(b=!0),!1===webphone_api.common.Glop()&&(r=!1),!(t||i||a||r||l||p||s||c||u||g||m||b))return e;var d=o.split("\n");if(webphone_api.common.isNull(d)&&d.length<10)return e;for(var _=-1,w=0;w<d.length;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("m=audio")>=0){_=w;break}if(_<0)return webphone_api.common.PutToDebugLog(2,"ERROR, HandleWebrtcPrefCodec m=audio not found"),e;if(!0===t){var f="0";d[_]=_o(d[_],f);for(var v=d.length,w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}if(!0===i){var f="8";d[_]=_o(d[_],f);for(var v=d.length,w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}if(!0===a){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("speex")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===r){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("opus")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===l){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("isac")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===p){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("g722")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===s){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("h264")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===c){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("h265")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===u){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("vp8")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===g){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("vp9")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===m){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("vp10")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}if(!0===b){for(var f="",v=d.length,w=0;w<v;w++)if(!webphone_api.common.isNull(d[w])&&d[w].indexOf("a=rtpmap:")>=0&&d[w].toLowerCase().indexOf("av1")>0){f=d[w].replace("a=rtpmap:",""),f=webphone_api.common.Trim(f);var P=f.indexOf(" ");P>0&&(f=webphone_api.common.Trim(f.substring(0,P)))}if(!webphone_api.common.isNull(f)&&f.length>0){d[_]=_o(d[_],f);for(var w=0;w<v;w++)!webphone_api.common.isNull(d[w])&&(d[w].indexOf("a=rtpmap:"+f)>=0||d[w].indexOf("a=rtcp-fb:"+f)>=0||d[w].indexOf("a=fmtp:"+f)>=0)&&(d.splice(w,1),w--,v--)}}o="";for(var w=0;w<d.length;w++)o.length>0&&(o+="\n"),o+=d[w];return o}catch(E){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcPrefCodec",E)}return e}function vo(e){try{if("Firefox"!==webphone_api.common.GetBrowser()||webphone_api.common.GetBrowserVersion()<75)return e;if(void 0===e||null===e||e.indexOf("\r\n\r\n")<0)return e;var o=e.toLowerCase();if(o.indexOf("invite sip:")<0&&o.indexOf("invite sips:")<0)return e;var n=e,t=n.split("\n");if(webphone_api.common.isNull(t)&&t.length<10)return e;n="";for(var i=0,a=-1,r=-1,l=0;l<t.length;l++)t[l].indexOf("a=sendrecv")>=0&&(i++,a=l),t[l].indexOf("a=sendonly")>=0&&(i++,r=l);if(i>1&&a>0){r>0&&(t[a]=t[a].replace("a=sendrecv","a=sendonly")),t.splice(a,1),webphone_api.common.PutToDebugLog(2,"EVENT, HandleWebrtcFirefoxHold sendrecv removed_2");for(var l=0;l<t.length;l++)n.length>0&&(n+="\n"),n+=t[l];return n}}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcFirefoxHold",p)}return e}function Po(e){try{if(void 0===e||null===e)return e;if("Firefox"!==webphone_api.common.GetBrowser())return e;var o=e,n=o.split("\n");if(webphone_api.common.isNull(n)&&n.length<10)return e;o="";for(var t=0,i=-1,a=0;a<n.length;a++)n[a].indexOf("a=msid:")>=0&&(t++,i=a);if(t>1&&i>0){n.splice(i,1),webphone_api.common.PutToDebugLog(2,"EVENT, HandleWebrtcFirefoxHold_RemoveDuplicateHeader removed");for(var a=0;a<n.length;a++)o.length>0&&(o+="\n"),o+=n[a];return o}}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcFirefoxHold_RemoveDuplicateHeader",r)}return e}function Eo(){try{var e=!1,o=webphone_api.common.GetParameter("serveraddressbook_url");if(!webphone_api.common.isNull(o)&&o.length>0){var n=webphone_api.common.GetParameterInt("serveraddressbook_sync",0),t=webphone_api.common.GetParameterInt("serveraddressbook_status",2);t<1?e=!0:1===t&&n>0&&(e=!0),n>1&&(e=!0)}if(!0===e){webphone_api.common.IsHttps()&&(o=o.replace("http:","https:")),webphone_api.common.PutToDebugLog(3,"EVENT, DownloadServerAddressbook url: "+o);var i=new XMLHttpRequest;if("withCredentials"in i)i.open("GET",o,!0);else{if("undefined"==typeof XDomainRequest)return void webphone_api.common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook, CORS not supported");i=new XDomainRequest,i.open("GET",o)}var a=0;i.onload=function(){try{webphone_api.common.PutToDebugLog(4,"EVENT, DownloadServerAddressbook.onload"),a=19;var e=i.responseText;return a=20,webphone_api.common.PutToDebugLog(2,"EVENT, DownloadServerAddressbook response: "+e),a=21,webphone_api.common.isNull(e)||e.length<1?(a=23,void webphone_api.common.PutToDebugLog(2,"ERROR, DownloadServerAddressbook response is NULL")):void To(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"DownloadServerAddressbook.onload inner ("+a+")",o)}},i.onerror=function(e){var o="";webphone_api.common.isNull(e)||(o=e.toString(),webphone_api.common.isNull(e.target)||(o=webphone_api.common.isNull(e.target.status)?o+" "+e.target.toString():o+" "+e.target.status.toString())),webphone_api.common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook: onerror: "+o)},i.timeout=9e3,i.ontimeout=function(e){webphone_api.common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook: Timeout")},i.send()}}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: DownloadServerAddressbook",r)}}function To(e){try{if(webphone_api.common.isNull(e)||e.length<1)return;var o=e.split("\r\n"),n=0;if(webphone_api.common.isNull(o))return void webphone_api.common.PutToDebugLog(2,"ERROR, ParserServerAddressbook list is NULL: "+e);for(var t=0;t<o.length;t++)if(!(webphone_api.common.isNull(o[t])||o[t].length<3||o[t].indexOf("\t")<1)){var i=o[t].split("\t");if(!(webphone_api.common.isNull(i)||i.length<2)){var a=i[0],r=i[1],l=0,p="",s="",c="",u="";if(!(webphone_api.common.isNull(a)||a.length<1||webphone_api.common.isNull(r)||r.length<1)){i.length>2&&(webphone_api.common.isNull(i[2])||"1"!==webphone_api.common.Trim(i[2])||(l=1)),i.length>3&&!webphone_api.common.isNull(i[3])&&webphone_api.common.Trim(i[3]).length>3&&(p=webphone_api.common.Trim(i[3])),i.length>4&&!webphone_api.common.isNull(i[4])&&webphone_api.common.Trim(i[4]).length>3&&(s=webphone_api.common.Trim(i[4])),i.length>5&&!webphone_api.common.isNull(i[5])&&webphone_api.common.Trim(i[5]).length>0&&(c=webphone_api.common.Trim(i[5])),i.length>6&&!webphone_api.common.isNull(i[6])&&webphone_api.common.Trim(i[6]).length>3&&(u=webphone_api.common.Trim(i[6]));var g="sip",m=r.replace("+","");webphone_api.common.IsNumber(m)&&(g="phone"),n++;ge(a,r,l,g,webphone_api.common.GetTickCount(),p,s,c,u,"1")}}}webphone_api.common.PutToDebugLog(4,"EVENT, ParserServerAddressbook: "+n.toString()+" contacts added sucessfully")}catch(b){webphone_api.common.PutToDebugLogException(2,"plhandler: ParserServerAddressbook",b)}}function No(e,o){Fo("IsServiceInstalled"),webphone_api.common.IsServiceInstalled(e,o)}function So(){return Fo("CanIUseWebrtc"),webphone_api.common.CanIUseWebRTC()}function Io(e,o,n){Fo("ShowToast-"+e),webphone_api.common.ShowToast(e,o,n)}function Ro(e,o,n){Fo("AlertDialog-"+o),webphone_api.common.AlertDialog(e,o,n)}function Go(e,o,n,t,i){webphone_api.webphone.API_SetCredentials(e,o,n,t,i)}function Oo(e,o,n,t){webphone_api.webphone.API_SetCredentialsMD5(e,o,n,t)}function Lo(e){webphone_api.webphone.API_CheckVoicemail(e)}function Co(e){webphone_api.webphone.API_SetLine(e)}function Do(e){webphone_api.webphone.API_GetLine(e)}function yo(e){webphone_api.webphone.API_GetLineStatus(e)}function xo(e,o){webphone_api.webphone.API_Forward(e,o)}function Ao(e){webphone_api.webphone.API_IsMuted(e)}function ko(e){webphone_api.webphone.API_IsOnHold(e)}function Uo(e){webphone_api.webphone.API_GetAudioDeviceList(e)}function Vo(e){webphone_api.webphone.API_GetAudioDevice(e)}function Wo(e){webphone_api.webphone.API_SetAudioDevice(e)}function Mo(e){webphone_api.webphone.API_GetVolume(e)}function Fo(e){try{if(!0===webphone_api.common.IsWindowsSoftphone())return;if(!1===webphone_api.global.wploaded){var o="WARNING,WapiTouced API called before webphone loaded: "+e;if(webphone_api.common.PutToDebugLog(2,o),"undefined"!=typeof console&&null!==console)if("delsettings"===e&&"undefined"!=typeof console.log&&null!==console.log)try{console.log(o)}catch(n){}else if("undefined"!=typeof console.error&&null!==console.error)try{console.error(o)}catch(n){}else if("undefined"!=typeof console.log&&null!==console.log)try{console.log(o)}catch(n){}}}catch(t){webphone_api.common.PutToDebugLogSpecial(2,"EVENT, plhandler WapiTouced",!0,t)}}function Ho(e,arguments){webphone_api.common.isNull(e)||e.length<1||(Bo(),webphone_api.common.isNull(jn)&&(jn=[]),webphone_api.common.isNull(arguments)&&(arguments=[]),webphone_api.common.PutToDebugLog(2,"EVENT,AddToQueueEn cached for execution after engine start: "+e.toLowerCase()+"("+arguments.toString()+")"),arguments.unshift(e),arguments.unshift(webphone_api.common.GetTickCount().toString()),jn.push(arguments))}function Bo(){webphone_api.common.isNull(qn)&&(qn=setInterval(function(){if(++zn>1e5||zn>1e5&&(webphone_api.common.isNull(jn)||jn.length<1||webphone_api.global.phonestarted>=2))return void 0!==qn&&null!==qn&&clearInterval(qn),qn=null,jn=[],void(zn=0);if(!(webphone_api.common.isNull(jn)||jn.length<1)&&webphone_api.global.phonestarted>=2){var e=jn.shift();if(webphone_api.common.isNull(e)||e.length<2)return;var o=0;try{o=webphone_api.common.StrToInt(e[0])}catch(i){}e.shift();var n=e[0];if(webphone_api.common.isNull(n)||n.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, handle API function queue invalid name(engine: "+webphone_api.common.getuseengine()+"): "+n);if(webphone_api.common.GetTickCount()-o>6e5)return void webphone_api.common.PutToDebugLog(2,"ERROR, handle API function queue(engine: "+webphone_api.common.getuseengine()+"): "+n+" (too late)");e.shift();var t="";webphone_api.common.isNull(e)||(t=e.toString()),webphone_api.common.PutToDebugLog(2,"EVENT, handle API function queue(engine: "+webphone_api.common.getuseengine()+"): "+n+" ("+t+");"),$o(n,e)}},15))}function $o(e,arguments){var o=window.webphone_api.plhandler[e];"function"==typeof o&&o.apply(window,arguments)}function jo(e){try{if(webphone_api.common.isNull(e)||e.length<1||webphone_api.common.isNull(webphone_api.origparameters))return"";if("undefined"!=typeof webphone_api.origparameters[e]&&null!=webphone_api.origparameters[e]&&webphone_api.origparameters[e].toString().length>0){var o=webphone_api.origparameters[e];return o.indexOf("dcid_")>=0&&(o=webphone_api.common.StrDc(o,"X9hAm21TaGzqeR45Bj")),o}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetOrigConfigParam",n)}return""}function qo(e){try{if(webphone_api.common.isNull(e)||e.length<1)return"";var o=webphone_api.common.GetConfig(e),n=webphone_api.common.GetConfigAll(!0);if(!webphone_api.common.isNull(n)){var t="overwrite_"+e;"undefined"!=typeof n[t]&&null!==n[t]&&n[t].toString().length>0&&(o=n[t].toString())}"undefined"!=typeof webphone_api.parameters[e]&&null!=webphone_api.parameters[e]&&webphone_api.parameters[e].toString().length>0&&(o=webphone_api.parameters[e]);var i=window.location.href;if(!webphone_api.common.isNull(i)){var a=webphone_api.common.GetUrlParamVal(i,e);!webphone_api.common.isNull(a)&&a.toString().length>0&&(o=a)}return o.indexOf("dcid_")>=0&&(o=webphone_api.common.StrDc(o,"X9hAm21TaGzqeR45Bj")),o}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: GetCCParam",r)}return""}function zo(){try{var e=qo("serveraddress"),o=qo("webrtcserveraddress"),n=qo("proxyaddress"),t=qo("transport"),i=qo("realm"),a=jo("serveraddress"),r=jo("webrtcserveraddress"),l=jo("proxyaddress"),p=jo("transport"),s=jo("realm");webphone_api.common.isNull(e)&&(e=""),webphone_api.common.isNull(o)&&(o=""),webphone_api.common.isNull(n)&&(n=""),webphone_api.common.isNull(t)&&(t=""),webphone_api.common.isNull(i)&&(i=""),webphone_api.common.isNull(a)&&(a=""),webphone_api.common.isNull(r)&&(r=""),webphone_api.common.isNull(l)&&(l=""),webphone_api.common.isNull(p)&&(p=""),webphone_api.common.isNull(s)&&(s=""),e=e.toString().toLowerCase(),o=o.toString().toLowerCase(),n=n.toString().toLowerCase(),t=t.toString().toLowerCase(),i=i.toString().toLowerCase(),a=a.toString().toLowerCase(),r=r.toString().toLowerCase(),l=l.toString().toLowerCase(),p=p.toString().toLowerCase(),s=s.toString().toLowerCase();return e+o+i+n+t+a+r+s+l+p}catch(c){webphone_api.common.PutToDebugLogException(2,"plhandler: GetMainConfigsAsString",c)}return""}function Ko(){try{if(Kn)return;var e=webphone_api.common.GetParameter("lastwpapixxx"),o=fe("configversion"),n=fe("prevconfigversion");if(webphone_api.common.isNull(n)||!webphone_api.common.IsNumber(n)){var t=o;!webphone_api.common.isNull(t)&&webphone_api.common.IsNumber(t)||(t=0),webphone_api.common.SaveParameter("prevconfigversion",t)}var i=zo();!webphone_api.common.isNull(o)&&webphone_api.common.IsNumber(o)&&o>0&&!webphone_api.common.isNull(n)&&webphone_api.common.IsNumber(n)&&o!==n?(Kn=!0,webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"WARNING, DelSettings on start because configversion new: "+o+", old: "+n),oo(1,!1)):!webphone_api.common.isNull(e)&&e.length>0&&!webphone_api.common.isNull(i)&&i.length>0?(Kn=!0,e!==i?(webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"WARNING, DelSettings on start because main configs changed x"),webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings old config: "+e),webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings new config: "+i)),oo(1,!1),webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings new2 config: "+zo()),webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings new3 config: "+fe("serveraddress")+fe("webrtcserveraddress")+fe("realm")+fe("proxyaddress")+fe("transport")))):webphone_api.common.CanLog(5)&&webphone_api.common.PutToDebugLog(5,"EVENT, check config change old: "+e+", new: "+i)):webphone_api.common.CanLog(5)&&(!webphone_api.common.isNull(i)&&i.length>0?webphone_api.common.PutToDebugLog(5,"EVENT, check config change old: null, new: "+i):!webphone_api.common.isNull(e)&&e.length>0&&webphone_api.common.PutToDebugLog(5,"EVENT, check config change old: "+e+", new: null")),!webphone_api.common.isNull(i)&&i.length>0&&webphone_api.common.SaveParameter("lastwpapixxx",i)}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: ConfigChanged",a)}}var Jo="",Xo=!1,Yo=null;webphone_api.global.isfirststart=!0,1==webphone_api.common.IsSDK()&&(webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler call HandleSettingsSDK",!1,""),webphone_api.global.domloaded_tick=webphone_api.common.GetTickCount(),i(function(e){if(webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler onload HandleSettingsSDK FINISHED: "+e,!1,""),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: initialize start"),webphone_api.common.Glv()<1)return void(webphone_api.global.webrtcavailable=0);webphone_api.$(document).ready(function(){webphone_api.loadwebrtc_timestamp=webphone_api.common.GetTickCount(),webphone_api.webrtcapi.WebRtcIsSupported(function(e){function o(){if(webphone_api.common.EngineSelect(0,27),webphone_api.common.SetLanguage(),Ko(),!1===webphone_api.global.onloaded_called){webphone_api.global.wploaded=!0,webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler webphone onLoaded",!1,"");try{webphone_api.onAppStateChangeCb("loaded")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(loaded) callback",e)}try{webphone_api.onLoadedCb()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onLoaded() callback",e)}try{!0===webphone_api.common.IsWebphoneInIframe()&&webphone_api.WebphoneSendMessageToParent("wploadedandready_IFRAME")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: send loaded state message to iframe parent page",e)}webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onload,"onLoad","","","",""),webphone_api.global.onloaded_called=!0,setTimeout(function(){webphone_api.global.onloaded_called=!1},5e3),webphone_api.webphone_loaded=!0,webphone_api.common.WebphoneIsLoaded()}}if("Windows"===webphone_api.common.GetOs()&&("MSIE"===webphone_api.common.GetBrowser()?e=!1:"Edge"===webphone_api.common.GetBrowser()&&(webphone_api.common.GetBrowserVersion()<14?e=!1:!1===e&&webphone_api.common.PutToDebugLog(2,"ERROR,plhandler Edge webrtc is not supported, getusermedia: "+typeof navigator.getUserMedia+"; RTCPeerConnection: "+typeof window.RTCPeerConnection))),"iOS"===webphone_api.common.GetOs()?(("Safari"===webphone_api.common.GetBrowser()||"iPhone"===webphone_api.common.GetBrowser())&&webphone_api.common.GetBrowserVersion()<11&&(e=!1),"Firefox"!==webphone_api.common.GetBrowser()||navigator.mozGetUserMedia||navigator.GetUserMedia||(e=!1),"Chrome"!==webphone_api.common.GetBrowser()||navigator.webkitGetUserMedia||navigator.GetUserMedia||(e=!1)):"Windows"===webphone_api.common.GetOs()&&"Safari"===webphone_api.common.GetBrowser()&&(e=!1),webphone_api.common.isNull(e)&&(e=""),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: initialize LoadWebrtc engine: "+e),!0===e){webphone_api.global.webrtcavailable=1,webphone_api.common.PutToDebugLog(2,"webrtc engine available (plh)");var n=webphone_api.common.GetEngine("webrtc"),t=webphone_api.common.GetParameter2("serveraddress_user");(webphone_api.common.isNull(t)||t.length<2)&&(t=webphone_api.common.GetParameter2("serveraddress")),(webphone_api.common.isNull(t)||t.length<2)&&(t=webphone_api.common.GetConfig("serveraddress")),webphone_api.common.isNull(t)&&(t=""),webphone_api.common.IsLanIP(webphone_api.common.GetWebrtcUpperServer())||t.length>0&&webphone_api.common.IsLanIP(t)?webphone_api.common.isNull(n)||(n.issupported_cache=0,n.available=0):!0===webphone_api.common.BrowserRequiresHttps(!0)?webphone_api.common.isNull(n)||(n.issupported_cache=1,n.available=2):webphone_api.common.isNull(n)||(n.issupported_cache=2,n.available=3)}else!1===e&&(webphone_api.global.webrtcavailable=0,webphone_api.common.PutToDebugLog(2,"webrtc engine NOT available"));!0===webphone_api.common.UseCustomAutoprov(!0)?webphone_api.common.GetCustomAutoprov(function(e){webphone_api.common.RecAutoprovCustom(e),o()}):o()})})}));var Qo=null,Zo=!1,en=null,on=!1,nn=null,tn=10,an=185,rn=null,ln=null,pn=!1,sn=0,cn="",un=!1,gn=null,mn=0,bn=0,hn=!1,dn=!1,_n=null,wn=-1,fn=0,vn=0,Pn=null,En=null,Tn=!1,Nn=0,Sn=null,In=0,Rn=0,Gn=null,On=[],Ln=[],Cn=null,Dn=null,yn=!1,xn=[],An=[],kn=null,Un=[],Vn=[],Wn=null,Mn=[],Fn=[],Hn=[],Bn=[],$n=null,jn=[],qn=null,zn=0,Kn=!1;return{Start:e,StartUp:t,Register:m,RegisterEx:h,CheckPresence:d,SetPresenceStatus:_,CheckBLF:w,GetVersionNS:f,GetVersionNSNum:v,GetVersionJava:P,IsEncrypted:E,SetSipHeader:T,GetSipHeader:S,GetSipHeaderInternal:N,GetSipMessage:I,ChangeTheme:R,GetWorkDir:G,Call:y,VideoCall:O,MuteVideo:L,ScreenShare:C,StopScreenShare:k,Hangup:U,Accept:W,Reject:M,Ignore:F,SetVideoSize:H,GetAvailableCallfunc:B,Forward:$,Conference:q,Transfer:z,Dtmf:K,MuteEx:J,IsMuted:X,Hold:Y,IsOnHold:Z,SendChat:ee,SendSms:ne,Voicerecord:te,DevicePopup:re,SetVolume:le,GetVolume:pe,SetLoudspeaker:se,PlaySound:ce,AddContact:ue,SaveTheContact:ge,DeleteContact:me,GetContact:he,ListContacts:de,ListCallhistory:_e,SetParameter:we,GetParameter:fe,SetLine:ve,GetLine:Pe,LineToCallID:Ee,CallIDToLine:Te,IsRegistered:Le,IsInCall:Ce,GetDeviceList:De,GetDevice:ye,SetDevice:xe,StopEngine:Ae,Stop:ke,HelpWindow:We,BrowserWindowIsActive:Ve,SettingsPage:Me,DialPage:Fe,MessageInboxPage:He,MessagePage:Be,AddContactPage:$e,InsertApplet:je,EnterKeyPress:qe,FileTransferCallback:ze,GetTelsearchName:Ke,Cfin:D,bwanswer:Je,onappexit:Xe,getlogs:Ye,getlogsex:Qe,putlogs:Ze,ImportContacts:eo,delsettings:oo,needratingrequest:no,IsMobileBrowser:to,Getenginename:io,GetLastInvite:ao,GetLastRecInvite:ro,GetLastSentInvite:lo,getstringresource:go,Jvoip:mo,GetStatus:ie,GetRegFailReason:ae,Unregister:Re,UnregisterEngine:Ge,HTTPKeepAlive:Oe,GetLineDetails:Ne,GetLastCallDetails:Se,GetIncomingDisplay:Ie,ParseReceivedParameters:r,GetOneStunSrv:bo,HandleWebrtcCodecs:wo,HandleWebrtcPrefCodec:fo,HandleWebrtcFirefoxHold:vo,HandleWebrtcFirefoxHold_RemoveDuplicateHeader:Po,IsServiceInstalled:No,CanIUseWebrtc:So,API_SetCredentials:Go,API_SetCredentialsMD5:Oo,API_CheckVoicemail:Lo,API_SetLine:Co,API_GetLine:Do,API_GetLineStatus:yo,API_Forward:xo,API_IsMuted:Ao,API_IsOnHold:ko,API_GetAudioDeviceList:Uo,API_GetAudioDevice:Vo,API_SetAudioDevice:Wo,API_GetVolume:Mo,API_RecFiles_Upload:po,API_RecFiles_UploadEx:so,API_RecFiles_Clear:co,API_RecFiles_Del:uo,SendChatIsComposing:Ue,ShowToast:Io,AlertDialog:Ro,LoginSkin:u,GetAudioDevicesForMenu:g,ConfigChanged:Ko}}(),webphone_api.webphone=function(){function e(){try{webphone_api.common.PutToDebugLog(2,"EVENT, webphone Init called"),Me=!1,Fe=null,He=0,Be=!1,$e=!0,je=!1,qe=!1,Ye=!1,Qe=0,webphone_api.webphone_pollstatus=!0,webphone_api.global.apppletloaded=!1}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: Init",e)}}function o(){try{webphone_api.common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs called"),void 0!==Xe&&null!==Xe&&clearTimeout(Xe),Xe=setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs starting timer"),!0===webphone_api.webphone_pollstatus&&(webphone_api.common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs starting status polling"),je=!0,webphone_api.global.polltimerid=setInterval(function(){webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&Fe&&Fe.API_Poll&&webphonetojs(Fe.API_Poll())},Ke))},Je),setTimeout(function(){!0===je&&webphone_api.common.WinAPI("API_RegisterNoParam",function(){webphone_api.common.PutToDebugLog(2,"ERROR, webphone API_RegisterNoParam called")})},Je+1e3)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: CheckWebphonetojs",e)}}function n(){try{webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("initializing")),e();try{if(!webphone_api.common.isNull(webphone_api.global.settmap2)){for(var o in webphone_api.global.settmap2){var n=webphone_api.global.settmap2[o];if(!webphone_api.common.isNull(n)&&!(o.indexOf("server")<0&&o.indexOf("username")<0&&o.indexOf("password")<0&&"1"===n[webphone_api.common.SETT_ISDEFAULT])){if("username"===o||"sipusername"===o||"password"===o){var i=n[webphone_api.common.SETT_VALUE];if(!webphone_api.common.isNull(i)&&i.length>0){i=t(i),ze[o]=i;continue}}if("serveraddress"===o){var i=n[webphone_api.common.SETT_VALUE],a=ze.serveraddress;if((webphone_api.common.isNull(i)||i.length<1)&&a.length>1)continue;if((webphone_api.common.isNull(a)||a.length<1)&&(webphone_api.common.isNull(i)||i.length<1)){ze.serveraddress=webphone_api.common.GetParameter("serveraddress_user");continue}}else if("serveraddress_orig"===o)o="serveraddress";else if("upperserver"===o){var i=n[webphone_api.common.SETT_VALUE],a=webphone_api.common.GetParameter("serveraddress_orig");i===a||i.length<1?ze[o]="":ze[o]=webphone_api.common.GetParameter("serveraddress_orig")}else"aec"===o?o="aec_orig":"agc"===o?o="agc_orig":"denoise"===o?o="denoise_orig":"plc"===o?o="plc_orig":"has_video"===o?"0"===webphone_api.common.GetParameter2("video")?ze[o]="false":ze[o]="true":ze[o]=n[webphone_api.common.SETT_VALUE]}}var r=webphone_api.common.GetParameter("extraoption");if(!webphone_api.common.isNull(r)&&r.length>0){r=webphone_api.common.Trim(r);var l=r.split(";");if(!webphone_api.common.isNull(l)&&l.length>0)for(var p=0;p<l.length;p++)if(!(webphone_api.common.isNull(l[p])||l[p].length<1||l[p].indexOf("=")<1)){var o=webphone_api.common.Trim(l[p].substring(0,l[p].indexOf("="))),n=webphone_api.common.Trim(l[p].substring(l[p].indexOf("=")+1));!webphone_api.common.isNull(o)&&o.length>0&&!webphone_api.common.isNull(n)&&(ze[o]=n)}}
}webphone_api.common.GetConfig("upperserverip").length>0&&(ze.upperserverip=webphone_api.common.GetConfig("upperserverip")),webphone_api.common.GetConfig("upperserverdomain").length>0&&(ze.upperserverdomain=webphone_api.common.GetConfig("upperserverdomain")),ze.jsscriptevent=3,(webphone_api.common.isNull(ze.serveraddress_orig)||ze.serveraddress_orig.length<1)&&(ze.serveraddress_orig=ze.serveraddress);var s=webphone_api.parameters.customsipheader;if(!webphone_api.common.isNull(s)&&s.length>0&&(s=webphone_api.common.Trim(s),!webphone_api.common.isNull(ze.customsipheader)&&ze.customsipheader.toString().length>0?ze.customsipheader.lastIndexOf(";")<ze.customsipheader.length-1&&(ze.customsipheader=ze.customsipheader+";"):ze.customsipheader="",ze.customsipheader=ze.customsipheader+s),ze.extraregisteraccounts="",!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>0){for(var p=0;p<webphone_api.global.sipaccounts.length;p++){var c=webphone_api.global.sipaccounts[p];if(!(webphone_api.common.isNull(c)||c.length<4)&&(!0!==c.ismain&&!1!==c.enabled)){var u=c.serveraddress,g=c.username,m=c.password,b=c.callerid,h=c.displayname,d=c.proxyaddress,_=c.realm;void 0!==u&&null!==u||(u=""),void 0!==g&&null!==g||(g=""),void 0!==m&&null!==m||(m=""),void 0!==b&&null!==b||(b=""),void 0!==h&&null!==h||(h=""),void 0!==d&&null!==d||(d=""),void 0!==_&&null!==_||(_=""),webphone_api.common.Trim(b).length<1&&(b=g),ze.extraregisteraccounts.length>0&&(ze.extraregisteraccounts=ze.extraregisteraccounts+";"),ze.extraregisteraccounts=ze.extraregisteraccounts+u+","+b+","+m+","+c.ival+","+d+","+_+","+g}}var w=webphone_api.common.GetExtraRegAccFromAPIparam();!webphone_api.common.isNull(w)&&w.length>5&&(ze.extraregisteraccounts.length>0&&(ze.extraregisteraccounts=ze.extraregisteraccounts+";"),ze.extraregisteraccounts=ze.extraregisteraccounts+w)}ze.autohold="0",ze.automute="0",webphone_api.common.CanLog(4)&&webphone_api.common.LogAllParameters("Webphone all parameters:",ze)}catch(f){webphone_api.common.PutToDebugLogException(2,"webphone: Start Setting parameters",f)}be(),setTimeout(function(){no=webphone_api.common.GetTickCount(),de()},1e3)}catch(f){webphone_api.common.PutToDebugLogException(2,"webphone: Start",f)}}function t(e){try{if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(2,"ERROR, wp B4 invalid extracted value"),"";if(e.length<1)return"";var o=e;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){if(o.indexOf("=")>=0)return o="Bb7Sb2VVVVV_"+webphone_api.common.B64Enc(o)}else if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||!0===webphone_api.common.IsWindowsSoftphone()){var n=webphone_api.common.GetParameterInt("srvupgrade_currversion",0);if(n>18&&(o.indexOf("%")>=0||o.indexOf("^")>=0||o.indexOf("&")>=0||o.indexOf("<")>=0||o.indexOf(">")>=0||o.indexOf("|")>=0||o.indexOf("'")>=0||o.indexOf("`")>=0||o.indexOf(",")>=0||o.indexOf(";")>=0||o.indexOf("=")>=0||o.indexOf("(")>=0||o.indexOf(")")>=0||o.indexOf("!")>=0||o.indexOf('"')>=0||o.indexOf("\\")>=0||o.indexOf("[")>=0||o.indexOf("]")>=0||o.indexOf('"')>=0||o.indexOf(".")>=0||o.indexOf("*")>=0||o.indexOf("?")>=0))return o="Bb7Sb2VVVVV_"+webphone_api.common.B64Enc(o)}}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: B64EncUserPwd",t)}return e}function i(){function n(e){webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"EVENT, webphone: StartWin: API_SetParameters called"),webphone_api.common.PutToDebugLog(4,"EVENT, webphone: StartWin: API_SetParameters paramlist: "+a)),i=37,webphone_api.common.WinAPI("API_SetParameters",function(e){Ye=!0,Qe=0,i=41,webphone_api.common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0&&webphone_api.common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_SetParameters callback: failed to save settings"),i=42,webphone_api.global.apistartstate=1,webphone_api.global.apistarttick=webphone_api.common.GetTickCount(),webphone_api.common.WinAPI("API_Start",function(e){i=43,webphone_api.common.SetDID(),qe=!0,i=44,webphone_api.common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0?(i=45,webphone_api.common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_Start callback: failed to start webphone (1), answ: "+e)):(i=46,r(),setTimeout(function(){webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2)},1e3))}),i=47,o()},e),setTimeout(function(){webphone_api.common.GetSrvVersions()},1e3)}var i=0;webphone_api.common.PutToDebugLog(2,"EVENT, webphone: StartWin called"),webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("initializing"));try{e(),i=1;var a="",l=[];if(!webphone_api.common.isNull(webphone_api.global.settmap2)){i=2;for(var p in webphone_api.global.settmap2)if(!(webphone_api.common.isNull(p)||p.length<1)){var s=webphone_api.global.settmap2[p];"has_video"===p&&("0"===webphone_api.common.GetParameter2("video")?s[0]="false":s[0]="true"),p.indexOf("server")<0&&p.indexOf("username")<0&&p.indexOf("password")<0&&"1"===s[webphone_api.common.SETT_ISDEFAULT]||(l[p]=s[0])}i=3}i=4;for(var p in ze)if(!(webphone_api.common.isNull(p)||p.length<1||"username"===p&&!webphone_api.common.isNull(l[p])&&l[p].length>0&&(webphone_api.common.isNull(ze[p])||ze[p].length<1))){if("loglevel"===p)try{webphone_api.common.GetLogLevel()>1?l.jsscriptevent="3":l.jsscriptevent="2"}catch(S){}l[p]=ze[p]}i=5,!webphone_api.common.isNull(webphone_api.common.GetConfig("upperserverip"))&&webphone_api.common.GetConfig("upperserverip").length>0&&(l.upperserverip=webphone_api.common.GetConfig("upperserverip")),i=11,!webphone_api.common.isNull(webphone_api.common.GetConfig("upperserverdomain"))&&webphone_api.common.GetConfig("upperserverdomain").length>0&&(l.upperserverdomain=webphone_api.common.GetConfig("upperserverdomain")),i=12,webphone_api.common.isNull(l.serveraddress_orig||l.serveraddress_orig.length<1)&&(l.serveraddress_orig=l.serveraddress),i=13;var c=webphone_api.parameters.customsipheader;if(!webphone_api.common.isNull(c)&&c.length>0&&(i=14,c=webphone_api.common.Trim(c),!webphone_api.common.isNull(l.customsipheader)&&l.customsipheader.toString().length>0?(i=15,l.customsipheader.lastIndexOf(";")<l.customsipheader.length-1&&(l.customsipheader=l.customsipheader+";",i=16)):(i=17,l.customsipheader=""),l.customsipheader=l.customsipheader+c),i=21,l.extraregisteraccounts="",!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>0){for(var u=0;u<webphone_api.global.sipaccounts.length;u++){var g=webphone_api.global.sipaccounts[u];if(!(webphone_api.common.isNull(g)||g.length<4)&&(!0!==g.ismain&&!1!==g.enabled)){var m=g.serveraddress,b=g.username,h=g.password,d=g.callerid,_=g.displayname,w=g.proxyaddress,f=g.realm;void 0!==m&&null!==m||(m=""),void 0!==b&&null!==b||(b=""),void 0!==h&&null!==h||(h=""),void 0!==d&&null!==d||(d=""),void 0!==_&&null!==_||(_=""),void 0!==w&&null!==w||(w=""),void 0!==f&&null!==f||(f=""),webphone_api.common.Trim(d).length<1&&(d=b),l.extraregisteraccounts.length>0&&(l.extraregisteraccounts=l.extraregisteraccounts+";"),l.extraregisteraccounts=l.extraregisteraccounts+m+","+d+","+h+","+g.ival+","+w+","+f+","+b}}var v=webphone_api.common.GetExtraRegAccFromAPIparam();!webphone_api.common.isNull(v)&&v.length>5&&(ze.extraregisteraccounts.length>0&&(l.extraregisteraccounts=l.extraregisteraccounts+";"),l.extraregisteraccounts=l.extraregisteraccounts+v)}(webphone_api.common.isNull(l.loglevel)||l.loglevel.toString().length<1)&&(l.loglevel=webphone_api.common.GetLogLevel().toString()),webphone_api.common.isNull(a)&&(a="");for(var p in l)if(!(webphone_api.common.isNull(p)||p.length<1||"callto"===p||"platform"===p)){if(p.length>9){if(0==p.indexOf("transfertype")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("transfwithreplace")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("allowreplace")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("discontransfer")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("disconincomingrefer")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("inversetransfer")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("transferdelay")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("newdialogforrefer")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("useserverdomainforrefer")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue;if(0==p.indexOf("holdontransfer")&&p.charAt(p.length-1)>="0"&&p.charAt(p.length-1)<="9")continue}"autohold"!==p&&"automute"!==p||(l[p]="0"),"sippassword"===p&&(p="password");var P=l[p];"password"===p&&!webphone_api.common.isNull(P)&&P.length>0&&(P=t(P)),!webphone_api.common.isNull(P)&&P.toString().length>0&&(a.length>0&&(a+="\r\n"),a=a+p+"="+P)}i=22;var E=webphone_api.common.GetMinServiceVersion();a=a+"\r\nminserviceversion="+E,i=27,"rigitel"===webphone_api.common.GetConfig("brandname").toLowerCase()&&(a+="\r\nhasincomingcall=false");var T=webphone_api.common.GetNPLocation();i=31,webphone_api.common.isNull(T)&&(T=""),i=32;var N=T.indexOf("native/");N>0&&(T=T.substr(0,N)),i=33,a=a+"\r\nwebphoneurl="+T,i=34,a+="\r\ndummy=3",i=35,a="akarmidw=true\r\n"+a,i=36,n(a),Ze=setInterval(function(){return!0===Ye?(webphone_api.common.isNull(Ze)||clearInterval(Ze),Ze=null,void(Qe=0)):++Qe>15?(webphone_api.common.PutToDebugLog(2,"ERROR, API_Setparameters timer reached maxloop"),webphone_api.common.isNull(Ze)||clearInterval(Ze),void(Ze=null)):(webphone_api.common.PutToDebugLog(2,"ERROR, API_Setparameters try to send parameters again, because earlier send failed"),void n(a))},1e3),i=51,setTimeout(function(){i=52,qe||!0!==Ye||(i=53,webphone_api.global.apistartstate=1,webphone_api.global.apistarttick=webphone_api.common.GetTickCount(),webphone_api.common.WinAPI("API_Start",function(e){i=54,webphone_api.common.SetDID(),webphone_api.common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0?(i=55,webphone_api.common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_Start callback: failed to start webphone (2) answ: "+e)):(i=56,r())})),i=57,qe=!1},2500),webphone_api.common.GetCustomMenus(),i=58}catch(I){webphone_api.common.PutToDebugLogException(2,"webphone: StartWin ("+i.toString()+")",I)}}function a(){try{webphone_api.common.PutToDebugLog(3,"EVENT, StartService"),i()}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: StartService",e)}}function r(){}function l(){try{return _e()?Fe.API_Restart():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Restart(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: Restart",e)}}function p(e){try{return _e()?Fe.API_PushContactlist(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: PushContactlist(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: PushContactlist",o)}}function s(e){try{return _e()?Fe.API_CheckPresence(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: CheckPresence(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: CheckPresence",o)}}function c(e){try{return _e()?Fe.API_SetPresenceStatus(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetPresenceStatus(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: SetPresenceStatus",o)}}function u(e){try{return _e()?Fe.API_CheckBLF(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: CheckBLF(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: CheckBLF",o)}}function g(){try{return _e()?Fe.API_GetExeVersion():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVersionNS(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetVersionNS",e)}return 0}function m(){try{return _e()?Fe.API_GetExeVersionNumber():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVersionNSNum(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetVersionNSNum",e)}return 0}function b(){try{return _e()?Fe.API_GetVersion():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVersionJava(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetVersionJava",e)}return 0}function h(){try{return _e()?Fe.API_IsEncrypted():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsEncrypted(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: IsEncrypted",e)}return 0}function d(e){try{return _e()?Fe.RegisterEx(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: RegisterEx(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: RegisterEx",o)}}function _(e,o){try{return _e()?Fe.API_SetSIPHeader(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetSipHeader(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SetSipHeader",n)}}function w(e,o){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetSipHeader(), no applethandle "),"ERROR, webphone: GetSipHeader(), no applethandle";return Fe.API_GetSIPHeader(e,o)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetSipHeader",n)}return""}function f(e,o){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetSipHeaderInternal(), no applethandle "),"ERROR, webphone: GetSipHeader(), no applethandle";return Fe.API_GetSipHeaderInternal(e,o)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetSipHeaderInternal",n)}return""}function v(e,o,n){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetSipMessage(), no applethandle "),"ERROR, webphone: GetSipMessage(), no applethandle";return Fe.API_GetSIPMessage(e,o,n)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetSipMessage",t)}return""}function P(e,o){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetGetLastInvite(), no applethandle "),"";o(Fe.API_GetLastInvite(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetGetLastInvite",n)}o("")}function E(e,o){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetGetLastRecInvite(), no applethandle "),"";o(Fe.API_GetGetLastRecInvite(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetGetLastRecInvite",n)}o("")}function T(e,o){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetGetLastSentInvite(), no applethandle "),"";o(Fe.API_GetGetLastSentInvite(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetGetLastSentInvite",n)}o("")}function N(){try{return _e()?Fe.API_GetWorkdir():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetWorkDir(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetWorkDir",e)}return""}function S(){try{return _e()?Fe.API_Unregister():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Unregister(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: Unregister",e)}}function I(){try{return _e()?Fe.API_ReRegister():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: ReRegister(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: ReRegister",e)}}function R(){try{return _e()?Fe.API_HTTPKeepAlive():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: HTTPKeepAlive(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: HTTPKeepAlive",e)}}function G(e,o){try{return _e()?Fe.API_Call(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Call(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Call",n)}}function O(e){try{return _e()?Fe.API_Hangup(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Hangup(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: Hangup",o)}}function L(e){try{return _e()?Fe.API_Accept(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Accept(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: Accept",o)}}function C(e){try{return _e()?Fe.API_Reject(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Reject(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: Reject",o)}}function D(e){try{return _e()?Fe.API_Ignore(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Ignore(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: Ignore",o)}}function y(e,o){try{return _e()?Fe.API_Forward(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Forward(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Forward",n)}}function x(e){try{return _e()?Fe.API_Conf(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Conference(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: Conference",o)}}function A(e,o,n){try{return _e()?Fe.API_ConfEx(e,o,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: ConferenceEx(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: ConferenceEx",t)}}function k(e,o){try{return _e()?Fe.API_Transfer(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Transfer(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Transfer",n)}}function U(e,o){try{return _e()?Fe.API_Dtmf(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Dtmf(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Dtmf",n)}}function V(e,o,n){try{return _e()?Fe.API_MuteEx(e,o,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: MuteEx(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: MuteEx",t)}}function W(e){try{return _e()?Fe.API_IsMuted(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsMuted(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: IsMuted",o)}}function M(e,o){try{return _e()?Fe.API_Hold(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Hold(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Hold",n)}}function F(e){try{return _e()?Fe.API_IsOnHold(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsOnHold(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: IsOnHold",o)}}function H(e,o,n,t){try{return _e()?Fe.API_SendChat(e,o,n,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SendChat(), no applethandle "),!1)}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: SendChat",i)}}function B(e,o,n){try{return _e()?Fe.API_VoiceRecord(e,o,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: VoiceRecord(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: VoiceRecord",t)}}function $(){try{return _e()?Fe.API_AudioDevice():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: AudioDevice(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: AudioDevice",e)}}function j(e,o){try{return _e()?Fe.API_SetVolume(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetVolume(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SetVolume",n)}}function q(e){try{return _e()?Fe.API_GetVolume(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVolume(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetVolume",o)}}function z(e,o,n,t,i,a,r){try{return _e()?Fe.API_PlaySound(e,o,n,t,i,a,r):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: PlaySound(), no applethandle "),!1)}catch(l){webphone_api.common.PutToDebugLogException(2,"webphone: PlaySound",l)}return!1}function K(e,o){var n="";try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetRegFailReason(), no applethandle "),!1;n=Fe.API_GetRegFailReason(o)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetVolume",t)}e(n)}function J(e,o){try{if(!Be)return;return webphone_api.common.isNull(webphone_api.global.maintimerid)?(webphone_api.common.PutToDebugLog(3,"EVENT, webphone: SetParameter: cannot set parameter, because webphone is not running"),!1):"callto"!==e&&(_e()?Fe.API_SetParameter(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetParameter(), no applethandle "),!1))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SetParameter",n)}}function X(e){try{if(webphone_api.common.isNull(e)||e<-4||e>35)return webphone_api.common.PutToDebugLog(3,"EVENT, webphone: SetLine: invalid line"),!1;if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetLine(), no applethandle "),!1;Fe.API_SetLine(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: SetLine",o)}}function Y(e){try{if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"EVENT, webphone: SetLineEx: invalid line"),!1;if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetLineEx(), no applethandle "),!1;Fe.API_SetLineEx(e)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: SetLine",o)}}function Q(){try{return _e()?Fe.API_GetLine():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetLine(), no applethandle "),-1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetLine",e)}return-1}function Z(e){try{return _e()?Fe.API_LineToCallID(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: LineToCallID(), no applethandle "),-1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: LineToCallID",o)}return""}function ee(e){try{return _e()?Fe.API_CallIDToLine(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: CallIDToLine(), no applethandle "),-1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: CallIDToLine",o)}return-10}function oe(e){try{return _e()?Fe.API_GetLineDetails(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetLineDetails(), no applethandle "),"")}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetLineDetails",o)}return""}function ne(){try{return _e()?Fe.API_IsRegistered():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsRegistered(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: IsRegistered",e)}}function te(e){try{return _e()?Fe.API_GetAudioDeviceList(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetAudioDeviceList(), no applethandle "),"")}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetAudioDeviceList",o)}}function ie(e){try{return _e()?Fe.API_GetAudioDevice(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetAudioDevice(), no applethandle "),"")}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetAudioDevice",o)}}function ae(e,o,n){try{return _e()?Fe.API_SetAudioDevice(e,o,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetAudioDevice(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: SetAudioDevice",t)}}function re(e,o,n,t){try{return _e()?Fe.API_SetPushNotifications(e,o,n,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetPushNotifications(), no applethandle "),!1)}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: SetPushNotifications",i)}}function le(){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Exit(), no applethandle "),!1;var e=Fe.API_Exit();return webphone_api.common.isNull(e)&&(e=!1),webphone_api.common.PutToDebugLog(3,"EVENT, webphone: Exit result: "+e.toString()),e}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: Exit",o)}}function pe(e,o){try{return _e()?Fe.API_SendChatIsComposing(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SendChatIsComposing(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SendChatIsComposing",n)}}function se(e){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: NeedRatingRequest(), no applethandle "),e(!1),!1;e(Fe.API_NeedRatingRequest())}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: NeedRatingRequest",o)}}function ce(){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetLastCallDetails(), no applethandle "),webphone_api.global.lastcalldetails;var e=Fe.API_GetLastCallDetails();if(!webphone_api.common.isNull(e)&&e.length>0){var o=e.split(",");webphone_api.common.isNull(o)&&(o="");for(var n="",t=0;t<o.length;t++)webphone_api.common.isNull(o[t])||o[t].length<1||(n.length>0&&(n+="<br>"),n+=webphone_api.common.Trim(o[t]));if(n.length>0)return n}}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: GetLastCallDetails",i)}return webphone_api.global.lastcalldetails}function ue(){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetIncomingDisplay(), no applethandle "),"";var e=Fe.API_GetIncomingDisplay();return webphone_api.common.PutToDebugLog(5,"EVENT, webphone: API_GetIncomingDisplay: "+e),e}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetIncomingDisplay",o)}return""}function ge(e){try{return _e()?Fe.API_DelSettings(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: DelSettings(), no applethandle "),"")}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: DelSettings",o)}return""}function me(e,o){try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Jvoip(), no applethandle "),!1;Fe[e].apply(Fe,o)}else if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE){var n=null,t=null,i=null,a=null,r=null,l=null,p=null,s=null,c=null;if(!webphone_api.common.isNull(o)&&o.length>0)for(var u=0;u<o.length;u++)0===u&&(n=o[0]),1===u&&(t=o[1]),2===u&&(i=o[2]),3===u&&(a=o[3]),4===u&&(r=o[4]),5===u&&(l=o[5]),6===u&&(p=o[6]),7===u&&(s=o[7]),8===u&&(c=o[8]);webphone_api.common.WinAPI(e,null,n,t,i,a,r,l,p,s,c)}}catch(g){webphone_api.common.PutToDebugLogException(2,"webphone: Jvoip",g)}}function be(){try{if(webphone_api.global.apppletloaded)return;return webphone_api.global.apppletloaded=!0,webphone_api.common.PutToDebugLog(2,"EVENT, webphone LoadApplet called"),window.attributes=ke,window.parameters=ze,mwpdeploy.runApplet(ke,ze,"1.5"),$e=webphone_api.common.GetParameterBool("isfirststart",!0),Me=!0,!0}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: LoadApplet",e)}}function he(e){try{webphone_api.common.PutToDebugLog(2,"EVENT, webphone LoadApplet InsertApplet called"),webphone_api.$("#wpappletconatiner").remove();var o='<div id="wpappletconatiner" style="z-index:10000; position:absolute; float:left; top:0; left:0; line-height: 1px; font-size: 1px;">'+e+"</div>";webphone_api.$("body").append(o),webphone_api.common.PutToDebugLog(2,"EVENT, webphone LoadApplet InsertApplet inserted")}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: InsertApplet",n)}}function de(){if(He>20)return void webphone_api.common.PutToDebugLog(2,"ERROR, waitForWebphone maxloop elapsed");if(webphone_api.global.useengine.length>0&&"java"!==webphone_api.global.useengine)return void webphone_api.common.PutToDebugLog(2,"ERROR, waitForWebphone useengine not set or incorrect: "+webphone_api.global.useengine);if(webphone_api.common.GetTickCount()-no>45e3&&webphone_api.global.phonestarted<3){var e=100;if(!1===webphone_api.common.IsSDK()){var n=webphone_api.$.mobile.activePage.attr("id");if(!webphone_api.common.isNull(n)&&n.indexOf("_settings")>0)return void setTimeout(function(){de()},1e3);e=webphone_api.common.GetDeviceWidth(),!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)||(e=200)}webphone_api.common.PutToDebugLog(2,"WARNING, waitForWebphone display Applet, because no handle found_1");var t=webphone_api.common.GetDeviceHeight();webphone_api.common.isNull(t)&&(t=200),webphone_api.$("#webphone").css("position","absolute"),webphone_api.$("#webphone").css("top","100px"),webphone_api.$("#webphone").width(e),webphone_api.$("#webphone").height(t-100)}if(!1===webphone_api.global.applet_started&&webphone_api.global.phonestarted<3)return void setTimeout(function(){de()},250);if((webphone_api.common.isNull(eo)||webphone_api.common.isNull(oo)||eo<10||oo<10)&&(eo=webphone_api.common.GetDeviceWidth(),(webphone_api.common.isNull(eo)||webphone_api.common.isNull(oo)||eo<50||oo<50)&&(eo=150,oo=100)),He++,Be=_e())setTimeout(function(){webphone_api.$("#webphone").width(1),webphone_api.$("#webphone").height(1)},10),webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2),webphone_api.common.isNull(document.getElementById("javaerrormsg"))||(document.getElementById("javaerrormsg").style.display="none"),He=0,webphone_api.common.SaveParameter("isfirststart","false"),o(),webphone_api.common.PutToDebugLog(2,"EVENT, appletAvailable: "+Be),r();else{var i=0;if(i=!0===$e?25:50,He>=i&&webphone_api.global.phonestarted<3){webphone_api.common.PutToDebugLog(2,"WARNING, waitForWebphone display Applet, because no handle found_2");var t=webphone_api.common.GetDeviceHeight();webphone_api.common.isNull(t)&&(t=200),webphone_api.$("#webphone").css("position","absolute"),webphone_api.$("#webphone").css("top","100px"),webphone_api.$("#webphone").width(eo-1),webphone_api.$("#webphone").height(t-100),webphone_api.common.isNull(document.getElementById("javaerrormsg"))||(document.getElementById("javaerrormsg").style.display="block")}setTimeout(function(){de()},450)}}function _e(){if(!1===webphone_api.global.applet_started)return!1;if(null===Fe||void 0===Fe){try{Fe=document.getElementById("webphone")}catch(r){}if(null==Fe){var e=null;try{e=document.applets,0==e.length&&(e=document.getElementsByTagName("object")),0==e.length&&(e=document.getElementsByTagName("applet"));for(var o=0;o<e.length;++o)try{if("undefined"!=typeof e[o].API_Call){Fe=e[o];break}}catch(r){}}catch(r){}if(null==Fe)try{Fe=document.applets[0]}catch(r){}null==Fe&&webphone_api.common.PutToDebugLog(3,"ERROR, webphone: initcheck(), cannot find applet handle")}if(null!=Fe)try{var n=Fe.getSubApplet();null!=n&&(Fe=n)}catch(r){}}var t="",i=navigator.userAgent.toLowerCase();try{if(null==Fe)return!1;if(void 0!==Fe&&(t=Fe.toString()),i.indexOf("msie")>0||i.indexOf("trident")>0)for(var a in Fe)if("contentDocument"===a){if(null==Fe)return!1;t=Fe[a].toString();break}}catch(r){webphone_api.common.PutToDebugLogException(2,"ERROR, webphone: initcheck",r)}return null==t||""==t||t.toLowerCase().indexOf("[object")>=0&&t.toLowerCase().indexOf("[object")<5?(Fe=null,!1):(webphone_api.webphone_handle=Fe,!0)}function we(e,o,n,t,i){try{return _e()?Fe.API_SetCredentials(e,o,n,t,i):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetCredentials(), no applethandle "),!1)}catch(a){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetCredentials",a)}}function fe(e,o,n,t){try{return _e()?Fe.API_SetCredentials(e,o,n,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetCredentialsMD5(), no applethandle "),!1)}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetCredentialsMD5",i)}}function ve(e){try{return _e()?Fe.API_CheckVoicemail(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_CheckVoicemail(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_CheckVoicemail",o)}}function Pe(e){try{
return _e()?Fe.API_SetLine(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetLine(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetLine",o)}}function Ee(e){try{return _e()?Fe.API_GetLine(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetLine(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetLine",o)}}function Te(e){try{return _e()?Fe.API_GetLineStatus(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetLineStatus(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetLineStatus",o)}}function Ne(e,o){try{return _e()?Fe.API_Forward(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_Forward(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: API_Forward",n)}}function Se(e){try{return _e()?Fe.API_IsMuted(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_IsMuted(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_IsMuted",o)}}function Ie(e){try{return _e()?Fe.API_IsOnHold(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_IsOnHold(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_IsOnHold",o)}}function Re(e){try{return _e()?Fe.API_GetAudioDeviceList(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetAudioDeviceList(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetAudioDeviceList",o)}}function Ge(e){try{return _e()?Fe.API_GetAudioDevice(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetAudioDevice(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetAudioDevice",o)}}function Oe(e){try{return _e()?Fe.API_SetAudioDevice(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetAudioDevice(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetAudioDevice",o)}}function Le(e){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetVolume(), no applethandle "),!1;var o=Fe.API_GetVolume(e);return webphone_api.common.PutToDebugLog(2,"webphone: GetVolume java returned: "+o.toString()),o}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetVolume",n)}}function Ce(){try{return _e()?Fe.API_RecFiles_Upload():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Upload(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_Upload",e)}return!1}function De(e,o){try{return _e()?Fe.API_RecFiles_UploadEx(e,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_UploadEx(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_UploadEx",n)}return!1}function ye(){try{return _e()?Fe.API_RecFiles_Clear():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Clear(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_Clear",e)}return!1}function xe(){try{return _e()?Fe.API_RecFiles_Del():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Del(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_Del",e)}return!1}var Ae=webphone_api.getbasedir2()+"native",ke={id:"webphone",code:"webphone.webphone.class",name:"webphone",archive:"webphone.jar",codebase:Ae,width:1,height:1,MAYSCRIPT:!0},Ue="X-Webdomain: "+webphone_api.common.GetWebdomain(),Ve=webphone_api.common.GetParameter("companyname");!webphone_api.common.isNull(Ve)&&Ve.length>0&&(Ue=Ue+"\r\nX-Company: "+Ve);var We=webphone_api.common.GetParameter("brandname");!webphone_api.common.isNull(We)&&We.length>0&&(Ue=Ue+"\r\nX-Brand: "+We);var Me,Fe,He,Be,$e,je,qe,ze={serveraddress:"",username:"",MAYSCRIPT:!0,mayscript:"yes",scriptable:!0,jsscriptevent:3,autocfgsave:3,align:"middle",customsipheader:Ue,loglevel:5,canopenlogview:!1,hasincomingcall:!1,textmessaging:-1,pluginspage:"https://java.com/download/",permissions:"all-permissions",alt:"Enable or install java: https://www.java.com/en/download/index.jsp",java_arguments:"-Djava.net.preferIPv4Stack=true -Dsun.net.maxDatagramSockets=60"},Ke=300,Je=8e3,Xe=null,Ye=!1,Qe=0,Ze=null,eo=0,oo=0,no=0;return webphone_api.webphone_handle=Fe,webphone_api.webphone_pollstatus=!0,{InsertApplet:he,Start:n,StartWin:i,StartService:a,LoadApplet:be,Restart:l,PushContactlist:p,StartPresence:r,CheckPresence:s,SetPresenceStatus:c,CheckBLF:u,GetVersionNS:g,GetVersionNSNum:m,GetVersionJava:b,IsEncrypted:h,RegisterEx:d,SetSipHeader:_,GetSipHeader:w,GetSipHeaderInternal:f,GetSipMessage:v,GetGetLastInvite:P,GetGetLastRecInvite:E,GetGetLastSentInvite:T,GetWorkDir:N,Unregister:S,ReRegister:I,HTTPKeepAlive:R,Call:G,Hangup:O,Accept:L,Reject:C,Ignore:D,Forward:y,Conference:x,ConferenceEx:A,Transfer:k,Dtmf:U,MuteEx:V,IsMuted:W,Hold:M,IsOnHold:F,SendChat:H,VoiceRecord:B,AudioDevice:$,SetVolume:j,GetVolume:q,PlaySound:z,GetRegFailReason:K,SetParameter:J,SetLine:X,SetLineEx:Y,GetLine:Q,LineToCallID:Z,CallIDToLine:ee,GetLineDetails:oe,IsRegistered:ne,GetAudioDeviceList:te,GetAudioDevice:ie,SetAudioDevice:ae,SetPushNotifications:re,Exit:le,NeedRatingRequest:se,Jvoip:me,GetLastCallDetails:ce,GetIncomingDisplay:ue,DelSettings:ge,API_SetCredentials:we,API_SetCredentialsMD5:fe,API_CheckVoicemail:ve,API_SetLine:Pe,API_GetLine:Ee,API_GetLineStatus:Te,API_Forward:Ne,API_IsMuted:Se,API_IsOnHold:Ie,API_GetAudioDeviceList:Re,API_GetAudioDevice:Ge,API_SetAudioDevice:Oe,API_GetVolume:Le,API_RecFiles_Upload:Ce,API_RecFiles_UploadEx:De,API_RecFiles_Clear:ye,API_RecFiles_Del:xe,SendChatIsComposing:pe}}(),webphone_api.notifications=function(){function e(){try{webphone_api.global.creditRequestIval=100,webphone_api.global.closeCallAtivity=!1,_=!1,g=0;var e=webphone_api.common.GetTickCount();N=e,S=e,I=e,m=0,b=!1,h=!1,Ee="",d="",webphone_api.global.last_event="",O=e,webphone_api.global.httpkatimer=e,webphone_api.global.audio_devices_loaded=!1,webphone_api.common.GetAudioRecList().length>5&&(webphone_api.global.audio_devices_loaded=!0),webphone_api.global.lastcallduration=0,C=-1,D=e,x=e,$=null,j="",q="";var o=webphone_api.common.GetParameter2("ringtimeout"),n=webphone_api.common.GetParameter2("ringtimeoutin"),t=webphone_api.common.GetParameter2("ringtimeoutout"),i=webphone_api.common.GetParameter2("calltimeout");if((webphone_api.common.isNull(o)||o.length<2||!1===webphone_api.common.IsNumber(o))&&(o=9e4),(webphone_api.common.isNull(n)||n.length<2||!1===webphone_api.common.IsNumber(n))&&(n=0),(webphone_api.common.isNull(t)||t.length<2||!1===webphone_api.common.IsNumber(t))&&(t=0),(webphone_api.common.isNull(i)||i.length<2||!1===webphone_api.common.IsNumber(i))&&(o=108e5),k=webphone_api.common.StrToInt(o),U=webphone_api.common.StrToInt(n),V=webphone_api.common.StrToInt(t),W=webphone_api.common.StrToInt(i),webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.global.useajax_forservice=!1,webphone_api.global.wsuser_succeded=!1,M=!1,webphone_api.global.acallcount=0,webphone_api.global.enstarteddisplayed=!1,F=!1,Pe=0,webphone_api.global.httpheaderslogged=!1,webphone_api.global.onregisteredcalled=!1,webphone_api.global.wsc_contimeout=0,webphone_api.global.wsc_reqtimeout=0,webphone_api.global.firstregister_sessiontick=0,webphone_api.common.isNull(document.getElementById("loader")))if(webphone_api.common.PutToDebugLog(2,"EVENT, init adding loader iframe, because not found in page"),webphone_api.common.isNull(document.body))webphone_api.common.PutToDebugLog(2,"ERROR, init adding loader iframe, document.body is NULL");else{var a=document.createElement("iframe");a.style.display="none",a.style.height="0",a.style.width="0",a.id="loader",a.setAttribute("allow","microphone; camera"),document.body.appendChild(a)}}catch(r){webphone_api.common.PutToDebugLogException(2,"notifications: Init",r)}}function o(n){var p=0;try{if(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"PROCESSING_NOTIFICATIONS: "+n),webphone_api.global.initcalled||(webphone_api.global.initcalled=!0,e()),!webphone_api.common.isNull(n)&&n.length>0)try{var g=n.split(",");if(!webphone_api.common.isNull(g)&&g.length>0){for(var m="",N=0;N<g.length;N++)webphone_api.common.isNull(g[N])&&(g[N]=""),g[N]=webphone_api.common.Trim(g[N]),0===g[N].indexOf("_BASE64_")&&(g[N]=webphone_api.common.B64Dec(g[N]),webphone_api.common.isNull(g[N])&&(g[N]=""),g[N]=webphone_api.common.Trim(g[N])),m.length>0&&(m+=","),m+=g[N];!webphone_api.common.isNull(m)&&m.length>0&&(n=m)}}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications base64 decode",nn)}if(ie<0&&(ie=webphone_api.common.IsCExt()),webphone_api.common.isNull(Z)&&webphone_api.common.getuseengine().length>0&&(Z=webphone_api.common.Te2(),webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(Z=!1),Z)){var S=[];S.push("L"),S.push("i"),S.push("m"),S.push("i"),S.push("t"),S.push(" "),S.push("f"),S.push("u"),S.push("n"),S.push("c");var I=S.join("");setTimeout(function(){webphone_api.common.PutToDebugLog(3,"EVENT, "+I)},920),S=[],S.push("S"),S.push("T"),S.push("A"),S.push("T"),S.push("U"),S.push("S"),te=S.join("")}if(Z&&!webphone_api.common.isNull(te)&&te.length>0){var O="";if(!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0)for(var N=0;N<webphone_api.global.ep.length;N++)if(!webphone_api.common.isNull(webphone_api.global.ep[N][webphone_api.common.EP_CALLID])&&webphone_api.global.ep[N][webphone_api.common.EP_CALLID].length>3){O=webphone_api.global.ep[N][webphone_api.common.EP_CALLID];break}!webphone_api.common.isNull(O)&&O.length>3&&!1===s(O)&&n.indexOf(te)>=0&&(n=n.replace(te,""),n=webphone_api.common.Trim(n),n=n.substring(1),n=webphone_api.common.Trim(n))}if(p=10,!_){webphone_api.global.presence_started=!1,_=!0,webphone_api.common.isNull(webphone_api.global.maintimerid)||clearInterval(webphone_api.global.maintimerid),webphone_api.global.maintimerid=null,webphone_api.global.maintimerid=setInterval(function(){t()},R),webphone_api.common.LcAc(!0,!1),p=14;try{if(0==webphone_api.common.IsSDK()){var D=webphone_api.common.GetColortheme(),y=webphone_api.themes.gettheme("theme_"+D);if(webphone_api.common.isNull(y))L="#ffffff";else{var x=y.fontcstatus;L=webphone_api.common.isNull(x.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))?"#ffffff":x}}}catch(tn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications at init 1",tn)}}if(p=20,webphone_api.common.isNull(n)||n.length<1)return;if(n=n.replace("NORETRY",""),n=webphone_api.common.Trim(n),J=n,0===J.indexOf("START")&&(J.indexOf("api")>0||J.indexOf("sip")>0)&&(webphone_api.global.apistartstate=2,webphone_api.plhandler.GetAudioDevicesForMenu(100)),!1===webphone_api.global.applet_started&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&"START,api"===J){webphone_api.global.applet_started=!0,p=24;var A=webphone_api.common.GetParameter2("serveraddress_user");if((webphone_api.common.isNull(A)||A.length<2)&&(A=webphone_api.common.GetParameter2("serveraddress")),(webphone_api.common.isNull(A)||A.length<2)&&webphone_api.common.PutToDebugLog(2,"EVENT, notifications ProcessNotifications serveraddress not set"),!1===webphone_api.global.usestorage&&!webphone_api.common.CheckDID(A,!1)){var S=[];S.push("E"),S.push("R"),S.push("R"),S.push("O"),S.push("R"),S.push(","),S.push("S"),S.push("e"),S.push("r"),S.push("v"),S.push("e"),S.push("r"),S.push(" "),S.push("n"),S.push("o"),S.push("t"),S.push(" "),S.push("a"),S.push("l"),S.push("l"),S.push("o"),S.push("w"),S.push("e"),S.push("d"),S.push("_"),S.push("3");var I=S.join("");return p=26,void setTimeout(function(){webphone_api.common.PutToDebugLog(1,I+" "+A)},1251)}}if(p=30,J.indexOf("CHATCOMPOSING")>=0){var k=0,U="",V=J.indexOf(",");if(V>0&&(p=32,J=J.substring(V+1),(V=J.indexOf(","))>0&&(p=34,k=webphone_api.common.Trim(J.substring(0,V)),J=J.substring(V+1),(V=J.indexOf(","))>0))){p=36,U=webphone_api.common.Trim(J.substring(0,V));var W=webphone_api.common.Trim(J.substring(V+1));!webphone_api.common.isNull(W)&&webphone_api.common.IsNumber(W)&&1===webphone_api.common.StrToInt(W)&&(p=39,l(U+" "+webphone_api.stringres.get("composing")+"...","EVENT",1,-1))}return}if(p=40,J.indexOf("SERVERCONTACTS")>=0){if(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, notifications: "+J),J.toLowerCase().indexOf("error")>=0)return void webphone_api.common.PutToDebugLog(2,"ERROR, notifications: "+J);p=44;var F="",V=0;V=J.indexOf(","),V>0&&(F=webphone_api.common.Trim(J.substring(V+1,J.length))),p=48,webphone_api.common.SaveParameter("servercontacts",F),!webphone_api.common.isNull(F)&&F.length>0&&webphone_api.common.PutToDebugLog(2,"EVENT, servercontacts list: "+F)}if(p=50,J.indexOf("PRESENCE")>=0&&!0===webphone_api.common.UsePresence2()){if(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, notifications: "+J),J.toLowerCase().indexOf("error")>=0)return void webphone_api.common.PutToDebugLog(2,"ERROR, notifications: "+J);var H="",V=0;if(V=J.indexOf(","),p=54,V>0){H=webphone_api.common.Trim(J.substring(V+1,J.length));var B="",ae="",re="",le="",ce="",ue=H.split(",");if(!webphone_api.common.isNull(ue)&&ue.length>1){B=webphone_api.common.Trim(ue[0]),ae=webphone_api.common.Trim(ue[1]),ue.length>2&&(re=webphone_api.common.Trim(ue[2])),ue.length>3&&(le=webphone_api.common.Trim(ue[3])),ue.length>4&&(ce=webphone_api.common.Trim(ue[4]));var ge="-1";(webphone_api.common.isNull(re)||re.length<1)&&(re=ae),ge=webphone_api.common.SaveReceivedPresence2(B,re),"-2"===ge&&ae.length>1&&re!==ae&&(ge=webphone_api.common.SaveReceivedPresence2(B,ae));try{webphone_api.onPresenceCb(B,ae,le,ce)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onPresenceStateChange() callback",an)}p=58,!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._dialpad)||webphone_api._dialpad.PopulateListRecents(),p=59,!0!==webphone_api.global.isContactdetailsStarted||!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._contactdetails)||webphone_api._contactdetails.PopulateData(),!0===webphone_api.global.isMessageStarted&&webphone_api._message.DisplayPresence(ge)}}}if(J.indexOf("BLF")>=0&&webphone_api.common.GetParameterInt("enableblf",1)>0){if(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, notifications: "+J),J.toLowerCase().indexOf("error")>=0)return void webphone_api.common.PutToDebugLog(2,"ERROR, notifications: "+J);var me="",V=0;if(V=J.indexOf(","),p=54,V>0){me=webphone_api.common.Trim(J.substring(V+1,J.length));var B="",be="",ae="",he="",de=me.split(",");if(!webphone_api.common.isNull(de)&&de.length>1){B=webphone_api.common.Trim(de[0]),be=webphone_api.common.Trim(de[1]),de.length>2&&(ae=webphone_api.common.Trim(de[2])),de.length>3&&(he=webphone_api.common.Trim(de[3]));try{webphone_api.onBLFCb(B,be,ae,he)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onBLFStateChange() callback",an)}}}}p=60,z="",K="";var V=0;if("["===J.charAt(0)&&(V=J.indexOf("]"))>0&&(J=webphone_api.common.Trim(J.substring(V+1,J.length))),p=63,V=J.indexOf(","),V>0?(z=webphone_api.common.Trim(J.substring(0,V)),J=webphone_api.common.Trim(J.substring(V+1,J.length))):z="EVENT",p=65,"ANSWER"===z)return p=69,void webphone_api.common.HttpAsyncHandler(J);if(p=70,"DTMF"===z){var _e=-1,we=n,fe=we.indexOf(",");fe>0&&(we=we.substring(fe+1),(fe=we.indexOf(","))>0&&(we=webphone_api.common.Trim(we.substring(0,fe)),!webphone_api.common.isNull(we)&&webphone_api.common.IsNumber(we)&&(_e=webphone_api.common.StrToInt(we))));try{webphone_api.onDTMFCb(J,_e)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onDTMF() callback",an)}}if("STATUS"===z||"CDR"===z||"CHAT"===z||"SUBSCRIBE"===z||"NOTIFY"===z||"EVENT"===z||"ERROR"===z||"WARNING"===z||"POPUP"===z||"CREDIT"===z||"RATING"===z||"MWI"===z||"START"===z||"VREC"===z||"DTMF"===z||"PRESENCE"===z||"CHATREPORT"===z||"CHATCOMPOSING"===z||"BLF"===z||"LINE"===z||"STOP"===z||"LINEDETAILS"===z||"QRCODE"===z||"NOTIFICATION"===z||"GROUP"===z||"RTPSTAT"===z||"INFO"===z||"SHOULDRESET"===z||"PLAYREADY"===z||"VAD"===z||"SERVERCONTACTS"===z||"NEWUSER"===z||"ANSWER"===z){p=71;try{webphone_api.onEventCb("event",n,null)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onEvent() callback at notification: "+n,an)}try{webphone_api.RecEvt(n)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onEvents() callback at notification: "+n,an)}try{ie>0&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents(n)}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications AndroidWebphoneJsInterface send",an)}}else if("LOG"!==z)return p=74,void(!1===Z&&webphone_api.common.PutToDebugLog(5,"EVENT, unknown notification a: "+n));if(n.indexOf("-1,Stop")>=0&&webphone_api.global.phonestarted>0&&webphone_api.common.OpenSettings(!0,8),"GROUP"===z&&J.toLowerCase().indexOf("error")<0&&!1===webphone_api.common.IsSDK())try{var ve=J.split(",");if(!webphone_api.common.isNull(ve)&&ve.length>2){var Pe=ve[2];!webphone_api.common.isNull(Pe)&&Pe.length>0&&isCallStarted&&null!=Call.instance&&(CommonGUI.GetObj().PutToDebugLog(2,"EVENT, Group conference update peers to: "+Pe),webphone_api.$("#page_call_additional_info").html(Pe),webphone_api.$("#page_call_peer_details").html(""),webphone_api.$("#page_call_peer_details").hide(),webphone_api.$("#display_notmain_account").html(""),webphone_api.$("#display_notmain_account").hide(),webphone_api.$("#contact_image_img").attr("src",webphone_api.common.GetElementSource()+"images/default_contact_conf.png"))}}catch(rn){webphone_api.common.PutToDebugLogException(2,"notifications ProcessNotifications handle group conference",rn)}if("QRCODE"===z)webphone_api.common.ParseQRcode(J);else if("LOG"===z)J.indexOf("mzserver detected")>=0&&(J.indexOf("gw")>=0?2==webphone_api.common.ismizuserverdetected?webphone_api.common.ismizuserverdetected=3:webphone_api.common.ismizuserverdetected=1:J.indexOf("both")>=0?webphone_api.common.ismizuserverdetected=3:1==webphone_api.common.ismizuserverdetected?webphone_api.common.ismizuserverdetected=3:webphone_api.common.ismizuserverdetected=2);else if("CHATREPORT"===z){var Ee=J.split(",");if(!webphone_api.common.isNull(Ee)&&Ee.length>5){var Te=Ee[1],Ne=Ee[2],Se=Ee[5];if(webphone_api.common.isNull(Te)&&(Te=""),Te=webphone_api.common.Trim(Te),Te=Te.toLowerCase(),webphone_api.common.isNull(Ne)&&(Ne=""),Ne=webphone_api.common.Trim(Ne),webphone_api.common.isNull(Se)&&(Se=""),Se=webphone_api.common.Trim(Se),"2"==Ne||"4"==Ne){var Ie="chat_"+webphone_api.common.GetSipusername()+"_"+Te;Te.length>0&&Ne.length>0&&Se.length>0&&(Se=Se.toLowerCase(),webphone_api.common.IsWindowsSoftphone()?webphone_api.common.ApiWinLoadFile(Ie,function(e){webphone_api.common.isNull(e)&&(e=""),r(Ie,Ne,Se,e,Te)}):webphone_api.File.ReadFile(Ie,webphone_api.global.STORAGE_LOCAL,function(e){webphone_api.common.isNull(e)&&(e=""),r(Ie,Ne,Se,e,Te)}))}}}else if("LINEDETAILS"===z){var Re=J.split(",");if(!webphone_api.common.isNull(Re)&&Re.length>10){webphone_api.common.PutToDebugLog(2,"EVENT, update ep from received LINEDETAILS notification");var Ge=Re[0],Oe=Re[3],Le=Re[2],Ce=Re[5],De=Re[8],ye=Re[9];webphone_api.common.SaveCallSession(Ge,null,Oe,Ce,-1,-1,-1,null,Le,"","","",De,ye,"")}}else if("LINE"===z){var xe=-20,Ae=J,V=Ae.indexOf(",");if(V>0&&(Ae=Ae.substring(0,V)),Ae=webphone_api.common.Trim(Ae),webphone_api.common.IsNumber(Ae)&&(xe=webphone_api.common.StrToInt(Ae)),xe>-5)return void(webphone_api.global.aline=xe)}else if("STATUS"===z){webphone_api.global.apistartstate=2,d=J;var ke=c(n,-1);webphone_api.global.lnstat[ke]=[webphone_api.common.GetTickCount(),J]}else("STATUS"===z||"EVENT"===z)&&J.toLowerCase().indexOf("permission")<0&&(webphone_api.global.last_event=J);if(!0===webphone_api.common.Glbr()&&"CREDIT"===z)T=!0,webphone_api.global.credit=" "+J;else if(!0===webphone_api.common.Glbr()&&"RATING"===z)p=82,webphone_api.global.rating=" ("+webphone_api.common.Trim(J)+")";else if("MWI"===z&&(p=83,!webphone_api.common.isNull(J)&&J.length>0&&J.indexOf(",")>=0)){var Ue=J.split(",");if(!webphone_api.common.isNull(Ue)&&Ue.length>=2)if("no"===Ue[0])p=85,60===webphone_api.common.GetConfigInt("brandid",-1)?webphone_api.common.SetNotCounter("dialpad_message_counter","0"):webphone_api.common.SetNotCounter("dialpad_voicemail_counter","0");else{p=87;var Ve=Ue[2];webphone_api.common.isNull(Ve)&&(Ve=""),Ve=webphone_api.common.Trim(Ve),Ve.length>0&&webphone_api.common.IsNumber(Ve)&&(p=88,webphone_api.common.PutToDebugLog(3,"EVENT, New voicemail messages found: "+Ve),60===webphone_api.common.GetConfigInt("brandid",-1)?webphone_api.common.SetNotCounter("dialpad_message_counter",Ve):webphone_api.common.SetNotCounter("dialpad_voicemail_counter",Ve))}}p=90;var We=J.indexOf("POPUP");if(We>=0){var Me=J.substring(We+5);Me=webphone_api.common.Trim(Me),We=Me.indexOf(","),We>=0&&(Me=Me.substring(We+1)),p=94,!webphone_api.common.isNull(Me)&&Me.length>0&&webphone_api.common.ShowToast(Me,5e3)}if(V=J.indexOf(","),J=webphone_api.common.Trim(J),V>0&&(J=webphone_api.common.Trim(J.substring(V+1,J.length))),p=96,V=J.indexOf(","),V>0?(K=webphone_api.common.Trim(J.substring(0,V)),J=webphone_api.common.Trim(J.substring(V+1,J.length))):K=J,p=100,V=K.indexOf("("),V>0&&K.indexOf(oe)<0&&K.indexOf(ne)<0&&(K=webphone_api.common.Trim(K.substring(0,V))),K.length<1&&!1===Z)return void webphone_api.common.PutToDebugLog(5,"WARNING, unknown notification b: "+n);if(J.length<1&&!1===Z)return void webphone_api.common.PutToDebugLog(5,"WARNING, unknown notification c: "+n);if(p=110,"CDR"===z&&(webphone_api.common.CanLog(5)&&webphone_api.common.PutToDebugLog("EVENT, notifications: ProcessNotifications CDR received: "+n,5),webphone_api.global.lastcallcdr=n,(V=n.indexOf(","))>0))try{var Fe="";p=115;var He=n.split(","),Be=He[1],B=He[2],$e=He[3],je=He[4],qe=(He[5],He[6]),ze=He[7],Ke=He[8],Je=He[9],he="";He.length>10&&(he=He[10]);var Xe=2;B===je&&(Xe=1),webphone_api.common.isNull(Je)&&(Je=""),Je.indexOf("[")>0&&(Je=Je.substring(0,Je.indexOf("["))),p=120,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.GetDiscReasonFromSignaling(function(e){(webphone_api.common.isNull(e)||e.length<2)&&(e=Je),!0===webphone_api.global.dontshowdiscreason?webphone_api.common.PutToDebugLog(2,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+e):(webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+e),l(webphone_api.stringres.get("disc_reason")+": "+e,"EVENT",0,webphone_api.common.StrToIntDef(Be,-1))),webphone_api.common.RemoveSessionHeadersFromCache(webphone_api.common.StrToIntDef(Be,-1))}),webphone_api.common.RemoveSessionHeadersFromCache(webphone_api.common.StrToInt(Be)),webphone_api.global.lastcalldetails="",webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetLastCallDetails",null),p=124;var Ye="<br>",be="outgoing";if(2===Xe&&(be="incoming"),webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Line: "+Be+", Direction: "+be+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Auth Username: "+webphone_api.common.GetSipusername()+Ye,2===Xe?(webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Caller: "+$e+Ye,$e!==B&&(webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Caller Name: "+B+Ye)):webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Caller ID: "+webphone_api.common.GetCallerid()+Ye,p=128,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Connecttime: "+qe+" msec"+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Duration: "+ze+" msec"+Ye,webphone_api.global.lastcalldetails="1"===Ke?webphone_api.global.lastcalldetails+"Disconnect By: Local"+Ye:webphone_api.global.lastcalldetails+"Disconnect By: Remote"+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Reason: "+Je+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"CDR: "+webphone_api.global.lastcallcdr+Ye,webphone_api.common.getuseengine===webphone_api.global.ENGINE_WEBRTC){var Qe=webphone_api.common.ReplaceAll(webphone_api.global.lastcalldetails,Ye,"\n");setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, Call details:\n"+Qe)},1)}webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(!0===webphone_api.global.dontshowdiscreason?webphone_api.common.PutToDebugLog(2,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+Je):(webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+Je),l(webphone_api.stringres.get("disc_reason")+": "+Je,"EVENT",0,webphone_api.common.StrToIntDef(Be,-1)))),p=122;try{webphone_api.onCdrCb($e,je,qe,ze,Xe,B,Je,webphone_api.common.StrToInt(Be),he)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCdr() callback",an)}if(!0===webphone_api.common.UsePresence2()&&!webphone_api.common.isNull(ze)&&webphone_api.common.IsNumber(ze)){if(webphone_api.common.StrToInt(ze)<=0)webphone_api.common.PutToDebugLog(4,"EVENT,notifications CDR 0 duration get presence status for: "+B),!1===webphone_api.common.IsSDK()&&webphone_api.common.PresenceGet2(B);else{if(!webphone_api.common.isNull(webphone_api.global.presenceHM))var Ze=webphone_api.global.presenceHM[B];if(!webphone_api.common.isNull(Ze)){var eo=Ze[webphone_api.common.PRES_STATUS];webphone_api.common.isNull(eo)||"0"!==eo||(webphone_api.common.PutToDebugLog(4,"EVENT,notifications CDR connected call but presence was offline, so set it to online for: "+B),webphone_api.common.SaveReceivedPresence2(B,"online"))}}}p=130,!webphone_api.common.isNull(He[9])&&He[9].length>0&&webphone_api.common.PutToDebugLog(1,"EVENT, "+He[9]),Fe=webphone_api.common.Trim(He[2]);var oo=0;try{oo=webphone_api.common.StrToInt(He[7])/1e3}catch(ln){}webphone_api.global.lastcallduration=oo,p=132;var no="recfile";if(2===Xe?(w=!1,!1===webphone_api.global.acceptReject?(p=136,i(Fe,"2",no,oo,Be,Je)):(p=137,i(Fe,"1",no,oo,Be,Je)),webphone_api.global.acceptReject=!1):(p=138,i(Fe,"0",no,oo,Be,Je)),f="",no="",oo>60){var to=webphone_api.common.GetParameterInt("successfulcalls",0),io=webphone_api.common.GetParameterInt("webrtc_successfulcalls",0);to<0&&(to=0),io<0&&(io=0),to++,webphone_api.common.SaveParameter("successfulcalls",to.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(io++,webphone_api.common.SaveParameter("webrtc_successfulcalls",io.toString()));var ao=4;to===ao&&"Android"===webphone_api.common.GetOs()&&(!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api.common.PutToDebugLog(4,"EVENT, Close call page because trying to display Add to Home Screen popup"),webphone_api._call.CloseCall()),setTimeout(function(){var e=webphone_api.$(".ui-page-active .ui-popup-active").length;!0===webphone_api.common.IsSDK()||e<1?(webphone_api.common.PutToDebugLog(2,"EVENT, Offer pin to desktop Home Screen Android"),webphone_api.common.AlertDialog(webphone_api.stringres.get("add_to_home_title"),webphone_api.stringres.get("add_to_home_msg"))):(ao-=1,webphone_api.common.SaveParameter("successfulcalls",ao.toString()))},500))}}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications CDR and save to call history",an)}if(p=140,"STATUS"===z){if("Registered."===K||"Registered"===K){webphone_api.global.phonestarted=3,webphone_api.common.SaveParameter("firststart_webrtc","false"),webphone_api.common.SaveParameter("last_login_failed","false");var ro=webphone_api.common.GetParameter("profilepicture");if(!webphone_api.common.isNull(ro)&&ro.length>10&&SetSipHeader("X-Profile: "+ro,-1),webphone_api.global.firstregister_sessiontick<1&&(webphone_api.global.firstregister_sessiontick=webphone_api.common.GetTickCount()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&2===webphone_api.global.usuk.length&&webphone_api.common.SaveParameter("last_good_webrtc_gw",webphone_api.global.usuk),!1===webphone_api.common.IsSDK()&&("undefined"!=typeof webphone_api._dialpad&&null!==webphone_api._dialpad?webphone_api._dialpad.HandleAutoaction():console&&console.log&&console.log("ERROR, notifications ProcessNotifications webphone_api._dialpad is not defined")),p=141,!0===webphone_api.common.UsePresence2()&&!1===webphone_api.global.pres_set_at_start&&(p=142,setTimeout(function(){webphone_api.global.pres_set_at_start=!0,webphone_api.common.PutToDebugLog(2,"EVENT,SetSelectedPresence to Online on notification reg"),webphone_api.common.SetSelectedPresence("Online"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.SetSipHeader(-2,"X-IMStatus:"+webphone_api.common.GetParameter("presencestatus"))},200)),p=143,!1===webphone_api.global.onregisteredcalled){webphone_api.global.onregisteredcalled=!0;try{webphone_api.onRegStateChangeCb("registered",null)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onRegStateChangeCb(registered) callback",an)}try{webphone_api.onRegisteredCb()}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onRegistered() callback",an)}}if(webphone_api.$("#webphone").width(1),webphone_api.$("#webphone").height(1),p=145,p=147,!0===webphone_api.common.Glbr()&&!T){var lo=webphone_api.common.GetParameter("creditrequest");!webphone_api.common.isNull(lo)&&lo.length>0&&(p=148,webphone_api.common.UriParser(lo,"","","","","creditrequest"))}}if(p=150,K.toLowerCase().indexOf("unregistered")>=0&&(webphone_api.global.authenticated_displayed=!1,!1===webphone_api.global.onunregistered_flag)){webphone_api.global.onunregistered_flag=!0,webphone_api.global.onregisteredcalled=!1,setTimeout(function(){webphone_api.global.onunregistered_flag=!1},2e3),p=152;try{webphone_api.onRegStateChangeCb("unregistered",null)}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(unregistered) callback",an)}try{webphone_api.onUnRegisteredCb()}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onUnRegistered() callback",an)}}if(p=160,"InProgress"===K){var po=J.split(",");if(webphone_api.common.isNull(po)||po.length<3)return void webphone_api.common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip InProgress event, because not enough parameters: "+J);var so="",B="",be="",co=n.replace(" ",""),uo="";!webphone_api.common.isNull(po)&&po.length>4&&(uo=po[4]),!webphone_api.common.isNull(po)&&po.length>2&&(!webphone_api.common.isNull(po[0])&&po[0].length>1?so=webphone_api.common.Trim(po[0]):!webphone_api.common.isNull(po[1])&&po[1].length>1&&(so=webphone_api.common.Trim(po[1])),!webphone_api.common.isNull(po[2])&&po[2].length>0&&(be=webphone_api.common.Trim(po[2])),po.length>3&&(B=po[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=so))),webphone_api.common.isNull(so)&&(so="");var xe=webphone_api.global.aline;if(webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC){var go=webphone_api.common.Trim(n),mo=go.indexOf(",");mo>0&&(go=go.substring(mo+1),go=webphone_api.common.Trim(go),(mo=go.indexOf(","))>0&&(go=go.substring(0,mo),go=webphone_api.common.Trim(go),!webphone_api.common.isNull(go)&&webphone_api.common.IsNumber(go)&&(xe=webphone_api.common.StrToInt(go),webphone_api.global.aline=xe,
webphone_api.global.lastalinesettick=0)))}if(1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callTrying",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callTrying",an)}try{webphone_api.onCallStateChangeCb("trying",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback trying",an)}}if("Midcall"===K){var po=J.split(",");if(webphone_api.common.isNull(po)||po.length<3)return void webphone_api.common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip Midcall event, because not enough parameters: "+J);var so="",B="",be="",co=n.replace(" ",""),uo="";!webphone_api.common.isNull(po)&&po.length>4&&(uo=po[4]),!webphone_api.common.isNull(po)&&po.length>2&&(!webphone_api.common.isNull(po[0])&&po[0].length>1?so=webphone_api.common.Trim(po[0]):!webphone_api.common.isNull(po[1])&&po[1].length>1&&(so=webphone_api.common.Trim(po[1])),!webphone_api.common.isNull(po[2])&&po[2].length>0&&(be=webphone_api.common.Trim(po[2])),po.length>3&&(B=po[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=so))),webphone_api.common.isNull(so)&&(so="");var xe=webphone_api.global.aline;if(webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC){var go=webphone_api.common.Trim(n),mo=go.indexOf(",");mo>0&&(go=go.substring(mo+1),go=webphone_api.common.Trim(go),(mo=go.indexOf(","))>0&&(go=go.substring(0,mo),go=webphone_api.common.Trim(go),!webphone_api.common.isNull(go)&&webphone_api.common.IsNumber(go)&&(xe=webphone_api.common.StrToInt(go))))}if(1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("midcall",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback midcall",an)}}if(K===webphone_api.stringres.get("muted")||K===webphone_api.stringres.get("unmuted")){var co=n.replace(" ",""),po=co.split(","),xe=webphone_api.global.aline;if(!webphone_api.common.isNull(po)&&po.length>1&&webphone_api.common.IsNumber(po[1])&&(xe=webphone_api.common.StrToInt(po[1])),1===webphone_api.common.GetApibehaviour())if(K===webphone_api.stringres.get("muted"))try{webphone_api.onCallStateChangeCb("muted","","","",xe,"")}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback muted",an)}else try{webphone_api.onCallStateChangeCb("unmuted","","","",xe,"")}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback unmuted",an)}}if("Transfer"===K&&1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("transfer","","","",-1,"")}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback transfer",an)}if(n.indexOf("EVENT,Hold")>=0){if(1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("hold","","","","","")}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback hold",an)}}else if(n.indexOf("EVENT,Reload")>=0&&1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("reload","","","","","")}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback reload",an)}if(n.indexOf("EVENT,conference created")>=0&&1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("conference","","","","","")}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback conference",an)}if("CallSetup"===K||"Ringing"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200));var po=J.split(",");if(webphone_api.common.isNull(po)||po.length<3)return void webphone_api.common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip ringing event, because not enough parameters: "+J);var so="",B="",be="",co=n.replace(" ",""),bo="";if(!webphone_api.common.isNull(po)&&po.length>1&&(bo=po[1]),!1===webphone_api.common.UserExists(bo))return webphone_api.common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),X=K,Y="STATUS",void(Q=se);var uo="";!webphone_api.common.isNull(po)&&po.length>4&&(uo=po[4]),!webphone_api.common.isNull(po)&&po.length>2&&(!webphone_api.common.isNull(po[0])&&po[0].length>1?so=webphone_api.common.Trim(po[0]):!webphone_api.common.isNull(po[1])&&po[1].length>1&&(so=webphone_api.common.Trim(po[1])),p=163,!webphone_api.common.isNull(po[2])&&po[2].length>0&&(be=webphone_api.common.Trim(po[2])),p=164,po.length>3&&(B=po[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=so))),p=167,webphone_api.common.isNull(so)&&(so="");var xe=webphone_api.global.aline;if(webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC){var go=webphone_api.common.Trim(n),mo=go.indexOf(",");p=169,mo>0&&(go=go.substring(mo+1),go=webphone_api.common.Trim(go),(mo=go.indexOf(","))>0&&(p=172,go=go.substring(0,mo),go=webphone_api.common.Trim(go),!webphone_api.common.isNull(go)&&webphone_api.common.IsNumber(go)&&(p=175,xe=webphone_api.common.StrToInt(go),webphone_api.global.aline=xe,webphone_api.global.lastalinesettick=0)))}if("CallSetup"==q&&"Ringing"===K){if(1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callRinging",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callRinging",an)}try{webphone_api.onCallStateChangeCb("ringing",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback ringing",an)}"1"==be?(p=271,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallringing,"callRinging",be,so,so,"")):(p=272,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallringing,"callRinging",be,so,so,""))}if(q=K,!webphone_api.common.isNull(j)&&j.length>0&&j===uo)return;var ho=!1,_o=webphone_api.global.aline;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.GetNrOfActiveCalls()>0&&"Firefox"===webphone_api.common.GetBrowser()&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0)for(var N=0;N<webphone_api.global.ep.length;N++)if(!webphone_api.common.isNull(webphone_api.global.ep[N])&&"true"==webphone_api.global.ep[N][webphone_api.common.EP_HOLDSTATE]){var wo=webphone_api.global.ep[N][webphone_api.common.EP_LINE];webphone_api.mysetline(wo),webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mainlogic resume call from nt; peer: "+webphone_api.global.ep[N][webphone_api.common.EP_DESTNR]+" on line: "+wo),webphone_api.hold(!1),webphone_api.mute(!0),ho=!0}ho&&webphone_api.mysetline(_o),j=uo,webphone_api.common.isNull($)||clearTimeout($),$=null,webphone_api.global.acallcount++,M=!1,p=161,webphone_api.common.RemoveSipHeadreFromCache("X-reason"),webphone_api.common.RemoveSipHeadreFromCache("Reason"),webphone_api.common.RemoveSipHeadreFromCache("Warning"),webphone_api.global.ringstart_time=webphone_api.common.GetTickCount(),p=176;var _e=webphone_api.common.StrToInt(xe);if(_e>0&&webphone_api.common.GetOtherPartyName(_e,so),P=webphone_api.common.GetTickCount(),f=so,webphone_api.global.currcallnumber=f,webphone_api.global.checkIfInCall=!0,webphone_api.global.checkIfCallActive=!1,webphone_api.common.SaveCallSession(xe,null,so,be,webphone_api.common.GetTickCount(),-1,-1,"","","","",null),!0!==webphone_api.common.GetParameterBool("voicerecording",!1)||webphone_api.common.isNull(webphone_api._call)||!1===webphone_api._call.IsRecStarted(so)&&webphone_api._call.StartRecording(so),p=177,1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callSetup",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callSetup",an)}try{webphone_api.onCallStateChangeCb("setup",webphone_api.common.StrToInt(be),so,B,xe,uo)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback setup",an)}if(1==be?(p=178,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallsetup,"callSetup",be,so,so,"","additional_info")):(p=179,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallsetup,"callSetup",be,so,so,"","additional_info"),1===webphone_api.common.GetParameterInt("beeponincoming",0)&&webphone_api.common.Beep("1")),webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_displaypeerdetails,"callSetup",be,so,so,"","scurl_displaypeerdetails"),webphone_api.common.PutToDebugLog(2,"EVENT, currevent: "+co+"; isIcomingCall: "+be+"; line: "+Q),webphone_api.common.PutToDebugLog(2,"EVENT, lastRingEvenet: "+webphone_api.global.lastRingEvenet),webphone_api.common.UpdateContactLastActive(so),"2"==be){if(!1===webphone_api.common.IsSDK()&&!webphone_api.common.isNull(document.getElementById("display_notmain_account"))&&webphone_api.common.GetNrOfAcc()>1){var fo="",vo=po[1];if(!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>0){for(var N=0;N<webphone_api.global.sipaccounts.length;N++){var Po=webphone_api.global.sipaccounts[N];if(!0===Po.ismain){if(!webphone_api.common.isNull(vo)&&vo.length>0&&vo!=Po.username)for(var Eo=0;Eo<webphone_api.global.sipaccounts.length;Eo++)if(webphone_api.global.sipaccounts[Eo].username===vo){fo=webphone_api.global.sipaccounts[Eo].username,!webphone_api.common.isNull(webphone_api.global.sipaccounts[Eo].serveraddress)&&webphone_api.global.sipaccounts[Eo].serveraddress.length>0&&(fo=fo+"@"+webphone_api.global.sipaccounts[Eo].serveraddress);break}break}}!webphone_api.common.isNull(fo)&&fo.length>0&&(webphone_api.$("#display_notmain_account").html(fo),webphone_api.$("#display_notmain_account").show())}}var To=webphone_api.common.GetParameter("callnot_title"),No=webphone_api.common.GetParameter("callnot_body"),So=webphone_api.common.GetParameter("callnot_icon"),Io=webphone_api.common.GetParameter("callnot_image");(webphone_api.common.isNull(To)||To.length<1)&&(To=webphone_api.common.GetBrandName()),(webphone_api.common.isNull(No)||No.length<1)&&(No=webphone_api.stringres.get("notification_message")),No+=": ",B.length>0&&B!==so?No=No+B+" ("+so+")":No+=so,(webphone_api.common.isNull(So)||So.length<1)&&(So=webphone_api.common.GetElementSource()+"images/notification_icon.png"),webphone_api.common.isNull(Io)&&(Io=""),webphone_api.common.ShowIncomingCallNotification(To,No,So,!1,Io)}if(!webphone_api.common.isNull(be)&&"2"==be&&co!==webphone_api.global.lastRingEvenet){if(p=280,webphone_api.common.IsContactBlocked(f,null))return p=281,webphone_api.common.PutToDebugLog(4,"EVENT, call dropped (hangup) because blocked contact: "+f),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup blocked contact: "+f),void webphone_api.hangup();if(webphone_api.common.IsNumberBlacklisted(f,null))return p=282,webphone_api.common.PutToDebugLog(4,"EVENT, call dropped (hangup) because blacklisted number: "+f),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup blacklisted number: "+f),void webphone_api.hangup();if(webphone_api.global.active_incoming_call=!0,webphone_api.global.incommingCall=!0,w=!0,webphone_api.global.checkIfInCall=!0,webphone_api.global.checkIfCallActive=!1,p=285,webphone_api.common.SaveParameter("redial",f),webphone_api.common.SaveParameter("lastincalltime",webphone_api.common.GetTickCount()),webphone_api.global.intentcall[0]="number="+f,webphone_api.global.intentcall[1]="calltype=incoming",webphone_api.global.intentcall[2]="name=",p=286,!0===webphone_api.common.UsePresence2()&&!0===webphone_api.global.incommingCall&&"dnd"===webphone_api.common.GetParameter("presencestatus").toLowerCase())return webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup incoming call from: "+so+", because presence is DND"),void webphone_api.hangup();0==webphone_api.common.IsSDK()&&setTimeout(function(){p=290,!1===webphone_api.global.isCallStarted?webphone_api.$.mobile.changePage("#page_call",{transition:"pop",role:"page"}):(p=292,webphone_api.common.isNull(webphone_api._call)||webphone_api._call.OnNewIncomingCall())},500)}p=297,(webphone_api.common.isNull(webphone_api.global.lastRingEvenet)||webphone_api.global.lastRingEvenet.length<1)&&(webphone_api.global.lastRingEvenet=co)}if(p=180,"CallConnect"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200));var so="",B="",be="",po=J.split(","),bo="";if(!webphone_api.common.isNull(po)&&po.length>1&&(bo=po[1]),!1===webphone_api.common.UserExists(bo))return webphone_api.common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),X=K,Y="STATUS",void(Q=se);ie>0&&u(),webphone_api.common.PutToDebugLog(5,"EVENT, callConnected event received"),"Android"===webphone_api.common.GetOs()&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_GetDevice Callconnect"),webphone_api.getdevice(0,function(e){try{if(webphone_api.common.GetParameterInt("androidspeaker",1)>0){if("Default"===e){var o=webphone_api.common.GetAudioRecList();if(!webphone_api.common.isNull(o)&&o.length>0)for(var n=o.split("\r\n"),t=0;t<n.length;t++)!webphone_api.common.isNull(n[t])&&(n[t].toLowerCase().indexOf("earpiece")>=0||n[t].toLowerCase().indexOf("headset")>=0)&&(e=n[t],webphone_api.common.SaveParameter("sel_rtc_audio_in",e),webphone_api.global.audio_rec_curr_device=e,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",e))}!webphone_api.common.isNull(e)&&e.length>0&&(webphone_api.common.PutToDebugLog(4,"EVENT, Set input device id for Android loudspeaker: "+e),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_SetDevice Callconnect"),webphone_api.setdevice(0,e,2))}else{if(e.toLowerCase().indexOf("earpiece")>=0||e.toLowerCase().indexOf("headset")>=0){var o=webphone_api.common.GetAudioRecList();if(!webphone_api.common.isNull(o)&&o.length>0)for(var n=o.split("\r\n"),t=0;t<n.length;t++)!webphone_api.common.isNull(n[t])&&n[t].toLowerCase().indexOf("default")>=0&&(e=n[t],webphone_api.common.SaveParameter("sel_rtc_audio_in",e),webphone_api.global.audio_rec_curr_device=e,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",e))}!webphone_api.common.isNull(e)&&e.length>0&&(webphone_api.common.PutToDebugLog(4,"EVENT, Set input device id for Android loudspeaker: "+e),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_SetDevice Callconnect"),webphone_api.setdevice(0,e,2))}}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: getdevice loudspeaker 2",an)}})),webphone_api.common.ShowIncomingCallNotification("","","",!0,""),webphone_api.global.checkIfInCall=!0,webphone_api.global.callstart_time=webphone_api.common.GetTickCount(),p=182,!webphone_api.common.isNull(po)&&po.length>2&&(!webphone_api.common.isNull(po[0])&&po[0].length>1?so=webphone_api.common.Trim(po[0]):!webphone_api.common.isNull(po[1])&&po[1].length>1&&(so=webphone_api.common.Trim(po[1])),p=184,!webphone_api.common.isNull(po[2])&&po[2].length>0&&(be=webphone_api.common.Trim(po[2])),po.length>3&&(B=po[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=so)),p=188);var Ro="";if(po.length>9&&!webphone_api.common.isNull(po[9])&&(Ro=po[9]),webphone_api.common.isNull(so)&&(so=""),p=190,1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callConnected",webphone_api.common.StrToInt(be),so,B,webphone_api.common.StrToInt(webphone_api.global.aline),Ro)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callConnected",an)}try{webphone_api.common.PutToDebugLog(5,"EVENT, call connected event sent"),webphone_api.onCallStateChangeCb("connected",webphone_api.common.StrToInt(be),so,B,webphone_api.common.StrToInt(webphone_api.global.aline),Ro)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback connected",an)}if(1===webphone_api.common.StrToInt(be)){if(p=205,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallconnected,"callConnected",be,so,so,""),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var Go=webphone_api.common.GetParameterInt("beeponconnect",0);3!==Go&&4!==Go||webphone_api.common.Beep("1")}}else p=206,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallconnected,"callConnected",be,so,so,"");p=207,webphone_api.common.SaveCallSession(webphone_api.global.aline,null,so,be,-1,webphone_api.common.GetTickCount(),-1,"","","","",null),setTimeout(function(){webphone_api.common.RefreshInfo()},400)}if(p=200,"CallDisconnect"===K){webphone_api.common.PutToDebugLog(2,"EVENT, ProcessNotifications call disc received");var Oo=0;try{var Lo=webphone_api.common.Trim(n).split(","),bo="";if(!webphone_api.common.isNull(Lo)&&Lo.length>3&&(bo=Lo[4]),!1===webphone_api.common.UserExists(bo))return webphone_api.common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),X=K,Y="STATUS",void(Q=se);Oo=2,webphone_api.common.ShowIncomingCallNotification("","","",!0,"");var k=webphone_api.global.aline,Co="";Oo=3,!webphone_api.common.isNull(Lo)&&Lo.length>3&&(!webphone_api.common.isNull(Lo[1])&&webphone_api.common.IsNumber(Lo[1])&&(k=webphone_api.common.StrToInt(Lo[1])),webphone_api.common.isNull(Lo[3])||(Co=webphone_api.common.Trim(Lo[3]))),Oo=4,webphone_api.common.RemoveSessionHeadersFromCache(k),setTimeout(function(){webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, notifications delete/remove endpoint on call disconnected for number: "+Co+"; line: "+k.toString());var e=!0;!0===webphone_api.global.calltransf_completed&&(e=!1),(!0!==webphone_api.global.checkIfInCall||webphone_api.common.isNull(webphone_api.global.ep)||1!==webphone_api.global.ep.length)&&webphone_api.common.GetEndpoint(k,Co,"",e)},350),Oo=5;var po=J.split(","),so="",B="",be="";if(Oo=7,p=202,!webphone_api.common.isNull(po)&&po.length>2&&(!webphone_api.common.isNull(po[0])&&po[0].length>1?so=webphone_api.common.Trim(po[0]):!webphone_api.common.isNull(po[1])&&po[1].length>1&&(so=webphone_api.common.Trim(po[1])),p=204,!webphone_api.common.isNull(po[2])&&po[2].length>0&&(be=webphone_api.common.Trim(po[2])),p=206,po.length>3&&(B=po[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=so))),webphone_api.global.CLOSE_CALL_TIMER<0){var Do=0,yo=webphone_api.common.GetEndpoint(k,Co,"",!1);if(!webphone_api.common.isNull(yo)&&yo.length>5){var xo=yo[webphone_api.common.EP_CONNECTTIME];!webphone_api.common.isNull(xo)&&webphone_api.common.IsNumber(xo)&&(xo=webphone_api.common.StrToIntDef(xo,0))>0&&(Do=webphone_api.common.GetTickCount()-xo)}webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout",3e3),(1==be||"1"==be)&&Do<4e3&&(webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout_err",7e3))}webphone_api.common.GetNrOfActiveCalls()<2&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.isconfcall=!1),Oo=6,p=201,webphone_api.common.ResetIce(),Oo=8;var Ro="";if(po.length>9&&!webphone_api.common.isNull(po[9])&&(Ro=po[9]),p=213,webphone_api.common.isNull(so)&&(so=""),!1===webphone_api.common.IsSDK()&&(p=215),Oo=9,!0!==webphone_api.common.GetParameterBool("voicerecording",!1)||webphone_api.common.isNull(webphone_api._call)||!0===webphone_api._call.IsRecStarted(so)&&webphone_api._call.StopRecording(so),Oo=10,p=218,1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callDisconnected",webphone_api.common.StrToInt(be),so,B,k,Ro)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callDisconnected",an)}try{webphone_api.onCallStateChangeCb("disconnected",webphone_api.common.StrToInt(be),so,B,k,Ro)}catch(an){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback disconnected",an)}!1===webphone_api.global.calltransf_completed&&webphone_api.common.SaveCallSession(null,null,so,webphone_api.common.StrToInt(be),-1,-1,webphone_api.common.GetTickCount(),"","","","",null),Oo=11,webphone_api.global.acallcount--,webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.usemutemutiline=!1),Oo=12}catch(an){webphone_api.common.PutToDebugLogException(2,"ProcessNotifications CallDisconnect error: "+Oo.toString(),an)}}if(p=220,"Call Finished"===K){if(ee=!1,webphone_api.global.bothpartyhold=!1,webphone_api.global.authenticated_displayed=!1,webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.isscreensharecall=!1,webphone_api.global.rating="",webphone_api.global.isholdresume=!1,webphone_api.global.isresume=!1,webphone_api.global.holdresumecount=0,webphone_api.global.add_recall_header=!1,ie>0)try{"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_NOTIFICATION")}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications inner AndroidWebphoneJsInterface",an)}p=222,webphone_api.common.ResetIce(),v=webphone_api.common.GetTickCount(),webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.closeCallAtivity=!0),webphone_api.global.isCallStarted&&webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)||webphone_api.global.waiting_conf_numbers.length<1)&&!1===webphone_api.global.dontshow_closecall&&(webphone_api.$("#btn_hangup_img").attr("src",webphone_api.common.GetElementSource()+"images/btn_close_txt.png"),webphone_api.$("#btn_hangup").attr("title",webphone_api.stringres.get("hint_closecall")),webphone_api.$("#acceptreject_layout").hide(),webphone_api.$("#callfunctions_layout").hide(),webphone_api.$("#hangup_layout").show()),webphone_api.common.IsMultiline()||(webphone_api.global.hangupPressedCount=1),p=232,webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1,webphone_api.global.isconfcall=!1,M=!1),webphone_api.global.callTypeInOut="",webphone_api.global.creditRequestTimer=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL-50,webphone_api.global.lastRingEvenet="",webphone_api.global.isfirstcall=!1,h=!1}if(p=240,"Finished"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200)),ee=!1,webphone_api.global.bothpartyhold=!1,webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.global.rating="",webphone_api.global.firefoxholdcount=0,webphone_api.global.isholdresume=!1,webphone_api.global.isresume=!1,webphone_api.global.holdresumecount=0,webphone_api.global.add_recall_header=!1,p=242,webphone_api.common.ResetIce(),!0===webphone_api.global.incommingCall&&!1===webphone_api.global.acceptReject&&webphone_api.global.isCallStarted&&(p=245,!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.OnCallerHangup()),webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1,webphone_api.global.isconfcall=!1,M=!1,webphone_api.global.incommingCall=!1,webphone_api.global.speakerState=!0,webphone_api.global.bluetoothState=!0,webphone_api.global.lastBTclicktick=0,webphone_api.global.callTypeInOut="",webphone_api.global.lastRingEvenet="",webphone_api.global.isfirstcall=!1),h=!1;var Ao=webphone_api.common.GetParameterInt("vdnr",0);if(webphone_api.global.isvideocall||webphone_api.isscreensharecall){Ao+=1,webphone_api.common.SaveParameter("vdnr",Ao);4===webphone_api.common.GetParameterInt("videomode",0)&&webphone_api.common.ExitVideoMode("Auto, on call finished")}if(webphone_api.global.isvideocall=!1,webphone_api.isscreensharecall=!1,p=247,!1===webphone_api.global.usestorage&&!1===webphone_api.common.Strl(60)&&Ao<2&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&!0===webphone_api.common.CanIUseService()){if(!0===(!0===webphone_api.common.IsMacLin()&&!0===webphone_api.common.IsMizuPublicWebRTCGateway())){p=248;var ko=webphone_api.common.GetParameterInt("lccnr",0);if(ko>0&&ko<46){var Uo=webphone_api.common.GetParameterInt("closecall_timeout_err",7e3);Uo<webphone_api.common.GetParameterInt("closecall_timeout",4e3)&&(Uo=webphone_api.common.GetParameterInt("closecall_timeout",4e3)),Uo+=1500,setTimeout(function(){function e(){webphone_api.common.SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,p=253,webphone_api.common.ResetEngineClicked();var e=webphone_api.common.GetEngine("ns");e.clicked=2,webphone_api.common.SetEngine("ns",e),webphone_api.common.EngineSelect(1,1),p=257,webphone_api.common.PutToDebugLog(2,"EVENT, notifications: offer ns engine instead of WebRTC: "+webphone_api.common.GetMinServiceVersion().toString()),p=259,webphone_api.common.EngineForcedInstall("ns",webphone_api.stringres.get("serviceengine_msg"),null,function(){webphone_api.startInner()})}var o=webphone_api.$.mobile.activePage.find(".messagePopup");!webphone_api.common.isNull(o)&&o.length>0&&!0!==webphone_api.global.dontclosecurrpopup?webphone_api.$.mobile.activePage.find(".messagePopup").popup("close").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),e()}}):e()},Uo)}}}}if(p=260,p=300,"Starting call"===K&&(!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200)),webphone_api.global.checkIfInCall=!0,webphone_api.global.checkIfCallActive=!1),p=304,"InCall"!==K&&"In Call"!==K||(webphone_api.global.checkIfInCall=!0,w&&(p=307,!1===webphone_api.common.IsSDK()&&webphone_api.common.GetNrOfActiveCalls()<2&&!webphone_api.common.isNull(webphone_api._call)&&webphone_api._call.AcceptCall(!1))),p=310,"Speaking"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200));var po=J.split(","),bo="";if(!webphone_api.common.isNull(po)&&po.length>1&&(bo=po[1]),!1===webphone_api.common.UserExists(bo))return webphone_api.common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),X=K,Y="STATUS",void(Q=se);if(webphone_api.global.apistartstate=2,!1===ee&&(p=312,ee=!0,!1===webphone_api.common.IsSDK()&&webphone_api.common.GetNrOfActiveCalls()<2&&!webphone_api.common.isNull(webphone_api._call)&&webphone_api._call.AcceptCall(!1)),!1===webphone_api.common.IsSDK()&&!1===webphone_api.global.isCallStarted&&webphone_api.common.isNull($)&&($=setTimeout(function(){!1===webphone_api.global.isCallStarted&&(webphone_api.global.intentcall[0]="number=",webphone_api.global.intentcall[1]="calltype=outgoing",webphone_api.global.intentcall[2]="name=",webphone_api.global.intentcall[3]="callmode=0",webphone_api.$.mobile.changePage("#page_call",{transition:"pop",role:"page"}))},1e3)),G=!0,webphone_api.global.incommingCall&&(webphone_api.global.incommingCall=!1),webphone_api.global.checkIfCallActive=!0,webphone_api.global.checkIfInCall=!0,webphone_api.global.lastRingEvenet="",p=314,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){p=315;var Vo=location.hostname;webphone_api.common.isNull(Vo)&&(Vo=""),Vo+=" / ",Vo+=window.location.href,Vo+=" / ",Vo+=webphone_api.getbasedir2();var Wo=1;if(!1===webphone_api.common.Awb2()){var S=[];S.push("L"),S.push("i"),S.push("c"),S.push("e"),S.push("n"),S.push("s"),S.push("e "),S.push("e"),S.push("r"),S.push("r"),S.push("o"),S.push("r"),S.push(", "),S.push("w"),S.push("e"),S.push("b"),S.push("s"),S.push("e"),S.push("r"),S.push("v"),S.push("e"),S.push("r"),S.push(" "),S.push("n"),S.push("o"),S.push("t"),S.push(" "),S.push("a"),S.push("l"),S.push("l"),S.push("o"),S.push("w"),S.push("e"),S.push("d"),S.push(" "),S.push("(");var Mo=[];Mo.push(")"),Mo.push(" "),Mo.push("h"),Mo.push("a"),Mo.push("n"),Mo.push("g"),Mo.push("u"),Mo.push("p");var I=S.join(""),Fo=Mo.join("");p=320,setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+I+Vo+Fo)},3576),setTimeout(function(){webphone_api.common.ShowToast(I+Vo+Fo)},4235),Wo=10}if(Wo>5&&setTimeout(function(){webphone_api.hangup()},1180),C<0){if(!0===webphone_api.common.Ch())C=1;else{C=0;var S=[];S.push("L"),S.push("i"),S.push("c"),S.push("e"),S.push("n"),S.push("s"),S.push("e "),S.push("e"),S.push("r"),S.push("r"),S.push("o"),S.push("r"),S.push(", "),S.push("i"),S.push("n"),S.push("v"),S.push("a"),S.push("l"),S.push("i"),S.push("d "),S.push("s"),S.push("e"),S.push("r"),S.push("v"),S.push("e"),S.push("r"),S.push("a"),S.push("d"),S.push("d"),S.push("r"),S.push("e"),S.push("s"),S.push("s"),S.push(" "),S.push("h"),S.push("a"),S.push("n"),S.push("g"),S.push("u"),S.push("p");var I=S.join("");p=320,setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+I)},351),setTimeout(function(){webphone_api.common.ShowToast(I)},391)}}0===C&&setTimeout(function(){webphone_api.hangup()},123)}if(p=322,webphone_api.common.GetNrOfActiveCalls()>1&&!1===M){M=!0;var Ho=webphone_api.common.StrToInt(webphone_api.common.GetParameter("automute")),Bo=webphone_api.common.StrToInt(webphone_api.common.GetParameter("autohold")),$o=webphone_api.common.GetParameterInt("defmute",0);if(3!==$o&&4!==$o||($o=0),(webphone_api.common.isNull(Ho)||Ho<1)&&(webphone_api.common.isNull(Bo)||Bo<1));else for(var N=0;N<webphone_api.global.ep.length;N++){var jo=webphone_api.global.ep[N];if(!(webphone_api.common.isNull(jo)||jo.length<1)){if(!webphone_api.common.isNull(jo[webphone_api.common.EP_DISCONNECTTIME])&&webphone_api.common.IsNumber(jo[webphone_api.common.EP_DISCONNECTTIME])){var qo=webphone_api.common.StrToInt(jo[webphone_api.common.EP_DISCONNECTTIME]);if(qo>10)continue}var zo=jo[webphone_api.common.EP_LINE];if(!(webphone_api.common.isNull(zo)||zo.length<1||!1===webphone_api.common.IsNumber(zo))){var Ko=webphone_api.common.StrToInt(zo);if(webphone_api.global.aline!=Ko){var Jo=jo[webphone_api.common.EP_MUTESTATE],Xo=jo[webphone_api.common.EP_HOLDSTATE];"false"==Jo&&(3===Ho||2===Ho&&!1===w||1===Ho&&!0===w)&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?webphone_api.webrtcapi.SipToggleMute(!0,$o,Ko):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_MuteEx",null,Ko,!0,$o):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.MuteEx(Ko,!0,$o),webphone_api.global.ep[N][webphone_api.common.EP_MUTESTATE]="true"),"false"==Xo&&(3===Bo||2===Bo&&!1===w||1===Bo&&!0===w)&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?webphone_api.webrtcapi.SipToggleHoldResume(!0,Ko):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_Hold",null,Ko,!0):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&(webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mainlogic hold call because autohold; peer: "+webphone_api.global.ep[N][webphone_api.common.EP_DESTNR]+" on line: "+webphone_api.global.ep[N][webphone_api.common.EP_LINE]),webphone_api.webphone.Hold(Ko,!0)),webphone_api.global.ep[N][webphone_api.common.EP_HOLDSTATE]="true")}}}
}}h||(h=!0,p=338,webphone_api.global.isencrypted=webphone_api.isencrypted(),setTimeout(function(){webphone_api.global.isencrypted>0?webphone_api.$(".img_encrypt").show():webphone_api.$(".img_encrypt").hide()},1e3))}p=340,K.toLowerCase().indexOf("registered")>=0&&K.toLowerCase().indexOf("unregistered")<0&&(E<4&&(E=4),p=342,webphone_api.global.phonestarted=3,webphone_api.common.SaveParameter("lastsucc","1"),b||(b=!0),p=344,setTimeout(function(){webphone_api.global.isencrypted>0?webphone_api.$(".img_encrypt").show():webphone_api.$(".img_encrypt").hide()},1e3)),p=360}else if("CHAT"===z){var _e=-1,we=webphone_api.common.Trim(n),fe=we.indexOf(",");if(fe>0&&(we=we.substring(fe+1),(fe=we.indexOf(","))>0&&(we=webphone_api.common.Trim(we.substring(0,fe)),!webphone_api.common.isNull(we)&&webphone_api.common.IsNumber(we)&&(_e=webphone_api.common.StrToInt(we)))),J.indexOf("[PRESENCE")>=0)return J=J.replace("[",""),J=J.replace("]",""),void o(J);p=361,a(K,J,_e)}"Rejected"===K&&w&&(p=364,!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.RejectCall(!1)),V=J.indexOf(","),V>0&&(J=K),p=366,V=K.indexOf("[ep"),V>0&&(K=webphone_api.common.Trim(K.substring(0,V)),J=K),p=370;var Yo="";if(("EVENT"===z||"ERROR"===z||"WARNING"===z||"STATUS"===z)&&(p=371,V=J.indexOf("("),Yo=V>0&&K.indexOf(oe)<0&&K.indexOf(ne)<0?webphone_api.common.Trim(J.substring(0,V)):J,p=374,!webphone_api.common.IsNumber(Yo.charAt(0)))){if(Yo=Yo.substring(0,1).toUpperCase()+Yo.substring(1),"STATUS"===z){if("Deletable"!==Yo&&Yo.indexOf("Chat")<0){pe=Yo,se=-1;var Qo=n.split(",");if(!webphone_api.common.isNull(Qo)&&Qo.length>1&&!webphone_api.common.isNull(Qo[1])&&webphone_api.common.IsNumber(Qo[1])&&(se=webphone_api.common.StrToIntDef(Qo[1],-1)),webphone_api.common.isNull(webphone_api.global.callPageStatusCachePerLine)&&(webphone_api.global.callPageStatusCachePerLine={}),!1===webphone_api.common.IsSDK()&&("page_call"===webphone_api.$.mobile.activePage.attr("id")||n.indexOf("CallSetup")>0)){var Zo=webphone_api.common.StrToIntDef(Qo[1],-1);if(Zo>0){var en=L;n.indexOf("ERROR")>=0?en="#FF0000":n.indexOf("WARNING")>=0&&(en="#D28F00"),"undefined"!=typeof webphone_api.global.callPageStatusCachePerLine[Zo]&&null!==webphone_api.global.callPageStatusCachePerLine[Zo]&&"undefined"!=typeof webphone_api.global.callPageStatusCachePerLine[Zo][0]&&null!==webphone_api.global.callPageStatusCachePerLine[Zo][0]&&"Muted"===webphone_api.global.callPageStatusCachePerLine[Zo][0]&&"Speaking"===Yo||(webphone_api.global.callPageStatusCachePerLine[Zo]=[Yo,en])}}}}else{X=Yo,Y=z,Q=-1;var Qo=n.split(",");!webphone_api.common.isNull(Qo)&&Qo.length>1&&!webphone_api.common.isNull(Qo[1])&&webphone_api.common.IsNumber(Qo[1])&&(Q=webphone_api.common.StrToIntDef(Qo[1],-1))}if(p=377,"Register failed"===Yo){pe=Yo,se=-1;var Qo=n.split(",");!webphone_api.common.isNull(Qo)&&Qo.length>1&&!webphone_api.common.isNull(Qo[1])&&webphone_api.common.IsNumber(Qo[1])&&(se=webphone_api.common.StrToIntDef(Qo[1],-1))}if(p=379,(Yo.indexOf("Register failed")>=0||Yo.indexOf("Connection lost")>=0||Yo.indexOf("No network")>=0||Yo.indexOf("Network is down")>=0||Yo.indexOf("No response from server")>=0||Yo.indexOf("Server lost")>=0||Yo.indexOf("Authentication failed")>=0||Yo.indexOf("Rejected by server")>=0||Yo.indexOf("Register rejected")>=0||Yo.indexOf("Register expired")>=0||Yo.indexOf("Register failed")>=0)&&(webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetRegFailReason",function(e){try{webphone_api.onRegStateChangeCb("failed",e)}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(failed) callback service",an)}try{webphone_api.onRegisterFailedCb(e)}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegisterFailed() callback service",an)}},!0),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.GetRegFailReason(function(e){try{webphone_api.onRegStateChangeCb("failed",e)}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(failed) callback webphone",an)}try{webphone_api.onRegisterFailedCb(e)}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegisterFailed() callback webphone",an)}},!0),!0===webphone_api.global.onunregistered_flag||!1===webphone_api.flagrestartwebrtc||webphone_api.common.SaveParameter("lastsucc","0"),webphone_api.global.dispregfailed<2&&(webphone_api.global.laststarttick<1||webphone_api.common.GetTickCount()-webphone_api.global.laststarttick>2500))){p=382,webphone_api.global.dispregfailed=2;var on=Yo;on=on.indexOf("Register failed")<0?"Register failed_: "+on:on.replace("Register failed","Register failed_"),webphone_api.common.PutToDebugLog(2,"EVENT, notification ProcessNotifications display: Register failed_: "+on),webphone_api.common.ShowToast(on,6e3)}}p=400}catch(an){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications ("+p.toString()+"), not: "+n,an)}}function n(e){we=e}function t(){function e(e){try{webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup EarlyHangup: "+e),webphone_api.hangup()}catch(o){webphone_api.common.PutToDebugLogException(2,"notifications: EarlyHangup",o)}}var o=0;try{var n=webphone_api.common.GetTickCount();if(webphone_api.global.ever_received_pong&&webphone_api.global.pingpong>2){!0===WsReconnect()?webphone_api.common.PutToDebugLog(2,"EVENT, WSReConnect from timer succeded"):webphone_api.common.PutToDebugLog(2,"ERROR, WSReConnect from timer failed")}webphone_api.global.wsc_contimeout>10&&n-webphone_api.global.wsc_contimeout>5e3&&(webphone_api.global.wsc_contimeout=0,webphone_api.common.PutToDebugLog(2,"ERROR, WSReConnect websocketAPI connection timed out (from timer)"),webphone_api.common.WSReConnect()),webphone_api.global.wsc_reqtimeout>10&&n-webphone_api.global.wsc_reqtimeout>5e3&&(webphone_api.global.wsc_reqtimeout=0,webphone_api.common.PutToDebugLog(2,"ERROR, WSReConnect websocketAPI request timed out (from timer)"),webphone_api.common.WSReConnect()),!0===webphone_api.global.dontshowdiscreason&&H>25&&(H=0,webphone_api.global.dontshowdiscreason=!1),1===webphone_api.global.dispregfailed&&++Pe>330&&(Pe=0,webphone_api.global.dispregfailed=2,webphone_api.global.phonestarted<2&&!0===webphone_api.common.NeedRegister()&&(webphone_api.common.PutToDebugLog(2,"EVENT, notification OnTimerCycle display: Register failed"),webphone_api.common.ShowToast("Register failed"))),re<5e3&&re++,X.length>0?(X.toLowerCase().indexOf("authenticated successfully")>=0&&(pe="Registered.",se=-1),ce=X,ue=Y,ge=Q,re=0,X="",Y="",Q=-1):re>le?(ce=pe,ue="STATUS",ge=se):pe.indexOf("Registered.")>=0&&"ERROR"!==ue&&"WARNING"!==ue&&(webphone_api.global.firstregister_sessiontick<1||webphone_api.global.firstregister_sessiontick>0&&n-webphone_api.global.firstregister_sessiontick<5e3)&&(ce=pe,ue="STATUS",ge=se);try{var t=ce.indexOf("[");t>0&&(ce=ce.substring(0,t)),ce=webphone_api.common.Trim(ce),t=ce.indexOf("]"),t>0&&(ce=ce.substring(t+1)),ce=webphone_api.common.Trim(ce)}catch(f){webphone_api.common.PutToDebugLogException(3,"notifications OnTimerCycle parse displayed status",f)}if("Registered."!==ce&&"Registered"!==ce||(ce+=webphone_api.global.credit,Ee!==webphone_api.global.useengine&&(Ee=webphone_api.global.useengine,webphone_api.common.SaveLastUsedEngine())),"Register..."!==ce&&"Registering..."!==ce&&"Register Failed"!==ce&&"Not Found"!==ce||Ee!==webphone_api.global.useengine&&(Ee=webphone_api.global.useengine,webphone_api.common.SaveLastUsedEngine()),0!==ce.indexOf("Credit:")&&1!==ce.indexOf("Credit:")&&ce.indexOf("Outband")<0&&ce.indexOf("Deletable")<0&&ce.indexOf("Outbound")<0&&ce.toLowerCase().indexOf("subscribe")<0&&(ce.toLowerCase().indexOf("hide")>=0&&(ce=" "),l(ce,ue,0,ge)),o=40,webphone_api.global.ringstart_time>0&&webphone_api.global.callstart_time<1&&webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE){o=41,(webphone_api.common.isNull(k)||!1===webphone_api.common.IsNumber(k))&&(k=90001),(webphone_api.common.isNull(U)||!1===webphone_api.common.IsNumber(U))&&(U=0),(webphone_api.common.isNull(V)||!1===webphone_api.common.IsNumber(V))&&(V=0);var i=k;!0===webphone_api.global.incommingCall?U>0&&(i=U):V>0&&(i=V);var a=webphone_api.common.GetParameter2("cutincoming"),r=0;"-1"===a?r=-1:"0"===a?r=0:"1"===a&&(r=1),o=51,n-webphone_api.global.ringstart_time>i&&(0==webphone_api.global.lastringtimeouttick||n-webphone_api.global.ringstart_time>3e3)&&(webphone_api.global.lastringtimeouttick=n,e("Hangup because ringtimeout limit reached: "+i)),-1===r?!0===webphone_api.global.incommingCall&&n-webphone_api.global.ringstart_time>14e3&&"Chrome"===webphone_api.common.GetBrowser()&&e("Hangup because ringtimeout in Chrome browser limit reached: 14000"):1===r&&!0===webphone_api.global.incommingCall&&n-webphone_api.global.ringstart_time>14e3&&e("Hangup because ringtimeout in ALL browsers limit reached: 14000")}if(o=55,webphone_api.global.callstart_time>0&&webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE&&(o=56,(webphone_api.common.isNull(W)||!1===webphone_api.common.IsNumber(W))&&(o=57,W=108e5),o=58,n-webphone_api.global.callstart_time>W&&(o=67,webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because calltimeout limit reached: "+W),o=68,webphone_api.hangup(),o=69)),o=70,!0===webphone_api.common.Glbr()&&!T&&0===webphone_api.global.creditRequestTimer&&E>2){var p=webphone_api.common.GetParameter("creditrequest");!webphone_api.common.isNull(p)&&p.length>0&&webphone_api.common.UriParser(p,"","","","","creditrequest")}if(webphone_api.global.creditRequestTimer++,webphone_api.global.creditRequestTimer>webphone_api.global.creditRequestIval&&(webphone_api.global.creditRequestTimer=0),n-O>webphone_api.global.presenceinterval&&(O=n,!1===webphone_api.common.IsSDK()&&!0===(F=webphone_api.common.UsePresence2())&&webphone_api.common.PresenceGet2(webphone_api.common.GetParameter("srvcontacts"))),!0===F&&!0===webphone_api.global.isMessageStarted&&++webphone_api.global.msg_presence_timer>200&&(webphone_api.global.msg_presence_timer=0,!1===webphone_api.common.IsSDK()&&webphone_api._message.RefreshPresence()),n-D>y&&(D=n,webphone_api.common.CallWsuserKeepAlive(!1)),n-x>A&&(x=n,webphone_api.common.CallWsuserKeepAlive(!0),webphone_api.common.PutToDebugLog(2,"EVENT, wsuser keepalive hourly called")),webphone_api.global.closeCallAtivity&&(webphone_api.global.CLOSE_CALL_TIMER<0&&(webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout",3e3)),n-v>webphone_api.global.CLOSE_CALL_TIMER&&(webphone_api.global.CLOSE_CALL_TIMER=-100,webphone_api.global.closeCallAtivity=!1,v=0,!1===webphone_api.global.incommingCall&&!1===webphone_api.global.checkIfInCall&&webphone_api.global.isCallStarted&&(!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.CloseCall()))),n-N>5e3&&!0===webphone_api.global.wasSettModified){N=n,webphone_api.global.wasSettModified=!1;var s="";s=1==webphone_api.common.IsSDK()?webphone_api.common.GetSettFilenameSDK():webphone_api.common.GetActiveAccSettingsFilename(),webphone_api.common.SaveSettingsFile(1,s,function(e){webphone_api.common.CanLog(2)&&(e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveSettingsFile from timer Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveSettingsFile from timer Failed"))})}if(n-S>200&&(S=n,!0===webphone_api.global.wasCtModified&&(webphone_api.global.wasCtModified=!1,webphone_api.common.SaveContactsFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveContactsFile from timer Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveContactsFile from timer Failed")}))),n-I>400&&(I=n,webphone_api.global.wasChModified&&(webphone_api.global.wasChModified=!1,webphone_api.common.SaveCallhistoryFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveCallhistoryFile from timer Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveCallhistoryFile from timer Failed")}))),"Ringing"===K&&!0===he&&(we=webphone_api.common.GetTickCount(),he=!1,_e=!0),"Speaking"===K&&!0===de&&(we=webphone_api.common.GetTickCount(),de=!1,_e=!0),!1===webphone_api.common.IsSDK()&&webphone_api.global.isCallStarted&&!0===_e&&++fe>=3){ve=!0===webphone_api.common.GetHoldState(-1)?webphone_api.stringres.get("in_hold")+" ":"";var n=webphone_api.common.GetTickCount(),c=webphone_api.common.GetTickCount()-we,u=Math.floor(c/1e3),g=Math.floor(u/60);u%=60,u<10&&(u="0"+u),webphone_api.global.isCallStarted&&webphone_api.$("#call_duration").html(ve+g+":"+u+"&nbsp;"),fe=0}if("Call Finished"!==K&&"Finished"!==K||webphone_api.common.GetNrOfActiveCalls()<1&&(_e=!1,he=!0,de=!0,webphone_api.webrtcapi.RemoveUnusedAudioElements()),J.indexOf(":")>0){if("Call duration"===webphone_api.common.Trim(J.substring(0,J.indexOf(":")))){_e=!1,ve=webphone_api.stringres.get("duration")+" ";var m=webphone_api.common.Trim(J.substring(J.indexOf(":")+1,J.length)),b=0,g=0,u=0;if(m.indexOf(":")<0?u=webphone_api.common.Trim(m.substring(0,m.indexOf(" "))):(b=webphone_api.common.Trim(m.substring(0,m.indexOf(":"))),m=webphone_api.common.Trim(m.substring(m.indexOf(":")+1,m.length)),g=webphone_api.common.Trim(m.substring(0,m.indexOf(":"))),m=webphone_api.common.Trim(m.substring(m.indexOf(":")+1,m.length)),u=webphone_api.common.Trim(m.substring(0,m.length))),!webphone_api.common.isNull(b)&&b.length>0&&webphone_api.common.IsNumber(b)){var h=webphone_api.common.StrToInt(b);h*=60,g=webphone_api.common.StrToInt(g)+h}if(webphone_api.global.isCallStarted&&webphone_api.$("#call_duration").html(ve+g+":"+u+"&nbsp;"),G&&!1===webphone_api.common.GetParameterBool("customizedversion",!0)){var d=webphone_api.common.StrToInt(g),_=webphone_api.common.StrToInt(u);if(d>0||_>30){var w=0;try{w=webphone_api.common.StrToInt(webphone_api.common.GetParameter("proversioncallcount"))}catch(P){webphone_api.common.SaveParameter("proversioncallcount","0")}w<25&&w++,webphone_api.common.SaveParameter("proversioncallcount",w.toString()),G=!1}}}}n-webphone_api.global.httpkatimer>me&&webphone_api.global.phonestarted>1&&(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)&&(webphone_api.global.httpkatimer=n,webphone_api.common.WinAPI("API_HTTPKeepAlive",function(e){webphone_api.common.PutToDebugLog(2,"EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: "+e)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE&&webphone_api.global.service_last_life_signal>10&&n-webphone_api.global.service_last_life_signal>8e3&&(webphone_api.common.WinAPI("API_HTTPKeepAlive",function(e){webphone_api.common.PutToDebugLog(2,"EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: "+e)}),webphone_api.common.isNull(B)||clearTimeout(B),B=null,B=setTimeout(function(){webphone_api.common.GetTickCount()-webphone_api.global.service_last_life_signal>8e3&&(webphone_api.global.service_last_life_signal=webphone_api.common.GetTickCount(),webphone_api.common.PutToDebugLog(2,"ERROR, call Handle WSAPIReConnect from timer"),webphone_api.common.WSAPIHandleReConnect()),webphone_api.common.isNull(B)||clearTimeout(B),B=null},2e3))),n-webphone_api.global.httpkatimer>be&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&(webphone_api.global.httpkatimer=n,webphone_api.HTTPKeepAlive())}catch(R){webphone_api.common.PutToDebugLogException(2,"notifications: OnTimerCycle ("+o.toString()+")",R)}}function i(e,o,n,t,i,a){try{if(webphone_api.common.CanLog(4)&&webphone_api.common.PutToDebugLog(4,"EVENT, notifications CDR added; AddToCallLog(); number: "+e+"; type: "+o+"; recorded: "+n+"; duration: "+t+"; callDateTime = "+P+"; line: "+i),webphone_api.common.isNull(e)&&e.length<1)return;webphone_api.common.isNull(a)&&(a=""),a=webphone_api.common.ReplaceAll(a,","," "),a=webphone_api.common.Trim(a),webphone_api.global.refreshrecents=!0;var r=0;r=P>0?P:webphone_api.common.GetTickCount(),P=0,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE&&!webphone_api.common.isNull(t)&&webphone_api.common.IsNumber(t)&&t>0&&(webphone_api.common.SaveParameter("nsupdate","-1"),t>30&&(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))?webphone_api.common.SaveParameter("lnsengine","0"):webphone_api.common.SaveParameter("lnsengine","1"));var l=0,p=0,s="";try{t=Math.floor(t),l=Math.floor(t/60),p=t%60,l<10&&(s+="0"),s+=0===l?"0:":l+":",p<10&&(s+="0"),s+=p}catch(f){webphone_api.common.PutToDebugLogException(3,"notifications AddToCallLog calc duration",f)}webphone_api.common.isNull(webphone_api.global.callName)&&(webphone_api.global.callName=""),webphone_api.common.isNull(o)&&(o=""),webphone_api.common.isNull(n)&&(n="");var c="";(1===webphone_api.common.IsMultiline()||!webphone_api.common.isNull(i)&&webphone_api.common.StrToInt(i)>1)&&(c=webphone_api.common.GetContactNameFromNumber(e));var u=webphone_api.common.GetContactIdFromNumber(e);if(u>=0){var g=webphone_api.global.ctlist[u];if(webphone_api.common.IsNumber(g[webphone_api.common.CT_USAGE])){var m=webphone_api.common.StrToInt(g[webphone_api.common.CT_USAGE]);m++,g[webphone_api.common.CT_USAGE]=m.toString(),webphone_api.global.ctlist[u]=g}}c===e&&(c=!webphone_api.common.isNull(webphone_api.global.telsearchname)&&webphone_api.global.telsearchname.length>0?webphone_api.common.Trim(webphone_api.global.telsearchname):webphone_api.global.callName),webphone_api.global.telsearchname="",(webphone_api.common.isNull(c)||c.length<1)&&(c=e);var b=1;"0"!==o&&(b=2),1==b?webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcalldisconnected,"callDisconnected",b,e,c,"",r,t,webphone_api.global.lastcallcdr):webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincalldisconnected,"callDisconnected",b,e,c,"","","",webphone_api.global.lastcallcdr);var h=[o,c,e,""+r,""+t,n,a];if(webphone_api.global.chlist.unshift(h),webphone_api.global.wasChModified=!0,"2"===o&&webphone_api.common.PutNotifications2("0","",c+" - "+e,0),webphone_api.common.isNull(c)||c.length<1||!1===webphone_api.common.ContactExists(c,"")){var d=null,_=!1;if(!webphone_api.common.isNull(webphone_api.global.alreadyCalledNrs)&&webphone_api.global.alreadyCalledNrs.length>0&&(d=webphone_api.global.alreadyCalledNrs.split(",")),!webphone_api.common.isNull(d))for(var w=0;w<d.length;w++)if(d[w]===e){_=!0;break}!1===_&&(webphone_api.global.alreadyCalledNrs.length<=0?webphone_api.global.alreadyCalledNrs=e:webphone_api.global.alreadyCalledNrs=webphone_api.global.alreadyCalledNrs+","+e,webphone_api.global.contactExists=!1,webphone_api.global.contactExistsNr=e)}!1===webphone_api.isincall()&&(webphone_api.global.sipunicoderewritefrom="",webphone_api.global.sipunicoderewriteto="")}catch(v){webphone_api.common.PutToDebugLogException(2,"notifications: AddToCallLog",v)}}function a(e,o,n){try{if(webphone_api.common.CanLog(4)&&webphone_api.common.PutToDebugLog(4,"EVENT, notifications: OnMessageReceived from: "+e+"; message: "+o),webphone_api.common.IsContactBlocked(e,null))return void webphone_api.common.PutToDebugLog(4,"EVENT, chat message dropped because blocked contact: "+e);if(webphone_api.common.IsNumberBlacklisted(e,null))return void webphone_api.common.PutToDebugLog(4,"EVENT, chat message dropped because blacklisted number: "+e);var t="";if(o.indexOf("GROUP:")>=0&&(t=o.substring(o.indexOf("GROUP:")+6),t=webphone_api.common.Trim(t.substring(0,t.indexOf(":"))),webphone_api.common.isNull(t)&&(t=""),o=o.substring(o.indexOf("GROUP:")+6),o=webphone_api.common.Trim(o.substring(o.indexOf(":")+1))),webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o),0===o.indexOf("_BASE64_")&&(o=webphone_api.common.B64Dec(o),webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o)),o===webphone_api.stringres.get("composing")||o===webphone_api.stringres.get("composing")+"...")return void webphone_api.common.PutToDebugLog("CHATCOMPOSING,"+n+","+e+",1");if(o.indexOf("FILETRANSFER_DELIVERED:")>=0)return void(!0===webphone_api.global.isFiletransferStarted&&webphone_api.$("#ftranf_status").html(webphone_api.stringres.get("ftrnasf_status_delivered")));if(o.indexOf("[CONFERENCE]")>=0)return void webphone_api.common.ReceivedConferenceInvite(e,o);if(o.indexOf("[CONFERENCE_ANSWER]")>=0)return void(webphone_api.global.confanswer_received=!0);var i=o.indexOf("[PRESENCE,");if(i>=0){if(o=o.substring(i+10),(i=o.indexOf(","))>0){var a=webphone_api.common.Trim(o.substring(0,i)),r=webphone_api.common.Trim(o.substring(i));i=r.indexOf(","),i>0&&(r=r.substring(0,i)),r=webphone_api.common.Trim(r),webphone_api.common.SaveReceivedPresence2(a,r)}return}try{webphone_api.onChatCb(e,o,n,t)}catch(p){webphone_api.common.PutToDebugLogException(2,"There is an error in onChat() callback",p)}if(webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_oninchat,"inChat","",e,e,o),0==webphone_api.common.IsSDK()){if(!0===webphone_api.common.UsePresence2()&&"dnd"===webphone_api.common.GetParameter("presencestatus").toLowerCase()){webphone_api.common.PutToDebugLog(2,"EVENT, dont show incoming chat from: "+e+", because presence is DND");var l=webphone_api.common.GetContactNameFromNumber(e);webphone_api.common.PutNotifications2("1","",l+" - "+e,0),!1===webphone_api.common.IsSDK()&&webphone_api._message.SaveMissedIncomingMessage("chat",e,l,o)}if(3==webphone_api.common.GetParameterInt("chatsms",0)||0==webphone_api.common.GetParameterInt("textmessaging",-1)||1==webphone_api.common.GetParameterInt("textmessaging",-1))return void webphone_api.common.PutToDebugLog(4,"ERROR, OnMessageReceived message dropped because chat is disabled by user");if(webphone_api.global.isMessageStarted)!1===webphone_api.common.IsSDK()&&webphone_api._message.ShowIncomingMessage("chat",e,o);else if(webphone_api.global.checkIfInCall){var l=webphone_api.common.GetContactNameFromNumber(e);webphone_api.common.PutNotifications2("1","",l+" - "+e,0),!1===webphone_api.common.IsSDK()&&webphone_api._message.SaveMissedIncomingMessage("chat",e,l,o)}else webphone_api.global.intentmsg[0]="action=chat",webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+o,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}}catch(p){webphone_api.common.PutToDebugLogException(2,"notifications: OnMessageReceived",p)}}function r(e,o,n,t,i){var a='border="0"/>';try{if(e.length<1||o.length<1||n.length<1||t<1)return;if("2"!=o&&"4"!=o)return;var r=!1,l=t.split(a);if(webphone_api.common.isNull(l)||l.length<1)return;for(var p=l.length-1;p>=0;p--)if(!(webphone_api.common.isNull(l[p])||l[p].length<1)){var s=l[p].indexOf("<p>"),c=l[p].indexOf("</p>");if(!(s<0||c<s)){var u=l[p].substring(s+3,c);if(!(webphone_api.common.isNull(u)||u.length<1)&&webphone_api.common.Md5Hash(u)===n){if((s=l[p].indexOf('<img class="sent_status"'))>0){l[p]=l[p].substring(0,s);var g="spacer.png";"2"==o?g="icon_chat_status_green.png":"4"==o&&(g="icon_chat_status_black.png");var m='<img class="sent_status" src="'+webphone_api.common.GetElementSource()+"images/"+g+'" ';l[p]=l[p]+m,r=!0}break}}}if(!0===r){for(var b="",p=0;p<l.length;p++)if(!(webphone_api.common.isNull(l[p])||l[p].length<1)){var s=l[p].indexOf("<p>"),c=l[p].indexOf("</p>");s<0||c<s||(b=b+l[p]+a)}webphone_api.common.IsWindowsSoftphone()?webphone_api.common.ApiWinSaveFile(e,b,function(e){e&&webphone_api.common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1) WinApi"),!0===webphone_api.global.isMessageStarted&&webphone_api.global.mto===i&&webphone_api._message.LoadMessage()}):webphone_api.File.SaveFile(e,b,webphone_api.global.STORAGE_LOCAL,function(e){e||webphone_api.common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1)"),!0===webphone_api.global.isMessageStarted&&webphone_api.global.mto===i&&webphone_api._message.LoadMessage()})}}catch(h){webphone_api.common.PutToDebugLogException(2,"notifications: SaveChatReport",h)}}function l(e,o,n,t){try{if(!webphone_api.common.isNull(e)&&e.toLowerCase().indexOf("subscribe")>=0)return;if("Authenticated successfully"===e){if(!0===webphone_api.global.authenticated_displayed)return;webphone_api.global.authenticated_displayed=!0}if(webphone_api.global.flagWaitforautoprov)return;if(webphone_api.common.isNull(e))return;webphone_api.common.Trim(e).length<1&&(e="&nbsp"),e.indexOf(ye)<0&&"ERROR"!==o&&"WARNING"!==o&&(webphone_api.global.last_good_status=e);var i=webphone_api.common.GetTickCount();if(i-Ce<5e3)return;!webphone_api.common.isNull(De)&&De.length>0&&e.indexOf(De)>=0&&(Ce=i),e=e.replace("DISPLAY",""),e.toLowerCase().indexOf("demo")>=0&&(Ge=i,Le=e,Oe=o),i-Ge<15e3?(e=Le,o=Oe):(Le="",Oe="");var a=L;if((webphone_api.common.isNull(o)||o.length<1)&&(o="EVENT"),"ERROR"===o&&(a="#FF0000"),"WARNING"===o&&(a="#D28F00"),e.toLowerCase().indexOf("success")>=0&&(a="#4EC200"),1===n?webphone_api.common.isNull(Re)&&(Re=document.getElementById("status_message")):(webphone_api.common.isNull(Te)&&(Te=document.getElementById("status_dialpad")),webphone_api.common.isNull(Ne)&&(Ne=document.getElementById("status_contactslist")),webphone_api.common.isNull(Se)&&(Se=document.getElementById("status_callhistorylist")),webphone_api.common.isNull(Ie)&&(Ie=document.getElementById("status_call")),webphone_api.common.isNull(Re)&&(Re=document.getElementById("status_message"))),!0===webphone_api.global.last_presence_enabled&&!0===webphone_api.global.pres_unreg_called){var r=e.toLowerCase();(r.indexOf("unregister")>=0||r.indexOf("register failed")>=0||r.indexOf("disconnected")>=0)&&(e="Offline")}var l=webphone_api.common.Translate(e);if(webphone_api.common.isNull(Te)||-1!==t||(Te.innerHTML=l,Te.style.color=a),webphone_api.common.isNull(Ne)||-1!==t||(Ne.innerHTML=l,Ne.style.color=a),webphone_api.common.isNull(Se)||-1!==t||(Se.innerHTML=l,Se.style.color=a),!webphone_api.common.isNull(Ie)&&l.indexOf("uthenticated successfully")<1){var p=webphone_api.common.StrToIntDef(webphone_api.global.aline,-1),s="";if("undefined"!=typeof webphone_api.global.callPageStatusCachePerLine[p]&&null!==webphone_api.global.callPageStatusCachePerLine[p]&&webphone_api.global.callPageStatusCachePerLine[p].length>=2&&(s=webphone_api.global.callPageStatusCachePerLine[p][0],webphone_api.common.isNull(s)&&(s="")),t>0||s.length>0&&p>0){webphone_api.common.isNull(webphone_api.global.rating)||!webphone_api.global.rating.length||"STATUS"!==o&&"EVENT"!==o||(l+=webphone_api.global.rating);try{var p=webphone_api.common.StrToIntDef(webphone_api.global.aline,-1);if(s.length>0){var c=webphone_api.global.callPageStatusCachePerLine[p][1];s=webphone_api.common.Translate(s),Ie.innerHTML=s,Ie.style.color=c}else Ie.innerHTML=l,Ie.style.color=a}catch(g){webphone_api.common.PutToDebugLog(2,"ERROR, DisplayStatus per line on call page"),Ie.innerHTML=l,Ie.style.color=a}}}!webphone_api.common.isNull(Re)&&t>0&&(Re.innerHTML=l,Re.style.color=a);var u='<span style="color: '+a+';">'+l+"</span>";try{webphone_api.RecDisplayableNotifications(u)}catch(m){webphone_api.common.PutToDebugLogException(2,"notifications: DisplayStatus RecDisplayableNotifications",m)}}catch(m){webphone_api.common.PutToDebugLogException(2,"notifications: DisplayStatus",m)}}function p(){try{return webphone_api.common.isNull(d)&&(d="STATUS,-1,Ready."),d}catch(e){webphone_api.common.PutToDebugLogException(2,"notifications: GetStatus",e)}return""}function s(e){try{if(webphone_api.common.isNull(e)||e.lenght<1)return!0;var o=[];o.push("C"),o.push("a"),o.push("l"),o.push("l"),o.push("-"),o.push("I"),o.push("D"),o.push(":");var n=o.join(""),t=e.indexOf(n);if(t>0){var e=webphone_api.common.Trim(e.substring(t+8));e.indexOf("\r\n")>0&&(e=webphone_api.common.Trim(e.substring(0,e.indexOf("\r\n"))))}var i=0;e=e.toString();for(var a=0;a<e.length;a++)i+=e.charCodeAt(a);return i%webphone_api.global.testmessagevalidity!=0}catch(r){webphone_api.common.PutToDebugLogException(2,"notifications: IsGoodCRC",r)}return!0}function c(e,o){try{if(webphone_api.common.isNull(e)||e.length<4||e.indexOf(",")<0)return o;var n=e.split(",");if(webphone_api.common.isNull(n)||n.length<2)return o;if(!webphone_api.common.isNull(n[1])||webphone_api.common.IsNumber(n[1])){var t=webphone_api.common.StrToInt(n[1]);if(t>-3&&t<100)return t}}catch(i){webphone_api.common.PutToDebugLogException(2,"notifications: GetLineFromNot",i)}return o}function u(){try{ie>0&&(webphone_api.$(document).mousemove(function(e){xe=webphone_api.common.GetTickCount()}),webphone_api.$(document).keypress(function(e){xe=webphone_api.common.GetTickCount()}),webphone_api.$(document).scroll(function(e){xe=webphone_api.common.GetTickCount()}),webphone_api.common.isNull(ae)||clearInterval(ae),ae=setInterval(function(){try{webphone_api.common.GetTickCount()-xe<2e3&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[USERINTERACTION]_NOTIFICATION")}catch(e){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications inner AndroidWebphoneJsInterface userinteraction",e)}},500))}catch(e){webphone_api.common.PutToDebugLogException(2,"notifications: HandleAndroidUserInteraction",e)}}var g,m,b,h,d,_=!1,w=!1,f="",v=0,P=0,E=0,T=!1,N=0,S=0,I=0,R=100,G=!1,O=0,L="#ffffff",C=-1,D=0,y=18e4,x=0,A=36e5,k=0,U=0,V=0,W=0,M=!1,F=!1,H=0,B=null,$=null,j="",q="",z="",K="",J="",X="",Y="",Q=-1,Z=null,ee=!1,oe=webphone_api.stringres.get("status_startingengine"),ne=webphone_api.stringres.get("status_enginestarted"),te="",ie=-1,ae=null,re=0,le=35,pe="",se=-1,ce="",ue="",ge=-1,me=6e3,be=24e3,he=!0,de=!0,_e=!1,we=0,fe=0,ve="",Pe=0,Ee="",Te=null,Ne=null,Se=null,Ie=null,Re=null,Ge=0,Oe="",Le="",Ce=0,De=webphone_api.stringres.get("disc_reason"),ye=webphone_api.stringres.get("ns_engine_unreachable"),xe=0;return{ProcessNotifications:o,GetStatus:p,AddToCallLog:i,SetCallStartTime:n,IsGoodCRC:s,OnMessageReceived:a}}();